import{j as t,n as P,X as le,M as Cr,L as Pt,a as kr,U as Bt,P as Ae,S as ct,b as Er,c as Or,C as Ut,A as Tr,d as Ir,e as Pe,F as Mr,f as Ht,g as lt,B as Rr,T as Dr,h as Le,i as dt,k as ut,l as Fr,m as mt,o as Ar,p as Lr,q as $r,r as ht,s as Vt,t as zr,u as Wr,v as qr,w as _r,x as Br,y as Ur,z as Hr,D as St,E as Vr,G as Yr,I as Gr}from"./ui-UkQYLnQf.js";import{a as Qr,r as g,N as Yt,O as Gt,b as Ct,R as Re,u as Qt,c as Xr,H as Kr,d as Jr,e as he}from"./vendor-DkOrtBC1.js";import{i as Zr,g as es,s as ts,a as rs,b as ss,o as ns,r as O,c as te,p as $e,u as Ve,d as ft,e as H,f as ze,q as gt,h as pt,j as xt}from"./firebase-CuCkz2wO.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();var Xt,kt=Qr;Xt=kt.createRoot,kt.hydrateRoot;const as=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_DATABASE_URL","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],os={apiKey:"demo-mode-key",authDomain:"demo-mode.firebaseapp.com",databaseURL:"https://demo-mode.firebaseio.com",projectId:"demo-mode",storageBucket:"demo-mode.appspot.com",messagingSenderId:"000000000000",appId:"demo-mode-app-id"},is={BASE_URL:"/ordenes/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyBopcfbHLrWQZOsgitRYWk5h26ipYbD-hE",VITE_FIREBASE_APP_ID:"1:766340976237:web:e7123eedb37568a2f9b964",VITE_FIREBASE_AUTH_DOMAIN:"nrd-ordenes-prod.firebaseapp.com",VITE_FIREBASE_DATABASE_URL:"https://nrd-ordenes-prod-default-rtdb.firebaseio.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"766340976237",VITE_FIREBASE_PROJECT_ID:"nrd-ordenes-prod",VITE_FIREBASE_STORAGE_BUCKET:"nrd-ordenes-prod.firebasestorage.app"};function cs(){const e=as.filter(s=>!is[s]);return e.length>0?{isValid:!1,missingVars:e,config:null}:{isValid:!0,missingVars:[],config:{apiKey:"AIzaSyBopcfbHLrWQZOsgitRYWk5h26ipYbD-hE",authDomain:"nrd-ordenes-prod.firebaseapp.com",databaseURL:"https://nrd-ordenes-prod-default-rtdb.firebaseio.com",projectId:"nrd-ordenes-prod",storageBucket:"nrd-ordenes-prod.firebasestorage.app",messagingSenderId:"766340976237",appId:"1:766340976237:web:e7123eedb37568a2f9b964"}}}function ls(){return{...os}}const De=cs(),ds=De.isValid?De.config:ls(),Kt=Zr(ds);De.isValid?console.info("Firebase initialized in production mode"):console.warn("Firebase initialized in demo mode. The following environment variables are missing:",De.missingVars);const _e=!De.isValid,bt=es(Kt);async function us(e,r){try{return(await ts(bt,e,r)).user}catch(s){throw console.error("Authentication error:",s),new Error("Error de autenticación: credenciales inválidas")}}async function ms(){try{await rs(bt)}catch(e){throw console.error("Sign out error:",e),new Error("Error al cerrar sesión")}}const T=ss(Kt),Jt=g.createContext(void 0);function hs({children:e}){const[r,s]=g.useState(null),[n,a]=g.useState(!0),[o,i]=g.useState(null);g.useEffect(()=>{try{return ns(bt,m=>{s(m),a(!1)})}catch(d){console.error("Auth initialization error:",d),i(d instanceof Error?d:new Error("Error de autenticación")),a(!1)}},[]);const c=async(d,m)=>{if(_e){P.error("Autenticación no disponible en modo demo");return}try{await us(d,m),P.success("¡Bienvenido!")}catch(h){throw console.error("Sign in error:",h),P.error("Credenciales inválidas"),h}},l=async()=>{if(_e){P.error("Cierre de sesión no disponible en modo demo");return}try{await ms(),P.success("Sesión cerrada")}catch(d){throw console.error("Sign out error:",d),P.error("Error al cerrar sesión"),d}};return o?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-4",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full",children:[t.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"Error de Inicialización"}),t.jsx("p",{className:"text-gray-600",children:"No se pudo inicializar la aplicación. Por favor, verifique la configuración e intente nuevamente."}),_e&&t.jsx("p",{className:"mt-4 text-sm text-amber-600",children:"Ejecutando en modo demo. Algunas funciones estarán limitadas."})]})}):t.jsx(Jt.Provider,{value:{user:r,loading:n,signIn:c,signOut:l,isDemoMode:_e},children:!n&&e})}function yt(){const e=g.useContext(Jt);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e}function fs(){const{user:e}=yt();return e?t.jsx(Gt,{}):t.jsx(Yt,{to:"/login",replace:!0})}function B(e){const r=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&r==="[object Date]"?new e.constructor(+e):typeof e=="number"||r==="[object Number]"||typeof e=="string"||r==="[object String]"?new Date(e):new Date(NaN)}function ce(e,r){return e instanceof Date?new e.constructor(r):new Date(r)}function gs(e,r){const s=B(e);return isNaN(r)?ce(e,NaN):(s.setDate(s.getDate()+r),s)}const Zt=6048e5,ps=864e5;let xs={};function Ye(){return xs}function Fe(e,r){var c,l,d,m;const s=Ye(),n=(r==null?void 0:r.weekStartsOn)??((l=(c=r==null?void 0:r.locale)==null?void 0:c.options)==null?void 0:l.weekStartsOn)??s.weekStartsOn??((m=(d=s.locale)==null?void 0:d.options)==null?void 0:m.weekStartsOn)??0,a=B(e),o=a.getDay(),i=(o<n?7:0)+o-n;return a.setDate(a.getDate()-i),a.setHours(0,0,0,0),a}function He(e){return Fe(e,{weekStartsOn:1})}function er(e){const r=B(e),s=r.getFullYear(),n=ce(e,0);n.setFullYear(s+1,0,4),n.setHours(0,0,0,0);const a=He(n),o=ce(e,0);o.setFullYear(s,0,4),o.setHours(0,0,0,0);const i=He(o);return r.getTime()>=a.getTime()?s+1:r.getTime()>=i.getTime()?s:s-1}function st(e){const r=B(e);return r.setHours(0,0,0,0),r}function Et(e){const r=B(e),s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return s.setUTCFullYear(r.getFullYear()),+e-+s}function bs(e,r){const s=st(e),n=st(r),a=+s-Et(s),o=+n-Et(n);return Math.round((a-o)/ps)}function ys(e){const r=er(e),s=ce(e,0);return s.setFullYear(r,0,4),s.setHours(0,0,0,0),He(s)}function ws(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function vs(e){if(!ws(e)&&typeof e!="number")return!1;const r=B(e);return!isNaN(Number(r))}function js(e){const r=B(e);return r.setHours(23,59,59,999),r}function Ns(e){const r=B(e),s=ce(e,0);return s.setFullYear(r.getFullYear(),0,1),s.setHours(0,0,0,0),s}const Ps={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ss=(e,r,s)=>{let n;const a=Ps[e];return typeof a=="string"?n=a:r===1?n=a.one:n=a.other.replace("{{count}}",r.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+n:n+" ago":n};function ve(e){return(r={})=>{const s=r.width?String(r.width):e.defaultWidth;return e.formats[s]||e.formats[e.defaultWidth]}}const Cs={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},ks={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Es={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Os={date:ve({formats:Cs,defaultWidth:"full"}),time:ve({formats:ks,defaultWidth:"full"}),dateTime:ve({formats:Es,defaultWidth:"full"})},Ts={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Is=(e,r,s,n)=>Ts[e];function V(e){return(r,s)=>{const n=s!=null&&s.context?String(s.context):"standalone";let a;if(n==="formatting"&&e.formattingValues){const i=e.defaultFormattingWidth||e.defaultWidth,c=s!=null&&s.width?String(s.width):i;a=e.formattingValues[c]||e.formattingValues[i]}else{const i=e.defaultWidth,c=s!=null&&s.width?String(s.width):e.defaultWidth;a=e.values[c]||e.values[i]}const o=e.argumentCallback?e.argumentCallback(r):r;return a[o]}}const Ms={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Rs={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Ds={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Fs={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},As={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Ls={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},$s=(e,r)=>{const s=Number(e),n=s%100;if(n>20||n<10)switch(n%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},zs={ordinalNumber:$s,era:V({values:Ms,defaultWidth:"wide"}),quarter:V({values:Rs,defaultWidth:"wide",argumentCallback:e=>e-1}),month:V({values:Ds,defaultWidth:"wide"}),day:V({values:Fs,defaultWidth:"wide"}),dayPeriod:V({values:As,defaultWidth:"wide",formattingValues:Ls,defaultFormattingWidth:"wide"})};function Y(e){return(r,s={})=>{const n=s.width,a=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],o=r.match(a);if(!o)return null;const i=o[0],c=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(c)?qs(c,h=>h.test(i)):Ws(c,h=>h.test(i));let d;d=e.valueCallback?e.valueCallback(l):l,d=s.valueCallback?s.valueCallback(d):d;const m=r.slice(i.length);return{value:d,rest:m}}}function Ws(e,r){for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&r(e[s]))return s}function qs(e,r){for(let s=0;s<e.length;s++)if(r(e[s]))return s}function tr(e){return(r,s={})=>{const n=r.match(e.matchPattern);if(!n)return null;const a=n[0],o=r.match(e.parsePattern);if(!o)return null;let i=e.valueCallback?e.valueCallback(o[0]):o[0];i=s.valueCallback?s.valueCallback(i):i;const c=r.slice(a.length);return{value:i,rest:c}}}const _s=/^(\d+)(th|st|nd|rd)?/i,Bs=/\d+/i,Us={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Hs={any:[/^b/i,/^(a|c)/i]},Vs={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Ys={any:[/1/i,/2/i,/3/i,/4/i]},Gs={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Qs={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Xs={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ks={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Js={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Zs={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},en={ordinalNumber:tr({matchPattern:_s,parsePattern:Bs,valueCallback:e=>parseInt(e,10)}),era:Y({matchPatterns:Us,defaultMatchWidth:"wide",parsePatterns:Hs,defaultParseWidth:"any"}),quarter:Y({matchPatterns:Vs,defaultMatchWidth:"wide",parsePatterns:Ys,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Y({matchPatterns:Gs,defaultMatchWidth:"wide",parsePatterns:Qs,defaultParseWidth:"any"}),day:Y({matchPatterns:Xs,defaultMatchWidth:"wide",parsePatterns:Ks,defaultParseWidth:"any"}),dayPeriod:Y({matchPatterns:Js,defaultMatchWidth:"any",parsePatterns:Zs,defaultParseWidth:"any"})},tn={code:"en-US",formatDistance:Ss,formatLong:Os,formatRelative:Is,localize:zs,match:en,options:{weekStartsOn:0,firstWeekContainsDate:1}};function rn(e){const r=B(e);return bs(r,Ns(r))+1}function sn(e){const r=B(e),s=+He(r)-+ys(r);return Math.round(s/Zt)+1}function rr(e,r){var m,h,u,f;const s=B(e),n=s.getFullYear(),a=Ye(),o=(r==null?void 0:r.firstWeekContainsDate)??((h=(m=r==null?void 0:r.locale)==null?void 0:m.options)==null?void 0:h.firstWeekContainsDate)??a.firstWeekContainsDate??((f=(u=a.locale)==null?void 0:u.options)==null?void 0:f.firstWeekContainsDate)??1,i=ce(e,0);i.setFullYear(n+1,0,o),i.setHours(0,0,0,0);const c=Fe(i,r),l=ce(e,0);l.setFullYear(n,0,o),l.setHours(0,0,0,0);const d=Fe(l,r);return s.getTime()>=c.getTime()?n+1:s.getTime()>=d.getTime()?n:n-1}function nn(e,r){var c,l,d,m;const s=Ye(),n=(r==null?void 0:r.firstWeekContainsDate)??((l=(c=r==null?void 0:r.locale)==null?void 0:c.options)==null?void 0:l.firstWeekContainsDate)??s.firstWeekContainsDate??((m=(d=s.locale)==null?void 0:d.options)==null?void 0:m.firstWeekContainsDate)??1,a=rr(e,r),o=ce(e,0);return o.setFullYear(a,0,n),o.setHours(0,0,0,0),Fe(o,r)}function an(e,r){const s=B(e),n=+Fe(s,r)-+nn(s,r);return Math.round(n/Zt)+1}function M(e,r){const s=e<0?"-":"",n=Math.abs(e).toString().padStart(r,"0");return s+n}const ae={y(e,r){const s=e.getFullYear(),n=s>0?s:1-s;return M(r==="yy"?n%100:n,r.length)},M(e,r){const s=e.getMonth();return r==="M"?String(s+1):M(s+1,2)},d(e,r){return M(e.getDate(),r.length)},a(e,r){const s=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(e,r){return M(e.getHours()%12||12,r.length)},H(e,r){return M(e.getHours(),r.length)},m(e,r){return M(e.getMinutes(),r.length)},s(e,r){return M(e.getSeconds(),r.length)},S(e,r){const s=r.length,n=e.getMilliseconds(),a=Math.trunc(n*Math.pow(10,s-3));return M(a,r.length)}},ye={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ot={G:function(e,r,s){const n=e.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return s.era(n,{width:"abbreviated"});case"GGGGG":return s.era(n,{width:"narrow"});case"GGGG":default:return s.era(n,{width:"wide"})}},y:function(e,r,s){if(r==="yo"){const n=e.getFullYear(),a=n>0?n:1-n;return s.ordinalNumber(a,{unit:"year"})}return ae.y(e,r)},Y:function(e,r,s,n){const a=rr(e,n),o=a>0?a:1-a;if(r==="YY"){const i=o%100;return M(i,2)}return r==="Yo"?s.ordinalNumber(o,{unit:"year"}):M(o,r.length)},R:function(e,r){const s=er(e);return M(s,r.length)},u:function(e,r){const s=e.getFullYear();return M(s,r.length)},Q:function(e,r,s){const n=Math.ceil((e.getMonth()+1)/3);switch(r){case"Q":return String(n);case"QQ":return M(n,2);case"Qo":return s.ordinalNumber(n,{unit:"quarter"});case"QQQ":return s.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,r,s){const n=Math.ceil((e.getMonth()+1)/3);switch(r){case"q":return String(n);case"qq":return M(n,2);case"qo":return s.ordinalNumber(n,{unit:"quarter"});case"qqq":return s.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,r,s){const n=e.getMonth();switch(r){case"M":case"MM":return ae.M(e,r);case"Mo":return s.ordinalNumber(n+1,{unit:"month"});case"MMM":return s.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(n,{width:"wide",context:"formatting"})}},L:function(e,r,s){const n=e.getMonth();switch(r){case"L":return String(n+1);case"LL":return M(n+1,2);case"Lo":return s.ordinalNumber(n+1,{unit:"month"});case"LLL":return s.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(n,{width:"wide",context:"standalone"})}},w:function(e,r,s,n){const a=an(e,n);return r==="wo"?s.ordinalNumber(a,{unit:"week"}):M(a,r.length)},I:function(e,r,s){const n=sn(e);return r==="Io"?s.ordinalNumber(n,{unit:"week"}):M(n,r.length)},d:function(e,r,s){return r==="do"?s.ordinalNumber(e.getDate(),{unit:"date"}):ae.d(e,r)},D:function(e,r,s){const n=rn(e);return r==="Do"?s.ordinalNumber(n,{unit:"dayOfYear"}):M(n,r.length)},E:function(e,r,s){const n=e.getDay();switch(r){case"E":case"EE":case"EEE":return s.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(n,{width:"short",context:"formatting"});case"EEEE":default:return s.day(n,{width:"wide",context:"formatting"})}},e:function(e,r,s,n){const a=e.getDay(),o=(a-n.weekStartsOn+8)%7||7;switch(r){case"e":return String(o);case"ee":return M(o,2);case"eo":return s.ordinalNumber(o,{unit:"day"});case"eee":return s.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"});case"eeee":default:return s.day(a,{width:"wide",context:"formatting"})}},c:function(e,r,s,n){const a=e.getDay(),o=(a-n.weekStartsOn+8)%7||7;switch(r){case"c":return String(o);case"cc":return M(o,r.length);case"co":return s.ordinalNumber(o,{unit:"day"});case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"});case"cccc":default:return s.day(a,{width:"wide",context:"standalone"})}},i:function(e,r,s){const n=e.getDay(),a=n===0?7:n;switch(r){case"i":return String(a);case"ii":return M(a,r.length);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return s.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(n,{width:"short",context:"formatting"});case"iiii":default:return s.day(n,{width:"wide",context:"formatting"})}},a:function(e,r,s){const a=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,r,s){const n=e.getHours();let a;switch(n===12?a=ye.noon:n===0?a=ye.midnight:a=n/12>=1?"pm":"am",r){case"b":case"bb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,r,s){const n=e.getHours();let a;switch(n>=17?a=ye.evening:n>=12?a=ye.afternoon:n>=4?a=ye.morning:a=ye.night,r){case"B":case"BB":case"BBB":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,r,s){if(r==="ho"){let n=e.getHours()%12;return n===0&&(n=12),s.ordinalNumber(n,{unit:"hour"})}return ae.h(e,r)},H:function(e,r,s){return r==="Ho"?s.ordinalNumber(e.getHours(),{unit:"hour"}):ae.H(e,r)},K:function(e,r,s){const n=e.getHours()%12;return r==="Ko"?s.ordinalNumber(n,{unit:"hour"}):M(n,r.length)},k:function(e,r,s){let n=e.getHours();return n===0&&(n=24),r==="ko"?s.ordinalNumber(n,{unit:"hour"}):M(n,r.length)},m:function(e,r,s){return r==="mo"?s.ordinalNumber(e.getMinutes(),{unit:"minute"}):ae.m(e,r)},s:function(e,r,s){return r==="so"?s.ordinalNumber(e.getSeconds(),{unit:"second"}):ae.s(e,r)},S:function(e,r){return ae.S(e,r)},X:function(e,r,s){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(r){case"X":return It(n);case"XXXX":case"XX":return fe(n);case"XXXXX":case"XXX":default:return fe(n,":")}},x:function(e,r,s){const n=e.getTimezoneOffset();switch(r){case"x":return It(n);case"xxxx":case"xx":return fe(n);case"xxxxx":case"xxx":default:return fe(n,":")}},O:function(e,r,s){const n=e.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Tt(n,":");case"OOOO":default:return"GMT"+fe(n,":")}},z:function(e,r,s){const n=e.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Tt(n,":");case"zzzz":default:return"GMT"+fe(n,":")}},t:function(e,r,s){const n=Math.trunc(e.getTime()/1e3);return M(n,r.length)},T:function(e,r,s){const n=e.getTime();return M(n,r.length)}};function Tt(e,r=""){const s=e>0?"-":"+",n=Math.abs(e),a=Math.trunc(n/60),o=n%60;return o===0?s+String(a):s+String(a)+r+M(o,2)}function It(e,r){return e%60===0?(e>0?"-":"+")+M(Math.abs(e)/60,2):fe(e,r)}function fe(e,r=""){const s=e>0?"-":"+",n=Math.abs(e),a=M(Math.trunc(n/60),2),o=M(n%60,2);return s+a+r+o}const Mt=(e,r)=>{switch(e){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},sr=(e,r)=>{switch(e){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},on=(e,r)=>{const s=e.match(/(P+)(p+)?/)||[],n=s[1],a=s[2];if(!a)return Mt(e,r);let o;switch(n){case"P":o=r.dateTime({width:"short"});break;case"PP":o=r.dateTime({width:"medium"});break;case"PPP":o=r.dateTime({width:"long"});break;case"PPPP":default:o=r.dateTime({width:"full"});break}return o.replace("{{date}}",Mt(n,r)).replace("{{time}}",sr(a,r))},cn={p:sr,P:on},ln=/^D+$/,dn=/^Y+$/,un=["D","DD","YY","YYYY"];function mn(e){return ln.test(e)}function hn(e){return dn.test(e)}function fn(e,r,s){const n=gn(e,r,s);if(console.warn(n),un.includes(e))throw new RangeError(n)}function gn(e,r,s){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${r}\`) for formatting ${n} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const pn=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,xn=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,bn=/^'([^]*?)'?$/,yn=/''/g,wn=/[a-zA-Z]/;function Q(e,r,s){var m,h,u,f,x,b,p,y;const n=Ye(),a=(s==null?void 0:s.locale)??n.locale??tn,o=(s==null?void 0:s.firstWeekContainsDate)??((h=(m=s==null?void 0:s.locale)==null?void 0:m.options)==null?void 0:h.firstWeekContainsDate)??n.firstWeekContainsDate??((f=(u=n.locale)==null?void 0:u.options)==null?void 0:f.firstWeekContainsDate)??1,i=(s==null?void 0:s.weekStartsOn)??((b=(x=s==null?void 0:s.locale)==null?void 0:x.options)==null?void 0:b.weekStartsOn)??n.weekStartsOn??((y=(p=n.locale)==null?void 0:p.options)==null?void 0:y.weekStartsOn)??0,c=B(e);if(!vs(c))throw new RangeError("Invalid time value");let l=r.match(xn).map(w=>{const v=w[0];if(v==="p"||v==="P"){const j=cn[v];return j(w,a.formatLong)}return w}).join("").match(pn).map(w=>{if(w==="''")return{isToken:!1,value:"'"};const v=w[0];if(v==="'")return{isToken:!1,value:vn(w)};if(Ot[v])return{isToken:!0,value:w};if(v.match(wn))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:w}});a.localize.preprocessor&&(l=a.localize.preprocessor(c,l));const d={firstWeekContainsDate:o,weekStartsOn:i,locale:a};return l.map(w=>{if(!w.isToken)return w.value;const v=w.value;(!(s!=null&&s.useAdditionalWeekYearTokens)&&hn(v)||!(s!=null&&s.useAdditionalDayOfYearTokens)&&mn(v))&&fn(v,r,String(e));const j=Ot[v[0]];return j(c,v,a.localize,d)}).join("")}function vn(e){const r=e.match(bn);return r?r[1].replace(yn,"'"):e}function Rt(e,r){return gs(e,-r)}const jn={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 día",other:"{{count}} días"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 año",other:"alrededor de {{count}} años"},xYears:{one:"1 año",other:"{{count}} años"},overXYears:{one:"más de 1 año",other:"más de {{count}} años"},almostXYears:{one:"casi 1 año",other:"casi {{count}} años"}},Nn=(e,r,s)=>{let n;const a=jn[e];return typeof a=="string"?n=a:r===1?n=a.one:n=a.other.replace("{{count}}",r.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"en "+n:"hace "+n:n},Pn={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},Sn={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Cn={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},kn={date:ve({formats:Pn,defaultWidth:"full"}),time:ve({formats:Sn,defaultWidth:"full"}),dateTime:ve({formats:Cn,defaultWidth:"full"})},En={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'mañana a la' p",nextWeek:"eeee 'a la' p",other:"P"},On={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'mañana a las' p",nextWeek:"eeee 'a las' p",other:"P"},Tn=(e,r,s,n)=>r.getHours()!==1?On[e]:En[e],In={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","después de cristo"]},Mn={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},Rn={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},Dn={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sá"],abbreviated:["dom","lun","mar","mié","jue","vie","sáb"],wide:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]},Fn={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"}},An={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},Ln=(e,r)=>Number(e)+"º",$n={ordinalNumber:Ln,era:V({values:In,defaultWidth:"wide"}),quarter:V({values:Mn,defaultWidth:"wide",argumentCallback:e=>Number(e)-1}),month:V({values:Rn,defaultWidth:"wide"}),day:V({values:Dn,defaultWidth:"wide"}),dayPeriod:V({values:Fn,defaultWidth:"wide",formattingValues:An,defaultFormattingWidth:"wide"})},zn=/^(\d+)(º)?/i,Wn=/\d+/i,qn={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},_n={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},Bn={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},Un={any:[/1/i,/2/i,/3/i,/4/i]},Hn={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},Vn={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},Yn={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},Gn={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},Qn={narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},Xn={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},Kn={ordinalNumber:tr({matchPattern:zn,parsePattern:Wn,valueCallback:function(e){return parseInt(e,10)}}),era:Y({matchPatterns:qn,defaultMatchWidth:"wide",parsePatterns:_n,defaultParseWidth:"any"}),quarter:Y({matchPatterns:Bn,defaultMatchWidth:"wide",parsePatterns:Un,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Y({matchPatterns:Hn,defaultMatchWidth:"wide",parsePatterns:Vn,defaultParseWidth:"any"}),day:Y({matchPatterns:Yn,defaultMatchWidth:"wide",parsePatterns:Gn,defaultParseWidth:"any"}),dayPeriod:Y({matchPatterns:Qn,defaultMatchWidth:"any",parsePatterns:Xn,defaultParseWidth:"any"})},re={code:"es",formatDistance:Nn,formatLong:kn,formatRelative:Tn,localize:$n,match:Kn,options:{weekStartsOn:1,firstWeekContainsDate:1}};function K(e){return new Intl.NumberFormat("es-UY",{style:"currency",currency:"UYU"}).format(e)}function nr(e){const r=e.replace(/\D/g,""),s=r.startsWith("598")?r.slice(3):r;return s.length>=8?`+598 ${[s.slice(0,2),s.slice(2,5),s.slice(5)].join(" ")}`:`+598 ${s}`}function Dt(e){const r=e.replace(/\D/g,""),s=r.startsWith("598")?r.slice(3):r;return/^[0-9]{8,9}$/.test(s)}function ar(e,r){const s=e.replace(/\D/g,"");return`https://wa.me/${s.startsWith("598")?s:`598${s}`}?text=${encodeURIComponent(r)}`}function or(e){var r,s,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(r=0;r<a;r++)e[r]&&(s=or(e[r]))&&(n&&(n+=" "),n+=s)}else for(s in e)e[s]&&(n&&(n+=" "),n+=s);return n}function Jn(){for(var e,r,s=0,n="",a=arguments.length;s<a;s++)(e=arguments[s])&&(r=or(e))&&(n&&(n+=" "),n+=r);return n}const wt="-",Zn=e=>{const r=ta(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:i=>{const c=i.split(wt);return c[0]===""&&c.length!==1&&c.shift(),ir(c,r)||ea(i)},getConflictingClassGroupIds:(i,c)=>{const l=s[i]||[];return c&&n[i]?[...l,...n[i]]:l}}},ir=(e,r)=>{var i;if(e.length===0)return r.classGroupId;const s=e[0],n=r.nextPart.get(s),a=n?ir(e.slice(1),n):void 0;if(a)return a;if(r.validators.length===0)return;const o=e.join(wt);return(i=r.validators.find(({validator:c})=>c(o)))==null?void 0:i.classGroupId},Ft=/^\[(.+)\]$/,ea=e=>{if(Ft.test(e)){const r=Ft.exec(e)[1],s=r==null?void 0:r.substring(0,r.indexOf(":"));if(s)return"arbitrary.."+s}},ta=e=>{const{theme:r,prefix:s}=e,n={nextPart:new Map,validators:[]};return sa(Object.entries(e.classGroups),s).forEach(([o,i])=>{nt(i,n,o,r)}),n},nt=(e,r,s,n)=>{e.forEach(a=>{if(typeof a=="string"){const o=a===""?r:At(r,a);o.classGroupId=s;return}if(typeof a=="function"){if(ra(a)){nt(a(n),r,s,n);return}r.validators.push({validator:a,classGroupId:s});return}Object.entries(a).forEach(([o,i])=>{nt(i,At(r,o),s,n)})})},At=(e,r)=>{let s=e;return r.split(wt).forEach(n=>{s.nextPart.has(n)||s.nextPart.set(n,{nextPart:new Map,validators:[]}),s=s.nextPart.get(n)}),s},ra=e=>e.isThemeGetter,sa=(e,r)=>r?e.map(([s,n])=>{const a=n.map(o=>typeof o=="string"?r+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([i,c])=>[r+i,c])):o);return[s,a]}):e,na=e=>{if(e<1)return{get:()=>{},set:()=>{}};let r=0,s=new Map,n=new Map;const a=(o,i)=>{s.set(o,i),r++,r>e&&(r=0,n=s,s=new Map)};return{get(o){let i=s.get(o);if(i!==void 0)return i;if((i=n.get(o))!==void 0)return a(o,i),i},set(o,i){s.has(o)?s.set(o,i):a(o,i)}}},cr="!",aa=e=>{const{separator:r,experimentalParseClassName:s}=e,n=r.length===1,a=r[0],o=r.length,i=c=>{const l=[];let d=0,m=0,h;for(let p=0;p<c.length;p++){let y=c[p];if(d===0){if(y===a&&(n||c.slice(p,p+o)===r)){l.push(c.slice(m,p)),m=p+o;continue}if(y==="/"){h=p;continue}}y==="["?d++:y==="]"&&d--}const u=l.length===0?c:c.substring(m),f=u.startsWith(cr),x=f?u.substring(1):u,b=h&&h>m?h-m:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:x,maybePostfixModifierPosition:b}};return s?c=>s({className:c,parseClassName:i}):i},oa=e=>{if(e.length<=1)return e;const r=[];let s=[];return e.forEach(n=>{n[0]==="["?(r.push(...s.sort(),n),s=[]):s.push(n)}),r.push(...s.sort()),r},ia=e=>({cache:na(e.cacheSize),parseClassName:aa(e),...Zn(e)}),ca=/\s+/,la=(e,r)=>{const{parseClassName:s,getClassGroupId:n,getConflictingClassGroupIds:a}=r,o=[],i=e.trim().split(ca);let c="";for(let l=i.length-1;l>=0;l-=1){const d=i[l],{modifiers:m,hasImportantModifier:h,baseClassName:u,maybePostfixModifierPosition:f}=s(d);let x=!!f,b=n(x?u.substring(0,f):u);if(!b){if(!x){c=d+(c.length>0?" "+c:c);continue}if(b=n(u),!b){c=d+(c.length>0?" "+c:c);continue}x=!1}const p=oa(m).join(":"),y=h?p+cr:p,w=y+b;if(o.includes(w))continue;o.push(w);const v=a(b,x);for(let j=0;j<v.length;++j){const I=v[j];o.push(y+I)}c=d+(c.length>0?" "+c:c)}return c};function da(){let e=0,r,s,n="";for(;e<arguments.length;)(r=arguments[e++])&&(s=lr(r))&&(n&&(n+=" "),n+=s);return n}const lr=e=>{if(typeof e=="string")return e;let r,s="";for(let n=0;n<e.length;n++)e[n]&&(r=lr(e[n]))&&(s&&(s+=" "),s+=r);return s};function ua(e,...r){let s,n,a,o=i;function i(l){const d=r.reduce((m,h)=>h(m),e());return s=ia(d),n=s.cache.get,a=s.cache.set,o=c,c(l)}function c(l){const d=n(l);if(d)return d;const m=la(l,s);return a(l,m),m}return function(){return o(da.apply(null,arguments))}}const F=e=>{const r=s=>s[e]||[];return r.isThemeGetter=!0,r},dr=/^\[(?:([a-z-]+):)?(.+)\]$/i,ma=/^\d+\/\d+$/,ha=new Set(["px","full","screen"]),fa=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,ga=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,pa=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,xa=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,ba=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Z=e=>je(e)||ha.has(e)||ma.test(e),oe=e=>Se(e,"length",Ca),je=e=>!!e&&!Number.isNaN(Number(e)),Je=e=>Se(e,"number",je),Ee=e=>!!e&&Number.isInteger(Number(e)),ya=e=>e.endsWith("%")&&je(e.slice(0,-1)),C=e=>dr.test(e),ie=e=>fa.test(e),wa=new Set(["length","size","percentage"]),va=e=>Se(e,wa,ur),ja=e=>Se(e,"position",ur),Na=new Set(["image","url"]),Pa=e=>Se(e,Na,Ea),Sa=e=>Se(e,"",ka),Oe=()=>!0,Se=(e,r,s)=>{const n=dr.exec(e);return n?n[1]?typeof r=="string"?n[1]===r:r.has(n[1]):s(n[2]):!1},Ca=e=>ga.test(e)&&!pa.test(e),ur=()=>!1,ka=e=>xa.test(e),Ea=e=>ba.test(e),Oa=()=>{const e=F("colors"),r=F("spacing"),s=F("blur"),n=F("brightness"),a=F("borderColor"),o=F("borderRadius"),i=F("borderSpacing"),c=F("borderWidth"),l=F("contrast"),d=F("grayscale"),m=F("hueRotate"),h=F("invert"),u=F("gap"),f=F("gradientColorStops"),x=F("gradientColorStopPositions"),b=F("inset"),p=F("margin"),y=F("opacity"),w=F("padding"),v=F("saturate"),j=F("scale"),I=F("sepia"),$=F("skew"),W=F("space"),N=F("translate"),q=()=>["auto","contain","none"],E=()=>["auto","hidden","clip","visible","scroll"],R=()=>["auto",C,r],S=()=>[C,r],de=()=>["",Z,oe],ne=()=>["auto",je,C],xe=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ue=()=>["solid","dashed","dotted","double","none"],be=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ce=()=>["start","end","center","between","around","evenly","stretch"],me=()=>["","0",C],D=()=>["auto","avoid","all","avoid-page","page","left","right","column"],L=()=>[je,C];return{cacheSize:500,separator:":",theme:{colors:[Oe],spacing:[Z,oe],blur:["none","",ie,C],brightness:L(),borderColor:[e],borderRadius:["none","","full",ie,C],borderSpacing:S(),borderWidth:de(),contrast:L(),grayscale:me(),hueRotate:L(),invert:me(),gap:S(),gradientColorStops:[e],gradientColorStopPositions:[ya,oe],inset:R(),margin:R(),opacity:L(),padding:S(),saturate:L(),scale:L(),sepia:me(),skew:L(),space:S(),translate:S()},classGroups:{aspect:[{aspect:["auto","square","video",C]}],container:["container"],columns:[{columns:[ie]}],"break-after":[{"break-after":D()}],"break-before":[{"break-before":D()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...xe(),C]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:q()}],"overscroll-x":[{"overscroll-x":q()}],"overscroll-y":[{"overscroll-y":q()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[b]}],"inset-x":[{"inset-x":[b]}],"inset-y":[{"inset-y":[b]}],start:[{start:[b]}],end:[{end:[b]}],top:[{top:[b]}],right:[{right:[b]}],bottom:[{bottom:[b]}],left:[{left:[b]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ee,C]}],basis:[{basis:R()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",C]}],grow:[{grow:me()}],shrink:[{shrink:me()}],order:[{order:["first","last","none",Ee,C]}],"grid-cols":[{"grid-cols":[Oe]}],"col-start-end":[{col:["auto",{span:["full",Ee,C]},C]}],"col-start":[{"col-start":ne()}],"col-end":[{"col-end":ne()}],"grid-rows":[{"grid-rows":[Oe]}],"row-start-end":[{row:["auto",{span:[Ee,C]},C]}],"row-start":[{"row-start":ne()}],"row-end":[{"row-end":ne()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",C]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",C]}],gap:[{gap:[u]}],"gap-x":[{"gap-x":[u]}],"gap-y":[{"gap-y":[u]}],"justify-content":[{justify:["normal",...Ce()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ce(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ce(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[w]}],px:[{px:[w]}],py:[{py:[w]}],ps:[{ps:[w]}],pe:[{pe:[w]}],pt:[{pt:[w]}],pr:[{pr:[w]}],pb:[{pb:[w]}],pl:[{pl:[w]}],m:[{m:[p]}],mx:[{mx:[p]}],my:[{my:[p]}],ms:[{ms:[p]}],me:[{me:[p]}],mt:[{mt:[p]}],mr:[{mr:[p]}],mb:[{mb:[p]}],ml:[{ml:[p]}],"space-x":[{"space-x":[W]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[W]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",C,r]}],"min-w":[{"min-w":[C,r,"min","max","fit"]}],"max-w":[{"max-w":[C,r,"none","full","min","max","fit","prose",{screen:[ie]},ie]}],h:[{h:[C,r,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[C,r,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[C,r,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[C,r,"auto","min","max","fit"]}],"font-size":[{text:["base",ie,oe]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Je]}],"font-family":[{font:[Oe]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",C]}],"line-clamp":[{"line-clamp":["none",je,Je]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Z,C]}],"list-image":[{"list-image":["none",C]}],"list-style-type":[{list:["none","disc","decimal",C]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ue(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Z,oe]}],"underline-offset":[{"underline-offset":["auto",Z,C]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:S()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",C]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",C]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...xe(),ja]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",va]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Pa]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[...ue(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:ue()}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["",...ue()]}],"outline-offset":[{"outline-offset":[Z,C]}],"outline-w":[{outline:[Z,oe]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:de()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[Z,oe]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",ie,Sa]}],"shadow-color":[{shadow:[Oe]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":[...be(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":be()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",ie,C]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[m]}],invert:[{invert:[h]}],saturate:[{saturate:[v]}],sepia:[{sepia:[I]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[m]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[I]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",C]}],duration:[{duration:L()}],ease:[{ease:["linear","in","out","in-out",C]}],delay:[{delay:L()}],animate:[{animate:["none","spin","ping","pulse","bounce",C]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[j]}],"scale-x":[{"scale-x":[j]}],"scale-y":[{"scale-y":[j]}],rotate:[{rotate:[Ee,C]}],"translate-x":[{"translate-x":[N]}],"translate-y":[{"translate-y":[N]}],"skew-x":[{"skew-x":[$]}],"skew-y":[{"skew-y":[$]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",C]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",C]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":S()}],"scroll-mx":[{"scroll-mx":S()}],"scroll-my":[{"scroll-my":S()}],"scroll-ms":[{"scroll-ms":S()}],"scroll-me":[{"scroll-me":S()}],"scroll-mt":[{"scroll-mt":S()}],"scroll-mr":[{"scroll-mr":S()}],"scroll-mb":[{"scroll-mb":S()}],"scroll-ml":[{"scroll-ml":S()}],"scroll-p":[{"scroll-p":S()}],"scroll-px":[{"scroll-px":S()}],"scroll-py":[{"scroll-py":S()}],"scroll-ps":[{"scroll-ps":S()}],"scroll-pe":[{"scroll-pe":S()}],"scroll-pt":[{"scroll-pt":S()}],"scroll-pr":[{"scroll-pr":S()}],"scroll-pb":[{"scroll-pb":S()}],"scroll-pl":[{"scroll-pl":S()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",C]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Z,oe,Je]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Ta=ua(Oa);function _(...e){return Ta(Jn(e))}const ee=[{code:"GRL",name:"General"},{code:"GFR",name:"Granja Fresco"},{code:"GRE",name:"Granja Refrigerado"},{code:"GTM",name:"Granja Terminado"},{code:"GPA",name:"Granja Panadería"},{code:"GSC",name:"Granja Seco"},{code:"HEL",name:"Heladería"},{code:"REF",name:"Refrigerado"},{code:"CON",name:"Congelado"},{code:"FRU",name:"Frutas"}],Ia=["CAJA","BOLSA","PAQUETE","KILO"],Ne={name:"Panadería Nueva Río D'or",owner:"TEJAS DE LA CRUZ YOSBANY"};function Ma(e){const r=e.toString().padStart(5,"0"),s=parseInt(r.slice(0,2))-1;return s>=0&&s<ee.length?ee[s].code:ee[0].code}function Ra(e){const r=e.toString().padStart(5,"0");return parseInt(r.slice(2))}function mr(e){const r=Ma(e),s=Ra(e);return`${r}-${s.toString().padStart(3,"0")}`}const Lt=[{name:"Dashboard",to:"/",icon:kr},{name:"Proveedores",to:"/providers",icon:Bt},{name:"Productos",to:"/products",icon:Ae},{name:"Órdenes",to:"/orders",icon:ct}];function Da(){const{signOut:e}=yt(),[r,s]=g.useState(!1);return t.jsx("header",{className:"bg-white border-b border-gray-200",children:t.jsxs("div",{className:"mx-auto px-4",children:[t.jsxs("div",{className:"flex h-16 items-center justify-between",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("h1",{className:"text-xl font-bold text-gray-900 mr-4 whitespace-nowrap",children:"Gestión de Compras"}),t.jsx("button",{onClick:()=>s(!r),className:"md:hidden ml-2 p-2 rounded-md hover:bg-gray-100",children:r?t.jsx(le,{className:"h-6 w-6"}):t.jsx(Cr,{className:"h-6 w-6"})})]}),t.jsxs("nav",{className:"hidden md:flex space-x-4",children:[Lt.map(n=>t.jsxs(Ct,{to:n.to,className:({isActive:a})=>_("inline-flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors",a?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[t.jsx(n.icon,{className:"mr-2 h-5 w-5"}),n.name]},n.name)),t.jsxs("button",{onClick:()=>e(),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors",children:[t.jsx(Pt,{className:"mr-2 h-5 w-5"}),"Cerrar Sesión"]})]})]}),r&&t.jsxs("nav",{className:"md:hidden py-4 space-y-2",children:[Lt.map(n=>t.jsxs(Ct,{to:n.to,onClick:()=>s(!1),className:({isActive:a})=>_("flex items-center px-3 py-2 text-base font-medium rounded-md w-full transition-colors",a?"text-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[t.jsx(n.icon,{className:"mr-3 h-5 w-5"}),n.name]},n.name)),t.jsxs("button",{onClick:()=>e(),className:"flex items-center px-3 py-2 text-base font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md w-full transition-colors",children:[t.jsx(Pt,{className:"mr-3 h-5 w-5"}),"Cerrar Sesión"]})]})]})})}function Fa(){return t.jsxs("div",{className:"min-h-screen flex flex-col",children:[t.jsx(Da,{}),t.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 p-4",children:t.jsx(Gt,{})})]})}const k=({className:e,variant:r="primary",size:s="md",isLoading:n,children:a,...o})=>{const i="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",c={primary:"bg-blue-600 text-white hover:bg-blue-700",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",outline:"border border-gray-300 bg-transparent hover:bg-gray-100",ghost:"hover:bg-gray-100 hover:text-gray-900"},l={sm:"h-9 px-3 text-sm",md:"h-10 px-4",lg:"h-11 px-8"};return t.jsxs("button",{className:_(i,c[r],l[s],e),disabled:n,...o,children:[n?t.jsx("span",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):null,a]})},z=Re.forwardRef(({className:e,label:r,error:s,value:n,type:a,onChange:o,isCurrency:i,...c},l)=>{const[d,m]=g.useState(""),h=p=>{const y=p.toFixed(2).split(".");return y[0]=y[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),y.join(",")};g.useEffect(()=>{i&&typeof n=="number"&&m(h(n))},[n,i]);const u=p=>{var y;if(i){let w=p.target.value.replace(/[^\d.,]/g,"");if(w=w.replace(/,/g,"."),w.split(".").length-1>1){const $=w.split(".");w=$[0]+"."+$.slice(1).join("")}const j=w.split(".");((y=j[1])==null?void 0:y.length)>2&&(j[1]=j[1].slice(0,2),w=j.join("."));const I=parseFloat(w)||0;m(h(I)),o==null||o({...p,target:{...p.target,value:I.toString()}})}else if(a==="number"){const w=p.target.value;(w===""||!isNaN(Number(w)))&&(o==null||o(p))}else o==null||o(p)},f=p=>{var y;i&&typeof n=="number"&&m(n.toFixed(2).replace(".",",")),(y=c.onFocus)==null||y.call(c,p)},x=p=>{var y;i&&typeof n=="number"&&m(h(n)),(y=c.onBlur)==null||y.call(c,p)},b=i?d:a==="number"&&n===0&&!c.min?"":n;return t.jsxs("div",{className:"space-y-2",children:[r&&t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r}),t.jsxs("div",{className:"relative",children:[i&&t.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),t.jsx("input",{className:_("block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500","focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500","disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500",s&&"border-red-500 focus:border-red-500 focus:ring-red-500",i&&"pl-7 text-right",e),ref:l,value:b,onChange:u,onFocus:f,onBlur:x,type:i?"text":a,inputMode:i?"decimal":void 0,...c})]}),s&&t.jsx("p",{className:"text-sm text-red-600",children:s})]})});z.displayName="Input";function Aa(){const{user:e,signIn:r}=yt(),[s,n]=g.useState(!1),[a,o]=g.useState(""),[i,c]=g.useState(""),[l,d]=g.useState("");if(e)return t.jsx(Yt,{to:"/",replace:!0});const m=async h=>{h.preventDefault(),d(""),n(!0);try{await r(a,i)}catch(u){console.error("Login error:",u),d("Credenciales inválidas")}finally{n(!1)}};return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 py-12 px-4 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Órdenes de Compra"}),t.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Inicia sesión para continuar"})]}),t.jsxs("form",{className:"mt-8 space-y-6",onSubmit:m,children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"email",className:"sr-only",children:"Correo electrónico"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(Er,{className:"h-5 w-5 text-gray-400"})}),t.jsx(z,{id:"email",type:"email",value:a,onChange:h=>o(h.target.value),required:!0,className:"pl-10",placeholder:"Correo electrónico",autoComplete:"email"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"password",className:"sr-only",children:"Contraseña"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(Or,{className:"h-5 w-5 text-gray-400"})}),t.jsx(z,{id:"password",type:"password",value:i,onChange:h=>c(h.target.value),required:!0,className:"pl-10",placeholder:"Contraseña",autoComplete:"current-password"})]})]})]}),l&&t.jsx("div",{className:"text-red-600 text-sm text-center",children:l}),t.jsx(k,{type:"submit",className:"w-full",isLoading:s,children:"Iniciar sesión"})]})]})})}function pe(){const[e,r]=g.useState([]),[s,n]=g.useState(!0);return g.useEffect(()=>{const l=O(T,"providers"),d=te(l,m=>{const h=m.val(),u=h?Object.entries(h).map(([f,x])=>({id:f,...x})):[];r(u),n(!1)});return()=>d()},[]),{providers:e,loading:s,addProvider:async l=>{const d=O(T,"providers");await $e(d,l)},updateProvider:async(l,d)=>{const m=O(T,`providers/${l}`);await Ve(m,d)},deleteProvider:async l=>{const d=O(T,`providers/${l}`);await ft(d)},getProvider:async l=>{const d=O(T,`providers/${l}`),m=await H(d);return m.exists()?{id:l,...m.val()}:null}}}function A({children:e,className:r,isSelected:s,onClick:n}){return t.jsx("div",{className:_("rounded-lg transition-all duration-200 h-full",s?"border-2 border-blue-500 shadow-sm ring-2 ring-blue-100 bg-blue-50":"border border-gray-200 shadow-sm hover:border-gray-300 hover:shadow bg-gradient-to-br from-slate-50 to-gray-50",n&&"cursor-pointer",r),onClick:n,children:e})}A.Header=function({children:r,className:s}){return t.jsx("div",{className:_("p-3 sm:p-4 space-y-2",s),children:r})};A.Content=function({children:r,className:s}){return t.jsx("div",{className:_("px-3 sm:px-4 pb-3 sm:pb-4",s),children:r})};A.Footer=function({children:r,className:s}){return t.jsx("div",{className:_("px-3 sm:px-4 py-2 sm:py-3 border-t bg-white/50 rounded-b-lg",s),children:r})};A.Title=function({children:r,className:s}){return t.jsx("h3",{className:_("text-base sm:text-lg font-semibold text-gray-900 line-clamp-2",s),children:r})};A.Grid=function({children:r,className:s}){return t.jsx("div",{className:_("grid grid-cols-2 gap-2 text-sm text-gray-600",s),children:r})};function Ge(e){return new Date(e)}function vt(e){return st(new Date(e))}function jt(e){return js(new Date(e))}function La(e){return vt(e).getTime()}function $a(e){return jt(e).getTime()}function at(){return Date.now()}const hr=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];function za(e,r){if(!r.length)return e;let s=Rt(e,1),n=7;for(;n>0;){const a=hr[s.getDay()];if(r.includes(a))return s;s=Rt(s,1),n--}return e}function Wa(e){return hr[e.getDay()]}function qa(){const[e,r]=g.useState(0),[s,n]=g.useState(!0);return g.useEffect(()=>{(async()=>{try{const o=O(T,"orders"),i=await H(o);if(!i.exists()){r(0);return}const c=La(at()),l=$a(at()),m=Object.values(i.val()).filter(h=>h.date>=c&&h.date<=l);r(m.length)}catch(o){console.error("Error fetching today orders count:",o),r(0)}finally{n(!1)}})()},[]),{count:e,loading:s}}async function _a(e,r){const s=O(T,e),n=$e(s);return await ze(n,r),n.key}async function Ba(e,r,s){const n=O(T,`${e}/${r}`);await ze(n,s)}async function Ua(e,r){const s=O(T,`${e}/${r}`);await ft(s)}async function Ze(e){const r=O(T,e),s=await H(r);return s.exists()?Object.entries(s.val()).map(([n,a])=>({id:n,...a})):[]}async function fr(e,r,s){const n=O(T,e),a=gt(n,xt(r),pt(s)),o=await H(a);return o.exists()?Object.entries(o.val()).map(([i,c])=>({id:i,...c})):[]}const Ha=["orders","products","providers","packaging"];async function Va(e){try{const r=O(T,e),s=await H(r);return{name:e,exists:s.exists()}}catch(r){return{name:e,exists:!1,error:r instanceof Error?r.message:"Unknown error"}}}async function Ya(e){const r=O(T,e);await ze(r,{})}async function Ga(){try{console.log("Starting collections initialization...");const r=(await Promise.all(Ha.map(s=>Va(s)))).filter(s=>!s.exists).map(async({name:s})=>{try{await Ya(s),console.log(`Collection "${s}" created successfully`)}catch(n){console.error(`Failed to create collection "${s}":`,n)}});await Promise.all(r),console.log("Collections initialization completed")}catch(e){throw console.error("Failed to initialize collections:",e),e}}Ga().catch(e=>{console.error("Critical error during collections initialization:",e)});function Qa(e,r){const s=new Map;return e.forEach(n=>{n.items.forEach(a=>{const o=s.get(a.productId)||{amount:0,quantity:0,orders:new Set},i=a.price*a.quantity;o.amount+=i,o.quantity+=a.quantity,o.orders.add(n.id),s.set(a.productId,o)})}),Array.from(s.entries()).map(([n,a])=>{const o=r.find(i=>i.id===n);return o?{id:n,name:o.name,totalAmount:a.amount,totalQuantity:a.quantity,orderCount:a.orders.size}:null}).filter(n=>n!==null).sort((n,a)=>a.totalAmount-n.totalAmount)}async function Xa(){try{const[e,r,s]=await Promise.all([Ze("orders"),Ze("products"),Ze("providers")]);if(!e||!r||!s)throw new Error("Failed to fetch data");const n=new Date,a=new Date(n.getTime()-7*24*60*60*1e3),o=e.filter(l=>{const d=new Date(l.date);return d>=a&&d<=n}).reduce((l,d)=>{const m=new Date(d.date).toISOString().split("T")[0];return l[m]=(l[m]||0)+1,l},{}),i=Object.entries(o).map(([l,d])=>({date:l,count:d})).sort((l,d)=>d.date.localeCompare(l.date)),c=Qa(e,r);return{weeklyOrders:i,topProducts:c.slice(0,10),totalProducts:r.length,totalProviders:s.length}}catch(e){return console.error("Error fetching analytics:",e),{weeklyOrders:[],topProducts:[],totalProducts:0,totalProviders:0}}}function Ka(){const[e,r]=g.useState({weeklyOrders:[],topProducts:[],totalProducts:0,totalProviders:0}),[s,n]=g.useState(!0),[a,o]=g.useState(null);return g.useEffect(()=>{let i=!0;return(async()=>{try{n(!0);const l=await Xa();if(!i)return;r(l),o(null)}catch(l){if(console.error("Error fetching analytics:",l),!i)return;o("Error al cargar los datos analíticos")}finally{i&&n(!1)}})(),()=>{i=!1}},[]),{...e,loading:s,error:a}}function Te({title:e,icon:r,children:s,loading:n,className:a,onClick:o}){return t.jsx(A,{className:a,onClick:o,children:t.jsx(A.Header,{className:"!p-4",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-1",children:e}),n?t.jsx("div",{className:"h-6 w-24 bg-gray-200 rounded animate-pulse"}):t.jsx("div",{className:"break-words",children:s})]}),t.jsx("div",{className:"flex-shrink-0 p-2 bg-blue-100 rounded-lg",children:r})]})})})}function se({isOpen:e,onClose:r,title:s,children:n,className:a}){return e?t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:[t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25",onClick:r}),t.jsxs("div",{className:_("relative transform overflow-hidden rounded-lg bg-white p-6 text-left shadow-xl transition-all w-full max-w-md",a),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:s}),t.jsx("button",{onClick:r,className:"rounded-full p-1 hover:bg-gray-100",children:t.jsx(le,{className:"w-5 h-5"})})]}),n]})]})}):null}function Ja({isOpen:e,onClose:r,products:s}){return t.jsx(se,{isOpen:e,onClose:r,title:"Top 10 Productos Más Valorados",children:t.jsx("div",{className:"space-y-4",children:s.map((n,a)=>t.jsxs("div",{className:"flex items-start gap-4 p-4 bg-white rounded-lg border transition-colors hover:bg-gray-50",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full bg-blue-100 text-blue-600 font-bold",children:a+1}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium text-gray-900 truncate",children:n.name}),t.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2 text-sm text-gray-600",children:[t.jsx("div",{className:"flex items-center gap-1",children:t.jsx("span",{className:"font-medium text-blue-600",children:K(n.totalAmount)})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ae,{className:"w-4 h-4"}),t.jsxs("span",{children:[n.totalQuantity," ",n.purchasePackaging]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ct,{className:"w-4 h-4"}),t.jsxs("span",{children:[n.orderCount," órdenes"]})]})]})]})]},n.id))})})}const ge="orders",Ie={subscribeToProviderOrders(e,r){const s=O(T,ge),n=gt(s,xt("providerId"),pt(e));return te(n,o=>{if(!o.exists()){r([]);return}const c=Object.entries(o.val()).map(([l,d])=>({id:l,...d})).sort((l,d)=>new Date(d.date).getTime()-new Date(l.date).getTime());r(c)})},async getByProvider(e){try{return(await fr(ge,"providerId",e)).sort((s,n)=>new Date(n.date).getTime()-new Date(s.date).getTime())}catch(r){return console.error("Error fetching provider orders:",r),[]}},async create(e){try{return await _a(ge,e)}catch(r){throw console.error("Error creating order:",r),r}},async update(e,r){try{const s=O(T,`${ge}/${e}`),n=await H(s);if(!n.exists())throw new Error("Order not found");const o={...n.val(),...r};await Ba(ge,e,o)}catch(s){throw console.error("Error updating order:",s),s}},async delete(e){try{await Ua(ge,e)}catch(r){throw console.error("Error deleting order:",r),r}}};async function Za(e){try{return(await fr(ge,"providerId",e)).sort((s,n)=>new Date(n.date).getTime()-new Date(s.date).getTime())}catch(r){return console.error("Error fetching provider orders:",r),[]}}function gr(e){const[r,s]=g.useState([]),[n,a]=g.useState(!0);return g.useEffect(()=>{let o=!0;return e?(async()=>{try{const c=await Za(e);o&&s(c)}catch(c){console.error("Error fetching provider orders:",c)}finally{o&&a(!1)}})():(s([]),a(!1)),()=>{o=!1}},[e]),{orders:r,loading:n}}function eo({provider:e}){const r=Qt(),{orders:s}=gr(e.id),n=new Date,a=vt(n),o=jt(n),i=s.filter(l=>{const d=new Date(l.date);return d>=a&&d<=o}).length,c=()=>{i>0?r(`/orders?provider=${e.id}`):r(`/orders?provider=${e.id}&new=true`)};return t.jsx("li",{className:"py-3",children:t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("button",{onClick:c,className:"font-medium text-gray-900 hover:text-blue-600 text-left transition-colors",children:e.legalName&&e.legalName!==e.commercialName?`${e.legalName} (${e.commercialName})`:e.commercialName}),t.jsx("div",{className:"flex items-center gap-3",children:i>0?t.jsxs("span",{className:"text-sm font-medium text-blue-600 whitespace-nowrap",children:[i," ",i===1?"pedido":"pedidos"]}):t.jsx("span",{className:"text-sm font-medium text-amber-600 whitespace-nowrap",children:"Pendiente"})})]})})}function to({provider:e}){var l;const{orders:r}=gr(e.id),s=new Date,n=Wa(s),a=(l=e.orderDays)==null?void 0:l.includes(n),o=a?s:za(s,e.orderDays||[]),i=r.filter(d=>{const m=new Date(d.date);return m>=vt(o)&&m<=jt(o)}),c=i.reduce((d,m)=>d+m.total,0);return t.jsx("li",{className:"py-3",children:t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("span",{className:"font-medium text-gray-900",children:e.legalName&&e.legalName!==e.commercialName?`${e.legalName} (${e.commercialName})`:e.commercialName}),t.jsx("div",{className:"flex items-center gap-3",children:i.length>0?t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm font-medium text-blue-600",children:K(c)}),t.jsx("div",{className:"text-xs text-gray-500",children:a?"Pedido de hoy":Q(o,"d 'de' MMM",{locale:re})})]}):t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Sin pedidos previos"})})]})})}function pr(){const[e,r]=g.useState([]),[s,n]=g.useState(!0);return g.useEffect(()=>{const a=O(T,"products"),o=te(a,i=>{if(!i.exists()){r([]),n(!1);return}const c=Object.entries(i.val()).map(([l,d])=>({id:l,...d}));r(c),n(!1)});return()=>o()},[]),{products:e,loading:s}}async function ro(e,r){try{const s=O(T,`products/${e}`);await Ve(s,r)}catch(s){throw console.error("Error updating product:",s),s}}function so(e){const r=[];let s="",n=!1;for(let a=0;a<e.length;a++){const o=e[a];o==='"'?n&&e[a+1]==='"'?(s+='"',a++):n=!n:o===","&&!n?(r.push(s.trim()),s=""):s+=o}return r.push(s.trim()),r}function no(e){return e.trim().split(/\r?\n/).map(s=>so(s))}function ao(e){return e.map(r=>r.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}function oo(e){const r=no(e);if(r.length<2)throw new Error("El archivo está vacío o no tiene el formato correcto");const s=ao(r[0]),n=["fecha","rut","codigo","nombre","precio"],a=n.filter(i=>!s.includes(i));if(a.length>0)throw new Error(`Faltan las siguientes columnas: ${a.join(", ")}`);const o=n.map(i=>s.indexOf(i));return r.slice(1).map(i=>{if(i.length<o.length)throw new Error("Número incorrecto de columnas");return{fecha:i[o[0]],rut:i[o[1]],codigo:i[o[2]],nombre:i[o[3]],precio:i[o[4]]}})}function io(e){const r=e.rut.replace(/\D/g,"");if(!r)return"RUT vacío";if(!/^\d{12}$/.test(r))return"RUT inválido";if(!e.codigo.trim())return"Código vacío";const n=e.precio.replace(/[^\d.,]/g,"").replace(/\./g,"").replace(",","."),a=parseFloat(n);return isNaN(a)||a<0?"Precio inválido":null}function co(e){let r=e.replace(/[^\d.,]/g,"");r.includes(",")&&(r.indexOf(".")<r.indexOf(",")?r=r.replace(/\./g,"").replace(",","."):r=r.replace(",","."));const s=parseFloat(r);if(isNaN(s))throw new Error(`Precio inválido: ${e}`);return Number(s.toFixed(2))}async function lo(e,r,s){const n={updated:0,errors:[],details:{updatedProducts:[],notFoundProducts:[],invalidRows:[]}};try{if(!e.trim())throw new Error("El archivo está vacío");const a=oo(e);if(a.length===0)throw new Error("No se encontraron datos para procesar");for(const[o,i]of a.entries())try{const c=io(i);if(c){n.details.invalidRows.push({row:o+2,reason:c});continue}const l=i.rut.replace(/\D/g,""),d=s.find(h=>{var u;return((u=h.rut)==null?void 0:u.replace(/\D/g,""))===l});if(!d){n.details.notFoundProducts.push({code:i.codigo,providerRut:i.rut,csvName:i.nombre});continue}const m=r.find(h=>{var u;return h.providerId===d.id&&((u=h.supplierCode)==null?void 0:u.toLowerCase())===i.codigo.toLowerCase()});if(!m){n.details.notFoundProducts.push({code:i.codigo,providerRut:i.rut,csvName:i.nombre});continue}try{const h=co(i.precio);Math.abs(m.price-h)>.01&&(await ro(m.id,{price:h}),n.updated++,n.details.updatedProducts.push({name:m.name,oldPrice:m.price,newPrice:h,csvName:i.nombre}))}catch(h){n.details.invalidRows.push({row:o+2,reason:h instanceof Error?h.message:"Precio inválido"})}}catch(c){n.details.invalidRows.push({row:o+2,reason:c instanceof Error?c.message:"Error desconocido"})}return n}catch(a){throw new Error(a instanceof Error?a.message:"Error procesando el archivo")}}function uo({isOpen:e,onClose:r,result:s}){const[n,a]=g.useState(""),o=g.useMemo(()=>{if(!s)return null;const l=n.toLowerCase();return{updatedProducts:s.details.updatedProducts.filter(d=>d.name.toLowerCase().includes(l)||d.csvName.toLowerCase().includes(l)),notFoundProducts:s.details.notFoundProducts.filter(d=>d.code.toLowerCase().includes(l)||d.csvName.toLowerCase().includes(l)||d.providerRut.toLowerCase().includes(l)),invalidRows:s.details.invalidRows.filter(d=>d.reason.toLowerCase().includes(l))}},[s,n]);if(!s||!o)return null;const i=s.updated>0,c=s.errors.length>0;return t.jsx(se,{isOpen:e,onClose:r,title:"Resultado de la Importación",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg bg-gray-50",children:[i&&!c?t.jsx(Ut,{className:"w-6 h-6 text-green-500 flex-shrink-0"}):c?t.jsx(Tr,{className:"w-6 h-6 text-amber-500 flex-shrink-0"}):t.jsx(Ir,{className:"w-6 h-6 text-red-500 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"Resumen de la importación"}),t.jsxs("p",{className:"text-sm text-gray-600",children:[s.updated," producto",s.updated!==1?"s":""," actualizado",s.updated!==1?"s":""]})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(z,{placeholder:"Buscar en los resultados...",value:n,onChange:l=>a(l.target.value),className:"pl-10"}),t.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]}),t.jsxs("div",{className:"space-y-6 max-h-[60vh] overflow-y-auto",children:[o.updatedProducts.length>0&&t.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-green-800 mb-3",children:["Productos Actualizados (",o.updatedProducts.length,")"]}),t.jsx("div",{className:"space-y-3",children:o.updatedProducts.map((l,d)=>t.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[t.jsx("div",{className:"font-medium text-green-700",children:l.name}),t.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Nombre en CSV: ",l.csvName]}),t.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Precio anterior: $",l.oldPrice.toFixed(2)," → Nuevo precio: $",l.newPrice.toFixed(2)]})]},d))})]}),o.notFoundProducts.length>0&&t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-amber-800 mb-3",children:["Productos no encontrados (",o.notFoundProducts.length,")"]}),t.jsx("div",{className:"space-y-3",children:o.notFoundProducts.map((l,d)=>t.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[t.jsxs("div",{className:"font-medium text-amber-700",children:["Código: ",l.code]}),t.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Nombre en CSV: ",l.csvName]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["RUT Proveedor: ",l.providerRut]})]},d))})]}),o.invalidRows.length>0&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[t.jsxs("h4",{className:"font-medium text-red-800 mb-3",children:["Filas con errores (",o.invalidRows.length,")"]}),t.jsx("div",{className:"space-y-3",children:o.invalidRows.map((l,d)=>t.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[t.jsxs("div",{className:"font-medium text-red-700",children:["Fila ",l.row]}),t.jsx("div",{className:"text-sm text-gray-600 mt-1",children:l.reason})]},d))})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(k,{onClick:r,children:"Cerrar"})})]})})}function mo(){const e=g.useRef(null),[r,s]=g.useState(!1),[n,a]=g.useState(null),[o,i]=g.useState(!1),{products:c,loading:l}=pr(),{providers:d,loading:m}=pe(),h=async f=>{var b;const x=(b=f.target.files)==null?void 0:b[0];if(x){if(!x.name.toLowerCase().endsWith(".csv")){P.error("El archivo debe ser de tipo CSV");return}s(!0);try{const p=await x.text(),y=await lo(p,c,d);a(y),i(!0),y.updated>0&&P.success(`${y.updated} productos actualizados`)}catch(p){P.error(p instanceof Error?p.message:"Error al procesar el archivo")}finally{s(!1),e.current&&(e.current.value="")}}},u=()=>{var f;(f=e.current)==null||f.click()};return l||m?t.jsx(A,{children:t.jsx(A.Header,{className:"!p-4",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})}):t.jsxs(t.Fragment,{children:[t.jsx(A,{children:t.jsxs(A.Header,{className:"!p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{children:t.jsx("h3",{className:"text-lg font-bold mt-1",children:"Actualizar Precios"})}),t.jsx("div",{className:"p-2 bg-violet-100 rounded-lg",children:t.jsx(Mr,{className:"w-5 h-5 text-violet-600"})})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("input",{ref:e,type:"file",accept:".csv",onChange:h,className:"hidden"}),t.jsx(k,{onClick:u,isLoading:r,className:"w-full",children:r?"Procesando...":"Seleccionar Archivo"}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formato: Fecha, RUT, Código, Nombre, Precio"})]})]})}),t.jsx(uo,{isOpen:o,onClose:()=>i(!1),result:n})]})}const ho={lunes:"monday",martes:"tuesday",miércoles:"wednesday",jueves:"thursday",viernes:"friday",sábado:"saturday",domingo:"sunday"};function fo(){var p;const{providers:e}=pe(),r=new Date,s=ho[Q(r,"EEEE",{locale:re})],{count:n,loading:a}=qa(),{weeklyOrders:o,topProducts:i,totalProducts:c,totalProviders:l,loading:d}=Ka(),[m,h]=g.useState(!1),u=e.filter(y=>{var w;return(w=y.orderDays)==null?void 0:w.includes(s)}),f=((p=o[0])==null?void 0:p.count)||0,x=i[0],b=o.reduce((y,w)=>y+w.count,0);return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[t.jsx(A,{children:t.jsx(A.Header,{className:"!p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-bold capitalize",children:Q(r,"EEEE",{locale:re})}),t.jsx("div",{className:"text-sm text-gray-600 mt-1",children:Q(r,"dd/MM/yyyy")})]}),t.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:t.jsx(Ht,{className:"w-5 h-5 text-orange-600"})})]})})}),t.jsx(Te,{title:"Total Productos",icon:t.jsx(lt,{className:"w-5 h-5 text-indigo-600"}),loading:d,children:t.jsx("h3",{className:"text-2xl font-bold mt-1",children:c})}),t.jsx(Te,{title:"Total Proveedores",icon:t.jsx(Bt,{className:"w-5 h-5 text-emerald-600"}),loading:d,children:t.jsx("h3",{className:"text-2xl font-bold mt-1",children:l})}),t.jsx(Te,{title:"Total Órdenes",icon:t.jsx(ct,{className:"w-5 h-5 text-amber-600"}),loading:d,children:t.jsx("h3",{className:"text-2xl font-bold mt-1",children:b})}),t.jsx(A,{children:t.jsx(A.Header,{className:"!p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pedidos Hoy"}),t.jsx("h3",{className:"text-2xl font-bold mt-1",children:a?t.jsx("span",{className:"text-gray-400",children:"..."}):n})]}),t.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:t.jsx(Ae,{className:"w-5 h-5 text-purple-600"})})]})})}),t.jsx(Te,{title:"Órdenes Semanales",icon:t.jsx(Rr,{className:"w-5 h-5 text-blue-600"}),loading:d,children:t.jsx("h3",{className:"text-2xl font-bold mt-1",children:f})}),t.jsx(Te,{title:"Producto Más Valorado",icon:t.jsx(Dr,{className:"w-5 h-5 text-green-600"}),loading:d,className:"lg:col-span-2 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>h(!0),children:x&&t.jsxs("div",{className:"mt-1",children:[t.jsx("h3",{className:"text-lg font-bold break-words",children:x.name}),t.jsxs("div",{className:"flex items-center justify-between mt-1",children:[t.jsx("span",{className:"text-lg font-bold text-blue-600",children:K(x.totalAmount)}),t.jsxs("span",{className:"text-sm text-gray-500",children:[x.totalQuantity," ",x.purchasePackaging]})]})]})}),t.jsx(mo,{})]}),t.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[t.jsxs(A,{children:[t.jsx(A.Header,{children:t.jsx(A.Title,{children:"Hoy se deben realizar pedidos a:"})}),t.jsx(A.Content,{children:u.length>0?t.jsx("ul",{className:"divide-y",children:u.map(y=>t.jsx(eo,{provider:y},y.id))}):t.jsx("p",{className:"text-gray-500 py-3",children:"No hay pedidos programados para hoy"})})]}),t.jsxs(A,{children:[t.jsx(A.Header,{children:t.jsx(A.Title,{children:"Hoy se deben recibir pedidos de:"})}),t.jsx(A.Content,{children:u.length>0?t.jsx("ul",{className:"divide-y",children:u.map(y=>t.jsx(to,{provider:y},y.id))}):t.jsx("p",{className:"text-gray-500 py-3",children:"No hay entregas programadas para hoy"})})]})]}),t.jsx(Ja,{isOpen:m,onClose:()=>h(!1),products:i})]})}const $t=[{value:"monday",label:"Lunes"},{value:"tuesday",label:"Martes"},{value:"wednesday",label:"Miércoles"},{value:"thursday",label:"Jueves"},{value:"friday",label:"Viernes"},{value:"saturday",label:"Sábado"},{value:"sunday",label:"Domingo"}];function go({initialData:e,onSubmit:r,onCancel:s,isLoading:n}){const[a,o]=Re.useState({commercialName:(e==null?void 0:e.commercialName)||"",legalName:(e==null?void 0:e.legalName)||"",rut:(e==null?void 0:e.rut)||"",phone:(e==null?void 0:e.phone)||"",deliveryDays:(e==null?void 0:e.deliveryDays)||[],orderDays:(e==null?void 0:e.orderDays)||[]}),[i,c]=g.useState(""),l=u=>{let f=u.target.value;f=f.replace(/\D/g,""),f.startsWith("598")&&(f=f.slice(3)),f=f.slice(0,9),o(x=>({...x,phone:f})),f&&!Dt(f)?c("Ingrese un número de celular válido de Uruguay (8 o 9 dígitos)"):c("")},d=async u=>{if(u.preventDefault(),a.phone&&!Dt(a.phone)){c("Ingrese un número de celular válido de Uruguay (8 o 9 dígitos)");return}await r(a)},m=(u,f)=>{o(x=>{var b,p;return{...x,[f==="delivery"?"deliveryDays":"orderDays"]:(b=x[f==="delivery"?"deliveryDays":"orderDays"])!=null&&b.includes(u)?(p=x[f==="delivery"?"deliveryDays":"orderDays"])==null?void 0:p.filter(y=>y!==u):[...x[f==="delivery"?"deliveryDays":"orderDays"]||[],u]}})},h=a.phone?nr(a.phone):"";return t.jsxs("form",{onSubmit:d,className:"space-y-6",children:[t.jsx(z,{label:"Nombre comercial",value:a.commercialName,onChange:u=>o(f=>({...f,commercialName:u.target.value})),required:!0}),t.jsx(z,{label:"Razón social",value:a.legalName,onChange:u=>o(f=>({...f,legalName:u.target.value}))}),t.jsx(z,{label:"RUT",value:a.rut,onChange:u=>o(f=>({...f,rut:u.target.value}))}),t.jsxs("div",{children:[t.jsx(z,{label:"Celular",type:"tel",value:a.phone,onChange:l,error:i,placeholder:"93609319"}),a.phone&&t.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Se guardará como: ",h]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Días de pedido"}),t.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-7 gap-2",children:$t.map(({value:u,label:f})=>{var x;return t.jsx("button",{type:"button",onClick:()=>m(u,"order"),className:`
                  px-3 py-2 text-sm font-medium rounded-md transition-colors
                  ${(x=a.orderDays)!=null&&x.includes(u)?"bg-blue-100 text-blue-800 hover:bg-blue-200":"bg-gray-50 text-gray-600 hover:bg-gray-100"}
                `,children:f},u)})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Días de entrega"}),t.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-7 gap-2",children:$t.map(({value:u,label:f})=>{var x;return t.jsx("button",{type:"button",onClick:()=>m(u,"delivery"),className:`
                  px-3 py-2 text-sm font-medium rounded-md transition-colors
                  ${(x=a.deliveryDays)!=null&&x.includes(u)?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-50 text-gray-600 hover:bg-gray-100"}
                `,children:f},u)})})]})]}),t.jsxs("div",{className:"flex justify-end space-x-4",children:[t.jsx(k,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),t.jsxs(k,{type:"submit",isLoading:n,children:[e?"Actualizar":"Crear"," Proveedor"]})]})]})}function po(){const{providers:e,loading:r,addProvider:s,updateProvider:n,deleteProvider:a}=pe(),[o,i]=g.useState(!1),[c,l]=g.useState(null),[d,m]=g.useState(!1),[h,u]=g.useState(null),f=async v=>{m(!0);try{c?(await n(c.id,v),P.success("Proveedor actualizado exitosamente")):(await s(v),P.success("Proveedor creado exitosamente")),p()}catch{P.error("Ocurrió un error al guardar el proveedor")}finally{m(!1)}},x=async v=>{u(v)},b=async()=>{if(h)try{await a(h.id),P.success("Proveedor eliminado exitosamente"),u(null)}catch{P.error("Ocurrió un error al eliminar el proveedor")}},p=()=>{i(!1),l(null)},y=v=>{l(v),i(!0)},w=()=>{if(c){const v=se({isOpen:!0,onClose:()=>{},title:"Advertencia",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-amber-600",children:"Hay un proveedor en edición. ¿Desea cancelar los cambios y crear uno nuevo?"}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(k,{variant:"outline",onClick:()=>v.close(),children:"Cancelar"}),t.jsx(k,{onClick:()=>{l(null),i(!0),v.close()},children:"Continuar"})]})]})})}else i(!0)};return r?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):o||c?t.jsxs("div",{className:"bg-white p-4 md:p-6 rounded-lg shadow",children:[t.jsxs("h2",{className:"text-xl font-semibold mb-4",children:[c?"Editar":"Nuevo"," Proveedor"]}),t.jsx(go,{initialData:c||void 0,onSubmit:f,onCancel:p,isLoading:d})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex justify-end",children:t.jsxs(k,{onClick:w,children:[t.jsx(Le,{className:"w-4 h-4 mr-2"}),"Nuevo Proveedor"]})}),t.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.map(v=>t.jsxs("div",{className:"bg-white p-4 md:p-6 rounded-lg shadow-sm space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-lg font-semibold break-words",children:v.commercialName}),v.legalName&&t.jsx("p",{className:"text-sm text-gray-600 break-words",children:v.legalName}),v.rut&&t.jsxs("p",{className:"text-sm text-gray-600",children:["RUT: ",v.rut]}),v.phone&&t.jsxs("p",{className:"text-sm text-gray-600",children:["Celular: ",nr(v.phone)]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 items-center justify-between",children:[t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs(k,{variant:"outline",size:"sm",onClick:()=>y(v),children:[t.jsx(dt,{className:"w-4 h-4 mr-2"}),"Editar"]}),t.jsxs(k,{variant:"outline",size:"sm",onClick:()=>x(v),children:[t.jsx(ut,{className:"w-4 h-4 mr-2"}),"Eliminar"]})]}),v.phone&&t.jsx("a",{href:ar(v.phone,""),target:"_blank",rel:"noopener noreferrer",children:t.jsx(k,{variant:"ghost",size:"sm",children:t.jsx(Fr,{className:"w-4 h-4"})})})]})]},v.id))}),t.jsx(se,{isOpen:!!h,onClose:()=>u(null),title:"Eliminar proveedor",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("p",{className:"text-amber-600",children:['¿Está seguro que desea eliminar el proveedor "',h==null?void 0:h.commercialName,'"?']}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(k,{variant:"outline",onClick:()=>u(null),children:"Cancelar"}),t.jsx(k,{onClick:b,children:"Eliminar"})]})]})})]})}function xr({providers:e,selectedProviderId:r,onChange:s}){const[n,a]=g.useState(!1),[o,i]=g.useState(""),c=e.find(u=>u.id===r),l=g.useRef(null);g.useEffect(()=>{const u=f=>{l.current&&!l.current.contains(f.target)&&a(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const d=e.filter(u=>{var f;return u.commercialName.toLowerCase().includes(o.toLowerCase())||((f=u.legalName)==null?void 0:f.toLowerCase().includes(o.toLowerCase()))}),m=u=>{s(u),a(!1),i("")},h=u=>{u.stopPropagation(),s(""),i("")};return t.jsxs("div",{className:"relative",ref:l,children:[t.jsx("div",{className:"mb-2",children:t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Proveedor"})}),t.jsx("div",{role:"button",tabIndex:0,onClick:()=>a(!n),onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&a(!n)},className:_("relative w-full rounded-lg border bg-white px-4 py-3 h-[48px] cursor-pointer","focus:outline-none focus:ring-2 focus:ring-blue-500",r?"border-blue-200 hover:border-blue-300":"border-gray-200 hover:border-gray-300","transition-all duration-200 flex items-center"),children:t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx(mt,{className:`
            w-5 h-5 flex-shrink-0
            ${r?"text-blue-500":"text-gray-400"}
          `}),t.jsx("div",{className:"flex-1 min-w-0",children:c?t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900 truncate",children:c.commercialName}),c.legalName&&c.legalName!==c.commercialName&&t.jsx("div",{className:"text-sm text-gray-500 truncate",children:c.legalName})]}):t.jsx("span",{className:"text-gray-500",children:"Seleccionar proveedor..."})}),t.jsxs("div",{className:"flex items-center gap-2",children:[r&&t.jsx("div",{role:"button",tabIndex:0,onClick:h,onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&h(u)},className:"p-1 hover:bg-gray-100 rounded-full transition-colors cursor-pointer",children:t.jsx(le,{className:"w-4 h-4 text-gray-400"})}),t.jsx(Ar,{className:`
              w-5 h-5 transition-transform duration-200
              ${r?"text-blue-500":"text-gray-400"}
              ${n?"rotate-180":""}
            `})]})]})}),n&&t.jsxs("div",{className:"absolute z-10 mt-2 w-full rounded-lg bg-white shadow-lg border border-gray-200",children:[t.jsx("div",{className:"p-2 border-b",children:t.jsxs("div",{className:"relative",children:[t.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",value:o,onChange:u=>i(u.target.value),placeholder:"Buscar proveedor...",className:`
                  w-full rounded-md border border-gray-200 pl-9 pr-4 py-2 text-sm
                  placeholder-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500
                `})]})}),t.jsx("div",{className:"max-h-60 overflow-auto",children:d.length>0?t.jsx("div",{className:"py-1",children:d.map(u=>t.jsxs("div",{role:"button",tabIndex:0,onClick:()=>m(u.id),onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&m(u.id)},className:_("px-4 py-2 cursor-pointer hover:bg-gray-50 transition-colors",u.id===r&&"bg-blue-50"),children:[t.jsx("div",{className:"font-medium text-gray-900",children:u.commercialName}),u.legalName&&u.legalName!==u.commercialName&&t.jsx("div",{className:"text-sm text-gray-500",children:u.legalName})]},u.id))}):t.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 text-center",children:"No se encontraron proveedores"})})]})]})}function ot(e){var r,s,n;return(r=e.name)!=null&&r.trim()?(s=e.sku)!=null&&s.trim()?(n=e.purchasePackaging)!=null&&n.trim()?e.providerId?typeof e.minPackageStock!="number"||isNaN(e.minPackageStock)?{field:"minPackageStock",message:"El stock mínimo debe ser un número válido"}:typeof e.desiredStock!="number"||isNaN(e.desiredStock)?{field:"desiredStock",message:"El stock deseado debe ser un número válido"}:e.minPackageStock<0?{field:"minPackageStock",message:"El stock mínimo no puede ser negativo"}:e.desiredStock<0?{field:"desiredStock",message:"El stock deseado no puede ser negativo"}:e.minPackageStock>e.desiredStock?{field:"minPackageStock",message:"El stock mínimo no puede ser mayor al stock deseado"}:typeof e.price!="number"||isNaN(e.price)?{field:"price",message:"El precio debe ser un número válido"}:e.price<0?{field:"price",message:"El precio no puede ser negativo"}:typeof e.order!="number"||isNaN(e.order)?{field:"order",message:"El orden debe ser un número válido"}:null:{field:"providerId",message:"El proveedor es requerido"}:{field:"purchasePackaging",message:"El empaque de compra es requerido"}:{field:"sku",message:"El SKU es requerido"}:{field:"name",message:"El nombre es requerido"}}function zt(e){var r,s;return{name:e.name.trim().toUpperCase(),sku:e.sku.trim().toUpperCase(),supplierCode:((r=e.supplierCode)==null?void 0:r.trim().toUpperCase())||"",purchasePackaging:e.purchasePackaging.trim().toUpperCase(),salePackaging:((s=e.salePackaging)==null?void 0:s.trim().toUpperCase())||"",price:Number(e.price),minPackageStock:Number(e.minPackageStock),desiredStock:Number(e.desiredStock),order:Number(e.order),providerId:e.providerId,tags:e.tags||[]}}class X extends Error{constructor(r,s){super(r,s),this.name="DatabaseError"}}class we extends Error{constructor(r,s,n){super(r,n),this.field=s,this.name="ValidationError"}}function br(e){return e instanceof X||e instanceof we}function it(e){return e instanceof Error?e.message:"An unexpected error occurred"}async function xo(e){try{const r=O(T,"products"),s=await $e(r,e);if(!s.key)throw new X("Failed to generate product ID");return s.key}catch(r){throw new X("Failed to create product",{cause:r})}}async function bo(e,r){try{const s=O(T,`products/${e}`);if(!(await H(s)).exists())throw new X("Product not found");const{id:a,...o}=r;typeof o.supplierCode>"u"&&(o.supplierCode=""),await Ve(s,o)}catch(s){throw new X("Failed to update product",{cause:s})}}async function yo(e){try{const r=O(T,`products/${e}`),s=await H(r);return s.exists()?{id:e,...s.val()}:null}catch(r){throw new X("Failed to get product",{cause:r})}}async function wo(e){try{const r=O(T,`products/${e}`);await ft(r)}catch(r){throw new X("Failed to delete product",{cause:r})}}function Nt(e){const[r,s]=g.useState([]),[n,a]=g.useState(!0);return g.useEffect(()=>{if(!e){s([]),a(!1);return}const l=O(T,"products"),d=gt(l,xt("providerId"),pt(e)),m=te(d,h=>{const u=h.val(),f=u?Object.entries(u).map(([x,b])=>({id:x,...b})):[];s(f),a(!1)});return()=>m()},[e]),{products:r,loading:n,addProduct:async l=>{try{const d=ot(l);if(d)throw new we(d.message,d.field);const m=zt(l);return await xo(m)}catch(d){const m=br(d)?d.message:"Error al crear el producto";throw P.error(m),d}},updateProduct:async(l,d)=>{if(!l)throw new we("ID de producto no válido");try{const m=await yo(l);if(!m)throw new we("Producto no encontrado");const h={...m,...d,supplierCode:d.supplierCode??m.supplierCode??"",id:l},u=ot(h);if(u)throw new we(u.message,u.field);const f=zt(h);return await bo(l,f),f}catch(m){const h=it(m);throw P.error(h),m}},deleteProduct:async l=>{if(!l)throw new we("ID de producto no válido");try{await wo(l)}catch(d){const m=it(d);throw P.error(m),d}}}}function Wt({label:e,value:r,onChange:s,onRemove:n,suggestions:a=[],className:o,error:i,...c}){const[l,d]=g.useState(""),[m,h]=g.useState(!1),u=g.useRef(null),f=g.useRef(null);g.useEffect(()=>{const y=w=>{f.current&&!f.current.contains(w.target)&&h(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]);const x=y=>{d(y.target.value.toUpperCase()),h(!0)},b=y=>{y.key==="Enter"&&l.trim()&&(y.preventDefault(),s(l.trim()),d(""),h(!1))},p=y=>{var w;s(y),d(""),h(!1),(w=u.current)==null||w.focus()};return t.jsxs("div",{ref:f,className:"relative",children:[e&&t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e}),t.jsx("div",{className:_("flex items-center min-h-[42px] w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5","focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",i&&"border-red-500 focus-within:border-red-500 focus-within:ring-red-500",o),children:r?t.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm bg-blue-100 text-blue-800 mr-2",children:[r,t.jsx("button",{type:"button",onClick:n,className:"ml-1 p-0.5 hover:bg-blue-200 rounded-full transition-colors",children:t.jsx(le,{className:"w-3 h-3"})})]}):t.jsx("input",{ref:u,type:"text",className:"flex-1 outline-none bg-transparent text-gray-900 placeholder-gray-500 text-sm",value:l,onChange:x,onKeyDown:b,onFocus:()=>h(!0),...c})}),i&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:i}),m&&!r&&a.length>0&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:a.filter(y=>y.includes(l.toUpperCase())).map(y=>t.jsx("button",{type:"button",className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none",onClick:()=>p(y),children:y},y))})]})}function vo({label:e,value:r=[],onChange:s,suggestions:n=[],error:a,className:o}){const[i,c]=g.useState(""),[l,d]=g.useState(!1),m=g.useRef(null),h=g.useRef(null);g.useEffect(()=>{const w=v=>{h.current&&!h.current.contains(v.target)&&d(!1)};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[]);const u=w=>{c(w.target.value.toUpperCase()),d(!0)},f=w=>{w.key==="Enter"&&i.trim()?(w.preventDefault(),x(i.trim())):w.key==="Backspace"&&!i&&r.length>0&&b(r[r.length-1])},x=w=>{const v=w.toUpperCase();r.includes(v)||s([...r,v]),c(""),d(!1)},b=w=>{s(r.filter(v=>v!==w))},p=w=>{var v;x(w),(v=m.current)==null||v.focus()},y=n.filter(w=>!r.includes(w)&&w.includes(i.toUpperCase()));return t.jsxs("div",{ref:h,className:"relative",children:[e&&t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e}),t.jsxs("div",{className:_("flex flex-wrap items-center gap-2 min-h-[42px] w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5","focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",a&&"border-red-500 focus-within:border-red-500 focus-within:ring-red-500",o),children:[r.map(w=>t.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm bg-blue-100 text-blue-800",children:[w,t.jsx("button",{type:"button",onClick:()=>b(w),className:"ml-1 p-0.5 hover:bg-blue-200 rounded-full transition-colors",children:t.jsx(le,{className:"w-3 h-3"})})]},w)),t.jsx("div",{className:"flex-1 min-w-[120px]",children:t.jsx("input",{ref:m,type:"text",className:"w-full outline-none bg-transparent text-gray-900 placeholder-gray-500 text-sm",value:i,onChange:u,onKeyDown:f,onFocus:()=>d(!0),placeholder:"Agregar etiqueta..."})})]}),a&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:a}),l&&i&&y.length>0&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:y.map(w=>t.jsxs("button",{type:"button",className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none flex items-center gap-2",onClick:()=>p(w),children:[t.jsx(Le,{className:"w-4 h-4 text-gray-400"}),w]},w))})]})}function jo(){const[e,r]=g.useState([]),[s,n]=g.useState(!0);return g.useEffect(()=>{const o=O(T,"packaging"),i=O(T,"products"),c=te(o,d=>{const m=d.val(),h=m?Object.values(m):[],u=[...new Set([...Ia,...h])];r(u.sort()),n(!1)}),l=te(i,d=>{const m=d.val();if(m){const h=Object.values(m).map(u=>u.packaging).filter(Boolean).map(u=>u.toUpperCase());r(u=>[...new Set([...u,...h])].sort())}});return()=>{c(),l()}},[]),{packagingSuggestions:e,loading:s,addPackaging:async o=>{const i=O(T,"packaging"),c=$e(i);await ze(c,o.toUpperCase())}}}function No(){const[e,r]=g.useState([]),[s,n]=g.useState(!0);return g.useEffect(()=>{const o=O(T,"tags"),i=O(T,"products"),c=te(o,d=>{const m=d.val(),h=m?Object.values(m):[];r(h.sort()),n(!1)}),l=te(i,d=>{const m=d.val();if(m){const h=Object.values(m).flatMap(u=>u.tags||[]).filter(Boolean).map(u=>u.toUpperCase());r(u=>[...new Set([...u,...h])].sort())}});return()=>{c(),l()}},[]),{tags:e,loading:s,addTag:async o=>{const i=O(T,"tags"),c=$e(i);await ze(c,o.toUpperCase())}}}const Be="M",et=4;function Po(){const[e,r]=g.useState(""),[s,n]=g.useState(!0);return g.useEffect(()=>{(async()=>{try{const o=O(T,"products"),i=await H(o);if(!i.exists()){r(`${Be}${"0".repeat(et-1)}1`);return}const c=Object.values(i.val()),l=new RegExp(`^${Be}\\d{${et}}$`),d=c.map(u=>u.sku).filter(u=>l.test(u)).map(u=>parseInt(u.slice(Be.length))),h=(d.length>0?Math.max(...d)+1:1).toString().padStart(et,"0");r(`${Be}${h}`)}catch(o){console.error("Error generating SKU suggestion:",o),r("")}finally{n(!1)}})()},[]),{suggestedSku:e,loading:s}}function So({initialData:e,providerId:r,onSubmit:s}){const[n,a]=g.useState({name:(e==null?void 0:e.name)||"",sku:(e==null?void 0:e.sku)||"",supplierCode:(e==null?void 0:e.supplierCode)||"",purchasePackaging:(e==null?void 0:e.purchasePackaging)||"",salePackaging:(e==null?void 0:e.salePackaging)||"",order:(e==null?void 0:e.order)||0,price:(e==null?void 0:e.price)||0,desiredStock:(e==null?void 0:e.desiredStock)||0,minPackageStock:(e==null?void 0:e.minPackageStock)||0,providerId:(e==null?void 0:e.providerId)||r,tags:(e==null?void 0:e.tags)||[]}),[o,i]=g.useState(!1),[c,l]=g.useState({}),d=(f,x)=>{a(b=>({...b,[f]:x})),c[f]&&l(b=>{const p={...b};return delete p[f],p})},m=f=>{d("providerId",f),d("supplierCode","")},h=()=>{const f=ot(n);return f?(l({[f.field]:f.message}),P.error(f.message),!1):!0};return{formData:n,updateField:d,handleProviderChange:m,handleSubmit:async f=>{var x,b;if(f.preventDefault(),!o){l({});try{if(!h())return;i(!0);const p={...n,name:n.name.toUpperCase(),sku:n.sku.toUpperCase(),supplierCode:((x=n.supplierCode)==null?void 0:x.toUpperCase())||"",purchasePackaging:n.purchasePackaging.toUpperCase(),salePackaging:((b=n.salePackaging)==null?void 0:b.toUpperCase())||"",price:Number(n.price),minPackageStock:Number(n.minPackageStock),desiredStock:Number(n.desiredStock),order:Number(n.order),tags:n.tags||[]};await s(p),P.success(e?"Producto actualizado exitosamente":"Producto creado exitosamente")}catch(p){throw console.error("Error saving product:",p),P.error(p instanceof Error?p.message:"Error al guardar el producto"),p}finally{i(!1)}}},isSubmitting:o,errors:c,validateForm:h}}function G(e){const r=e.toString().padStart(5,"0"),s=parseInt(r.slice(0,2))-1;return s>=0&&s<ee.length?ee[s].code:ee[0].code}function U(e){const r=e.toString().padStart(5,"0");return parseInt(r.slice(2))}function Me(e,r){const s=ee.findIndex(n=>n.code===e)+1;return parseInt(`${s.toString().padStart(2,"0")}${r.toString().padStart(3,"0")}`)}function Qe(e){const r=G(e),s=U(e);return`${r}-${s.toString().padStart(3,"0")}`}const qt={GRL:{bg:"bg-gray-100",border:"border-gray-200",text:"text-gray-800"},GFR:{bg:"bg-green-100",border:"border-green-200",text:"text-green-800"},GRE:{bg:"bg-emerald-100",border:"border-emerald-200",text:"text-emerald-800"},GTM:{bg:"bg-teal-100",border:"border-teal-200",text:"text-teal-800"},GPA:{bg:"bg-amber-100",border:"border-amber-200",text:"text-amber-800"},GSC:{bg:"bg-orange-100",border:"border-orange-200",text:"text-orange-800"},HEL:{bg:"bg-blue-100",border:"border-blue-200",text:"text-blue-800"},REF:{bg:"bg-indigo-100",border:"border-indigo-200",text:"text-indigo-800"},CON:{bg:"bg-purple-100",border:"border-purple-200",text:"text-purple-800"},FRU:{bg:"bg-rose-100",border:"border-rose-200",text:"text-rose-800"}};function Ue(e){return qt[e]||qt.GRL}async function Co(e,r){try{const s=O(T,"products"),n=await H(s);if(!n.exists())throw new X("No products found");const a=Object.entries(n.val()).map(([u,f])=>({id:u,...f})),o=a.find(u=>u.id===e);if(!o)throw new X("Product not found");const i=G(o.order),c=G(r),l=U(r),d=a.filter(u=>G(u.order)===c).sort((u,f)=>U(u.order)-U(f.order)),m={};if(i===c){const u=U(o.order);d.forEach(f=>{if(f.id===e)return;let x=U(f.order);u<l?x>u&&x<=l&&(x--,m[f.id]=Me(c,x)):x>=l&&x<u&&(x++,m[f.id]=Me(c,x))})}else d.forEach(u=>{const f=U(u.order);f>=l&&(m[u.id]=Me(c,f+1))});m[e]=r;const h=Object.entries(m).reduce((u,[f,x])=>({...u,[`products/${f}/order`]:x}),{});await Ve(O(T),h)}catch(s){throw new X("Failed to update product order",{cause:s})}}function ko(){const[e,r]=g.useState(!1);return{updateOrder:async(n,a)=>{if(!e){r(!0);try{await Co(n,a),P.success("Orden actualizado correctamente")}catch(o){const i=br(o)?it(o):"Error al actualizar el orden";throw P.error(i),o}finally{r(!1)}}},isProcessing:e}}function Eo({isOpen:e,onClose:r,product:s,products:n,onOrderChange:a}){const[o,i]=g.useState(G(s.order)),[c,l]=g.useState(U(s.order)),{updateOrder:d,isProcessing:m}=ko(),h=n.filter(j=>G(j.order)===o).sort((j,I)=>U(j.order)-U(I.order)),u=h.length,f=c>1?h[c-2]:null,x=c<u?h[c-1]:null,b=Ue(G(s.order)),p=Ue(o),y=j=>{const I=j.target.value;i(I);const $=n.filter(W=>G(W.order)===I).length;l($+1)},w=j=>{const I=j==="prev"?Math.max(1,c-1):Math.min(u,c+1);l(I)},v=async()=>{if(!m)try{const j=Me(o,c);await a(j),r()}catch(j){console.error("Error updating order:",j)}};return t.jsx(se,{isOpen:e,onClose:r,title:"Cambiar orden del producto",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:`rounded-lg p-4 border ${b.bg} ${b.border}`,children:[t.jsx("div",{className:`text-sm font-medium ${b.text}`,children:s.name}),t.jsxs("div",{className:`text-sm mt-1 ${b.text}`,children:["Orden actual: ",Qe(s.order)]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sector"}),t.jsx("select",{value:o,onChange:y,className:"w-full rounded-md border border-gray-300 px-3 py-2",disabled:m,children:ee.map(j=>{const I=Ue(j.code);return t.jsxs("option",{value:j.code,className:`${I.bg}`,children:[j.code," - ",j.name]},j.code)})})]}),t.jsx("div",{className:`rounded-lg border p-4 ${p.bg} ${p.border}`,children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsx("button",{type:"button",onClick:()=>w("prev"),disabled:c<=1||m,className:`
                h-12 w-12 rounded-full flex items-center justify-center transition-colors
                ${c<=1||m?"bg-white/50 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-white/80"}
              `,children:t.jsx(Lr,{className:"w-6 h-6"})}),t.jsx("div",{className:"flex-1",children:t.jsx("div",{className:"bg-white rounded-lg py-3 shadow-sm",children:t.jsxs("div",{className:"text-center",children:[t.jsx("span",{className:"text-2xl font-bold",children:c}),t.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["de ",u]})]})})}),t.jsx("button",{type:"button",onClick:()=>w("next"),disabled:c>=u||m,className:`
                h-12 w-12 rounded-full flex items-center justify-center transition-colors
                ${c>=u||m?"bg-white/50 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-white/80"}
              `,children:t.jsx($r,{className:"w-6 h-6"})})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:`rounded-lg p-4 ${f?"border bg-white":"bg-gray-50 border-2 border-dashed"}`,children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Anterior"}),f?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:f.name}),t.jsx("div",{className:`text-xs ${p.text}`,children:U(f.order)})]}):t.jsx("div",{className:"text-sm text-gray-400",children:"No hay producto anterior"})]}),t.jsxs("div",{className:`rounded-lg p-4 ${x?"border bg-white":"bg-gray-50 border-2 border-dashed"}`,children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Siguiente"}),x?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:x.name}),t.jsx("div",{className:`text-xs ${p.text}`,children:U(x.order)})]}):t.jsx("div",{className:"text-sm text-gray-400",children:"No hay producto siguiente"})]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(k,{type:"button",variant:"outline",onClick:r,disabled:m,children:"Cancelar"}),t.jsx(k,{onClick:v,disabled:m,isLoading:m,children:"Confirmar"})]})]})})}function yr({providerId:e,initialData:r,onSubmit:s,onCancel:n,isLoading:a}){const{providers:o}=pe(),{packagingSuggestions:i,addPackaging:c}=jo(),{tags:l,addTag:d}=No(),{products:m}=Nt(e),{suggestedSku:h,loading:u}=Po(),[f,x]=Re.useState(!1),{formData:b,updateField:p,handleProviderChange:y,handleSubmit:w,isSubmitting:v,errors:j}=So({initialData:r,providerId:e,onSubmit:async N=>{try{await s({...N,providerId:N.providerId||e,id:r==null?void 0:r.id})}catch(q){throw console.error("Error in form submission:",q),q}}}),I=async N=>{p("order",N),x(!1)},$=async N=>{p("tags",N);const q=N.filter(E=>!l.includes(E));for(const E of q)await d(E)},W=Ue(G(b.order));return t.jsxs("form",{onSubmit:w,className:"space-y-6",children:[t.jsx(z,{label:"Nombre del producto",value:b.name,onChange:N=>p("name",N.target.value.toUpperCase()),error:j.name,required:!0}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(z,{label:"SKU",value:b.sku,onChange:N=>p("sku",N.target.value.toUpperCase()),error:j.sku,required:!0}),!r&&!u&&h&&t.jsxs("p",{className:"text-sm text-blue-600",children:["SKU sugerido: ",h]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Proveedor"}),t.jsx("select",{value:b.providerId,onChange:N=>y(N.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",children:o.map(N=>t.jsx("option",{value:N.id,children:N.commercialName},N.id))})]}),t.jsx(z,{label:"Código de proveedor",value:b.supplierCode,onChange:N=>p("supplierCode",N.target.value.toUpperCase()),placeholder:"Código asignado por el proveedor"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(Wt,{label:"Empaque de Compra",value:b.purchasePackaging,onChange:async N=>{p("purchasePackaging",N.toUpperCase()),i.includes(N.toUpperCase())||await c(N)},onRemove:()=>p("purchasePackaging",""),suggestions:i,placeholder:"Escriba y presione Enter",error:j.purchasePackaging,required:!0}),t.jsx(Wt,{label:"Empaque de Venta",value:b.salePackaging,onChange:async N=>{p("salePackaging",N.toUpperCase()),i.includes(N.toUpperCase())||await c(N)},onRemove:()=>p("salePackaging",""),suggestions:i,placeholder:"Escriba y presione Enter",error:j.salePackaging})]}),t.jsx(vo,{label:"Etiquetas",value:b.tags,onChange:$,suggestions:l}),t.jsx("div",{className:`rounded-lg p-4 border cursor-pointer transition-colors ${W.bg} ${W.border} hover:opacity-90`,onClick:()=>x(!0),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("label",{className:`text-sm font-medium ${W.text}`,children:"Orden del Producto"}),t.jsx("div",{className:`text-lg font-bold mt-1 ${W.text}`,children:Qe(b.order)})]}),t.jsx(ht,{className:`w-5 h-5 ${W.text}`})]})}),t.jsx(z,{label:"Precio",value:b.price,onChange:N=>p("price",parseFloat(N.target.value)||0),error:j.price,min:0,required:!0,isCurrency:!0}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(z,{label:"Stock mínimo",type:"number",value:b.minPackageStock,onChange:N=>p("minPackageStock",parseInt(N.target.value)||0),error:j.minPackageStock,min:0,required:!0}),t.jsx(z,{label:"Stock deseado",type:"number",value:b.desiredStock,onChange:N=>p("desiredStock",parseInt(N.target.value)||0),error:j.desiredStock,min:0,required:!0})]}),t.jsxs("div",{className:"flex justify-end space-x-4",children:[t.jsx(k,{type:"button",variant:"outline",onClick:n,disabled:a||v,children:"Cancelar"}),t.jsxs(k,{type:"submit",isLoading:a||v,children:[r?"Actualizar":"Crear"," Producto"]})]}),r&&t.jsx(Eo,{isOpen:f,onClose:()=>x(!1),product:r,products:m,onOrderChange:I})]})}function wr({providerId:e,initialData:r,onSubmit:s,onCancel:n,isLoading:a}){const o=async i=>{try{r?await s({...i,id:r.id,order:r.order,providerId:r.providerId}):await s({...i,providerId:e})}catch(c){throw console.error("Error en FullscreenProductForm submit:",c),c}};return t.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[t.jsx("div",{className:"border-b bg-white sticky top-0 z-10",children:t.jsxs("div",{className:"flex items-center justify-between px-3 h-16",children:[t.jsx("h2",{className:"text-lg font-semibold",children:r?`Editar ${r.name}`:"Nuevo Producto"}),t.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",disabled:a,"aria-label":"Cerrar",children:t.jsx(le,{className:"w-5 h-5"})})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"container mx-auto max-w-2xl px-3 py-4",children:t.jsx(yr,{providerId:e,initialData:r,onSubmit:o,onCancel:n,isLoading:a})})})]})}function Oo({product:e,onEdit:r,onDelete:s,providerId:n}){const[a,o]=Re.useState(!1),[i,c]=Re.useState(!1),l=async d=>{c(!0);try{await r(e),o(!1)}finally{c(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow p-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:e.name}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ae,{className:"w-4 h-4 mr-1.5 flex-shrink-0 text-gray-500"}),t.jsx("span",{className:"truncate",children:e.purchasePackaging})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(lt,{className:"w-4 h-4 mr-1.5 flex-shrink-0 text-gray-500"}),t.jsxs("span",{children:["Stock: ",e.minPackageStock," - ",e.desiredStock]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(Vt,{className:"w-4 h-4 mr-1.5 flex-shrink-0 text-gray-500"}),t.jsx("span",{className:"truncate",children:e.supplierCode||"Sin código"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(ht,{className:"w-4 h-4 mr-1.5 text-gray-400"}),t.jsx("span",{children:mr(e.order)})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 pt-2 border-t",children:[t.jsx("div",{className:"text-xl font-bold text-blue-600",children:K(e.price)}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(k,{variant:"outline",size:"sm",onClick:()=>o(!0),children:[t.jsx(dt,{className:"w-4 h-4 mr-2"}),"Editar"]}),t.jsxs(k,{variant:"outline",size:"sm",onClick:()=>s(e),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[t.jsx(ut,{className:"w-4 h-4 mr-2"}),"Eliminar"]})]})]})]})}),a&&t.jsx(wr,{providerId:n,initialData:e,onSubmit:l,onCancel:()=>o(!1),isLoading:i})]})}function To(e){const[r,s]=g.useState(!1);return g.useEffect(()=>{const n=window.matchMedia(e);s(n.matches);const a=o=>{s(o.matches)};return n.addEventListener("change",a),()=>n.removeEventListener("change",a)},[e]),r}function Io({products:e,onEdit:r,onDelete:s,onOrderChange:n,customRender:a}){const o=To("(min-width: 1024px)"),i=[...e].sort((l,d)=>l.order-d.order),c=l=>a?a(l):t.jsx(Oo,{product:l,products:i,onEdit:r,onDelete:s,onOrderChange:n},l.id);return o?t.jsx("div",{className:"grid grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-3",children:i.map(l=>t.jsx("div",{children:c(l)},l.id))}):t.jsx("div",{className:"space-y-3",children:i.map(l=>t.jsx("div",{children:c(l)},l.id))})}function Mo({onProductSelect:e}){const[r,s]=g.useState(""),[n,a]=g.useState([]),[o,i]=g.useState([]),[c,l]=g.useState({}),[d,m]=g.useState(!0);return g.useEffect(()=>{(async()=>{try{const[u,f]=await Promise.all([H(O(T,"products")),H(O(T,"providers"))]);if(u.exists()){const x=u.val(),b=Object.entries(x).map(([p,y])=>({id:p,...y}));i(b)}if(f.exists()){const x=f.val();l(x)}}catch(u){console.error("Error fetching data:",u),P.error("Error al buscar productos")}finally{m(!1)}})()},[]),g.useEffect(()=>{if(!r.trim()){a([]);return}const h=r.toLowerCase(),u=o.filter(f=>{var x,b;return f.name.toLowerCase().includes(h)||Qe(f.order).toLowerCase().includes(h)||((x=f.supplierCode)==null?void 0:x.toLowerCase().includes(h))||((b=f.tags)==null?void 0:b.some(p=>p.toLowerCase().includes(h)))}).map(f=>({...f,provider:c[f.providerId]})).sort((f,x)=>{var v,j;const b=f.name.toLowerCase().startsWith(h),p=x.name.toLowerCase().startsWith(h);if(b&&!p)return-1;if(!b&&p)return 1;const y=(v=f.tags)==null?void 0:v.some(I=>I.toLowerCase().startsWith(h)),w=(j=x.tags)==null?void 0:j.some(I=>I.toLowerCase().startsWith(h));return y&&!w?-1:!y&&w?1:f.name.localeCompare(x.name)}).slice(0,5);a(u)},[r,o,c]),t.jsxs("div",{className:"relative mb-6",children:[t.jsxs("div",{className:"relative",children:[t.jsx(z,{placeholder:"Buscar productos en todos los proveedores...",value:r,onChange:h=>s(h.target.value),className:"pl-10 bg-blue-50 border-blue-200 focus:border-blue-400 focus:ring-blue-400 placeholder-blue-400"}),t.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-blue-400"})]}),n.length>0&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-blue-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:n.map(h=>{var u;return t.jsx("button",{onClick:()=>e(h),className:"w-full px-4 py-2 text-left hover:bg-blue-50 focus:bg-blue-50 focus:outline-none",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-900",children:h.name}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[t.jsx(mt,{className:"w-3 h-3"}),t.jsx("span",{className:"truncate",children:(u=h.provider)==null?void 0:u.commercialName})]}),h.supplierCode&&t.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Código: ",h.supplierCode]}),h.tags&&h.tags.length>0&&t.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[t.jsx(zr,{className:"w-3 h-3 text-blue-400"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:h.tags.map(f=>t.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs bg-blue-100 text-blue-600",children:f},f))})]})]}),t.jsx("div",{className:"text-blue-600 font-medium",children:K(h.price)})]})},h.id)})}),d&&r&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-blue-200 rounded-lg shadow-lg p-4 text-center text-gray-500",children:"Buscando productos..."})]})}function Ro({products:e,onFilter:r}){const[s,n]=g.useState(""),a=g.useCallback(c=>{const l=c.trim();if(!l)return{filtered:e,isActive:!1};const d=l.toLowerCase();return{filtered:e.filter(h=>{var u,f,x;return h.name.toLowerCase().includes(d)||h.sku.toLowerCase().includes(d)||((u=h.supplierCode)==null?void 0:u.toLowerCase().includes(d))||mr(h.order).toLowerCase().includes(d)||h.purchasePackaging.toLowerCase().includes(d)||((f=h.salePackaging)==null?void 0:f.toLowerCase().includes(d))||K(h.price).toLowerCase().includes(d)||((x=h.tags)==null?void 0:x.some(b=>b.toLowerCase().includes(d)))}),isActive:!0}},[e]),{filtered:o,isActive:i}=g.useMemo(()=>a(s),[a,s]);return g.useEffect(()=>{r(o,i)},[o,i,r]),t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"relative",children:[t.jsx(z,{placeholder:"Buscar por nombre, SKU, código, orden, empaque, precio o etiquetas...",value:s,onChange:c=>n(c.target.value),className:"pl-10 bg-amber-50 border-amber-200 focus:border-amber-400 focus:ring-amber-400 placeholder-amber-400"}),t.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-amber-400"})]})})}function Do(){const{providers:e}=pe(),[r,s]=g.useState(""),{products:n,loading:a,addProduct:o,updateProduct:i,deleteProduct:c}=Nt(r),[l,d]=g.useState([]),[m,h]=g.useState(!1),[u,f]=g.useState(null),[x,b]=g.useState(!1),[p,y]=g.useState(null),[w,v]=g.useState(!1),j=async R=>{b(!0);try{if(u)await i(u.id,{...R,id:u.id}),P.success("Producto actualizado exitosamente");else{const S=ee[0].code,de=n.filter(xe=>G(xe.order)===S),ne=Me(S,de.length+1);await o({...R,order:ne}),P.success("Producto creado exitosamente")}W()}catch{P.error("Error al guardar el producto")}finally{b(!1)}},I=async R=>{y(R)},$=async()=>{if(p)try{await c(p.id),P.success("Producto eliminado exitosamente"),y(null)}catch{P.error("Error al eliminar el producto")}},W=()=>{h(!1),f(null)},N=R=>{f(R),h(!0)},q=()=>{if(u){const R=se({isOpen:!0,onClose:()=>{},title:"Advertencia",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-amber-600",children:"Hay un producto en edición. ¿Desea cancelar los cambios y crear uno nuevo?"}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(k,{variant:"outline",onClick:()=>R.close(),children:"Cancelar"}),t.jsx(k,{onClick:()=>{f(null),h(!0),R.close()},children:"Continuar"})]})]})})}else h(!0)},E=g.useCallback((R,S)=>{d(R),v(S)},[]);return t.jsxs("div",{className:"space-y-6",children:[t.jsx(Mo,{onProductSelect:N}),t.jsx("div",{className:"space-y-4 md:space-y-0",children:t.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsx(xr,{providers:e,selectedProviderId:r,onChange:s})}),r&&t.jsx("div",{className:"flex-shrink-0 w-full md:w-auto",children:t.jsxs(k,{onClick:q,className:"w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white h-[48px] px-6 rounded-lg shadow-sm hover:shadow transition-all",children:[t.jsx(Le,{className:"w-5 h-5 mr-2"}),t.jsx("span",{className:"whitespace-nowrap",children:"Nuevo Producto"})]})})]})}),m&&t.jsx(wr,{providerId:(u==null?void 0:u.providerId)||r,initialData:u||void 0,onSubmit:j,onCancel:W,isLoading:x}),r?a?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):!m&&t.jsxs(t.Fragment,{children:[t.jsx(Ro,{products:n,onFilter:E}),!w||l.length>0?t.jsx(Io,{products:w?l:n,onEdit:N,onDelete:I,providerId:r}):t.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:t.jsx("p",{className:"text-gray-500 text-center px-4",children:"No se encontraron productos que coincidan con la búsqueda"})})]}):t.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:t.jsx("p",{className:"text-gray-500 text-center px-4",children:"Seleccione un proveedor para ver sus productos"})}),t.jsx(se,{isOpen:!!p,onClose:()=>y(null),title:"Eliminar producto",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("p",{className:"text-amber-600",children:['¿Está seguro que desea eliminar el producto "',p==null?void 0:p.name,'"?']}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(k,{variant:"outline",onClick:()=>y(null),children:"Cancelar"}),t.jsx(k,{onClick:$,children:"Eliminar"})]})]})})]})}function Xe(e){const[r,s]=g.useState([]),[n,a]=g.useState(!0);return g.useEffect(()=>{let l;return(async()=>{if(!e){s([]),a(!1);return}try{const m=await Ie.getByProvider(e);m&&s(m),l=Ie.subscribeToProviderOrders(e,h=>{s(h)})}catch(m){console.error("Error setting up orders subscription:",m),P.error("Error al cargar las órdenes")}finally{a(!1)}})(),()=>{l&&l()}},[e]),{orders:r,loading:n,addOrder:async l=>{try{const d=await Ie.create(l);if(!d)throw new Error("Failed to create order");return d}catch(d){throw console.error("Error creating order:",d),new Error("Error al crear la orden")}},updateOrder:async(l,d)=>{try{await Ie.update(l,d)}catch(m){throw console.error("Error updating order:",m),new Error("Error al actualizar la orden")}},deleteOrder:async l=>{try{await Ie.delete(l)}catch(d){throw console.error("Error deleting order:",d),new Error("Error al eliminar la orden")}}}}function Fo(){const[e,r]=g.useState([]),[s,n]=g.useState(!0);return g.useEffect(()=>{const a=O(T,"orders"),o=te(a,i=>{if(!i.exists()){r([]),n(!1);return}const l=Object.entries(i.val()).map(([d,m])=>({id:d,...m})).sort((d,m)=>new Date(m.date).getTime()-new Date(d.date).getTime());r(l),n(!1)});return()=>o()},[]),{orders:e,loading:s}}function Ao(e){return[`Pedido Fecha: ${Q(Ge(e),"dd/MM/yyyy HH:mm",{locale:re})}`,Ne.name,Ne.owner,""]}function Lo(e,r,s){return`${`${e} ${r}`.padEnd(15)}${s}`}function $o(e,r){return r.sort((s,n)=>{const a=e.find(i=>i.id===s.productId),o=e.find(i=>i.id===n.productId);return!a||!o?0:a.order-o.order}).map(s=>{const n=e.find(a=>a.id===s.productId);return n?Lo(s.quantity,n.purchasePackaging,n.name):null}).filter(s=>s!==null)}function zo(e){const r=e.length,s=e.reduce((n,a)=>n+a.quantity,0);return["","--------------------------------",`Total Items: ${r}`,`Total Unidades: ${s}`,""]}function vr(e,r,s=!1){if(s){const i=[`Pedido Fecha: ${Q(Ge(e.date),"dd/MM/yyyy HH:mm",{locale:re})}`,Ne.name,Ne.owner,""],c=e.items.sort((d,m)=>{const h=r.find(f=>f.id===d.productId),u=r.find(f=>f.id===m.productId);return!h||!u?0:h.order-u.order}).map(d=>{const m=r.find(h=>h.id===d.productId);return m?`• *${d.quantity} ${m.purchasePackaging}* - ${m.name}`:null}).filter(Boolean),l=["","--------------------------------",`Total Items: ${e.items.length}`,`Total Unidades: ${e.items.reduce((d,m)=>d+m.quantity,0)}`];return[...i,...c,...l].join(`
`)}const n=Ao(e.date),a=$o(r,e.items),o=zo(e.items);return[...n,...a,...o].join(`
`)}function Wo(e,r,s){return vr(e,r,!0)}const qo=`
  /* Reset */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  /* Base styles */
  body {
    font-family: 'Courier New', monospace;
    font-size: 14px;
    line-height: 1.2;
    background: #f3f4f6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Preview Container */
  .content {
    width: 80mm;
    background: white;
    margin: 20px auto;
    padding: 2mm;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border-radius: 4px;
  }

  .header {
    text-align: center;
    margin-bottom: 3mm;
    border-bottom: 1px dashed #000;
    padding-bottom: 2mm;
  }

  .header div {
    margin-bottom: 1mm;
    font-weight: bold;
    font-size: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 2mm;
  }

  tr {
    border-bottom: none;
  }

  td {
    padding: 0.2mm;
    font-size: 14px;
    vertical-align: top;
    font-weight: bold;
  }

  td.quantity {
    white-space: nowrap;
    padding-right: 2mm;
    width: 1%;
    font-weight: bold;
    font-size: 14px;
  }

  td.name {
    word-break: break-word;
    font-size: 14px;
    font-weight: bold;
  }

  /* Summary Section */
  .summary {
    margin-top: 3mm;
    padding-top: 2mm;
    border-top: 1px dashed #000;
    text-align: right;
  }

  .summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1mm;
    font-weight: bold;
    font-size: 14px;
  }

  .summary-label {
    font-weight: normal;
  }

  /* Print Controls */
  .controls {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 100;
  }

  .print-button {
    padding: 12px 24px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .print-button:hover {
    background: #1d4ed8;
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .print-button:active {
    transform: translateY(0);
  }

  .print-button:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
  }

  .print-button svg {
    width: 16px;
    height: 16px;
  }

  /* Print Media Styles */
  @media print {
    @page {
      size: 80mm auto;
      margin: 0;
    }

    body {
      width: 80mm;
      margin: 0;
      padding: 0;
      background: white;
      min-height: auto;
      font-size: 14px;
    }

    .content {
      width: 100%;
      margin: 0;
      padding: 1mm;
      box-shadow: none;
      border-radius: 0;
    }

    .controls {
      display: none !important;
    }

    tr {
      page-break-inside: avoid;
    }

    td {
      font-size: 14px;
      padding: 0.2mm 1mm;
      vertical-align: top;
      font-weight: bold;
    }

    td.quantity {
      font-size: 14px;
      font-weight: bold;
    }

    td.name {
      font-size: 14px;
      font-weight: bold;
    }

    .header {
      margin-bottom: 2mm;
      padding-bottom: 1mm;
    }

    .header div {
      margin-bottom: 0.5mm;
      font-size: 20px;
    }

    .summary {
      margin-top: 2mm;
      padding-top: 1mm;
    }
  }
`,_o=`
  let isPrinting = false;
  let retryCount = 0;
  const MAX_RETRIES = 3;

  function createPrintIcon() {
    return \`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
      </svg>
    \`;
  }

  function showError(message) {
    const existingError = document.querySelector('.error-message');
    if (existingError) {
      existingError.remove();
    }

    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    document.body.appendChild(errorDiv);

    const printButton = document.getElementById('print-button');
    if (printButton) {
      printButton.disabled = false;
    }

    // Auto-hide error after 5 seconds
    setTimeout(() => {
      errorDiv.remove();
    }, 5000);
  }

  function setupPrintButton() {
    const printButton = document.getElementById('print-button');
    if (printButton) {
      printButton.innerHTML = createPrintIcon() + 'Imprimir';
    }
  }

  function handlePrint() {
    if (isPrinting) return;

    try {
      const printButton = document.getElementById('print-button');
      printButton.disabled = true;
      isPrinting = true;

      window.print();

      // Handle print completion
      window.onafterprint = () => {
        isPrinting = false;
        setTimeout(() => {
          window.close();
        }, 100);
      };

      // Timeout handler for print dialog
      setTimeout(() => {
        if (!window.closed && isPrinting) {
          isPrinting = false;
          printButton.disabled = false;
          
          if (retryCount < MAX_RETRIES) {
            retryCount++;
            showError('La impresión está tardando más de lo esperado. Intente nuevamente.');
          } else {
            showError('No se pudo completar la impresión. Por favor, cierre esta ventana e intente nuevamente.');
          }
        }
      }, 2000);

    } catch (error) {
      console.error('Print error:', error);
      isPrinting = false;
      showError('Error al imprimir. Por favor, intente nuevamente.');
    }
  }

  window.onload = () => {
    try {
      setupPrintButton();
      // Delay initial print to ensure content is rendered
      setTimeout(handlePrint, 800);
    } catch (error) {
      console.error('Print error:', error);
      showError('Error al iniciar la impresión. Por favor, use el botón Imprimir.');
    }
  };

  window.onerror = (message, source, lineno, colno, error) => {
    console.error('Print error:', { message, source, lineno, colno, error });
    showError('Ocurrió un error inesperado. Por favor, intente nuevamente.');
    return false;
  };
`;function Bo(e,r){const s=Q(Ge(e.date),"dd/MM/yyyy HH:mm",{locale:re}),a=e.items.sort((o,i)=>{const c=r.find(d=>d.id===o.productId),l=r.find(d=>d.id===i.productId);return!c||!l?0:c.order-l.order}).map(o=>{const i=r.find(c=>c.id===o.productId);return i?`
        <tr>
          <td class="quantity">${o.quantity} ${i.purchasePackaging}</td>
          <td class="name">${i.name}</td>
        </tr>
      `:""}).join("");return`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Orden de Compra</title>
        <style>${qo}</style>
      </head>
      <body>
        <div class="content">
          <div class="header">
            <div>Pedido Fecha: ${s}</div>
            <div>${Ne.name}</div>
            <div>${Ne.owner}</div>
          </div>

          <table>
            <tbody>
              ${a}
            </tbody>
          </table>
        </div>

        <div class="controls">
          <button id="print-button" class="print-button">
            Imprimir
          </button>
        </div>

        <script>${_o}<\/script>
      </body>
    </html>
  `}function jr({order:e,products:r,provider:s,onReopen:n}){const{updateOrder:a,deleteOrder:o}=Xe(s.id),[i,c]=g.useState(!1),[l,d]=g.useState(!1),m=async()=>{if(!s.phone){P.error("Este proveedor no tiene número de teléfono registrado");return}d(!0);try{e.status==="pending"&&await a(e.id,{...e,status:"completed"});const f=Wo(e,r,s),x=ar(s.phone,f);window.open(x,"_blank"),e.status==="pending"&&P.success("Orden completada y enviada por WhatsApp")}catch(f){console.error("Error sending WhatsApp:",f),P.error("Error al enviar por WhatsApp")}finally{d(!1)}},h=async()=>{d(!0);try{e.status==="pending"&&await a(e.id,{...e,status:"completed"});const f=Bo(e,r),x=window.open("","_blank");if(!x)throw new Error("No se pudo crear la pestaña de impresión");x.document.write(f),x.document.close(),e.status==="pending"&&P.success("Orden completada e impresa")}catch(f){console.error("Error printing order:",f),P.error("Error al imprimir la orden")}finally{d(!1)}},u=async()=>{d(!0);try{await o(e.id),P.success("Orden eliminada exitosamente"),c(!1)}catch(f){console.error("Error deleting order:",f),P.error("Error al eliminar la orden")}finally{d(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.phone&&t.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:m,disabled:l,className:"text-green-600 hover:text-green-700 hover:bg-green-50 w-11 h-11 p-0",title:"Enviar por WhatsApp",children:t.jsx(Wr,{className:"w-5 h-5"})}),t.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:h,disabled:l,className:"text-gray-600 hover:text-gray-700 hover:bg-gray-50 w-11 h-11 p-0",title:"Imprimir",children:t.jsx(qr,{className:"w-5 h-5"})}),e.status==="completed"&&n&&t.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:n,disabled:l,className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 w-11 h-11 p-0",title:"Reabrir orden",children:t.jsx(_r,{className:"w-5 h-5"})}),t.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>c(!0),disabled:l,className:"text-red-600 hover:text-red-700 hover:bg-red-50 w-11 h-11 p-0",title:"Eliminar orden",children:t.jsx(ut,{className:"w-5 h-5"})})]}),t.jsx(se,{isOpen:i,onClose:()=>c(!1),title:"Eliminar orden",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-amber-600",children:"¿Está seguro que desea eliminar esta orden?"}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(k,{variant:"outline",onClick:()=>c(!1),disabled:l,children:"Cancelar"}),t.jsx(k,{onClick:u,isLoading:l,children:"Eliminar"})]})]})})]})}function _t({orders:e,products:r,provider:s,onSelect:n}){const{providers:a}=pe(),o=[...e].sort((i,c)=>new Date(c.date).getTime()-new Date(i.date).getTime());return t.jsxs("div",{className:"space-y-4",children:[o.map((i,c)=>{const l=new Set(i.items.map(u=>u.productId)).size,d=i.items.reduce((u,f)=>u+f.quantity,0),m=o.length-c,h=s||a.find(u=>u.id===i.providerId);return h?t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[t.jsxs("div",{className:"cursor-pointer",onClick:()=>n(i,m),children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[i.status==="completed"?t.jsx(Ut,{className:"w-5 h-5 text-green-500"}):t.jsx(Br,{className:"w-5 h-5 text-yellow-500"}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold",children:["Orden #",m," - ",Q(new Date(i.date),"d 'de' MMMM, yyyy",{locale:re})]}),t.jsxs("p",{className:"text-sm text-gray-600",children:[h.commercialName,h.legalName&&h.legalName!==h.commercialName&&t.jsxs("span",{className:"text-gray-400",children:[" • ",h.legalName]})]})]})]})}),t.jsxs("div",{className:"flex items-center justify-between text-gray-600 mt-2",children:[t.jsxs("div",{className:"space-x-2",children:[t.jsxs("span",{children:[l," ",l===1?"producto":"productos"]}),t.jsx("span",{className:"text-gray-400",children:"•"}),t.jsxs("span",{children:[d," ",d===1?"unidad":"unidades"]})]}),t.jsx("span",{className:"font-medium text-blue-600",children:K(i.total)})]})]}),t.jsx("div",{className:"mt-4 pt-4 border-t",children:t.jsx(jr,{order:i,products:r,provider:h})})]},i.id):null}),e.length===0&&t.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay órdenes para mostrar"})]})}function Uo({order:e,products:r,provider:s,preview:n=!0}){[...e.items].sort((o,i)=>{const c=r.find(d=>d.id===o.productId),l=r.find(d=>d.id===i.productId);return!c||!l?0:c.order-l.order});const a=vr(e,r,n);return t.jsx("div",{className:"font-mono text-sm bg-gray-50 p-4 rounded-lg overflow-x-auto whitespace-pre-wrap",children:a})}function Ho({order:e,orderNumber:r,products:s,provider:n,onClose:a,onEdit:o}){const[i,c]=g.useState(!1),{updateOrder:l}=Xe(n.id),[d,m]=g.useState(!1),h=Q(Ge(e.date),"d 'de' MMMM, yyyy HH:mm",{locale:re}),u=e.items.length,f=e.items.reduce((b,p)=>b+p.quantity,0),x=async()=>{m(!0);try{await l(e.id,{...e,status:"pending"}),P.success("Orden reabierta exitosamente"),o==null||o()}catch(b){console.error("Error reopening order:",b),P.error("Error al reabrir la orden")}finally{m(!1),c(!1)}};return t.jsxs("div",{className:"fixed inset-0 bg-gray-50 z-50 flex flex-col",children:[t.jsx("div",{className:"bg-white border-b print:hidden sticky top-0 z-10",children:t.jsxs("div",{className:"flex items-center justify-between px-3 h-14",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(k,{variant:"ghost",size:"sm",onClick:a,className:"md:hidden",children:t.jsx(Ur,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("h2",{className:"text-lg font-semibold",children:["Orden #",r]}),t.jsx("span",{className:`
                  px-2 py-0.5 text-xs font-medium rounded-full
                  ${e.status==="completed"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}
                `,children:e.status==="completed"?"Completada":"Pendiente"})]}),t.jsx("p",{className:"text-sm text-gray-500",children:h})]})]}),t.jsx("button",{onClick:a,className:"hidden md:flex p-2 hover:bg-gray-100 rounded-full transition-colors",children:t.jsx(le,{className:"w-5 h-5"})})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsxs("div",{className:"container mx-auto max-w-4xl px-3 py-4",children:[t.jsxs("div",{className:"hidden print:block mb-8",children:[t.jsx("h1",{className:"text-2xl font-bold text-center mb-2",children:"Orden de Compra"}),t.jsxs("div",{className:"text-center text-gray-600 mb-4",children:["#",r]})]}),t.jsxs("div",{className:"grid gap-4",children:[t.jsxs("div",{className:"grid gap-4 sm:grid-cols-3 print:grid-cols-3",children:[t.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm print:border-gray-300",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:t.jsx(Ht,{className:"w-5 h-5 text-blue-600"})}),t.jsx("h3",{className:"font-medium",children:"Fecha"})]}),t.jsx("p",{className:"text-gray-600",children:h})]}),t.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm print:border-gray-300",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:t.jsx(mt,{className:"w-5 h-5 text-purple-600"})}),t.jsx("h3",{className:"font-medium",children:"Proveedor"})]}),t.jsx("p",{className:"font-medium",children:n.commercialName}),n.legalName&&n.legalName!==n.commercialName&&t.jsx("p",{className:"text-sm text-gray-500",children:n.legalName})]}),t.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm print:border-gray-300",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:t.jsx(Ae,{className:"w-5 h-5 text-green-600"})}),t.jsx("h3",{className:"font-medium",children:"Resumen"})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"text-gray-600",children:[u," ",u===1?"item":"items"]}),t.jsxs("p",{className:"text-gray-600",children:[f," ",f===1?"unidad":"unidades"]}),t.jsx("p",{className:"font-medium text-lg text-blue-600",children:K(e.total)})]})]})]}),t.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm print:border-gray-300",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4 print:mb-2",children:[t.jsx("div",{className:"p-2 bg-amber-50 rounded-lg",children:t.jsx(Vt,{className:"w-5 h-5 text-amber-600"})}),t.jsx("h3",{className:"font-medium",children:"Detalles del Pedido"})]}),t.jsx(Uo,{order:e,products:s,provider:n,preview:!1})]}),e.status==="completed"?t.jsx("div",{className:"print:hidden",children:t.jsx("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:t.jsx(jr,{order:e,products:s,provider:n,onReopen:()=>c(!0)})})}):t.jsx("div",{className:"print:hidden bg-amber-50 border border-amber-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center gap-3 text-amber-700",children:[t.jsx(Hr,{className:"w-5 h-5 flex-shrink-0"}),t.jsx("p",{children:"Esta orden está pendiente de completar"})]})})]})]})}),t.jsx(se,{isOpen:i,onClose:()=>c(!1),title:"Reabrir orden",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("p",{className:"text-amber-600",children:"¿Está seguro que desea reabrir esta orden para edición?"}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(k,{variant:"outline",onClick:()=>c(!1),disabled:d,children:"Cancelar"}),t.jsx(k,{onClick:x,isLoading:d,children:"Reabrir"})]})]})})]})}function Vo({orders:e,products:r,onOrderSelect:s}){const[n,a]=g.useState(""),[o,i]=g.useState([]);return g.useEffect(()=>{if(!n.trim()){i([]);return}const c=n.toLowerCase(),l=[...e].sort((m,h)=>new Date(h.date).getTime()-new Date(m.date).getTime()),d=l.map((m,h)=>{const u=m.items.map(f=>{var p;const x=r.find(y=>y.id===f.productId);return x&&(x.name.toLowerCase().includes(c)||x.sku.toLowerCase().includes(c)||((p=x.tags)==null?void 0:p.some(y=>y.toLowerCase().includes(c))))?{product:x,quantity:f.quantity}:null}).filter(f=>f!==null);return u.length===0?null:{...m,orderNumber:l.length-h,matchingProducts:u}}).filter(m=>m!==null).slice(0,5);i(d)},[n,e,r]),t.jsxs("div",{className:"relative mb-6",children:[t.jsxs("div",{className:"relative",children:[t.jsx(z,{placeholder:"Buscar productos en órdenes...",value:n,onChange:c=>a(c.target.value),className:"pl-10 bg-amber-50 border-amber-200 focus:border-amber-400 focus:ring-amber-400 placeholder-amber-400"}),t.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-amber-400"})]}),o.length>0&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-amber-200 rounded-lg shadow-lg max-h-[400px] overflow-auto",children:o.map(c=>t.jsx("button",{onClick:()=>s(c,c.orderNumber),className:"w-full px-4 py-3 text-left hover:bg-amber-50 border-b border-amber-100 last:border-b-0",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsxs("span",{className:"font-medium text-amber-700",children:["Orden #",c.orderNumber]}),t.jsx("span",{className:"text-gray-400",children:"•"}),t.jsx("span",{className:"text-sm text-gray-600",children:Q(new Date(c.date),"d 'de' MMMM, yyyy",{locale:re})})]}),t.jsx("div",{className:"space-y-1",children:c.matchingProducts.map(({product:l,quantity:d})=>t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-900",children:l.name}),t.jsxs("span",{className:"text-gray-600 whitespace-nowrap ml-2",children:[d," ",l.purchasePackaging]})]},l.id))})]}),t.jsx("div",{className:"text-amber-600 font-medium whitespace-nowrap",children:K(c.total)})]})},c.id))}),n&&o.length===0&&t.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-amber-200 rounded-lg shadow-lg p-4 text-center text-gray-500",children:"No se encontraron productos en las órdenes"})]})}function tt(e){return new Intl.NumberFormat("es-UY",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function Yo({providerId:e,product:r,onSubmit:s,onCancel:n,isSubmitting:a}){const o=async i=>{try{const c={...i,id:r.id,providerId:r.providerId,order:r.order};await s(c)}catch(c){throw console.error("Error in FullscreenProductEditor submit:",c),c}};return t.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[t.jsx("div",{className:"border-b bg-white sticky top-0 z-10",children:t.jsxs("div",{className:"flex items-center justify-between px-3 h-16",children:[t.jsxs("h2",{className:"text-lg font-semibold",children:["Editar ",r.name]}),t.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",disabled:a,children:t.jsx(le,{className:"w-5 h-5"})})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"container mx-auto max-w-2xl px-3 py-4",children:t.jsx(yr,{providerId:e,initialData:r,onSubmit:o,onCancel:n,isLoading:a})})})]})}function Go({product:e,products:r,isSelected:s,quantity:n,onQuantityChange:a,onProductUpdate:o,onReview:i,isReviewed:c}){const[l,d]=g.useState(!1),[m,h]=g.useState(!1),[u,f]=g.useState(!1),[x,b]=g.useState(n.toString()),p=g.useRef(null),y=g.useRef(null),w=g.useRef();g.useEffect(()=>{b(n.toString())},[n]),g.useEffect(()=>{const E=R=>{p.current&&!p.current.contains(R.target)&&f(!1)};return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[]),g.useEffect(()=>{u&&y.current&&(y.current.focus(),y.current.select())},[u]);const v=async E=>{if(o){h(!0);try{const R={...E,id:e.id,providerId:e.providerId};await o(e,R),d(!1)}catch(R){console.error("Error updating product:",R)}finally{h(!1)}}},j=E=>{E.target instanceof HTMLButtonElement||E.target instanceof HTMLInputElement||E.target.closest("button")||E.target.closest("input")||E.target.closest(".quantity-controls")||(w.current?(clearTimeout(w.current),w.current=void 0,a(s?0:e.desiredStock)):w.current=setTimeout(()=>{w.current=void 0,c||i()},250))},I=E=>{E.stopPropagation(),f(!0)},$=E=>{E>=0&&(a(E),c||i())},W=E=>{E.stopPropagation(),n>0&&$(n-1)},N=E=>{E.stopPropagation(),$(n+1)},q=E=>{const R=E.target.value;b(R);const S=parseInt(R);!isNaN(S)&&S>=0&&$(S)};return t.jsxs(t.Fragment,{children:[t.jsx(A,{isSelected:s,children:t.jsx(A.Header,{className:"!p-3",children:t.jsxs("div",{className:"relative",onClick:j,children:[c&&t.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full p-1",children:t.jsx(St,{className:"w-4 h-4"})}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:`
                  flex-shrink-0 w-5 h-5 rounded border cursor-pointer transition-colors mt-1
                  ${s?"bg-blue-500 border-blue-500":"border-gray-300 hover:border-blue-500"}
                `,onClick:E=>{E.stopPropagation(),$(s?0:e.desiredStock)},children:s&&t.jsx(St,{className:"w-full h-full text-white p-0.5"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("h3",{className:"font-semibold text-gray-900",children:e.name}),t.jsx(k,{variant:"ghost",size:"sm",onClick:E=>{E.stopPropagation(),d(!0)},className:"p-1 hover:bg-gray-100 rounded-full",children:t.jsx(dt,{className:"w-4 h-4 text-gray-500"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-600 mb-3",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(ht,{className:"w-4 h-4 mr-1.5 flex-shrink-0"}),t.jsxs("span",{children:["Orden: ",Qe(e.order)]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(lt,{className:"w-4 h-4 mr-1.5 flex-shrink-0"}),t.jsxs("span",{children:["Stock: ",e.minPackageStock," - ",e.desiredStock]})]})]}),s&&t.jsxs("div",{className:"flex items-end justify-between gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsx("div",{ref:p,className:"quantity-controls",children:u?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:W,disabled:n<=0,className:"w-12 h-12 rounded-full",children:t.jsx(Vr,{className:"w-5 h-5"})}),t.jsx(z,{ref:y,type:"number",min:"0",value:x,onChange:q,onClick:E=>E.stopPropagation(),placeholder:e.desiredStock.toString(),className:"text-center text-lg h-12"}),t.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:N,className:"w-12 h-12 rounded-full",children:t.jsx(Le,{className:"w-5 h-5"})})]}):t.jsx("button",{onClick:I,className:"w-full h-12 px-4 text-left bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsxs("span",{className:"text-lg font-medium",children:[n," ",e.purchasePackaging]})})})}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["$",tt(e.price)]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["Total: $",tt(e.price*n)]})]})]}),!s&&t.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["$",tt(e.price)]})]})]})]})})}),l&&t.jsx(Yo,{providerId:e.providerId,product:e,onSubmit:v,onCancel:()=>d(!1),isSubmitting:m})]})}function Qo({value:e,onChange:r}){return t.jsxs("div",{className:"relative mb-6",children:[t.jsx(z,{placeholder:"Filtrar",value:e,onChange:s=>r(s.target.value),className:"pl-10"}),t.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]})}function Xo({products:e,selectedProducts:r,onProductSelect:s,onProductUpdate:n}){const[a,o]=g.useState(new Set),[i,c]=g.useState(""),[l,d]=g.useState(!1),h=[...e].sort((b,p)=>b.order-p.order).filter(b=>{var p,y;if(l&&!r.has(b.id))return!1;if(i.trim()){const w=i.toLowerCase();return b.name.toLowerCase().includes(w)||b.sku.toLowerCase().includes(w)||((p=b.supplierCode)==null?void 0:p.toLowerCase().includes(w))||((y=b.tags)==null?void 0:y.some(v=>v.toLowerCase().includes(w)))}return!0}),u=(b,p)=>{p>=0&&(s(b,p),x(b))},f=async(b,p)=>{n&&(await n(b.id,p),x(b.id))},x=b=>{o(p=>new Set(p).add(b))};return t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(Qo,{value:i,onChange:c,placeholder:"Filtrar"})}),t.jsx(k,{variant:l?"primary":"outline",onClick:()=>d(!l),className:"w-10 h-10 p-0 flex items-center justify-center",title:l?"Mostrar todos":"Solo seleccionados",children:t.jsx(Yr,{className:"w-4 h-4"})})]}),h.map(b=>t.jsx(Go,{product:b,products:e,isSelected:r.has(b.id),quantity:r.get(b.id)||0,onQuantityChange:p=>u(b.id,p),onProductUpdate:f,onReview:()=>x(b.id),isReviewed:a.has(b.id)},b.id)),h.length===0&&t.jsx("div",{className:"text-center py-8 text-gray-500",children:l?"No hay productos seleccionados":"No se encontraron productos que coincidan con la búsqueda"})]})}function Ko(e){return Number(e.reduce((r,s)=>r+Number((s.price*s.quantity).toFixed(2)),0).toFixed(2))}function Jo(e,r){const s=Number(Number(e.price).toFixed(2)),n=Number((s*r).toFixed(2));return{productId:e.id,quantity:Number(r),price:s,subtotal:n}}function Nr(e,r,s){if(!e||!s||s.length===0)throw new Error("Invalid order data");const n=Array.from(r.entries()).map(([o,i])=>{const c=s.find(l=>l.id===o);if(!c)throw new Error(`Product ${o} not found`);return Jo(c,i)}).sort((o,i)=>{const c=s.find(d=>d.id===o.productId),l=s.find(d=>d.id===i.productId);return!c||!l?0:c.order-l.order}),a=Ko(n);return{providerId:e,date:at(),status:"pending",items:n,total:a}}function Pr(e,r){try{if(!e.providerId)return"El proveedor es requerido";if(!e.items||e.items.length===0)return"Debe agregar al menos un producto";const s=new Set;for(const a of e.items){if(!a.productId)return"Producto inválido";if(s.has(a.productId))return"No puede haber productos duplicados";if(s.add(a.productId),a.quantity<=0)return"La cantidad debe ser mayor a 0";const o=r.find(c=>c.id===a.productId);if(!o)return"Producto no encontrado";if(Math.abs(a.price-o.price)>.01)return`El precio del producto ${o.name} no coincide`;const i=Number((a.price*a.quantity).toFixed(2));if(Math.abs(a.subtotal-i)>.01)return`El subtotal del producto ${o.name} no coincide`}const n=Number(e.items.reduce((a,o)=>a+Number((o.price*o.quantity).toFixed(2)),0).toFixed(2));return Math.abs(e.total-n)>.01?"El total no coincide":null}catch(s){return console.error("Error validating order:",s),"Error al validar la orden"}}const rt=6e4;function Zo({providerId:e,selectedProducts:r,products:s,onSave:n,enabled:a=!0}){const o=g.useRef(Date.now()),i=g.useRef(),c=g.useRef(!1),l=()=>{i.current&&clearTimeout(i.current)};return g.useEffect(()=>{if(!a||!e||r.size===0){l();return}const d=async()=>{if(!c.current)try{c.current=!0;const m=Nr(e,r,s),h=Pr(m,s);if(h){console.warn("Autosave skipped due to validation error:",h);return}Date.now()-o.current>=rt&&(await n(m),o.current=Date.now(),P.success("Orden guardada automáticamente",{duration:2e3,position:"bottom-right"}))}catch(m){console.error("Error in autosave:",m),P.error("Error al guardar automáticamente",{duration:2e3,position:"bottom-right"})}finally{c.current=!1,a&&(i.current=setTimeout(d,rt))}};return i.current=setTimeout(d,rt),l},[a,e,r,s,n]),{lastSaveTime:o.current}}function ei({products:e,selectedProducts:r,onProductSelect:s,onProductUpdate:n,onConfirm:a,onCancel:o,isSubmitting:i,provider:c}){const[l,d]=g.useState(e),{orders:m,addOrder:h,updateOrder:u}=Xe(c.id),[f,x]=g.useState(!1);g.useEffect(()=>{d(p=>{const y=new Set(e.map(v=>v.id)),w=p.filter(v=>!y.has(v.id));return[...e,...w]})},[e]),Zo({providerId:c.id,selectedProducts:r,products:l,onSave:async p=>{if(!f){x(!0);try{const y=new Date,w=new Date(y.setHours(0,0,0,0)),v=new Date(y.setHours(23,59,59,999)),j=m.find(I=>{const $=new Date(I.date);return $>=w&&$<=v});j?await u(j.id,p):await h(p)}catch(y){throw console.error("Error saving order:",y),y}finally{x(!1)}}}});const b=Array.from(r.entries()).reduce((p,[y,w])=>{const v=l.find(j=>j.id===y);return p+((v==null?void 0:v.price)||0)*w},0);return t.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[t.jsx("div",{className:"border-b bg-white",children:t.jsxs("div",{className:"flex items-center justify-between px-2 h-14",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("h2",{className:"text-lg font-semibold truncate",children:[c.legalName&&c.legalName!==c.commercialName?t.jsxs("span",{className:"text-gray-500",children:[c.legalName," ",t.jsx("span",{className:"mx-1",children:"•"})]}):null,t.jsx("span",{children:c.commercialName})]}),r.size>0&&t.jsxs("div",{className:"text-sm text-gray-600",children:["Importe Total: ",t.jsx("span",{className:"font-medium text-blue-600",children:K(b)})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(k,{variant:"outline",onClick:o,disabled:i||f,size:"sm",children:"Cancelar"}),t.jsx(k,{onClick:a,isLoading:i||f,size:"sm",children:"Guardar"})]})]})}),t.jsx("div",{className:"flex-1 overflow-hidden",children:t.jsx("div",{className:"h-full overflow-y-auto",children:t.jsx("div",{className:"container mx-auto max-w-3xl px-2 py-4",children:t.jsx(Xo,{products:l,selectedProducts:r,onProductSelect:s,onProductUpdate:n})})})})]})}function ti(){const e=Qt(),[r,s]=Xr(),{providers:n}=pe(),[a,o]=g.useState(""),{orders:i,loading:c,addOrder:l,updateOrder:d}=Xe(a),{products:m,updateProduct:h}=Nt(a),{orders:u,loading:f}=Fo(),{products:x,loading:b}=pr(),[p,y]=g.useState(!1),[w,v]=g.useState(null),[j,I]=g.useState(null),[$,W]=g.useState(!1),[N,q]=g.useState(new Map),[E,R]=g.useState(!1),S=n.find(D=>D.id===a),de=u.sort((D,L)=>new Date(L.date).getTime()-new Date(D.date).getTime()).slice(0,5);g.useEffect(()=>{const D=r.get("provider"),L=r.get("new")==="true";if(D){if(o(D),L)y(!0),R(!0);else{const J=new Date,We=new Date(J.setHours(0,0,0,0)),Sr=new Date(J.setHours(23,59,59,999)),Ke=i.find(qe=>{const ke=new Date(qe.date);return ke>=We&&ke<=Sr});if(Ke){const qe=new Map;Ke.items.forEach(ke=>{qe.set(ke.productId,ke.quantity)}),q(qe),v(Ke),y(!0),R(!0)}}s({})}},[r,s,i]);const ne=(D,L)=>{const J=new Map(N);L>0?J.set(D,L):J.delete(D),q(J)},xe=async()=>{if(!a||!m||!S){P.error("Seleccione un proveedor");return}if(N.size===0){P.error("Debe agregar al menos un producto");return}W(!0);try{const D=Nr(a,N,m),L=Pr(D,m);if(L){P.error(L);return}w?(await d(w.id,D),P.success("Orden actualizada exitosamente")):(await l(D),P.success("Orden creada exitosamente")),ue()}catch(D){console.error("Error saving order:",D),P.error("Error al guardar la orden")}finally{W(!1)}},ue=()=>{y(!1),v(null),q(new Map),E&&e("/")},be=(D,L)=>{if(a||o(D.providerId),D.status==="completed")I({order:D,orderNumber:L});else{const J=new Map;D.items.forEach(We=>{J.set(We.productId,We.quantity)}),q(J),v(D),y(!0)}},Ce=()=>{if(!j)return;const D=new Map;j.order.items.forEach(L=>{D.set(L.productId,L.quantity)}),q(D),v(j.order),I(null),y(!0)},me=c||f||b;return t.jsxs("div",{className:"space-y-4",children:[t.jsx(Vo,{orders:u,products:x,onOrderSelect:be}),t.jsx("div",{className:"space-y-4 md:space-y-0",children:t.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsx(xr,{providers:n,selectedProviderId:a,onChange:o})}),a&&t.jsx("div",{className:"flex-shrink-0 w-full md:w-auto",children:t.jsxs(k,{onClick:()=>y(!0),className:"w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white h-[48px] px-6 rounded-lg shadow-sm hover:shadow transition-all",children:[t.jsx(Le,{className:"w-5 h-5 mr-2"}),t.jsx("span",{className:"whitespace-nowrap",children:"Nueva Orden"})]})})]})}),me?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t.jsxs(t.Fragment,{children:[!a&&de.length>0&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Últimas Órdenes"}),t.jsx(_t,{orders:de,products:x,onSelect:be})]}),p&&S&&t.jsx(ei,{products:m,selectedProducts:N,onProductSelect:ne,onProductUpdate:h,onConfirm:xe,onCancel:ue,isSubmitting:$,provider:S}),j&&S&&t.jsx(Ho,{order:j.order,orderNumber:j.orderNumber,products:x,provider:S,onClose:()=>I(null),onEdit:Ce}),!p&&!j&&a&&t.jsx(_t,{orders:i,products:m,provider:S,onSelect:be})]})]})}function ri(){return t.jsx(Kr,{children:t.jsxs(hs,{children:[t.jsx(Gr,{position:"top-right"}),t.jsxs(Jr,{children:[t.jsx(he,{path:"/login",element:t.jsx(Aa,{})}),t.jsx(he,{element:t.jsx(fs,{}),children:t.jsxs(he,{element:t.jsx(Fa,{}),children:[t.jsx(he,{path:"/",element:t.jsx(fo,{})}),t.jsx(he,{path:"/providers",element:t.jsx(po,{})}),t.jsx(he,{path:"/products",element:t.jsx(Do,{})}),t.jsx(he,{path:"/orders",element:t.jsx(ti,{})})]})})]})]})})}Xt(document.getElementById("root")).render(t.jsx(g.StrictMode,{children:t.jsx(ri,{})}));
//# sourceMappingURL=index-CmxJuImn.js.map
