var Qc=Object.defineProperty;var ja=t=>{throw TypeError(t)};var Xc=(t,e,r)=>e in t?Qc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var B=(t,e,r)=>Xc(t,typeof e!="symbol"?e+"":e,r),Na=(t,e,r)=>e.has(t)||ja("Cannot "+r);var be=(t,e,r)=>(Na(t,e,"read from private field"),r?r.call(t):e.get(t)),yt=(t,e,r)=>e.has(t)?ja("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),dt=(t,e,r,n)=>(Na(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);import{j as s,n as A,X as Ve,M as Jc,L as _a,a as Zc,U as Fn,P as ze,C as Ht,S as He,b as Kt,c as el,d as tl,e as rl,T as sl,f as Wt,g as Oi,h as Un,A as nl,i as Ai,k as Ft,F as Sa,l as Ei,m as $n,o as At,I as Mi,p as al,B as il,q as Us,r as Gt,s as er,t as Ca,u as ol,v as Ar,R as Dn,w as cl,x as Ti,y as ys,z as Ln,D as ll,E as Ri,G as Bn,H as Vn,J as zn,K as dl,N as yr,O as Ii,Q as Fi,V as Ui,W as ul,Y as hl,Z as ml,_ as fl,$ as gl,a0 as pl,a1 as xl,a2 as bl,a3 as vl,a4 as yl,a5 as wl,a6 as jl,a7 as Nl,a8 as _l}from"./ui-CvsEfRI4.js";import{a as $i,c as Pa,r as y,N as Di,O as Li,u as Sl,b as ka,R as ws,d as Bi,e as Cl,H as Pl,f as kl,g as ut}from"./vendor-Iby3O6Kz.js";import{i as Ol,g as Al,s as El,a as Ml,b as Tl,o as Rl,r as q,c as Me,q as sr,d as nr,e as ar,p as ct,u as Ye,f as ur,h as Ke,j as vt}from"./firebase-B5ujwCjz.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var Vi,Oa=$i;Vi=Oa.createRoot,Oa.hydrateRoot;/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Aa;(function(t){(function(e){var r=typeof globalThis=="object"?globalThis:typeof Pa=="object"?Pa:typeof self=="object"?self:typeof this=="object"?this:c(),n=a(t);typeof r.Reflect<"u"&&(n=a(r.Reflect,n)),e(n,r),typeof r.Reflect>"u"&&(r.Reflect=t);function a(l,d){return function(u,m){Object.defineProperty(l,u,{configurable:!0,writable:!0,value:m}),d&&d(u,m)}}function i(){try{return Function("return this;")()}catch{}}function o(){try{return(0,eval)("(function() { return this; })()")}catch{}}function c(){return i()||o()}})(function(e,r){var n=Object.prototype.hasOwnProperty,a=typeof Symbol=="function",i=a&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=a&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",c=typeof Object.create=="function",l={__proto__:[]}instanceof Array,d=!c&&!l,u={create:c?function(){return en(Object.create(null))}:l?function(){return en({__proto__:null})}:function(){return en({})},has:d?function(j,N){return n.call(j,N)}:function(j,N){return N in j},get:d?function(j,N){return n.call(j,N)?j[N]:void 0}:function(j,N){return j[N]}},m=Object.getPrototypeOf(Function),b=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Hc(),x=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Wc(),p=typeof WeakMap=="function"?WeakMap:Gc(),f=a?Symbol.for("@reflect-metadata:registry"):void 0,h=Vc(),g=zc(h);function w(j,N,C,M){if(V(C)){if(!fa(j))throw new TypeError;if(!ga(N))throw new TypeError;return G(j,N)}else{if(!fa(j))throw new TypeError;if(!R(N))throw new TypeError;if(!R(M)&&!V(M)&&!te(M))throw new TypeError;return te(M)&&(M=void 0),C=De(C),Se(j,N,C,M)}}e("decorate",w);function v(j,N){function C(M,K){if(!R(M))throw new TypeError;if(!V(K)&&!Lc(K))throw new TypeError;F(j,N,M,K)}return C}e("metadata",v);function _(j,N,C,M){if(!R(C))throw new TypeError;return V(M)||(M=De(M)),F(j,N,C,M)}e("defineMetadata",_);function P(j,N,C){if(!R(N))throw new TypeError;return V(C)||(C=De(C)),X(j,N,C)}e("hasMetadata",P);function S(j,N,C){if(!R(N))throw new TypeError;return V(C)||(C=De(C)),Pe(j,N,C)}e("hasOwnMetadata",S);function ee(j,N,C){if(!R(N))throw new TypeError;return V(C)||(C=De(C)),J(j,N,C)}e("getMetadata",ee);function me(j,N,C){if(!R(N))throw new TypeError;return V(C)||(C=De(C)),xe(j,N,C)}e("getOwnMetadata",me);function k(j,N){if(!R(j))throw new TypeError;return V(N)||(N=De(N)),W(j,N)}e("getMetadataKeys",k);function Y(j,N){if(!R(j))throw new TypeError;return V(N)||(N=De(N)),U(j,N)}e("getOwnMetadataKeys",Y);function de(j,N,C){if(!R(N))throw new TypeError;if(V(C)||(C=De(C)),!R(N))throw new TypeError;V(C)||(C=De(C));var M=Rr(N,C,!1);return V(M)?!1:M.OrdinaryDeleteMetadata(j,N,C)}e("deleteMetadata",de);function G(j,N){for(var C=j.length-1;C>=0;--C){var M=j[C],K=M(N);if(!V(K)&&!te(K)){if(!ga(K))throw new TypeError;N=K}}return N}function Se(j,N,C,M){for(var K=j.length-1;K>=0;--K){var Ee=j[K],Ae=Ee(N,C,M);if(!V(Ae)&&!te(Ae)){if(!R(Ae))throw new TypeError;M=Ae}}return M}function X(j,N,C){var M=Pe(j,N,C);if(M)return!0;var K=Zs(N);return te(K)?!1:X(j,K,C)}function Pe(j,N,C){var M=Rr(N,C,!1);return V(M)?!1:$e(M.OrdinaryHasOwnMetadata(j,N,C))}function J(j,N,C){var M=Pe(j,N,C);if(M)return xe(j,N,C);var K=Zs(N);if(!te(K))return J(j,K,C)}function xe(j,N,C){var M=Rr(N,C,!1);if(!V(M))return M.OrdinaryGetOwnMetadata(j,N,C)}function F(j,N,C,M){var K=Rr(C,M,!0);K.OrdinaryDefineOwnMetadata(j,N,C,M)}function W(j,N){var C=U(j,N),M=Zs(j);if(M===null)return C;var K=W(M,N);if(K.length<=0)return C;if(C.length<=0)return K;for(var Ee=new x,Ae=[],ne=0,I=C;ne<I.length;ne++){var $=I[ne],L=Ee.has($);L||(Ee.add($),Ae.push($))}for(var z=0,ae=K;z<ae.length;z++){var $=ae[z],L=Ee.has($);L||(Ee.add($),Ae.push($))}return Ae}function U(j,N){var C=Rr(j,N,!1);return C?C.OrdinaryOwnMetadataKeys(j,N):[]}function he(j){if(j===null)return 1;switch(typeof j){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return j===null?1:6;default:return 6}}function V(j){return j===void 0}function te(j){return j===null}function pe(j){return typeof j=="symbol"}function R(j){return typeof j=="object"?j!==null:typeof j=="function"}function D(j,N){switch(he(j)){case 0:return j;case 1:return j;case 2:return j;case 3:return j;case 4:return j;case 5:return j}var C="string",M=pa(j,i);if(M!==void 0){var K=M.call(j,C);if(R(K))throw new TypeError;return K}return ie(j)}function ie(j,N){var C,M;{var K=j.toString;if(cs(K)){var M=K.call(j);if(!R(M))return M}var C=j.valueOf;if(cs(C)){var M=C.call(j);if(!R(M))return M}}throw new TypeError}function $e(j){return!!j}function $t(j){return""+j}function De(j){var N=D(j);return pe(N)?N:$t(N)}function fa(j){return Array.isArray?Array.isArray(j):j instanceof Object?j instanceof Array:Object.prototype.toString.call(j)==="[object Array]"}function cs(j){return typeof j=="function"}function ga(j){return typeof j=="function"}function Lc(j){switch(he(j)){case 3:return!0;case 4:return!0;default:return!1}}function Js(j,N){return j===N||j!==j&&N!==N}function pa(j,N){var C=j[N];if(C!=null){if(!cs(C))throw new TypeError;return C}}function xa(j){var N=pa(j,o);if(!cs(N))throw new TypeError;var C=N.call(j);if(!R(C))throw new TypeError;return C}function ba(j){return j.value}function va(j){var N=j.next();return N.done?!1:N}function ya(j){var N=j.return;N&&N.call(j)}function Zs(j){var N=Object.getPrototypeOf(j);if(typeof j!="function"||j===m||N!==m)return N;var C=j.prototype,M=C&&Object.getPrototypeOf(C);if(M==null||M===Object.prototype)return N;var K=M.constructor;return typeof K!="function"||K===j?N:K}function Bc(){var j;!V(f)&&typeof r.Reflect<"u"&&!(f in r.Reflect)&&typeof r.Reflect.defineMetadata=="function"&&(j=qc(r.Reflect));var N,C,M,K=new p,Ee={registerProvider:Ae,getProvider:I,setProvider:L};return Ee;function Ae(z){if(!Object.isExtensible(Ee))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case j===z:break;case V(N):N=z;break;case N===z:break;case V(C):C=z;break;case C===z:break;default:M===void 0&&(M=new x),M.add(z);break}}function ne(z,ae){if(!V(N)){if(N.isProviderFor(z,ae))return N;if(!V(C)){if(C.isProviderFor(z,ae))return N;if(!V(M))for(var je=xa(M);;){var ke=va(je);if(!ke)return;var tt=ba(ke);if(tt.isProviderFor(z,ae))return ya(je),tt}}}if(!V(j)&&j.isProviderFor(z,ae))return j}function I(z,ae){var je=K.get(z),ke;return V(je)||(ke=je.get(ae)),V(ke)&&(ke=ne(z,ae),V(ke)||(V(je)&&(je=new b,K.set(z,je)),je.set(ae,ke))),ke}function $(z){if(V(z))throw new TypeError;return N===z||C===z||!V(M)&&M.has(z)}function L(z,ae,je){if(!$(je))throw new Error("Metadata provider not registered.");var ke=I(z,ae);if(ke!==je){if(!V(ke))return!1;var tt=K.get(z);V(tt)&&(tt=new b,K.set(z,tt)),tt.set(ae,je)}return!0}}function Vc(){var j;return!V(f)&&R(r.Reflect)&&Object.isExtensible(r.Reflect)&&(j=r.Reflect[f]),V(j)&&(j=Bc()),!V(f)&&R(r.Reflect)&&Object.isExtensible(r.Reflect)&&Object.defineProperty(r.Reflect,f,{enumerable:!1,configurable:!1,writable:!1,value:j}),j}function zc(j){var N=new p,C={isProviderFor:function($,L){var z=N.get($);return V(z)?!1:z.has(L)},OrdinaryDefineOwnMetadata:Ae,OrdinaryHasOwnMetadata:K,OrdinaryGetOwnMetadata:Ee,OrdinaryOwnMetadataKeys:ne,OrdinaryDeleteMetadata:I};return h.registerProvider(C),C;function M($,L,z){var ae=N.get($),je=!1;if(V(ae)){if(!z)return;ae=new b,N.set($,ae),je=!0}var ke=ae.get(L);if(V(ke)){if(!z)return;if(ke=new b,ae.set(L,ke),!j.setProvider($,L,C))throw ae.delete(L),je&&N.delete($),new Error("Wrong provider for target.")}return ke}function K($,L,z){var ae=M(L,z,!1);return V(ae)?!1:$e(ae.has($))}function Ee($,L,z){var ae=M(L,z,!1);if(!V(ae))return ae.get($)}function Ae($,L,z,ae){var je=M(z,ae,!0);je.set($,L)}function ne($,L){var z=[],ae=M($,L,!1);if(V(ae))return z;for(var je=ae.keys(),ke=xa(je),tt=0;;){var wa=va(ke);if(!wa)return z.length=tt,z;var Yc=ba(wa);try{z[tt]=Yc}catch(Kc){try{ya(ke)}finally{throw Kc}}tt++}}function I($,L,z){var ae=M(L,z,!1);if(V(ae)||!ae.delete($))return!1;if(ae.size===0){var je=N.get(L);V(je)||(je.delete(z),je.size===0&&N.delete(je))}return!0}}function qc(j){var N=j.defineMetadata,C=j.hasOwnMetadata,M=j.getOwnMetadata,K=j.getOwnMetadataKeys,Ee=j.deleteMetadata,Ae=new p,ne={isProviderFor:function(I,$){var L=Ae.get(I);return!V(L)&&L.has($)?!0:K(I,$).length?(V(L)&&(L=new x,Ae.set(I,L)),L.add($),!0):!1},OrdinaryDefineOwnMetadata:N,OrdinaryHasOwnMetadata:C,OrdinaryGetOwnMetadata:M,OrdinaryOwnMetadataKeys:K,OrdinaryDeleteMetadata:Ee};return ne}function Rr(j,N,C){var M=h.getProvider(j,N);if(!V(M))return M;if(C){if(h.setProvider(j,N,g))return g;throw new Error("Illegal state.")}}function Hc(){var j={},N=[],C=function(){function ne(I,$,L){this._index=0,this._keys=I,this._values=$,this._selector=L}return ne.prototype["@@iterator"]=function(){return this},ne.prototype[o]=function(){return this},ne.prototype.next=function(){var I=this._index;if(I>=0&&I<this._keys.length){var $=this._selector(this._keys[I],this._values[I]);return I+1>=this._keys.length?(this._index=-1,this._keys=N,this._values=N):this._index++,{value:$,done:!1}}return{value:void 0,done:!0}},ne.prototype.throw=function(I){throw this._index>=0&&(this._index=-1,this._keys=N,this._values=N),I},ne.prototype.return=function(I){return this._index>=0&&(this._index=-1,this._keys=N,this._values=N),{value:I,done:!0}},ne}(),M=function(){function ne(){this._keys=[],this._values=[],this._cacheKey=j,this._cacheIndex=-2}return Object.defineProperty(ne.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ne.prototype.has=function(I){return this._find(I,!1)>=0},ne.prototype.get=function(I){var $=this._find(I,!1);return $>=0?this._values[$]:void 0},ne.prototype.set=function(I,$){var L=this._find(I,!0);return this._values[L]=$,this},ne.prototype.delete=function(I){var $=this._find(I,!1);if($>=0){for(var L=this._keys.length,z=$+1;z<L;z++)this._keys[z-1]=this._keys[z],this._values[z-1]=this._values[z];return this._keys.length--,this._values.length--,Js(I,this._cacheKey)&&(this._cacheKey=j,this._cacheIndex=-2),!0}return!1},ne.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=j,this._cacheIndex=-2},ne.prototype.keys=function(){return new C(this._keys,this._values,K)},ne.prototype.values=function(){return new C(this._keys,this._values,Ee)},ne.prototype.entries=function(){return new C(this._keys,this._values,Ae)},ne.prototype["@@iterator"]=function(){return this.entries()},ne.prototype[o]=function(){return this.entries()},ne.prototype._find=function(I,$){if(!Js(this._cacheKey,I)){this._cacheIndex=-1;for(var L=0;L<this._keys.length;L++)if(Js(this._keys[L],I)){this._cacheIndex=L;break}}return this._cacheIndex<0&&$&&(this._cacheIndex=this._keys.length,this._keys.push(I),this._values.push(void 0)),this._cacheIndex},ne}();return M;function K(ne,I){return ne}function Ee(ne,I){return I}function Ae(ne,I){return[ne,I]}}function Wc(){var j=function(){function N(){this._map=new b}return Object.defineProperty(N.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),N.prototype.has=function(C){return this._map.has(C)},N.prototype.add=function(C){return this._map.set(C,C),this},N.prototype.delete=function(C){return this._map.delete(C)},N.prototype.clear=function(){this._map.clear()},N.prototype.keys=function(){return this._map.keys()},N.prototype.values=function(){return this._map.keys()},N.prototype.entries=function(){return this._map.entries()},N.prototype["@@iterator"]=function(){return this.keys()},N.prototype[o]=function(){return this.keys()},N}();return j}function Gc(){var j=16,N=u.create(),C=M();return function(){function I(){this._key=M()}return I.prototype.has=function($){var L=K($,!1);return L!==void 0?u.has(L,this._key):!1},I.prototype.get=function($){var L=K($,!1);return L!==void 0?u.get(L,this._key):void 0},I.prototype.set=function($,L){var z=K($,!0);return z[this._key]=L,this},I.prototype.delete=function($){var L=K($,!1);return L!==void 0?delete L[this._key]:!1},I.prototype.clear=function(){this._key=M()},I}();function M(){var I;do I="@@WeakMap@@"+ne();while(u.has(N,I));return N[I]=!0,I}function K(I,$){if(!n.call(I,C)){if(!$)return;Object.defineProperty(I,C,{value:u.create()})}return I[C]}function Ee(I,$){for(var L=0;L<$;++L)I[L]=Math.random()*255|0;return I}function Ae(I){if(typeof Uint8Array=="function"){var $=new Uint8Array(I);return typeof crypto<"u"?crypto.getRandomValues($):typeof msCrypto<"u"?msCrypto.getRandomValues($):Ee($,I),$}return Ee(new Array(I),I)}function ne(){var I=Ae(j);I[6]=I[6]&79|64,I[8]=I[8]&191|128;for(var $="",L=0;L<j;++L){var z=I[L];(L===4||L===6||L===8)&&($+="-"),z<16&&($+="0"),$+=z.toString(16).toLowerCase()}return $}}function en(j){return j.__=void 0,delete j.__,j}})})(Aa||(Aa={}));const Il=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_DATABASE_URL","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],Fl={apiKey:"AIzaSyCswObxYzO5gjurKWnAI387lzoEXJjn24k",authDomain:"nrd-ordenes.firebaseapp.com",databaseURL:"https://nrd-ordenes-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"nrd-ordenes",storageBucket:"nrd-ordenes.firebasestorage.app",messagingSenderId:"158356819364",appId:"1:158356819364:web:c9a87a35706babd4608531"},Ul={BASE_URL:"/ordenes/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyBopcfbHLrWQZOsgitRYWk5h26ipYbD-hE",VITE_FIREBASE_APP_ID:"1:766340976237:web:e7123eedb37568a2f9b964",VITE_FIREBASE_AUTH_DOMAIN:"nrd-ordenes-prod.firebaseapp.com",VITE_FIREBASE_DATABASE_URL:"https://nrd-ordenes-prod-default-rtdb.firebaseio.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"766340976237",VITE_FIREBASE_PROJECT_ID:"nrd-ordenes-prod",VITE_FIREBASE_STORAGE_BUCKET:"nrd-ordenes-prod.firebasestorage.app"};function $l(){const t=Il.filter(r=>!Ul[r]);return t.length>0?{isValid:!1,missingVars:t,config:null}:{isValid:!0,missingVars:[],config:{apiKey:"AIzaSyBopcfbHLrWQZOsgitRYWk5h26ipYbD-hE",authDomain:"nrd-ordenes-prod.firebaseapp.com",databaseURL:"https://nrd-ordenes-prod-default-rtdb.firebaseio.com",projectId:"nrd-ordenes-prod",storageBucket:"nrd-ordenes-prod.firebasestorage.app",messagingSenderId:"766340976237",appId:"1:766340976237:web:e7123eedb37568a2f9b964"}}}function Dl(){return{...Fl}}const zr=$l(),Ll=zr.isValid?zr.config:Dl(),zi=Ol(Ll);zr.isValid?console.info("Firebase initialized in production mode"):console.warn("Firebase initialized in demo mode. The following environment variables are missing:",zr.missingVars);const ls=!zr.isValid,_e=Al(zi);async function Bl(t,e){try{return(await El(_e,t,e)).user}catch(r){throw console.error("Authentication error:",r),new Error("Error de autenticación: credenciales inválidas")}}async function Vl(){try{await Ml(_e)}catch(t){throw console.error("Sign out error:",t),new Error("Error al cerrar sesión")}}const H=Tl(zi),qi=y.createContext(void 0);function zl({children:t}){const[e,r]=y.useState(null),[n,a]=y.useState(!0),[i,o]=y.useState(null);y.useEffect(()=>{try{return Rl(_e,u=>{r(u),a(!1)})}catch(d){console.error("Auth initialization error:",d),o(d instanceof Error?d:new Error("Error de autenticación")),a(!1)}},[]);const c=async(d,u)=>{if(ls){A.error("Autenticación no disponible en modo demo");return}try{await Bl(d,u),A.success("¡Bienvenido!")}catch(m){throw console.error("Sign in error:",m),A.error("Credenciales inválidas"),m}},l=async()=>{if(ls){A.error("Cierre de sesión no disponible en modo demo");return}try{await Vl(),A.success("Sesión cerrada")}catch(d){throw console.error("Sign out error:",d),A.error("Error al cerrar sesión"),d}};return i?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-4",children:s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full",children:[s.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"Error de Inicialización"}),s.jsx("p",{className:"text-gray-600",children:"No se pudo inicializar la aplicación. Por favor, verifique la configuración e intente nuevamente."}),ls&&s.jsx("p",{className:"mt-4 text-sm text-amber-600",children:"Ejecutando en modo demo. Algunas funciones estarán limitadas."})]})}):s.jsx(qi.Provider,{value:{user:e,loading:n,signIn:c,signOut:l,isDemoMode:ls},children:!n&&t})}function qn(){const t=y.useContext(qi);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function ql(){const{user:t}=qn();return t?s.jsx(Li,{}):s.jsx(Di,{to:"/login",replace:!0})}function Ce(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function Et(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function Hi(t,e){const r=Ce(t);return isNaN(e)?Et(t,NaN):(e&&r.setDate(r.getDate()+e),r)}const Wi=6048e5,Hl=864e5;let Wl={};function es(){return Wl}function st(t,e){var c,l,d,u;const r=es(),n=(e==null?void 0:e.weekStartsOn)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.weekStartsOn)??r.weekStartsOn??((u=(d=r.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,a=Ce(t),i=a.getDay(),o=(i<n?7:0)+i-n;return a.setDate(a.getDate()-o),a.setHours(0,0,0,0),a}function js(t){return st(t,{weekStartsOn:1})}function Gi(t){const e=Ce(t),r=e.getFullYear(),n=Et(t,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const a=js(n),i=Et(t,0);i.setFullYear(r,0,4),i.setHours(0,0,0,0);const o=js(i);return e.getTime()>=a.getTime()?r+1:e.getTime()>=o.getTime()?r:r-1}function qr(t){const e=Ce(t);return e.setHours(0,0,0,0),e}function Ea(t){const e=Ce(t),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return r.setUTCFullYear(e.getFullYear()),+t-+r}function Gl(t,e){const r=qr(t),n=qr(e),a=+r-Ea(r),i=+n-Ea(n);return Math.round((a-i)/Hl)}function Yl(t){const e=Gi(t),r=Et(t,0);return r.setFullYear(e,0,4),r.setHours(0,0,0,0),js(r)}function Kl(t,e){const r=e*7;return Hi(t,r)}function Ql(t){return Et(t,Date.now())}function Xl(t,e){const r=qr(t),n=qr(e);return+r==+n}function Jl(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Zl(t){if(!Jl(t)&&typeof t!="number")return!1;const e=Ce(t);return!isNaN(Number(e))}function ed(t){const e=Ce(t);return e.setHours(23,59,59,999),e}function Yi(t){const e=Ce(t),r=e.getMonth();return e.setFullYear(e.getFullYear(),r+1,0),e.setHours(23,59,59,999),e}function td(t,e){const r=Ce(t.start),n=Ce(t.end);let a=+r>+n;const i=a?+r:+n,o=a?n:r;o.setHours(0,0,0,0);let c=1;const l=[];for(;+o<=i;)l.push(Ce(o)),o.setDate(o.getDate()+c),o.setHours(0,0,0,0);return a?l.reverse():l}function rd(t,e){const r=Ce(t.start),n=Ce(t.end);let a=+r>+n;const i=st(a?n:r,e),o=st(a?r:n,e);i.setHours(15),o.setHours(15);const c=+o.getTime();let l=i,d=(e==null?void 0:e.step)??1;if(!d)return[];d<0&&(d=-d,a=!a);const u=[];for(;+l<=c;)l.setHours(0),u.push(Ce(l)),l=Kl(l,d),l.setHours(15);return a?u.reverse():u}function Ki(t){const e=Ce(t);return e.setDate(1),e.setHours(0,0,0,0),e}function sd(t){const e=Ce(t),r=Et(t,0);return r.setFullYear(e.getFullYear(),0,1),r.setHours(0,0,0,0),r}function nd(t,e){var c,l;const r=es(),n=r.weekStartsOn??((l=(c=r.locale)==null?void 0:c.options)==null?void 0:l.weekStartsOn)??0,a=Ce(t),i=a.getDay(),o=(i<n?-7:0)+6-(i-n);return a.setDate(a.getDate()+o),a.setHours(23,59,59,999),a}const ad={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},id=(t,e,r)=>{let n;const a=ad[t];return typeof a=="string"?n=a:e===1?n=a.one:n=a.other.replace("{{count}}",e.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function Sr(t){return(e={})=>{const r=e.width?String(e.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const od={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},cd={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ld={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},dd={date:Sr({formats:od,defaultWidth:"full"}),time:Sr({formats:cd,defaultWidth:"full"}),dateTime:Sr({formats:ld,defaultWidth:"full"})},ud={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},hd=(t,e,r,n)=>ud[t];function ht(t){return(e,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let a;if(n==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,c=r!=null&&r.width?String(r.width):o;a=t.formattingValues[c]||t.formattingValues[o]}else{const o=t.defaultWidth,c=r!=null&&r.width?String(r.width):t.defaultWidth;a=t.values[c]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(e):e;return a[i]}}const md={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},fd={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},gd={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},pd={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},xd={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},bd={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},vd=(t,e)=>{const r=Number(t),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},yd={ordinalNumber:vd,era:ht({values:md,defaultWidth:"wide"}),quarter:ht({values:fd,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ht({values:gd,defaultWidth:"wide"}),day:ht({values:pd,defaultWidth:"wide"}),dayPeriod:ht({values:xd,defaultWidth:"wide",formattingValues:bd,defaultFormattingWidth:"wide"})};function mt(t){return(e,r={})=>{const n=r.width,a=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],i=e.match(a);if(!i)return null;const o=i[0],c=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(c)?jd(c,m=>m.test(o)):wd(c,m=>m.test(o));let d;d=t.valueCallback?t.valueCallback(l):l,d=r.valueCallback?r.valueCallback(d):d;const u=e.slice(o.length);return{value:d,rest:u}}}function wd(t,e){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return r}function jd(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return r}function Qi(t){return(e,r={})=>{const n=e.match(t.matchPattern);if(!n)return null;const a=n[0],i=e.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=r.valueCallback?r.valueCallback(o):o;const c=e.slice(a.length);return{value:o,rest:c}}}const Nd=/^(\d+)(th|st|nd|rd)?/i,_d=/\d+/i,Sd={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Cd={any:[/^b/i,/^(a|c)/i]},Pd={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},kd={any:[/1/i,/2/i,/3/i,/4/i]},Od={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ad={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ed={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Md={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Td={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Rd={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Id={ordinalNumber:Qi({matchPattern:Nd,parsePattern:_d,valueCallback:t=>parseInt(t,10)}),era:mt({matchPatterns:Sd,defaultMatchWidth:"wide",parsePatterns:Cd,defaultParseWidth:"any"}),quarter:mt({matchPatterns:Pd,defaultMatchWidth:"wide",parsePatterns:kd,defaultParseWidth:"any",valueCallback:t=>t+1}),month:mt({matchPatterns:Od,defaultMatchWidth:"wide",parsePatterns:Ad,defaultParseWidth:"any"}),day:mt({matchPatterns:Ed,defaultMatchWidth:"wide",parsePatterns:Md,defaultParseWidth:"any"}),dayPeriod:mt({matchPatterns:Td,defaultMatchWidth:"any",parsePatterns:Rd,defaultParseWidth:"any"})},Fd={code:"en-US",formatDistance:id,formatLong:dd,formatRelative:hd,localize:yd,match:Id,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ud(t){const e=Ce(t);return Gl(e,sd(e))+1}function $d(t){const e=Ce(t),r=+js(e)-+Yl(e);return Math.round(r/Wi)+1}function Xi(t,e){var u,m,b,x;const r=Ce(t),n=r.getFullYear(),a=es(),i=(e==null?void 0:e.firstWeekContainsDate)??((m=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:m.firstWeekContainsDate)??a.firstWeekContainsDate??((x=(b=a.locale)==null?void 0:b.options)==null?void 0:x.firstWeekContainsDate)??1,o=Et(t,0);o.setFullYear(n+1,0,i),o.setHours(0,0,0,0);const c=st(o,e),l=Et(t,0);l.setFullYear(n,0,i),l.setHours(0,0,0,0);const d=st(l,e);return r.getTime()>=c.getTime()?n+1:r.getTime()>=d.getTime()?n:n-1}function Dd(t,e){var c,l,d,u;const r=es(),n=(e==null?void 0:e.firstWeekContainsDate)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.firstWeekContainsDate)??r.firstWeekContainsDate??((u=(d=r.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)??1,a=Xi(t,e),i=Et(t,0);return i.setFullYear(a,0,n),i.setHours(0,0,0,0),st(i,e)}function Ld(t,e){const r=Ce(t),n=+st(r,e)-+Dd(r,e);return Math.round(n/Wi)+1}function ge(t,e){const r=t<0?"-":"",n=Math.abs(t).toString().padStart(e,"0");return r+n}const Dt={y(t,e){const r=t.getFullYear(),n=r>0?r:1-r;return ge(e==="yy"?n%100:n,e.length)},M(t,e){const r=t.getMonth();return e==="M"?String(r+1):ge(r+1,2)},d(t,e){return ge(t.getDate(),e.length)},a(t,e){const r=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,e){return ge(t.getHours()%12||12,e.length)},H(t,e){return ge(t.getHours(),e.length)},m(t,e){return ge(t.getMinutes(),e.length)},s(t,e){return ge(t.getSeconds(),e.length)},S(t,e){const r=e.length,n=t.getMilliseconds(),a=Math.trunc(n*Math.pow(10,r-3));return ge(a,e.length)}},xr={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ma={G:function(t,e,r){const n=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(t,e,r){if(e==="yo"){const n=t.getFullYear(),a=n>0?n:1-n;return r.ordinalNumber(a,{unit:"year"})}return Dt.y(t,e)},Y:function(t,e,r,n){const a=Xi(t,n),i=a>0?a:1-a;if(e==="YY"){const o=i%100;return ge(o,2)}return e==="Yo"?r.ordinalNumber(i,{unit:"year"}):ge(i,e.length)},R:function(t,e){const r=Gi(t);return ge(r,e.length)},u:function(t,e){const r=t.getFullYear();return ge(r,e.length)},Q:function(t,e,r){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return ge(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,e,r){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return ge(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,e,r){const n=t.getMonth();switch(e){case"M":case"MM":return Dt.M(t,e);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(t,e,r){const n=t.getMonth();switch(e){case"L":return String(n+1);case"LL":return ge(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(t,e,r,n){const a=Ld(t,n);return e==="wo"?r.ordinalNumber(a,{unit:"week"}):ge(a,e.length)},I:function(t,e,r){const n=$d(t);return e==="Io"?r.ordinalNumber(n,{unit:"week"}):ge(n,e.length)},d:function(t,e,r){return e==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):Dt.d(t,e)},D:function(t,e,r){const n=Ud(t);return e==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):ge(n,e.length)},E:function(t,e,r){const n=t.getDay();switch(e){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(t,e,r,n){const a=t.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return ge(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(a,{width:"short",context:"formatting"});case"eeee":default:return r.day(a,{width:"wide",context:"formatting"})}},c:function(t,e,r,n){const a=t.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return ge(i,e.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(a,{width:"narrow",context:"standalone"});case"cccccc":return r.day(a,{width:"short",context:"standalone"});case"cccc":default:return r.day(a,{width:"wide",context:"standalone"})}},i:function(t,e,r){const n=t.getDay(),a=n===0?7:n;switch(e){case"i":return String(a);case"ii":return ge(a,e.length);case"io":return r.ordinalNumber(a,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(t,e,r){const a=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(t,e,r){const n=t.getHours();let a;switch(n===12?a=xr.noon:n===0?a=xr.midnight:a=n/12>=1?"pm":"am",e){case"b":case"bb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(t,e,r){const n=t.getHours();let a;switch(n>=17?a=xr.evening:n>=12?a=xr.afternoon:n>=4?a=xr.morning:a=xr.night,e){case"B":case"BB":case"BBB":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(t,e,r){if(e==="ho"){let n=t.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return Dt.h(t,e)},H:function(t,e,r){return e==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):Dt.H(t,e)},K:function(t,e,r){const n=t.getHours()%12;return e==="Ko"?r.ordinalNumber(n,{unit:"hour"}):ge(n,e.length)},k:function(t,e,r){let n=t.getHours();return n===0&&(n=24),e==="ko"?r.ordinalNumber(n,{unit:"hour"}):ge(n,e.length)},m:function(t,e,r){return e==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):Dt.m(t,e)},s:function(t,e,r){return e==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):Dt.s(t,e)},S:function(t,e){return Dt.S(t,e)},X:function(t,e,r){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return Ra(n);case"XXXX":case"XX":return Zt(n);case"XXXXX":case"XXX":default:return Zt(n,":")}},x:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"x":return Ra(n);case"xxxx":case"xx":return Zt(n);case"xxxxx":case"xxx":default:return Zt(n,":")}},O:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Ta(n,":");case"OOOO":default:return"GMT"+Zt(n,":")}},z:function(t,e,r){const n=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Ta(n,":");case"zzzz":default:return"GMT"+Zt(n,":")}},t:function(t,e,r){const n=Math.trunc(t.getTime()/1e3);return ge(n,e.length)},T:function(t,e,r){const n=t.getTime();return ge(n,e.length)}};function Ta(t,e=""){const r=t>0?"-":"+",n=Math.abs(t),a=Math.trunc(n/60),i=n%60;return i===0?r+String(a):r+String(a)+e+ge(i,2)}function Ra(t,e){return t%60===0?(t>0?"-":"+")+ge(Math.abs(t)/60,2):Zt(t,e)}function Zt(t,e=""){const r=t>0?"-":"+",n=Math.abs(t),a=ge(Math.trunc(n/60),2),i=ge(n%60,2);return r+a+e+i}const Ia=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Ji=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},Bd=(t,e)=>{const r=t.match(/(P+)(p+)?/)||[],n=r[1],a=r[2];if(!a)return Ia(t,e);let i;switch(n){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",Ia(n,e)).replace("{{time}}",Ji(a,e))},Vd={p:Ji,P:Bd},zd=/^D+$/,qd=/^Y+$/,Hd=["D","DD","YY","YYYY"];function Wd(t){return zd.test(t)}function Gd(t){return qd.test(t)}function Yd(t,e,r){const n=Kd(t,e,r);if(console.warn(n),Hd.includes(t))throw new RangeError(n)}function Kd(t,e,r){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Qd=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Xd=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Jd=/^'([^]*?)'?$/,Zd=/''/g,eu=/[a-zA-Z]/;function fe(t,e,r){var u,m,b,x,p,f,h,g;const n=es(),a=(r==null?void 0:r.locale)??n.locale??Fd,i=(r==null?void 0:r.firstWeekContainsDate)??((m=(u=r==null?void 0:r.locale)==null?void 0:u.options)==null?void 0:m.firstWeekContainsDate)??n.firstWeekContainsDate??((x=(b=n.locale)==null?void 0:b.options)==null?void 0:x.firstWeekContainsDate)??1,o=(r==null?void 0:r.weekStartsOn)??((f=(p=r==null?void 0:r.locale)==null?void 0:p.options)==null?void 0:f.weekStartsOn)??n.weekStartsOn??((g=(h=n.locale)==null?void 0:h.options)==null?void 0:g.weekStartsOn)??0,c=Ce(t);if(!Zl(c))throw new RangeError("Invalid time value");let l=e.match(Xd).map(w=>{const v=w[0];if(v==="p"||v==="P"){const _=Vd[v];return _(w,a.formatLong)}return w}).join("").match(Qd).map(w=>{if(w==="''")return{isToken:!1,value:"'"};const v=w[0];if(v==="'")return{isToken:!1,value:tu(w)};if(Ma[v])return{isToken:!0,value:w};if(v.match(eu))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:w}});a.localize.preprocessor&&(l=a.localize.preprocessor(c,l));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:a};return l.map(w=>{if(!w.isToken)return w.value;const v=w.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&Gd(v)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&Wd(v))&&Yd(v,e,String(t));const _=Ma[v[0]];return _(c,v,a.localize,d)}).join("")}function tu(t){const e=t.match(Jd);return e?e[1].replace(Zd,"'"):t}function ru(t,e){const r=Ce(t),n=Ce(e);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function su(t){return Xl(t,Ql(t))}const nu={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 día",other:"{{count}} días"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 año",other:"alrededor de {{count}} años"},xYears:{one:"1 año",other:"{{count}} años"},overXYears:{one:"más de 1 año",other:"más de {{count}} años"},almostXYears:{one:"casi 1 año",other:"casi {{count}} años"}},au=(t,e,r)=>{let n;const a=nu[t];return typeof a=="string"?n=a:e===1?n=a.one:n=a.other.replace("{{count}}",e.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"en "+n:"hace "+n:n},iu={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},ou={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},cu={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},lu={date:Sr({formats:iu,defaultWidth:"full"}),time:Sr({formats:ou,defaultWidth:"full"}),dateTime:Sr({formats:cu,defaultWidth:"full"})},du={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'mañana a la' p",nextWeek:"eeee 'a la' p",other:"P"},uu={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'mañana a las' p",nextWeek:"eeee 'a las' p",other:"P"},hu=(t,e,r,n)=>e.getHours()!==1?uu[t]:du[t],mu={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","después de cristo"]},fu={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},gu={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},pu={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sá"],abbreviated:["dom","lun","mar","mié","jue","vie","sáb"],wide:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]},xu={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"}},bu={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},vu=(t,e)=>Number(t)+"º",yu={ordinalNumber:vu,era:ht({values:mu,defaultWidth:"wide"}),quarter:ht({values:fu,defaultWidth:"wide",argumentCallback:t=>Number(t)-1}),month:ht({values:gu,defaultWidth:"wide"}),day:ht({values:pu,defaultWidth:"wide"}),dayPeriod:ht({values:xu,defaultWidth:"wide",formattingValues:bu,defaultFormattingWidth:"wide"})},wu=/^(\d+)(º)?/i,ju=/\d+/i,Nu={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},_u={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},Su={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},Cu={any:[/1/i,/2/i,/3/i,/4/i]},Pu={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},ku={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},Ou={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},Au={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},Eu={narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},Mu={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},Tu={ordinalNumber:Qi({matchPattern:wu,parsePattern:ju,valueCallback:function(t){return parseInt(t,10)}}),era:mt({matchPatterns:Nu,defaultMatchWidth:"wide",parsePatterns:_u,defaultParseWidth:"any"}),quarter:mt({matchPatterns:Su,defaultMatchWidth:"wide",parsePatterns:Cu,defaultParseWidth:"any",valueCallback:t=>t+1}),month:mt({matchPatterns:Pu,defaultMatchWidth:"wide",parsePatterns:ku,defaultParseWidth:"any"}),day:mt({matchPatterns:Ou,defaultMatchWidth:"wide",parsePatterns:Au,defaultParseWidth:"any"}),dayPeriod:mt({matchPatterns:Eu,defaultMatchWidth:"any",parsePatterns:Mu,defaultParseWidth:"any"})},ye={code:"es",formatDistance:au,formatLong:lu,formatRelative:hu,localize:yu,match:Tu,options:{weekStartsOn:1,firstWeekContainsDate:1}};function Q(t){return new Intl.NumberFormat("es-UY",{style:"currency",currency:"UYU"}).format(t)}function Zi(t){const e=t.replace(/\D/g,""),r=e.startsWith("598")?e.slice(3):e;return r.length>=8?`+598 ${[r.slice(0,2),r.slice(2,5),r.slice(5)].join(" ")}`:`+598 ${r}`}function Fa(t){const e=t.replace(/\D/g,""),r=e.startsWith("598")?e.slice(3):e;return/^[0-9]{8,9}$/.test(r)}function eo(t,e){const r=t.replace(/\D/g,"");return`https://wa.me/${r.startsWith("598")?r:`598${r}`}?text=${encodeURIComponent(e)}`}function to(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(r=to(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function Ru(){for(var t,e,r=0,n="",a=arguments.length;r<a;r++)(t=arguments[r])&&(e=to(t))&&(n&&(n+=" "),n+=e);return n}const Hn="-",Iu=t=>{const e=Uu(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:o=>{const c=o.split(Hn);return c[0]===""&&c.length!==1&&c.shift(),ro(c,e)||Fu(o)},getConflictingClassGroupIds:(o,c)=>{const l=r[o]||[];return c&&n[o]?[...l,...n[o]]:l}}},ro=(t,e)=>{var o;if(t.length===0)return e.classGroupId;const r=t[0],n=e.nextPart.get(r),a=n?ro(t.slice(1),n):void 0;if(a)return a;if(e.validators.length===0)return;const i=t.join(Hn);return(o=e.validators.find(({validator:c})=>c(i)))==null?void 0:o.classGroupId},Ua=/^\[(.+)\]$/,Fu=t=>{if(Ua.test(t)){const e=Ua.exec(t)[1],r=e==null?void 0:e.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},Uu=t=>{const{theme:e,prefix:r}=t,n={nextPart:new Map,validators:[]};return Du(Object.entries(t.classGroups),r).forEach(([i,o])=>{wn(o,n,i,e)}),n},wn=(t,e,r,n)=>{t.forEach(a=>{if(typeof a=="string"){const i=a===""?e:$a(e,a);i.classGroupId=r;return}if(typeof a=="function"){if($u(a)){wn(a(n),e,r,n);return}e.validators.push({validator:a,classGroupId:r});return}Object.entries(a).forEach(([i,o])=>{wn(o,$a(e,i),r,n)})})},$a=(t,e)=>{let r=t;return e.split(Hn).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},$u=t=>t.isThemeGetter,Du=(t,e)=>e?t.map(([r,n])=>{const a=n.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,c])=>[e+o,c])):i);return[r,a]}):t,Lu=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,n=new Map;const a=(i,o)=>{r.set(i,o),e++,e>t&&(e=0,n=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=n.get(i))!==void 0)return a(i,o),o},set(i,o){r.has(i)?r.set(i,o):a(i,o)}}},so="!",Bu=t=>{const{separator:e,experimentalParseClassName:r}=t,n=e.length===1,a=e[0],i=e.length,o=c=>{const l=[];let d=0,u=0,m;for(let h=0;h<c.length;h++){let g=c[h];if(d===0){if(g===a&&(n||c.slice(h,h+i)===e)){l.push(c.slice(u,h)),u=h+i;continue}if(g==="/"){m=h;continue}}g==="["?d++:g==="]"&&d--}const b=l.length===0?c:c.substring(u),x=b.startsWith(so),p=x?b.substring(1):b,f=m&&m>u?m-u:void 0;return{modifiers:l,hasImportantModifier:x,baseClassName:p,maybePostfixModifierPosition:f}};return r?c=>r({className:c,parseClassName:o}):o},Vu=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(n=>{n[0]==="["?(e.push(...r.sort(),n),r=[]):r.push(n)}),e.push(...r.sort()),e},zu=t=>({cache:Lu(t.cacheSize),parseClassName:Bu(t),...Iu(t)}),qu=/\s+/,Hu=(t,e)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:a}=e,i=[],o=t.trim().split(qu);let c="";for(let l=o.length-1;l>=0;l-=1){const d=o[l],{modifiers:u,hasImportantModifier:m,baseClassName:b,maybePostfixModifierPosition:x}=r(d);let p=!!x,f=n(p?b.substring(0,x):b);if(!f){if(!p){c=d+(c.length>0?" "+c:c);continue}if(f=n(b),!f){c=d+(c.length>0?" "+c:c);continue}p=!1}const h=Vu(u).join(":"),g=m?h+so:h,w=g+f;if(i.includes(w))continue;i.push(w);const v=a(f,p);for(let _=0;_<v.length;++_){const P=v[_];i.push(g+P)}c=d+(c.length>0?" "+c:c)}return c};function Wu(){let t=0,e,r,n="";for(;t<arguments.length;)(e=arguments[t++])&&(r=no(e))&&(n&&(n+=" "),n+=r);return n}const no=t=>{if(typeof t=="string")return t;let e,r="";for(let n=0;n<t.length;n++)t[n]&&(e=no(t[n]))&&(r&&(r+=" "),r+=e);return r};function Gu(t,...e){let r,n,a,i=o;function o(l){const d=e.reduce((u,m)=>m(u),t());return r=zu(d),n=r.cache.get,a=r.cache.set,i=c,c(l)}function c(l){const d=n(l);if(d)return d;const u=Hu(l,r);return a(l,u),u}return function(){return i(Wu.apply(null,arguments))}}const Ne=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},ao=/^\[(?:([a-z-]+):)?(.+)\]$/i,Yu=/^\d+\/\d+$/,Ku=new Set(["px","full","screen"]),Qu=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Xu=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Ju=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Zu=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,eh=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,wt=t=>Cr(t)||Ku.has(t)||Yu.test(t),Lt=t=>Er(t,"length",ch),Cr=t=>!!t&&!Number.isNaN(Number(t)),tn=t=>Er(t,"number",Cr),Ir=t=>!!t&&Number.isInteger(Number(t)),th=t=>t.endsWith("%")&&Cr(t.slice(0,-1)),re=t=>ao.test(t),Bt=t=>Qu.test(t),rh=new Set(["length","size","percentage"]),sh=t=>Er(t,rh,io),nh=t=>Er(t,"position",io),ah=new Set(["image","url"]),ih=t=>Er(t,ah,dh),oh=t=>Er(t,"",lh),Fr=()=>!0,Er=(t,e,r)=>{const n=ao.exec(t);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):r(n[2]):!1},ch=t=>Xu.test(t)&&!Ju.test(t),io=()=>!1,lh=t=>Zu.test(t),dh=t=>eh.test(t),uh=()=>{const t=Ne("colors"),e=Ne("spacing"),r=Ne("blur"),n=Ne("brightness"),a=Ne("borderColor"),i=Ne("borderRadius"),o=Ne("borderSpacing"),c=Ne("borderWidth"),l=Ne("contrast"),d=Ne("grayscale"),u=Ne("hueRotate"),m=Ne("invert"),b=Ne("gap"),x=Ne("gradientColorStops"),p=Ne("gradientColorStopPositions"),f=Ne("inset"),h=Ne("margin"),g=Ne("opacity"),w=Ne("padding"),v=Ne("saturate"),_=Ne("scale"),P=Ne("sepia"),S=Ne("skew"),ee=Ne("space"),me=Ne("translate"),k=()=>["auto","contain","none"],Y=()=>["auto","hidden","clip","visible","scroll"],de=()=>["auto",re,e],G=()=>[re,e],Se=()=>["",wt,Lt],X=()=>["auto",Cr,re],Pe=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],J=()=>["solid","dashed","dotted","double","none"],xe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],F=()=>["start","end","center","between","around","evenly","stretch"],W=()=>["","0",re],U=()=>["auto","avoid","all","avoid-page","page","left","right","column"],he=()=>[Cr,re];return{cacheSize:500,separator:":",theme:{colors:[Fr],spacing:[wt,Lt],blur:["none","",Bt,re],brightness:he(),borderColor:[t],borderRadius:["none","","full",Bt,re],borderSpacing:G(),borderWidth:Se(),contrast:he(),grayscale:W(),hueRotate:he(),invert:W(),gap:G(),gradientColorStops:[t],gradientColorStopPositions:[th,Lt],inset:de(),margin:de(),opacity:he(),padding:G(),saturate:he(),scale:he(),sepia:W(),skew:he(),space:G(),translate:G()},classGroups:{aspect:[{aspect:["auto","square","video",re]}],container:["container"],columns:[{columns:[Bt]}],"break-after":[{"break-after":U()}],"break-before":[{"break-before":U()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Pe(),re]}],overflow:[{overflow:Y()}],"overflow-x":[{"overflow-x":Y()}],"overflow-y":[{"overflow-y":Y()}],overscroll:[{overscroll:k()}],"overscroll-x":[{"overscroll-x":k()}],"overscroll-y":[{"overscroll-y":k()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[f]}],"inset-x":[{"inset-x":[f]}],"inset-y":[{"inset-y":[f]}],start:[{start:[f]}],end:[{end:[f]}],top:[{top:[f]}],right:[{right:[f]}],bottom:[{bottom:[f]}],left:[{left:[f]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ir,re]}],basis:[{basis:de()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",re]}],grow:[{grow:W()}],shrink:[{shrink:W()}],order:[{order:["first","last","none",Ir,re]}],"grid-cols":[{"grid-cols":[Fr]}],"col-start-end":[{col:["auto",{span:["full",Ir,re]},re]}],"col-start":[{"col-start":X()}],"col-end":[{"col-end":X()}],"grid-rows":[{"grid-rows":[Fr]}],"row-start-end":[{row:["auto",{span:[Ir,re]},re]}],"row-start":[{"row-start":X()}],"row-end":[{"row-end":X()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",re]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",re]}],gap:[{gap:[b]}],"gap-x":[{"gap-x":[b]}],"gap-y":[{"gap-y":[b]}],"justify-content":[{justify:["normal",...F()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...F(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...F(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[w]}],px:[{px:[w]}],py:[{py:[w]}],ps:[{ps:[w]}],pe:[{pe:[w]}],pt:[{pt:[w]}],pr:[{pr:[w]}],pb:[{pb:[w]}],pl:[{pl:[w]}],m:[{m:[h]}],mx:[{mx:[h]}],my:[{my:[h]}],ms:[{ms:[h]}],me:[{me:[h]}],mt:[{mt:[h]}],mr:[{mr:[h]}],mb:[{mb:[h]}],ml:[{ml:[h]}],"space-x":[{"space-x":[ee]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ee]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",re,e]}],"min-w":[{"min-w":[re,e,"min","max","fit"]}],"max-w":[{"max-w":[re,e,"none","full","min","max","fit","prose",{screen:[Bt]},Bt]}],h:[{h:[re,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[re,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[re,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[re,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Bt,Lt]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",tn]}],"font-family":[{font:[Fr]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",re]}],"line-clamp":[{"line-clamp":["none",Cr,tn]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",wt,re]}],"list-image":[{"list-image":["none",re]}],"list-style-type":[{list:["none","disc","decimal",re]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[g]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...J(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",wt,Lt]}],"underline-offset":[{"underline-offset":["auto",wt,re]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:G()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",re]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",re]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[g]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Pe(),nh]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",sh]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},ih]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[x]}],"gradient-via":[{via:[x]}],"gradient-to":[{to:[x]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[g]}],"border-style":[{border:[...J(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[g]}],"divide-style":[{divide:J()}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["",...J()]}],"outline-offset":[{"outline-offset":[wt,re]}],"outline-w":[{outline:[wt,Lt]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:Se()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[g]}],"ring-offset-w":[{"ring-offset":[wt,Lt]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Bt,oh]}],"shadow-color":[{shadow:[Fr]}],opacity:[{opacity:[g]}],"mix-blend":[{"mix-blend":[...xe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":xe()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Bt,re]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[m]}],saturate:[{saturate:[v]}],sepia:[{sepia:[P]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[m]}],"backdrop-opacity":[{"backdrop-opacity":[g]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[P]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",re]}],duration:[{duration:he()}],ease:[{ease:["linear","in","out","in-out",re]}],delay:[{delay:he()}],animate:[{animate:["none","spin","ping","pulse","bounce",re]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[_]}],"scale-x":[{"scale-x":[_]}],"scale-y":[{"scale-y":[_]}],rotate:[{rotate:[Ir,re]}],"translate-x":[{"translate-x":[me]}],"translate-y":[{"translate-y":[me]}],"skew-x":[{"skew-x":[S]}],"skew-y":[{"skew-y":[S]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",re]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",re]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":G()}],"scroll-mx":[{"scroll-mx":G()}],"scroll-my":[{"scroll-my":G()}],"scroll-ms":[{"scroll-ms":G()}],"scroll-me":[{"scroll-me":G()}],"scroll-mt":[{"scroll-mt":G()}],"scroll-mr":[{"scroll-mr":G()}],"scroll-mb":[{"scroll-mb":G()}],"scroll-ml":[{"scroll-ml":G()}],"scroll-p":[{"scroll-p":G()}],"scroll-px":[{"scroll-px":G()}],"scroll-py":[{"scroll-py":G()}],"scroll-ps":[{"scroll-ps":G()}],"scroll-pe":[{"scroll-pe":G()}],"scroll-pt":[{"scroll-pt":G()}],"scroll-pr":[{"scroll-pr":G()}],"scroll-pb":[{"scroll-pb":G()}],"scroll-pl":[{"scroll-pl":G()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",re]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[wt,Lt,tn]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},hh=Gu(uh);function Fe(...t){return hh(Ru(t))}const zt=[{code:"GRL",name:"General"},{code:"GFR",name:"Granja Fresco"},{code:"GRE",name:"Granja Refrigerado"},{code:"GTM",name:"Granja Terminado"},{code:"GPA",name:"Granja Panadería"},{code:"GSC",name:"Granja Seco"},{code:"HEL",name:"Heladería"},{code:"REF",name:"Refrigerado"},{code:"CON",name:"Congelado"},{code:"FRU",name:"Frutas"}],Yt={name:"Panadería Nueva Río D'or",owner:"TEJAS DE LA CRUZ YOSBANY"};function oo(t){const e=t.toString().padStart(5,"0"),r=parseInt(e.slice(0,2))-1;return r>=0&&r<zt.length?zt[r].code:zt[0].code}function mh(t){const e=t.toString().padStart(5,"0");return parseInt(e.slice(2))}function co(t){const e=oo(t),r=mh(t);return`${e}-${r.toString().padStart(3,"0")}`}const rn=[{name:"Dashboard",to:"/",icon:Zc,color:"bg-blue-500"},{name:"Proveedores",to:"/providers",icon:Fn,color:"bg-emerald-500"},{name:"Productos",to:"/products",icon:ze,color:"bg-purple-500"},{name:"Recetas",to:"/recipes",icon:Ht,color:"bg-amber-500"},{name:"Órdenes",to:"/orders",icon:He,color:"bg-indigo-500"},{name:"Cronograma",to:"/schedule",icon:Kt,color:"bg-rose-500"},{name:"Inventario",to:"/inventory",icon:el,color:"bg-teal-500"}];function fh(){const{signOut:t}=qn(),[e,r]=y.useState(!1),n=Sl(),a=rn.find(o=>o.to===n.pathname),i=(a==null?void 0:a.color)||"bg-gray-100";return s.jsxs("header",{className:"bg-white border-b border-gray-200",children:[s.jsxs("div",{className:"mx-auto px-4",children:[s.jsxs("div",{className:"flex h-16 items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("h1",{className:"text-xl font-bold text-gray-900 mr-4 whitespace-nowrap",children:"Gestión de Compras"}),s.jsx("button",{onClick:()=>r(!e),className:"md:hidden ml-2 p-2 rounded-md hover:bg-gray-100",children:e?s.jsx(Ve,{className:"h-6 w-6"}):s.jsx(Jc,{className:"h-6 w-6"})})]}),s.jsxs("nav",{className:"hidden md:flex space-x-1",children:[rn.map(o=>s.jsxs(ka,{to:o.to,className:({isActive:c})=>Fe("inline-flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors",c?`${o.color.replace("bg-","text-")} ${o.color.replace("bg-","bg-")}/10`:"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[s.jsx(o.icon,{className:"mr-2 h-5 w-5"}),o.name]},o.name)),s.jsxs("button",{onClick:()=>t(),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md transition-colors",children:[s.jsx(_a,{className:"mr-2 h-5 w-5"}),"Cerrar Sesión"]})]})]}),e&&s.jsxs("nav",{className:"md:hidden py-4 space-y-1",children:[rn.map(o=>s.jsxs(ka,{to:o.to,onClick:()=>r(!1),className:({isActive:c})=>Fe("flex items-center px-3 py-2 text-base font-medium rounded-md w-full transition-colors",c?`${o.color.replace("bg-","text-")} ${o.color.replace("bg-","bg-")}/10`:"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[s.jsx(o.icon,{className:"mr-3 h-5 w-5"}),o.name]},o.name)),s.jsxs("button",{onClick:()=>t(),className:"flex items-center px-3 py-2 text-base font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md w-full transition-colors",children:[s.jsx(_a,{className:"mr-3 h-5 w-5"}),"Cerrar Sesión"]})]})]}),s.jsx("div",{className:`h-1 ${i}`})]})}function gh(){return s.jsxs("div",{className:"min-h-screen flex flex-col",children:[s.jsx(fh,{}),s.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 p-4",children:s.jsx(Li,{})})]})}const E=({className:t,variant:e="primary",size:r="md",isLoading:n,children:a,...i})=>{const o="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",c={primary:"bg-blue-600 text-white hover:bg-blue-700",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200",outline:"border border-gray-300 bg-transparent hover:bg-gray-100",ghost:"hover:bg-gray-100 hover:text-gray-900"},l={sm:"h-9 px-3 text-sm",md:"h-10 px-4",lg:"h-11 px-8"};return s.jsxs("button",{className:Fe(o,c[e],l[r],t),disabled:n,...i,children:[n?s.jsx("span",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):null,a]})},se=ws.forwardRef(({className:t,label:e,error:r,value:n,type:a,onChange:i,isCurrency:o,...c},l)=>{const[d,u]=y.useState(""),[m,b]=y.useState(!1),x=w=>{const v=w.toString().split(".");return v[0]=v[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),v.join(",")};y.useEffect(()=>{o&&typeof n=="number"&&!m&&u(x(n))},[n,o,m]);const p=w=>{if(o){let v=w.target.value.replace(/[^\d.,]/g,"");if(v=v.replace(/,/g,"."),v.split(".").length-1>1){const S=v.split(".");v=S[0]+"."+S.slice(1).join("")}u(v);const P=parseFloat(v)||0;i==null||i({...w,target:{...w.target,value:P.toString()}})}else if(a==="number"){const v=w.target.value;(v===""||!isNaN(Number(v)))&&(i==null||i(w))}else i==null||i(w)},f=w=>{var v;if(o){b(!0);const _=typeof n=="number"?n.toString():"0";u(_.replace(".",","))}(v=c.onFocus)==null||v.call(c,w)},h=w=>{var v;o&&(b(!1),typeof n=="number"&&u(x(n))),(v=c.onBlur)==null||v.call(c,w)},g=o?d:a==="number"&&n===0&&!c.min?"":n;return s.jsxs("div",{className:"space-y-2",children:[e&&s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:e}),s.jsxs("div",{className:"relative",children:[o&&s.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),s.jsx("input",{className:Fe("block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500","focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500","disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500",r&&"border-red-500 focus:border-red-500 focus:ring-red-500",o&&"pl-7 text-right",t),ref:l,value:g,onChange:p,onFocus:f,onBlur:h,type:o?"text":a,inputMode:o?"decimal":void 0,...c})]}),r&&s.jsx("p",{className:"text-sm text-red-600",children:r})]})});se.displayName="Input";function ph(){const{user:t,signIn:e}=qn(),[r,n]=y.useState(!1),[a,i]=y.useState(""),[o,c]=y.useState(""),[l,d]=y.useState("");if(t)return s.jsx(Di,{to:"/",replace:!0});const u=async m=>{m.preventDefault(),d(""),n(!0);try{await e(a,o)}catch(b){console.error("Login error:",b),d("Credenciales inválidas")}finally{n(!1)}};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 py-12 px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Órdenes de Compra"}),s.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Inicia sesión para continuar"})]}),s.jsxs("form",{className:"mt-8 space-y-6",onSubmit:u,children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email",className:"sr-only",children:"Correo electrónico"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(tl,{className:"h-5 w-5 text-gray-400"})}),s.jsx(se,{id:"email",type:"email",value:a,onChange:m=>i(m.target.value),required:!0,className:"pl-10",placeholder:"Correo electrónico",autoComplete:"email"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"password",className:"sr-only",children:"Contraseña"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(rl,{className:"h-5 w-5 text-gray-400"})}),s.jsx(se,{id:"password",type:"password",value:o,onChange:m=>c(m.target.value),required:!0,className:"pl-10",placeholder:"Contraseña",autoComplete:"current-password"})]})]})]}),l&&s.jsx("div",{className:"text-red-600 text-sm text-center",children:l}),s.jsx(E,{type:"submit",className:"w-full",isLoading:r,children:"Iniciar sesión"})]})]})})}function le(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];throw new Error(typeof t=="number"?"[MobX] minified error nr: "+t+(r.length?" "+r.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+t)}var xh={};function $s(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:xh}var lo=Object.assign,Ns=Object.getOwnPropertyDescriptor,pt=Object.defineProperty,Ds=Object.prototype,jn=[];Object.freeze(jn);var uo={};Object.freeze(uo);var bh=typeof Proxy<"u",vh=Object.toString();function ho(){bh||le("Proxy not available")}function mo(t){var e=!1;return function(){if(!e)return e=!0,t.apply(this,arguments)}}var wr=function(){};function it(t){return typeof t=="function"}function ir(t){var e=typeof t;switch(e){case"string":case"symbol":case"number":return!0}return!1}function Ls(t){return t!==null&&typeof t=="object"}function Mt(t){if(!Ls(t))return!1;var e=Object.getPrototypeOf(t);if(e==null)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r.toString()===vh}function fo(t){var e=t==null?void 0:t.constructor;return e?e.name==="GeneratorFunction"||e.displayName==="GeneratorFunction":!1}function ts(t,e,r){pt(t,e,{enumerable:!1,writable:!0,configurable:!0,value:r})}function go(t,e,r){pt(t,e,{enumerable:!1,writable:!1,configurable:!0,value:r})}function hr(t,e){var r="isMobX"+t;return e.prototype[r]=!0,function(n){return Ls(n)&&n[r]===!0}}function Mr(t){return t!=null&&Object.prototype.toString.call(t)==="[object Map]"}function yh(t){var e=Object.getPrototypeOf(t),r=Object.getPrototypeOf(e),n=Object.getPrototypeOf(r);return n===null}function St(t){return t!=null&&Object.prototype.toString.call(t)==="[object Set]"}var po=typeof Object.getOwnPropertySymbols<"u";function wh(t){var e=Object.keys(t);if(!po)return e;var r=Object.getOwnPropertySymbols(t);return r.length?[].concat(e,r.filter(function(n){return Ds.propertyIsEnumerable.call(t,n)})):e}var Pr=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:po?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames;function xo(t){return t===null?null:typeof t=="object"?""+t:t}function kt(t,e){return Ds.hasOwnProperty.call(t,e)}var jh=Object.getOwnPropertyDescriptors||function(e){var r={};return Pr(e).forEach(function(n){r[n]=Ns(e,n)}),r};function We(t,e){return!!(t&e)}function Ge(t,e,r){return r?t|=e:t&=~e,t}function Da(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Nh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Sh(n.key),n)}}function Tr(t,e,r){return e&&Nh(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function jr(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=Ch(t))||e){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function or(){return or=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},or.apply(null,arguments)}function bo(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Nn(t,e)}function Nn(t,e){return Nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},Nn(t,e)}function _h(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function Sh(t){var e=_h(t,"string");return typeof e=="symbol"?e:e+""}function Ch(t,e){if(t){if(typeof t=="string")return Da(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Da(t,e):void 0}}var gt=Symbol("mobx-stored-annotations");function xt(t){function e(r,n){if(ss(n))return t.decorate_20223_(r,n);rs(r,n,t)}return Object.assign(e,t)}function rs(t,e,r){kt(t,gt)||ts(t,gt,or({},t[gt])),Ih(r)||(t[gt][e]=r)}function Ph(t){return kt(t,gt)||ts(t,gt,or({},t[gt])),t[gt]}function ss(t){return typeof t=="object"&&typeof t.kind=="string"}var Z=Symbol("mobx administration"),Qt=function(){function t(r){r===void 0&&(r="Atom"),this.name_=void 0,this.flags_=0,this.observers_=new Set,this.lastAccessedBy_=0,this.lowestObserverState_=ue.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=r}var e=t.prototype;return e.onBO=function(){this.onBOL&&this.onBOL.forEach(function(n){return n()})},e.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(n){return n()})},e.reportObserved=function(){return Io(this)},e.reportChanged=function(){Ze(),Fo(this),et()},e.toString=function(){return this.name_},Tr(t,[{key:"isBeingObserved",get:function(){return We(this.flags_,t.isBeingObservedMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isBeingObservedMask_,n)}},{key:"isPendingUnobservation",get:function(){return We(this.flags_,t.isPendingUnobservationMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isPendingUnobservationMask_,n)}},{key:"diffValue",get:function(){return We(this.flags_,t.diffValueMask_)?1:0},set:function(n){this.flags_=Ge(this.flags_,t.diffValueMask_,n===1)}}])}();Qt.isBeingObservedMask_=1;Qt.isPendingUnobservationMask_=2;Qt.diffValueMask_=4;var Wn=hr("Atom",Qt);function vo(t,e,r){e===void 0&&(e=wr),r===void 0&&(r=wr);var n=new Qt(t);return e!==wr&&Um(n,e),r!==wr&&Vo(n,r),n}function kh(t,e){return t===e}function Oh(t,e){return Zn(t,e)}function Ah(t,e){return Zn(t,e,1)}function Eh(t,e){return Object.is?Object.is(t,e):t===e?t!==0||1/t===1/e:t!==t&&e!==e}var _s={identity:kh,structural:Oh,default:Eh,shallow:Ah};function cr(t,e,r){return Go(t)?t:Array.isArray(t)?Ie.array(t,{name:r}):Mt(t)?Ie.object(t,void 0,{name:r}):Mr(t)?Ie.map(t,{name:r}):St(t)?Ie.set(t,{name:r}):typeof t=="function"&&!Wr(t)&&!Gr(t)?fo(t)?kr(t):Hr(r,t):t}function Mh(t,e,r){if(t==null||Ws(t)||Hs(t)||fr(t)||ft(t))return t;if(Array.isArray(t))return Ie.array(t,{name:r,deep:!1});if(Mt(t))return Ie.object(t,void 0,{name:r,deep:!1});if(Mr(t))return Ie.map(t,{name:r,deep:!1});if(St(t))return Ie.set(t,{name:r,deep:!1})}function Bs(t){return t}function Th(t,e){return Zn(t,e)?e:t}var Rh="override";function Ih(t){return t.annotationType_===Rh}function ns(t,e){return{annotationType_:t,options_:e,make_:Fh,extend_:Uh,decorate_20223_:$h}}function Fh(t,e,r,n){var a;if((a=this.options_)!=null&&a.bound)return this.extend_(t,e,r,!1)===null?0:1;if(n===t.target_)return this.extend_(t,e,r,!1)===null?0:2;if(Wr(r.value))return 1;var i=yo(t,this,e,r,!1);return pt(n,e,i),2}function Uh(t,e,r,n){var a=yo(t,this,e,r);return t.defineProperty_(e,a,n)}function $h(t,e){var r=e.kind,n=e.name,a=e.addInitializer,i=this,o=function(d){var u,m,b,x;return lr((u=(m=i.options_)==null?void 0:m.name)!=null?u:n.toString(),d,(b=(x=i.options_)==null?void 0:x.autoAction)!=null?b:!1)};if(r=="field")return function(l){var d,u=l;return Wr(u)||(u=o(u)),(d=i.options_)!=null&&d.bound&&(u=u.bind(this),u.isMobxAction=!0),u};if(r=="method"){var c;return Wr(t)||(t=o(t)),(c=this.options_)!=null&&c.bound&&a(function(){var l=this,d=l[n].bind(l);d.isMobxAction=!0,l[n]=d}),t}le("Cannot apply '"+i.annotationType_+"' to '"+String(n)+"' (kind: "+r+"):"+(`
'`+i.annotationType_+"' can only be used on properties with a function value."))}function Dh(t,e,r,n){e.annotationType_,n.value}function yo(t,e,r,n,a){var i,o,c,l,d,u,m;a===void 0&&(a=T.safeDescriptors),Dh(t,e,r,n);var b=n.value;if((i=e.options_)!=null&&i.bound){var x;b=b.bind((x=t.proxy_)!=null?x:t.target_)}return{value:lr((o=(c=e.options_)==null?void 0:c.name)!=null?o:r.toString(),b,(l=(d=e.options_)==null?void 0:d.autoAction)!=null?l:!1,(u=e.options_)!=null&&u.bound?(m=t.proxy_)!=null?m:t.target_:void 0),configurable:a?t.isPlainObject_:!0,enumerable:!1,writable:!a}}function wo(t,e){return{annotationType_:t,options_:e,make_:Lh,extend_:Bh,decorate_20223_:Vh}}function Lh(t,e,r,n){var a;if(n===t.target_)return this.extend_(t,e,r,!1)===null?0:2;if((a=this.options_)!=null&&a.bound&&(!kt(t.target_,e)||!Gr(t.target_[e]))&&this.extend_(t,e,r,!1)===null)return 0;if(Gr(r.value))return 1;var i=jo(t,this,e,r,!1,!1);return pt(n,e,i),2}function Bh(t,e,r,n){var a,i=jo(t,this,e,r,(a=this.options_)==null?void 0:a.bound);return t.defineProperty_(e,i,n)}function Vh(t,e){var r,n=e.name,a=e.addInitializer;return Gr(t)||(t=kr(t)),(r=this.options_)!=null&&r.bound&&a(function(){var i=this,o=i[n].bind(i);o.isMobXFlow=!0,i[n]=o}),t}function zh(t,e,r,n){e.annotationType_,n.value}function jo(t,e,r,n,a,i){i===void 0&&(i=T.safeDescriptors),zh(t,e,r,n);var o=n.value;if(Gr(o)||(o=kr(o)),a){var c;o=o.bind((c=t.proxy_)!=null?c:t.target_),o.isMobXFlow=!0}return{value:o,configurable:i?t.isPlainObject_:!0,enumerable:!1,writable:!i}}function Gn(t,e){return{annotationType_:t,options_:e,make_:qh,extend_:Hh,decorate_20223_:Wh}}function qh(t,e,r){return this.extend_(t,e,r,!1)===null?0:1}function Hh(t,e,r,n){return Gh(t,this,e,r),t.defineComputedProperty_(e,or({},this.options_,{get:r.get,set:r.set}),n)}function Wh(t,e){var r=this,n=e.name,a=e.addInitializer;return a(function(){var i=gr(this)[Z],o=or({},r.options_,{get:t,context:this});o.name||(o.name="ObservableObject."+n.toString()),i.values_.set(n,new ot(o))}),function(){return this[Z].getObservablePropValue_(n)}}function Gh(t,e,r,n){e.annotationType_,n.get}function Vs(t,e){return{annotationType_:t,options_:e,make_:Yh,extend_:Kh,decorate_20223_:Qh}}function Yh(t,e,r){return this.extend_(t,e,r,!1)===null?0:1}function Kh(t,e,r,n){var a,i;return Xh(t,this),t.defineObservableProperty_(e,r.value,(a=(i=this.options_)==null?void 0:i.enhancer)!=null?a:cr,n)}function Qh(t,e){var r=this,n=e.kind,a=e.name,i=new WeakSet;function o(c,l){var d,u,m=gr(c)[Z],b=new rr(l,(d=(u=r.options_)==null?void 0:u.enhancer)!=null?d:cr,"ObservableObject."+a.toString(),!1);m.values_.set(a,b),i.add(c)}if(n=="accessor")return{get:function(){return i.has(this)||o(this,t.get.call(this)),this[Z].getObservablePropValue_(a)},set:function(l){return i.has(this)||o(this,l),this[Z].setObservablePropValue_(a,l)},init:function(l){return i.has(this)||o(this,l),l}}}function Xh(t,e,r,n){e.annotationType_}var Jh="true",Zh=No();function No(t){return{annotationType_:Jh,options_:t,make_:em,extend_:tm,decorate_20223_:rm}}function em(t,e,r,n){var a,i;if(r.get)return zs.make_(t,e,r,n);if(r.set){var o=lr(e.toString(),r.set);return n===t.target_?t.defineProperty_(e,{configurable:T.safeDescriptors?t.isPlainObject_:!0,set:o})===null?0:2:(pt(n,e,{configurable:!0,set:o}),2)}if(n!==t.target_&&typeof r.value=="function"){var c;if(fo(r.value)){var l,d=(l=this.options_)!=null&&l.autoBind?kr.bound:kr;return d.make_(t,e,r,n)}var u=(c=this.options_)!=null&&c.autoBind?Hr.bound:Hr;return u.make_(t,e,r,n)}var m=((a=this.options_)==null?void 0:a.deep)===!1?Ie.ref:Ie;if(typeof r.value=="function"&&(i=this.options_)!=null&&i.autoBind){var b;r.value=r.value.bind((b=t.proxy_)!=null?b:t.target_)}return m.make_(t,e,r,n)}function tm(t,e,r,n){var a,i;if(r.get)return zs.extend_(t,e,r,n);if(r.set)return t.defineProperty_(e,{configurable:T.safeDescriptors?t.isPlainObject_:!0,set:lr(e.toString(),r.set)},n);if(typeof r.value=="function"&&(a=this.options_)!=null&&a.autoBind){var o;r.value=r.value.bind((o=t.proxy_)!=null?o:t.target_)}var c=((i=this.options_)==null?void 0:i.deep)===!1?Ie.ref:Ie;return c.extend_(t,e,r,n)}function rm(t,e){le("'"+this.annotationType_+"' cannot be used as a decorator")}var sm="observable",nm="observable.ref",am="observable.shallow",im="observable.struct",_o={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(_o);function ds(t){return t||_o}var _n=Vs(sm),om=Vs(nm,{enhancer:Bs}),cm=Vs(am,{enhancer:Mh}),lm=Vs(im,{enhancer:Th}),So=xt(_n);function us(t){return t.deep===!0?cr:t.deep===!1?Bs:um(t.defaultDecorator)}function dm(t){var e;return t?(e=t.defaultDecorator)!=null?e:No(t):void 0}function um(t){var e,r;return t&&(e=(r=t.options_)==null?void 0:r.enhancer)!=null?e:cr}function Co(t,e,r){if(ss(e))return _n.decorate_20223_(t,e);if(ir(e)){rs(t,e,_n);return}return Go(t)?t:Mt(t)?Ie.object(t,e,r):Array.isArray(t)?Ie.array(t,e):Mr(t)?Ie.map(t,e):St(t)?Ie.set(t,e):typeof t=="object"&&t!==null?t:Ie.box(t,e)}lo(Co,So);var hm={box:function(e,r){var n=ds(r);return new rr(e,us(n),n.name,!0,n.equals)},array:function(e,r){var n=ds(r);return(T.useProxies===!1||n.proxy===!1?lf:Jm)(e,us(n),n.name)},map:function(e,r){var n=ds(r);return new Ko(e,us(n),n.name)},set:function(e,r){var n=ds(r);return new Qo(e,us(n),n.name)},object:function(e,r,n){return Xt(function(){return qo(T.useProxies===!1||(n==null?void 0:n.proxy)===!1?gr({},n):Gm({},n),e,r)})},ref:xt(om),shallow:xt(cm),deep:So,struct:xt(lm)},Ie=lo(Co,hm),Po="computed",mm="computed.struct",Sn=Gn(Po),fm=Gn(mm,{equals:_s.structural}),zs=function(e,r){if(ss(r))return Sn.decorate_20223_(e,r);if(ir(r))return rs(e,r,Sn);if(Mt(e))return xt(Gn(Po,e));var n=Mt(r)?r:{};return n.get=e,n.name||(n.name=e.name||""),new ot(n)};Object.assign(zs,Sn);zs.struct=xt(fm);var La,Ba,Ss=0,gm=1,pm=(La=(Ba=Ns(function(){},"name"))==null?void 0:Ba.configurable)!=null?La:!1,Va={value:"action",configurable:!0,writable:!1,enumerable:!1};function lr(t,e,r,n){r===void 0&&(r=!1);function a(){return ko(t,r,e,n||this,arguments)}return a.isMobxAction=!0,a.toString=function(){return e.toString()},pm&&(Va.value=t,pt(a,"name",Va)),a}function ko(t,e,r,n,a){var i=xm(t,e);try{return r.apply(n,a)}catch(o){throw i.error_=o,o}finally{bm(i)}}function xm(t,e,r,n){var a=!1,i=0,o=T.trackingDerivation,c=!e||!o;Ze();var l=T.allowStateChanges;c&&(mr(),l=Yn(!0));var d=Qn(!0),u={runAsAction_:c,prevDerivation_:o,prevAllowStateChanges_:l,prevAllowStateReads_:d,notifySpy_:a,startTime_:i,actionId_:gm++,parentActionId_:Ss};return Ss=u.actionId_,u}function bm(t){Ss!==t.actionId_&&le(30),Ss=t.parentActionId_,t.error_!==void 0&&(T.suppressReactionErrors=!0),Kn(t.prevAllowStateChanges_),Lr(t.prevAllowStateReads_),et(),t.runAsAction_&&Ot(t.prevDerivation_),T.suppressReactionErrors=!1}function Yn(t){var e=T.allowStateChanges;return T.allowStateChanges=t,e}function Kn(t){T.allowStateChanges=t}var rr=function(t){function e(n,a,i,o,c){var l;return i===void 0&&(i="ObservableValue"),c===void 0&&(c=_s.default),l=t.call(this,i)||this,l.enhancer=void 0,l.name_=void 0,l.equals=void 0,l.hasUnreportedChange_=!1,l.interceptors_=void 0,l.changeListeners_=void 0,l.value_=void 0,l.dehancer=void 0,l.enhancer=a,l.name_=i,l.equals=c,l.value_=a(n,void 0,i),l}bo(e,t);var r=e.prototype;return r.dehanceValue=function(a){return this.dehancer!==void 0?this.dehancer(a):a},r.set=function(a){this.value_,a=this.prepareNewValue_(a),a!==T.UNCHANGED&&this.setNewValue_(a)},r.prepareNewValue_=function(a){if(Xe(this)){var i=Je(this,{object:this,type:bt,newValue:a});if(!i)return T.UNCHANGED;a=i.newValue}return a=this.enhancer(a,this.value_,this.name_),this.equals(this.value_,a)?T.UNCHANGED:a},r.setNewValue_=function(a){var i=this.value_;this.value_=a,this.reportChanged(),nt(this)&&at(this,{type:bt,object:this,newValue:a,oldValue:i})},r.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},r.intercept_=function(a){return as(this,a)},r.observe_=function(a,i){return i&&a({observableKind:"value",debugObjectName:this.name_,object:this,type:bt,newValue:this.value_,oldValue:void 0}),is(this,a)},r.raw=function(){return this.value_},r.toJSON=function(){return this.get()},r.toString=function(){return this.name_+"["+this.value_+"]"},r.valueOf=function(){return xo(this.get())},r[Symbol.toPrimitive]=function(){return this.valueOf()},e}(Qt),ot=function(){function t(r){this.dependenciesState_=ue.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.observers_=new Set,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=ue.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new Ps(null),this.name_=void 0,this.triggeredBy_=void 0,this.flags_=0,this.derivation=void 0,this.setter_=void 0,this.isTracing_=Cs.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,r.get||le(31),this.derivation=r.get,this.name_=r.name||"ComputedValue",r.set&&(this.setter_=lr("ComputedValue-setter",r.set)),this.equals_=r.equals||(r.compareStructural||r.struct?_s.structural:_s.default),this.scope_=r.context,this.requiresReaction_=r.requiresReaction,this.keepAlive_=!!r.keepAlive}var e=t.prototype;return e.onBecomeStale_=function(){Nm(this)},e.onBO=function(){this.onBOL&&this.onBOL.forEach(function(n){return n()})},e.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(n){return n()})},e.get=function(){if(this.isComputing&&le(32,this.name_,this.derivation),T.inBatch===0&&this.observers_.size===0&&!this.keepAlive_)Cn(this)&&(this.warnAboutUntrackedRead_(),Ze(),this.value_=this.computeValue_(!1),et());else if(Io(this),Cn(this)){var n=T.trackingContext;this.keepAlive_&&!n&&(T.trackingContext=this),this.trackAndCompute()&&jm(this),T.trackingContext=n}var a=this.value_;if(gs(a))throw a.cause;return a},e.set=function(n){if(this.setter_){this.isRunningSetter&&le(33,this.name_),this.isRunningSetter=!0;try{this.setter_.call(this.scope_,n)}finally{this.isRunningSetter=!1}}else le(34,this.name_)},e.trackAndCompute=function(){var n=this.value_,a=this.dependenciesState_===ue.NOT_TRACKING_,i=this.computeValue_(!0),o=a||gs(n)||gs(i)||!this.equals_(n,i);return o&&(this.value_=i),o},e.computeValue_=function(n){this.isComputing=!0;var a=Yn(!1),i;if(n)i=Oo(this,this.derivation,this.scope_);else if(T.disableErrorBoundaries===!0)i=this.derivation.call(this.scope_);else try{i=this.derivation.call(this.scope_)}catch(o){i=new Ps(o)}return Kn(a),this.isComputing=!1,i},e.suspend_=function(){this.keepAlive_||(Pn(this),this.value_=void 0)},e.observe_=function(n,a){var i=this,o=!0,c=void 0;return Mm(function(){var l=i.get();if(!o||a){var d=mr();n({observableKind:"computed",debugObjectName:i.name_,type:bt,object:i,newValue:l,oldValue:c}),Ot(d)}o=!1,c=l})},e.warnAboutUntrackedRead_=function(){},e.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},e.valueOf=function(){return xo(this.get())},e[Symbol.toPrimitive]=function(){return this.valueOf()},Tr(t,[{key:"isComputing",get:function(){return We(this.flags_,t.isComputingMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isComputingMask_,n)}},{key:"isRunningSetter",get:function(){return We(this.flags_,t.isRunningSetterMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isRunningSetterMask_,n)}},{key:"isBeingObserved",get:function(){return We(this.flags_,t.isBeingObservedMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isBeingObservedMask_,n)}},{key:"isPendingUnobservation",get:function(){return We(this.flags_,t.isPendingUnobservationMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isPendingUnobservationMask_,n)}},{key:"diffValue",get:function(){return We(this.flags_,t.diffValueMask_)?1:0},set:function(n){this.flags_=Ge(this.flags_,t.diffValueMask_,n===1)}}])}();ot.isComputingMask_=1;ot.isRunningSetterMask_=2;ot.isBeingObservedMask_=4;ot.isPendingUnobservationMask_=8;ot.diffValueMask_=16;var qs=hr("ComputedValue",ot),ue;(function(t){t[t.NOT_TRACKING_=-1]="NOT_TRACKING_",t[t.UP_TO_DATE_=0]="UP_TO_DATE_",t[t.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",t[t.STALE_=2]="STALE_"})(ue||(ue={}));var Cs;(function(t){t[t.NONE=0]="NONE",t[t.LOG=1]="LOG",t[t.BREAK=2]="BREAK"})(Cs||(Cs={}));var Ps=function(e){this.cause=void 0,this.cause=e};function gs(t){return t instanceof Ps}function Cn(t){switch(t.dependenciesState_){case ue.UP_TO_DATE_:return!1;case ue.NOT_TRACKING_:case ue.STALE_:return!0;case ue.POSSIBLY_STALE_:{for(var e=Qn(!0),r=mr(),n=t.observing_,a=n.length,i=0;i<a;i++){var o=n[i];if(qs(o)){if(T.disableErrorBoundaries)o.get();else try{o.get()}catch{return Ot(r),Lr(e),!0}if(t.dependenciesState_===ue.STALE_)return Ot(r),Lr(e),!0}}return Eo(t),Ot(r),Lr(e),!1}}}function Oo(t,e,r){var n=Qn(!0);Eo(t),t.newObserving_=new Array(t.runId_===0?100:t.observing_.length),t.unboundDepsCount_=0,t.runId_=++T.runId;var a=T.trackingDerivation;T.trackingDerivation=t,T.inBatch++;var i;if(T.disableErrorBoundaries===!0)i=e.call(r);else try{i=e.call(r)}catch(o){i=new Ps(o)}return T.inBatch--,T.trackingDerivation=a,vm(t),Lr(n),i}function vm(t){for(var e=t.observing_,r=t.observing_=t.newObserving_,n=ue.UP_TO_DATE_,a=0,i=t.unboundDepsCount_,o=0;o<i;o++){var c=r[o];c.diffValue===0&&(c.diffValue=1,a!==o&&(r[a]=c),a++),c.dependenciesState_>n&&(n=c.dependenciesState_)}for(r.length=a,t.newObserving_=null,i=e.length;i--;){var l=e[i];l.diffValue===0&&To(l,t),l.diffValue=0}for(;a--;){var d=r[a];d.diffValue===1&&(d.diffValue=0,wm(d,t))}n!==ue.UP_TO_DATE_&&(t.dependenciesState_=n,t.onBecomeStale_())}function Pn(t){var e=t.observing_;t.observing_=[];for(var r=e.length;r--;)To(e[r],t);t.dependenciesState_=ue.NOT_TRACKING_}function Ao(t){var e=mr();try{return t()}finally{Ot(e)}}function mr(){var t=T.trackingDerivation;return T.trackingDerivation=null,t}function Ot(t){T.trackingDerivation=t}function Qn(t){var e=T.allowStateReads;return T.allowStateReads=t,e}function Lr(t){T.allowStateReads=t}function Eo(t){if(t.dependenciesState_!==ue.UP_TO_DATE_){t.dependenciesState_=ue.UP_TO_DATE_;for(var e=t.observing_,r=e.length;r--;)e[r].lowestObserverState_=ue.UP_TO_DATE_}}var ps=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},xs=!0,Mo=!1,T=function(){var t=$s();return t.__mobxInstanceCount>0&&!t.__mobxGlobals&&(xs=!1),t.__mobxGlobals&&t.__mobxGlobals.version!==new ps().version&&(xs=!1),xs?t.__mobxGlobals?(t.__mobxInstanceCount+=1,t.__mobxGlobals.UNCHANGED||(t.__mobxGlobals.UNCHANGED={}),t.__mobxGlobals):(t.__mobxInstanceCount=1,t.__mobxGlobals=new ps):(setTimeout(function(){Mo||le(35)},1),new ps)}();function ym(){if((T.pendingReactions.length||T.inBatch||T.isRunningReactions)&&le(36),Mo=!0,xs){var t=$s();--t.__mobxInstanceCount===0&&(t.__mobxGlobals=void 0),T=new ps}}function wm(t,e){t.observers_.add(e),t.lowestObserverState_>e.dependenciesState_&&(t.lowestObserverState_=e.dependenciesState_)}function To(t,e){t.observers_.delete(e),t.observers_.size===0&&Ro(t)}function Ro(t){t.isPendingUnobservation===!1&&(t.isPendingUnobservation=!0,T.pendingUnobservations.push(t))}function Ze(){T.inBatch++}function et(){if(--T.inBatch===0){Uo();for(var t=T.pendingUnobservations,e=0;e<t.length;e++){var r=t[e];r.isPendingUnobservation=!1,r.observers_.size===0&&(r.isBeingObserved&&(r.isBeingObserved=!1,r.onBUO()),r instanceof ot&&r.suspend_())}T.pendingUnobservations=[]}}function Io(t){var e=T.trackingDerivation;return e!==null?(e.runId_!==t.lastAccessedBy_&&(t.lastAccessedBy_=e.runId_,e.newObserving_[e.unboundDepsCount_++]=t,!t.isBeingObserved&&T.trackingContext&&(t.isBeingObserved=!0,t.onBO())),t.isBeingObserved):(t.observers_.size===0&&T.inBatch>0&&Ro(t),!1)}function Fo(t){t.lowestObserverState_!==ue.STALE_&&(t.lowestObserverState_=ue.STALE_,t.observers_.forEach(function(e){e.dependenciesState_===ue.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=ue.STALE_}))}function jm(t){t.lowestObserverState_!==ue.STALE_&&(t.lowestObserverState_=ue.STALE_,t.observers_.forEach(function(e){e.dependenciesState_===ue.POSSIBLY_STALE_?e.dependenciesState_=ue.STALE_:e.dependenciesState_===ue.UP_TO_DATE_&&(t.lowestObserverState_=ue.UP_TO_DATE_)}))}function Nm(t){t.lowestObserverState_===ue.UP_TO_DATE_&&(t.lowestObserverState_=ue.POSSIBLY_STALE_,t.observers_.forEach(function(e){e.dependenciesState_===ue.UP_TO_DATE_&&(e.dependenciesState_=ue.POSSIBLY_STALE_,e.onBecomeStale_())}))}var Tt=function(){function t(r,n,a,i){r===void 0&&(r="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=ue.NOT_TRACKING_,this.runId_=0,this.unboundDepsCount_=0,this.flags_=0,this.isTracing_=Cs.NONE,this.name_=r,this.onInvalidate_=n,this.errorHandler_=a,this.requiresObservable_=i}var e=t.prototype;return e.onBecomeStale_=function(){this.schedule_()},e.schedule_=function(){this.isScheduled||(this.isScheduled=!0,T.pendingReactions.push(this),Uo())},e.runReaction_=function(){if(!this.isDisposed){Ze(),this.isScheduled=!1;var n=T.trackingContext;if(T.trackingContext=this,Cn(this)){this.isTrackPending=!0;try{this.onInvalidate_()}catch(a){this.reportExceptionInDerivation_(a)}}T.trackingContext=n,et()}},e.track=function(n){if(!this.isDisposed){Ze(),this.isRunning=!0;var a=T.trackingContext;T.trackingContext=this;var i=Oo(this,n,void 0);T.trackingContext=a,this.isRunning=!1,this.isTrackPending=!1,this.isDisposed&&Pn(this),gs(i)&&this.reportExceptionInDerivation_(i.cause),et()}},e.reportExceptionInDerivation_=function(n){var a=this;if(this.errorHandler_){this.errorHandler_(n,this);return}if(T.disableErrorBoundaries)throw n;var i="[mobx] uncaught error in '"+this+"'";T.suppressReactionErrors||console.error(i,n),T.globalReactionErrorHandlers.forEach(function(o){return o(n,a)})},e.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.isRunning||(Ze(),Pn(this),et()))},e.getDisposer_=function(n){var a=this,i=function o(){a.dispose(),n==null||n.removeEventListener==null||n.removeEventListener("abort",o)};return n==null||n.addEventListener==null||n.addEventListener("abort",i),i[Z]=this,i},e.toString=function(){return"Reaction["+this.name_+"]"},e.trace=function(n){},Tr(t,[{key:"isDisposed",get:function(){return We(this.flags_,t.isDisposedMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isDisposedMask_,n)}},{key:"isScheduled",get:function(){return We(this.flags_,t.isScheduledMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isScheduledMask_,n)}},{key:"isTrackPending",get:function(){return We(this.flags_,t.isTrackPendingMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isTrackPendingMask_,n)}},{key:"isRunning",get:function(){return We(this.flags_,t.isRunningMask_)},set:function(n){this.flags_=Ge(this.flags_,t.isRunningMask_,n)}},{key:"diffValue",get:function(){return We(this.flags_,t.diffValueMask_)?1:0},set:function(n){this.flags_=Ge(this.flags_,t.diffValueMask_,n===1)}}])}();Tt.isDisposedMask_=1;Tt.isScheduledMask_=2;Tt.isTrackPendingMask_=4;Tt.isRunningMask_=8;Tt.diffValueMask_=16;var _m=100,kn=function(e){return e()};function Uo(){T.inBatch>0||T.isRunningReactions||kn(Sm)}function Sm(){T.isRunningReactions=!0;for(var t=T.pendingReactions,e=0;t.length>0;){++e===_m&&(console.error("[mobx] cycle in reaction: "+t[0]),t.splice(0));for(var r=t.splice(0),n=0,a=r.length;n<a;n++)r[n].runReaction_()}T.isRunningReactions=!1}var ks=hr("Reaction",Tt);function Cm(t){var e=kn;kn=function(n){return t(function(){return e(n)})}}function Br(){return!1}function Pm(t){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}var $o="action",km="action.bound",Do="autoAction",Om="autoAction.bound",Lo="<unnamed action>",On=ns($o),Am=ns(km,{bound:!0}),An=ns(Do,{autoAction:!0}),Em=ns(Om,{autoAction:!0,bound:!0});function Bo(t){var e=function(n,a){if(it(n))return lr(n.name||Lo,n,t);if(it(a))return lr(n,a,t);if(ss(a))return(t?An:On).decorate_20223_(n,a);if(ir(a))return rs(n,a,t?An:On);if(ir(n))return xt(ns(t?Do:$o,{name:n,autoAction:t}))};return e}var Nr=Bo(!1);Object.assign(Nr,On);var Hr=Bo(!0);Object.assign(Hr,An);Nr.bound=xt(Am);Hr.bound=xt(Em);function sn(t){return ko(t.name||Lo,!1,t,this,void 0)}function Wr(t){return it(t)&&t.isMobxAction===!0}function Mm(t,e){var r,n,a,i;e===void 0&&(e=uo);var o=(r=(n=e)==null?void 0:n.name)!=null?r:"Autorun",c=!e.scheduler&&!e.delay,l;if(c)l=new Tt(o,function(){this.track(m)},e.onError,e.requiresObservable);else{var d=Rm(e),u=!1;l=new Tt(o,function(){u||(u=!0,d(function(){u=!1,l.isDisposed||l.track(m)}))},e.onError,e.requiresObservable)}function m(){t(l)}return(a=e)!=null&&(a=a.signal)!=null&&a.aborted||l.schedule_(),l.getDisposer_((i=e)==null?void 0:i.signal)}var Tm=function(e){return e()};function Rm(t){return t.scheduler?t.scheduler:t.delay?function(e){return setTimeout(e,t.delay)}:Tm}var Im="onBO",Fm="onBUO";function Um(t,e,r){return zo(Im,t,e,r)}function Vo(t,e,r){return zo(Fm,t,e,r)}function zo(t,e,r,n){var a=Es(e),i=it(n)?n:r,o=t+"L";return a[o]?a[o].add(i):a[o]=new Set([i]),function(){var c=a[o];c&&(c.delete(i),c.size===0&&delete a[o])}}var $m="never",hs="always",Dm="observed";function Lm(t){t.isolateGlobalState===!0&&ym();var e=t.useProxies,r=t.enforceActions;if(e!==void 0&&(T.useProxies=e===hs?!0:e===$m?!1:typeof Proxy<"u"),e==="ifavailable"&&(T.verifyProxies=!0),r!==void 0){var n=r===hs?hs:r===Dm;T.enforceActions=n,T.allowStateChanges=!(n===!0||n===hs)}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach(function(a){a in t&&(T[a]=!!t[a])}),T.allowStateReads=!T.observableRequiresReaction,t.reactionScheduler&&Cm(t.reactionScheduler)}function qo(t,e,r,n){var a=jh(e);return Xt(function(){var i=gr(t,n)[Z];Pr(a).forEach(function(o){i.extend_(o,a[o],r&&o in r?r[o]:!0)})}),t}function Bm(t,e){return Ho(Es(t,e))}function Ho(t){var e={name:t.name_};return t.observing_&&t.observing_.length>0&&(e.dependencies=Vm(t.observing_).map(Ho)),e}function Vm(t){return Array.from(new Set(t))}var zm=0;function Wo(){this.message="FLOW_CANCELLED"}Wo.prototype=Object.create(Error.prototype);var nn=wo("flow"),qm=wo("flow.bound",{bound:!0}),kr=Object.assign(function(e,r){if(ss(r))return nn.decorate_20223_(e,r);if(ir(r))return rs(e,r,nn);var n=e,a=n.name||"<unnamed flow>",i=function(){var c=this,l=arguments,d=++zm,u=Nr(a+" - runid: "+d+" - init",n).apply(c,l),m,b=void 0,x=new Promise(function(p,f){var h=0;m=f;function g(_){b=void 0;var P;try{P=Nr(a+" - runid: "+d+" - yield "+h++,u.next).call(u,_)}catch(S){return f(S)}v(P)}function w(_){b=void 0;var P;try{P=Nr(a+" - runid: "+d+" - yield "+h++,u.throw).call(u,_)}catch(S){return f(S)}v(P)}function v(_){if(it(_==null?void 0:_.then)){_.then(v,f);return}return _.done?p(_.value):(b=Promise.resolve(_.value),b.then(g,w))}g(void 0)});return x.cancel=Nr(a+" - runid: "+d+" - cancel",function(){try{b&&za(b);var p=u.return(void 0),f=Promise.resolve(p.value);f.then(wr,wr),za(f),m(new Wo)}catch(h){m(h)}}),x};return i.isMobXFlow=!0,i},nn);kr.bound=xt(qm);function za(t){it(t.cancel)&&t.cancel()}function Gr(t){return(t==null?void 0:t.isMobXFlow)===!0}function Hm(t,e){return t?Ws(t)||!!t[Z]||Wn(t)||ks(t)||qs(t):!1}function Go(t){return Hm(t)}function Ct(t,e){e===void 0&&(e=void 0),Ze();try{return t.apply(e)}finally{et()}}function br(t){return t[Z]}var Wm={has:function(e,r){return br(e).has_(r)},get:function(e,r){return br(e).get_(r)},set:function(e,r,n){var a;return ir(r)?(a=br(e).set_(r,n,!0))!=null?a:!0:!1},deleteProperty:function(e,r){var n;return ir(r)?(n=br(e).delete_(r,!0))!=null?n:!0:!1},defineProperty:function(e,r,n){var a;return(a=br(e).defineProperty_(r,n))!=null?a:!0},ownKeys:function(e){return br(e).ownKeys_()},preventExtensions:function(e){le(13)}};function Gm(t,e){var r,n;return ho(),t=gr(t,e),(n=(r=t[Z]).proxy_)!=null?n:r.proxy_=new Proxy(t,Wm)}function Xe(t){return t.interceptors_!==void 0&&t.interceptors_.length>0}function as(t,e){var r=t.interceptors_||(t.interceptors_=[]);return r.push(e),mo(function(){var n=r.indexOf(e);n!==-1&&r.splice(n,1)})}function Je(t,e){var r=mr();try{for(var n=[].concat(t.interceptors_||[]),a=0,i=n.length;a<i&&(e=n[a](e),e&&!e.type&&le(14),!!e);a++);return e}finally{Ot(r)}}function nt(t){return t.changeListeners_!==void 0&&t.changeListeners_.length>0}function is(t,e){var r=t.changeListeners_||(t.changeListeners_=[]);return r.push(e),mo(function(){var n=r.indexOf(e);n!==-1&&r.splice(n,1)})}function at(t,e){var r=mr(),n=t.changeListeners_;if(n){n=n.slice();for(var a=0,i=n.length;a<i;a++)n[a](e);Ot(r)}}function Ym(t,e,r){return Xt(function(){var n,a=gr(t,r)[Z];(n=e)!=null||(e=Ph(t)),Pr(e).forEach(function(i){return a.make_(i,e[i])})}),t}var an=Symbol("mobx-keys");function Km(t,e,r){return Mt(t)?qo(t,t,e,r):(Xt(function(){var n=gr(t,r)[Z];if(!t[an]){var a=Object.getPrototypeOf(t),i=new Set([].concat(Pr(t),Pr(a)));i.delete("constructor"),i.delete(Z),ts(a,an,i)}t[an].forEach(function(o){return n.make_(o,e&&o in e?e[o]:!0)})}),t)}var qa="splice",bt="update",Qm=1e4,Xm={get:function(e,r){var n=e[Z];return r===Z?n:r==="length"?n.getArrayLength_():typeof r=="string"&&!isNaN(r)?n.get_(parseInt(r)):kt(Os,r)?Os[r]:e[r]},set:function(e,r,n){var a=e[Z];return r==="length"&&a.setArrayLength_(n),typeof r=="symbol"||isNaN(r)?e[r]=n:a.set_(parseInt(r),n),!0},preventExtensions:function(){le(15)}},Xn=function(){function t(r,n,a,i){r===void 0&&(r="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=a,this.legacyMode_=i,this.atom_=new Qt(r),this.enhancer_=function(o,c){return n(o,c,"ObservableArray[..]")}}var e=t.prototype;return e.dehanceValue_=function(n){return this.dehancer!==void 0?this.dehancer(n):n},e.dehanceValues_=function(n){return this.dehancer!==void 0&&n.length>0?n.map(this.dehancer):n},e.intercept_=function(n){return as(this,n)},e.observe_=function(n,a){return a===void 0&&(a=!1),a&&n({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),is(this,n)},e.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},e.setArrayLength_=function(n){(typeof n!="number"||isNaN(n)||n<0)&&le("Out of range: "+n);var a=this.values_.length;if(n!==a)if(n>a){for(var i=new Array(n-a),o=0;o<n-a;o++)i[o]=void 0;this.spliceWithArray_(a,0,i)}else this.spliceWithArray_(n,a-n)},e.updateArrayLength_=function(n,a){n!==this.lastKnownLength_&&le(16),this.lastKnownLength_+=a,this.legacyMode_&&a>0&&ec(n+a+1)},e.spliceWithArray_=function(n,a,i){var o=this;this.atom_;var c=this.values_.length;if(n===void 0?n=0:n>c?n=c:n<0&&(n=Math.max(0,c+n)),arguments.length===1?a=c-n:a==null?a=0:a=Math.max(0,Math.min(a,c-n)),i===void 0&&(i=jn),Xe(this)){var l=Je(this,{object:this.proxy_,type:qa,index:n,removedCount:a,added:i});if(!l)return jn;a=l.removedCount,i=l.added}if(i=i.length===0?i:i.map(function(m){return o.enhancer_(m,void 0)}),this.legacyMode_){var d=i.length-a;this.updateArrayLength_(c,d)}var u=this.spliceItemsIntoValues_(n,a,i);return(a!==0||i.length!==0)&&this.notifyArraySplice_(n,i,u),this.dehanceValues_(u)},e.spliceItemsIntoValues_=function(n,a,i){if(i.length<Qm){var o;return(o=this.values_).splice.apply(o,[n,a].concat(i))}else{var c=this.values_.slice(n,n+a),l=this.values_.slice(n+a);this.values_.length+=i.length-a;for(var d=0;d<i.length;d++)this.values_[n+d]=i[d];for(var u=0;u<l.length;u++)this.values_[n+i.length+u]=l[u];return c}},e.notifyArrayChildUpdate_=function(n,a,i){var o=!this.owned_&&Br(),c=nt(this),l=c||o?{observableKind:"array",object:this.proxy_,type:bt,debugObjectName:this.atom_.name_,index:n,newValue:a,oldValue:i}:null;this.atom_.reportChanged(),c&&at(this,l)},e.notifyArraySplice_=function(n,a,i){var o=!this.owned_&&Br(),c=nt(this),l=c||o?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:qa,index:n,removed:i,added:a,removedCount:i.length,addedCount:a.length}:null;this.atom_.reportChanged(),c&&at(this,l)},e.get_=function(n){if(this.legacyMode_&&n>=this.values_.length){console.warn("[mobx] Out of bounds read: "+n);return}return this.atom_.reportObserved(),this.dehanceValue_(this.values_[n])},e.set_=function(n,a){var i=this.values_;if(this.legacyMode_&&n>i.length&&le(17,n,i.length),n<i.length){this.atom_;var o=i[n];if(Xe(this)){var c=Je(this,{type:bt,object:this.proxy_,index:n,newValue:a});if(!c)return;a=c.newValue}a=this.enhancer_(a,o);var l=a!==o;l&&(i[n]=a,this.notifyArrayChildUpdate_(n,a,o))}else{for(var d=new Array(n+1-i.length),u=0;u<d.length-1;u++)d[u]=void 0;d[d.length-1]=a,this.spliceWithArray_(i.length,0,d)}},t}();function Jm(t,e,r,n){return r===void 0&&(r="ObservableArray"),n===void 0&&(n=!1),ho(),Xt(function(){var a=new Xn(r,e,n,!1);go(a.values_,Z,a);var i=new Proxy(a.values_,Xm);return a.proxy_=i,t&&t.length&&a.spliceWithArray_(0,0,t),i})}var Os={clear:function(){return this.splice(0)},replace:function(e){var r=this[Z];return r.spliceWithArray_(0,r.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,r){for(var n=arguments.length,a=new Array(n>2?n-2:0),i=2;i<n;i++)a[i-2]=arguments[i];var o=this[Z];switch(arguments.length){case 0:return[];case 1:return o.spliceWithArray_(e);case 2:return o.spliceWithArray_(e,r)}return o.spliceWithArray_(e,r,a)},spliceWithArray:function(e,r,n){return this[Z].spliceWithArray_(e,r,n)},push:function(){for(var e=this[Z],r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return e.spliceWithArray_(e.values_.length,0,n),e.values_.length},pop:function(){return this.splice(Math.max(this[Z].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[Z],r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return e.spliceWithArray_(0,0,n),e.values_.length},reverse:function(){return T.trackingDerivation&&le(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){T.trackingDerivation&&le(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var r=this[Z],n=r.dehanceValues_(r.values_).indexOf(e);return n>-1?(this.splice(n,1),!0):!1}};we("at",Qe);we("concat",Qe);we("flat",Qe);we("includes",Qe);we("indexOf",Qe);we("join",Qe);we("lastIndexOf",Qe);we("slice",Qe);we("toString",Qe);we("toLocaleString",Qe);we("toSorted",Qe);we("toSpliced",Qe);we("with",Qe);we("every",lt);we("filter",lt);we("find",lt);we("findIndex",lt);we("findLast",lt);we("findLastIndex",lt);we("flatMap",lt);we("forEach",lt);we("map",lt);we("some",lt);we("toReversed",lt);we("reduce",Yo);we("reduceRight",Yo);function we(t,e){typeof Array.prototype[t]=="function"&&(Os[t]=e(t))}function Qe(t){return function(){var e=this[Z];e.atom_.reportObserved();var r=e.dehanceValues_(e.values_);return r[t].apply(r,arguments)}}function lt(t){return function(e,r){var n=this,a=this[Z];a.atom_.reportObserved();var i=a.dehanceValues_(a.values_);return i[t](function(o,c){return e.call(r,o,c,n)})}}function Yo(t){return function(){var e=this,r=this[Z];r.atom_.reportObserved();var n=r.dehanceValues_(r.values_),a=arguments[0];return arguments[0]=function(i,o,c){return a(i,o,c,e)},n[t].apply(n,arguments)}}var Zm=hr("ObservableArrayAdministration",Xn);function Hs(t){return Ls(t)&&Zm(t[Z])}var ef={},Vt="add",As="delete",Ko=function(){function t(r,n,a){var i=this;n===void 0&&(n=cr),a===void 0&&(a="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[Z]=ef,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=n,this.name_=a,it(Map)||le(18),Xt(function(){i.keysAtom_=vo("ObservableMap.keys()"),i.data_=new Map,i.hasMap_=new Map,r&&i.merge(r)})}var e=t.prototype;return e.has_=function(n){return this.data_.has(n)},e.has=function(n){var a=this;if(!T.trackingDerivation)return this.has_(n);var i=this.hasMap_.get(n);if(!i){var o=i=new rr(this.has_(n),Bs,"ObservableMap.key?",!1);this.hasMap_.set(n,o),Vo(o,function(){return a.hasMap_.delete(n)})}return i.get()},e.set=function(n,a){var i=this.has_(n);if(Xe(this)){var o=Je(this,{type:i?bt:Vt,object:this,newValue:a,name:n});if(!o)return this;a=o.newValue}return i?this.updateValue_(n,a):this.addValue_(n,a),this},e.delete=function(n){var a=this;if(this.keysAtom_,Xe(this)){var i=Je(this,{type:As,object:this,name:n});if(!i)return!1}if(this.has_(n)){var o=Br(),c=nt(this),l=c||o?{observableKind:"map",debugObjectName:this.name_,type:As,object:this,oldValue:this.data_.get(n).value_,name:n}:null;return Ct(function(){var d;a.keysAtom_.reportChanged(),(d=a.hasMap_.get(n))==null||d.setNewValue_(!1);var u=a.data_.get(n);u.setNewValue_(void 0),a.data_.delete(n)}),c&&at(this,l),!0}return!1},e.updateValue_=function(n,a){var i=this.data_.get(n);if(a=i.prepareNewValue_(a),a!==T.UNCHANGED){var o=Br(),c=nt(this),l=c||o?{observableKind:"map",debugObjectName:this.name_,type:bt,object:this,oldValue:i.value_,name:n,newValue:a}:null;i.setNewValue_(a),c&&at(this,l)}},e.addValue_=function(n,a){var i=this;this.keysAtom_,Ct(function(){var d,u=new rr(a,i.enhancer_,"ObservableMap.key",!1);i.data_.set(n,u),a=u.value_,(d=i.hasMap_.get(n))==null||d.setNewValue_(!0),i.keysAtom_.reportChanged()});var o=Br(),c=nt(this),l=c||o?{observableKind:"map",debugObjectName:this.name_,type:Vt,object:this,name:n,newValue:a}:null;c&&at(this,l)},e.get=function(n){return this.has(n)?this.dehanceValue_(this.data_.get(n).get()):this.dehanceValue_(void 0)},e.dehanceValue_=function(n){return this.dehancer!==void 0?this.dehancer(n):n},e.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},e.values=function(){var n=this,a=this.keys();return Ha({next:function(){var o=a.next(),c=o.done,l=o.value;return{done:c,value:c?void 0:n.get(l)}}})},e.entries=function(){var n=this,a=this.keys();return Ha({next:function(){var o=a.next(),c=o.done,l=o.value;return{done:c,value:c?void 0:[l,n.get(l)]}}})},e[Symbol.iterator]=function(){return this.entries()},e.forEach=function(n,a){for(var i=jr(this),o;!(o=i()).done;){var c=o.value,l=c[0],d=c[1];n.call(a,d,l,this)}},e.merge=function(n){var a=this;return fr(n)&&(n=new Map(n)),Ct(function(){Mt(n)?wh(n).forEach(function(i){return a.set(i,n[i])}):Array.isArray(n)?n.forEach(function(i){var o=i[0],c=i[1];return a.set(o,c)}):Mr(n)?(yh(n)||le(19,n),n.forEach(function(i,o){return a.set(o,i)})):n!=null&&le(20,n)}),this},e.clear=function(){var n=this;Ct(function(){Ao(function(){for(var a=jr(n.keys()),i;!(i=a()).done;){var o=i.value;n.delete(o)}})})},e.replace=function(n){var a=this;return Ct(function(){for(var i=tf(n),o=new Map,c=!1,l=jr(a.data_.keys()),d;!(d=l()).done;){var u=d.value;if(!i.has(u)){var m=a.delete(u);if(m)c=!0;else{var b=a.data_.get(u);o.set(u,b)}}}for(var x=jr(i.entries()),p;!(p=x()).done;){var f=p.value,h=f[0],g=f[1],w=a.data_.has(h);if(a.set(h,g),a.data_.has(h)){var v=a.data_.get(h);o.set(h,v),w||(c=!0)}}if(!c)if(a.data_.size!==o.size)a.keysAtom_.reportChanged();else for(var _=a.data_.keys(),P=o.keys(),S=_.next(),ee=P.next();!S.done;){if(S.value!==ee.value){a.keysAtom_.reportChanged();break}S=_.next(),ee=P.next()}a.data_=o}),this},e.toString=function(){return"[object ObservableMap]"},e.toJSON=function(){return Array.from(this)},e.observe_=function(n,a){return is(this,n)},e.intercept_=function(n){return as(this,n)},Tr(t,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Map"}}])}(),fr=hr("ObservableMap",Ko);function Ha(t){return t[Symbol.toStringTag]="MapIterator",ea(t)}function tf(t){if(Mr(t)||fr(t))return t;if(Array.isArray(t))return new Map(t);if(Mt(t)){var e=new Map;for(var r in t)e.set(r,t[r]);return e}else return le(21,t)}var rf={},Qo=function(){function t(r,n,a){var i=this;n===void 0&&(n=cr),a===void 0&&(a="ObservableSet"),this.name_=void 0,this[Z]=rf,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=a,it(Set)||le(22),this.enhancer_=function(o,c){return n(o,c,a)},Xt(function(){i.atom_=vo(i.name_),r&&i.replace(r)})}var e=t.prototype;return e.dehanceValue_=function(n){return this.dehancer!==void 0?this.dehancer(n):n},e.clear=function(){var n=this;Ct(function(){Ao(function(){for(var a=jr(n.data_.values()),i;!(i=a()).done;){var o=i.value;n.delete(o)}})})},e.forEach=function(n,a){for(var i=jr(this),o;!(o=i()).done;){var c=o.value;n.call(a,c,c,this)}},e.add=function(n){var a=this;if(this.atom_,Xe(this)){var i=Je(this,{type:Vt,object:this,newValue:n});if(!i)return this}if(!this.has(n)){Ct(function(){a.data_.add(a.enhancer_(n,void 0)),a.atom_.reportChanged()});var o=!1,c=nt(this),l=c||o?{observableKind:"set",debugObjectName:this.name_,type:Vt,object:this,newValue:n}:null;c&&at(this,l)}return this},e.delete=function(n){var a=this;if(Xe(this)){var i=Je(this,{type:As,object:this,oldValue:n});if(!i)return!1}if(this.has(n)){var o=!1,c=nt(this),l=c||o?{observableKind:"set",debugObjectName:this.name_,type:As,object:this,oldValue:n}:null;return Ct(function(){a.atom_.reportChanged(),a.data_.delete(n)}),c&&at(this,l),!0}return!1},e.has=function(n){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(n))},e.entries=function(){var n=0,a=Array.from(this.keys()),i=Array.from(this.values());return Wa({next:function(){var c=n;return n+=1,c<i.length?{value:[a[c],i[c]],done:!1}:{value:void 0,done:!0}}})},e.keys=function(){return this.values()},e.values=function(){this.atom_.reportObserved();var n=this,a=0,i=Array.from(this.data_.values());return Wa({next:function(){return a<i.length?{value:n.dehanceValue_(i[a++]),done:!1}:{value:void 0,done:!0}}})},e.intersection=function(n){if(St(n)&&!ft(n))return n.intersection(this);var a=new Set(this);return a.intersection(n)},e.union=function(n){if(St(n)&&!ft(n))return n.union(this);var a=new Set(this);return a.union(n)},e.difference=function(n){return new Set(this).difference(n)},e.symmetricDifference=function(n){if(St(n)&&!ft(n))return n.symmetricDifference(this);var a=new Set(this);return a.symmetricDifference(n)},e.isSubsetOf=function(n){return new Set(this).isSubsetOf(n)},e.isSupersetOf=function(n){return new Set(this).isSupersetOf(n)},e.isDisjointFrom=function(n){if(St(n)&&!ft(n))return n.isDisjointFrom(this);var a=new Set(this);return a.isDisjointFrom(n)},e.replace=function(n){var a=this;return ft(n)&&(n=new Set(n)),Ct(function(){Array.isArray(n)?(a.clear(),n.forEach(function(i){return a.add(i)})):St(n)?(a.clear(),n.forEach(function(i){return a.add(i)})):n!=null&&le("Cannot initialize set from "+n)}),this},e.observe_=function(n,a){return is(this,n)},e.intercept_=function(n){return as(this,n)},e.toJSON=function(){return Array.from(this)},e.toString=function(){return"[object ObservableSet]"},e[Symbol.iterator]=function(){return this.values()},Tr(t,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Set"}}])}(),ft=hr("ObservableSet",Qo);function Wa(t){return t[Symbol.toStringTag]="SetIterator",ea(t)}var Ga=Object.create(null),Ya="remove",Xo=function(){function t(r,n,a,i){n===void 0&&(n=new Map),i===void 0&&(i=Zh),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=r,this.values_=n,this.name_=a,this.defaultAnnotation_=i,this.keysAtom_=new Qt("ObservableObject.keys"),this.isPlainObject_=Mt(this.target_)}var e=t.prototype;return e.getObservablePropValue_=function(n){return this.values_.get(n).get()},e.setObservablePropValue_=function(n,a){var i=this.values_.get(n);if(i instanceof ot)return i.set(a),!0;if(Xe(this)){var o=Je(this,{type:bt,object:this.proxy_||this.target_,name:n,newValue:a});if(!o)return null;a=o.newValue}if(a=i.prepareNewValue_(a),a!==T.UNCHANGED){var c=nt(this),l=!1,d=c||l?{type:bt,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:i.value_,name:n,newValue:a}:null;i.setNewValue_(a),c&&at(this,d)}return!0},e.get_=function(n){return T.trackingDerivation&&!kt(this.target_,n)&&this.has_(n),this.target_[n]},e.set_=function(n,a,i){return i===void 0&&(i=!1),kt(this.target_,n)?this.values_.has(n)?this.setObservablePropValue_(n,a):i?Reflect.set(this.target_,n,a):(this.target_[n]=a,!0):this.extend_(n,{value:a,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,i)},e.has_=function(n){if(!T.trackingDerivation)return n in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var a=this.pendingKeys_.get(n);return a||(a=new rr(n in this.target_,Bs,"ObservableObject.key?",!1),this.pendingKeys_.set(n,a)),a.get()},e.make_=function(n,a){if(a===!0&&(a=this.defaultAnnotation_),a!==!1){if(!(n in this.target_)){var i;if((i=this.target_[gt])!=null&&i[n])return;le(1,a.annotationType_,this.name_+"."+n.toString())}for(var o=this.target_;o&&o!==Ds;){var c=Ns(o,n);if(c){var l=a.make_(this,n,c,o);if(l===0)return;if(l===1)break}o=Object.getPrototypeOf(o)}Qa(this,a,n)}},e.extend_=function(n,a,i,o){if(o===void 0&&(o=!1),i===!0&&(i=this.defaultAnnotation_),i===!1)return this.defineProperty_(n,a,o);var c=i.extend_(this,n,a,o);return c&&Qa(this,i,n),c},e.defineProperty_=function(n,a,i){i===void 0&&(i=!1),this.keysAtom_;try{Ze();var o=this.delete_(n);if(!o)return o;if(Xe(this)){var c=Je(this,{object:this.proxy_||this.target_,name:n,type:Vt,newValue:a.value});if(!c)return null;var l=c.newValue;a.value!==l&&(a=or({},a,{value:l}))}if(i){if(!Reflect.defineProperty(this.target_,n,a))return!1}else pt(this.target_,n,a);this.notifyPropertyAddition_(n,a.value)}finally{et()}return!0},e.defineObservableProperty_=function(n,a,i,o){o===void 0&&(o=!1),this.keysAtom_;try{Ze();var c=this.delete_(n);if(!c)return c;if(Xe(this)){var l=Je(this,{object:this.proxy_||this.target_,name:n,type:Vt,newValue:a});if(!l)return null;a=l.newValue}var d=Ka(n),u={configurable:T.safeDescriptors?this.isPlainObject_:!0,enumerable:!0,get:d.get,set:d.set};if(o){if(!Reflect.defineProperty(this.target_,n,u))return!1}else pt(this.target_,n,u);var m=new rr(a,i,"ObservableObject.key",!1);this.values_.set(n,m),this.notifyPropertyAddition_(n,m.value_)}finally{et()}return!0},e.defineComputedProperty_=function(n,a,i){i===void 0&&(i=!1),this.keysAtom_;try{Ze();var o=this.delete_(n);if(!o)return o;if(Xe(this)){var c=Je(this,{object:this.proxy_||this.target_,name:n,type:Vt,newValue:void 0});if(!c)return null}a.name||(a.name="ObservableObject.key"),a.context=this.proxy_||this.target_;var l=Ka(n),d={configurable:T.safeDescriptors?this.isPlainObject_:!0,enumerable:!1,get:l.get,set:l.set};if(i){if(!Reflect.defineProperty(this.target_,n,d))return!1}else pt(this.target_,n,d);this.values_.set(n,new ot(a)),this.notifyPropertyAddition_(n,void 0)}finally{et()}return!0},e.delete_=function(n,a){if(a===void 0&&(a=!1),this.keysAtom_,!kt(this.target_,n))return!0;if(Xe(this)){var i=Je(this,{object:this.proxy_||this.target_,name:n,type:Ya});if(!i)return null}try{var o;Ze();var c=nt(this),l=!1,d=this.values_.get(n),u=void 0;if(!d&&(c||l)){var m;u=(m=Ns(this.target_,n))==null?void 0:m.value}if(a){if(!Reflect.deleteProperty(this.target_,n))return!1}else delete this.target_[n];if(d&&(this.values_.delete(n),d instanceof rr&&(u=d.value_),Fo(d)),this.keysAtom_.reportChanged(),(o=this.pendingKeys_)==null||(o=o.get(n))==null||o.set(n in this.target_),c||l){var b={type:Ya,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:u,name:n};c&&at(this,b)}}finally{et()}return!0},e.observe_=function(n,a){return is(this,n)},e.intercept_=function(n){return as(this,n)},e.notifyPropertyAddition_=function(n,a){var i,o=nt(this),c=!1;if(o||c){var l=o||c?{type:Vt,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:n,newValue:a}:null;o&&at(this,l)}(i=this.pendingKeys_)==null||(i=i.get(n))==null||i.set(!0),this.keysAtom_.reportChanged()},e.ownKeys_=function(){return this.keysAtom_.reportObserved(),Pr(this.target_)},e.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},t}();function gr(t,e){var r;if(kt(t,Z))return t;var n=(r=e==null?void 0:e.name)!=null?r:"ObservableObject",a=new Xo(t,new Map,String(n),dm(e));return ts(t,Z,a),t}var sf=hr("ObservableObjectAdministration",Xo);function Ka(t){return Ga[t]||(Ga[t]={get:function(){return this[Z].getObservablePropValue_(t)},set:function(r){return this[Z].setObservablePropValue_(t,r)}})}function Ws(t){return Ls(t)?sf(t[Z]):!1}function Qa(t,e,r){var n;(n=t.target_[gt])==null||delete n[r]}var nf=Zo(0),af=function(){var t=!1,e={};return Object.defineProperty(e,"0",{set:function(){t=!0}}),Object.create(e)[0]=1,t===!1}(),on=0,Jo=function(){};function of(t,e){Object.setPrototypeOf?Object.setPrototypeOf(t.prototype,e):t.prototype.__proto__!==void 0?t.prototype.__proto__=e:t.prototype=e}of(Jo,Array.prototype);var Jn=function(t){function e(n,a,i,o){var c;return i===void 0&&(i="ObservableArray"),o===void 0&&(o=!1),c=t.call(this)||this,Xt(function(){var l=new Xn(i,a,o,!0);l.proxy_=c,go(c,Z,l),n&&n.length&&c.spliceWithArray(0,0,n),af&&Object.defineProperty(c,"0",nf)}),c}bo(e,t);var r=e.prototype;return r.concat=function(){this[Z].atom_.reportObserved();for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return Array.prototype.concat.apply(this.slice(),i.map(function(c){return Hs(c)?c.slice():c}))},r[Symbol.iterator]=function(){var n=this,a=0;return ea({next:function(){return a<n.length?{value:n[a++],done:!1}:{done:!0,value:void 0}}})},Tr(e,[{key:"length",get:function(){return this[Z].getArrayLength_()},set:function(a){this[Z].setArrayLength_(a)}},{key:Symbol.toStringTag,get:function(){return"Array"}}])}(Jo);Object.entries(Os).forEach(function(t){var e=t[0],r=t[1];e!=="concat"&&ts(Jn.prototype,e,r)});function Zo(t){return{enumerable:!1,configurable:!0,get:function(){return this[Z].get_(t)},set:function(r){this[Z].set_(t,r)}}}function cf(t){pt(Jn.prototype,""+t,Zo(t))}function ec(t){if(t>on){for(var e=on;e<t+100;e++)cf(e);on=t}}ec(1e3);function lf(t,e,r){return new Jn(t,e,r)}function Es(t,e){if(typeof t=="object"&&t!==null){if(Hs(t))return e!==void 0&&le(23),t[Z].atom_;if(ft(t))return t.atom_;if(fr(t)){if(e===void 0)return t.keysAtom_;var r=t.data_.get(e)||t.hasMap_.get(e);return r||le(25,e,En(t)),r}if(Ws(t)){if(!e)return le(26);var n=t[Z].values_.get(e);return n||le(27,e,En(t)),n}if(Wn(t)||qs(t)||ks(t))return t}else if(it(t)&&ks(t[Z]))return t[Z];le(28)}function df(t,e){if(t||le(29),Wn(t)||qs(t)||ks(t)||fr(t)||ft(t))return t;if(t[Z])return t[Z];le(24,t)}function En(t,e){var r;if(e!==void 0)r=Es(t,e);else{if(Wr(t))return t.name;Ws(t)||fr(t)||ft(t)?r=df(t):r=Es(t)}return r.name_}function Xt(t){var e=mr(),r=Yn(!0);Ze();try{return t()}finally{et(),Kn(r),Ot(e)}}var Xa=Ds.toString;function Zn(t,e,r){return r===void 0&&(r=-1),Mn(t,e,r)}function Mn(t,e,r,n,a){if(t===e)return t!==0||1/t===1/e;if(t==null||e==null)return!1;if(t!==t)return e!==e;var i=typeof t;if(i!=="function"&&i!=="object"&&typeof e!="object")return!1;var o=Xa.call(t);if(o!==Xa.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:+t==0?1/+t===1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(t)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":r>=0&&r++;break}t=Ja(t),e=Ja(e);var c=o==="[object Array]";if(!c){if(typeof t!="object"||typeof e!="object")return!1;var l=t.constructor,d=e.constructor;if(l!==d&&!(it(l)&&l instanceof l&&it(d)&&d instanceof d)&&"constructor"in t&&"constructor"in e)return!1}if(r===0)return!1;r<0&&(r=-1),n=n||[],a=a||[];for(var u=n.length;u--;)if(n[u]===t)return a[u]===e;if(n.push(t),a.push(e),c){if(u=t.length,u!==e.length)return!1;for(;u--;)if(!Mn(t[u],e[u],r-1,n,a))return!1}else{var m=Object.keys(t),b;if(u=m.length,Object.keys(e).length!==u)return!1;for(;u--;)if(b=m[u],!(kt(e,b)&&Mn(t[b],e[b],r-1,n,a)))return!1}return n.pop(),a.pop(),!0}function Ja(t){return Hs(t)?t.slice():Mr(t)||fr(t)||St(t)||ft(t)?Array.from(t.entries()):t}var Za,uf=((Za=$s().Iterator)==null?void 0:Za.prototype)||{};function ea(t){return t[Symbol.iterator]=hf,Object.assign(Object.create(uf),t)}function hf(){return this}["Symbol","Map","Set"].forEach(function(t){var e=$s();typeof e[t]>"u"&&le("MobX requires global '"+t+"' to be available or polyfilled")});typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:Pm,extras:{getDebugName:En},$mobx:Z});if(!y.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!Ym)throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");function mf(t){t()}function ff(t){t||(t=mf),Lm({reactionScheduler:t})}function gf(t){return Bm(t)}var pf=1e4,xf=1e4,bf=function(){function t(e){var r=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(n){n===void 0&&(n=pf),clearTimeout(r.sweepTimeout),r.sweepTimeout=void 0;var a=Date.now();r.registrations.forEach(function(i,o){a-i.registeredAt>=n&&(r.finalize(i.value),r.registrations.delete(o))}),r.registrations.size>0&&r.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){r.sweep(0)}})}return Object.defineProperty(t.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r,n){this.registrations.set(n,{value:r,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(t.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.registrations.delete(e)}}),Object.defineProperty(t.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.sweepTimeout===void 0&&(this.sweepTimeout=setTimeout(this.sweep,xf))}}),t}(),vf=typeof FinalizationRegistry<"u"?FinalizationRegistry:bf,Tn=new vf(function(t){var e;(e=t.reaction)===null||e===void 0||e.dispose(),t.reaction=null}),tc={exports:{}},rc={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Or=y;function yf(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var wf=typeof Object.is=="function"?Object.is:yf,jf=Or.useState,Nf=Or.useEffect,_f=Or.useLayoutEffect,Sf=Or.useDebugValue;function Cf(t,e){var r=e(),n=jf({inst:{value:r,getSnapshot:e}}),a=n[0].inst,i=n[1];return _f(function(){a.value=r,a.getSnapshot=e,cn(a)&&i({inst:a})},[t,r,e]),Nf(function(){return cn(a)&&i({inst:a}),t(function(){cn(a)&&i({inst:a})})},[t]),Sf(r),r}function cn(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!wf(t,r)}catch{return!0}}function Pf(t,e){return e()}var kf=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Pf:Cf;rc.useSyncExternalStore=Or.useSyncExternalStore!==void 0?Or.useSyncExternalStore:kf;tc.exports=rc;var Of=tc.exports;function ei(t){t.reaction=new Tt("observer".concat(t.name),function(){var e;t.stateVersion=Symbol(),(e=t.onStoreChange)===null||e===void 0||e.call(t)})}function Af(t,e){e===void 0&&(e="observed");var r=ws.useRef(null);if(!r.current){var n={reaction:null,onStoreChange:null,stateVersion:Symbol(),name:e,subscribe:function(c){return Tn.unregister(n),n.onStoreChange=c,n.reaction||(ei(n),n.stateVersion=Symbol()),function(){var l;n.onStoreChange=null,(l=n.reaction)===null||l===void 0||l.dispose(),n.reaction=null}},getSnapshot:function(){return n.stateVersion}};r.current=n}var a=r.current;a.reaction||(ei(a),Tn.register(r,a,a)),ws.useDebugValue(a.reaction,gf),Of.useSyncExternalStore(a.subscribe,a.getSnapshot,a.getSnapshot);var i,o;if(a.reaction.track(function(){try{i=t()}catch(c){o=c}}),o)throw o;return i}var ln,dn,sc=typeof Symbol=="function"&&Symbol.for,Ef=(dn=(ln=Object.getOwnPropertyDescriptor(function(){},"name"))===null||ln===void 0?void 0:ln.configurable)!==null&&dn!==void 0?dn:!1,ti=sc?Symbol.for("react.forward_ref"):typeof y.forwardRef=="function"&&y.forwardRef(function(t){return null}).$$typeof,ri=sc?Symbol.for("react.memo"):typeof y.memo=="function"&&y.memo(function(t){return null}).$$typeof;function Mf(t,e){var r;if(ri&&t.$$typeof===ri)throw new Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");var n=(r=void 0)!==null&&r!==void 0?r:!1,a=t,i=t.displayName||t.name;if(ti&&t.$$typeof===ti&&(n=!0,a=t.render,typeof a!="function"))throw new Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var o=function(c,l){return Af(function(){return a(c,l)},i)};return o.displayName=t.displayName,Ef&&Object.defineProperty(o,"name",{value:t.name,writable:!0,configurable:!0}),t.contextTypes&&(o.contextTypes=t.contextTypes),n&&(o=y.forwardRef(o)),o=y.memo(o),Rf(t,o),o}var Tf={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};function Rf(t,e){Object.keys(t).forEach(function(r){Tf[r]||Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}var un;ff($i.unstable_batchedUpdates);un=Tn.finalizeAllImmediately;const If={default:"border-gray-200 hover:border-gray-300",blue:"border-blue-200 hover:border-blue-300",green:"border-emerald-200 hover:border-emerald-300",amber:"border-amber-200 hover:border-amber-300",purple:"border-purple-200 hover:border-purple-300",rose:"border-rose-200 hover:border-rose-300",teal:"border-teal-200 hover:border-teal-300",indigo:"border-indigo-200 hover:border-indigo-300"};function O({children:t,className:e,isSelected:r,onClick:n,variant:a="default"}){return s.jsx("div",{className:Fe("rounded-lg transition-all duration-200 h-full",r?"border-2 border-blue-500 shadow-sm ring-2 ring-blue-100 bg-blue-50":`border ${If[a]} shadow-sm hover:shadow bg-white`,n&&"cursor-pointer",e),onClick:n,children:t})}O.Header=function({children:e,className:r}){return s.jsx("div",{className:Fe("p-4 border-b border-gray-100",r),children:e})};O.Content=function({children:e,className:r}){return s.jsx("div",{className:Fe("p-4",r),children:e})};O.Footer=function({children:e,className:r}){return s.jsx("div",{className:Fe("px-4 py-3 border-t bg-gray-50 rounded-b-lg",r),children:e})};O.Title=function({children:e,className:r}){return s.jsx("h3",{className:Fe("text-base font-semibold text-gray-900 line-clamp-2",r),children:e})};O.Grid=function({children:e,className:r}){return s.jsx("div",{className:Fe("grid grid-cols-2 gap-2 text-sm text-gray-600",r),children:e})};const hn=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");var _i,Kr,Si;let Ff=(_i=hn,Si=class{constructor(e){B(this,_i);yt(this,Kr);dt(this,Kr,e),this[hn]=!0}static is(e){return typeof e=="object"&&e!==null&&e[hn]===!0}unwrap(){return be(this,Kr).call(this)}},Kr=new WeakMap,Si);function Rt(t,e){return Reflect.getMetadata(e,t)}function si(t,e,r,n){const a=n(Rt(t,e)??r);Reflect.defineMetadata(e,a,t)}const Gs="named",ta="name",ra="unmanaged",sa="optional",na="inject",aa="multi_inject",nc="post_construct",ac="pre_destroy",Uf=[na,aa,ta,ra,Gs,sa],mn=Symbol.for("@inversifyjs/core/InversifyCoreError");var Ci,Pi;let dr=class ic extends(Pi=Error,Ci=mn,Pi){constructor(r,n,a){super(n,a);B(this,Ci);B(this,"kind");this[mn]=!0,this.kind=r}static is(r){return typeof r=="object"&&r!==null&&r[mn]===!0}static isErrorOfKind(r,n){return ic.is(r)&&r.kind===n}};var It,qe;function oc(t,e){const r=[];for(let n=0;n<e.length;++n)e[n]===void 0&&r.push(n);if(r.length>0)throw new dr(It.missingInjectionDecorator,`Found unexpected missing metadata on type "${t.name}" at constructor indexes "${r.join('", "')}".

Are you using @inject, @multiInject or @unmanaged decorators at those indexes?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}function cc(t){return{kind:qe.singleInjection,name:void 0,optional:!1,tags:new Map,targetName:void 0,value:t}}function Ys(t){const e=t.find(o=>o.key===na),r=t.find(o=>o.key===aa);if(t.find(o=>o.key===ra)!==void 0)return function(o,c){if(c!==void 0||o!==void 0)throw new dr(It.missingInjectionDecorator,"Expected a single @inject, @multiInject or @unmanaged metadata");return{kind:qe.unmanaged}}(e,r);if(r===void 0&&e===void 0)throw new dr(It.missingInjectionDecorator,"Expected @inject, @multiInject or @unmanaged metadata");const n=t.find(o=>o.key===Gs),a=t.find(o=>o.key===sa),i=t.find(o=>o.key===ta);return{kind:e===void 0?qe.multipleInjection:qe.singleInjection,name:n==null?void 0:n.value,optional:a!==void 0,tags:new Map(t.filter(o=>Uf.every(c=>o.key!==c)).map(o=>[o.key,o.value])),targetName:i==null?void 0:i.value,value:e===void 0?r==null?void 0:r.value:e.value}}function lc(t,e,r){try{return Ys(r)}catch(n){throw dr.isErrorOfKind(n,It.missingInjectionDecorator)?new dr(It.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${t.name}" at constructor arguments at index "${e.toString()}"`,{cause:n}):n}}function $f(t){const e=Rt(t,"design:paramtypes"),r=Rt(t,"inversify:tagged"),n=[];if(r!==void 0)for(const[a,i]of Object.entries(r)){const o=parseInt(a);n[o]=lc(t,o,i)}if(e!==void 0){for(let a=0;a<e.length;++a)if(n[a]===void 0){const i=e[a];n[a]=cc(i)}}return oc(t,n),n}function dc(t,e,r){try{return Ys(r)}catch(n){throw dr.isErrorOfKind(n,It.missingInjectionDecorator)?new dr(It.missingInjectionDecorator,`Expected a single @inject, @multiInject or @unmanaged decorator at type "${t.name}" at property "${e.toString()}"`,{cause:n}):n}}function uc(t){const e=Rt(t,"inversify:tagged_props"),r=new Map;if(e!==void 0)for(const n of Reflect.ownKeys(e)){const a=e[n];r.set(n,dc(t,n,a))}return r}function Df(t){const e=Rt(t,nc),r=Rt(t,ac);return{constructorArguments:$f(t),lifecycle:{postConstructMethodName:e==null?void 0:e.value,preDestroyMethodName:r==null?void 0:r.value},properties:uc(t)}}function Lf(t,e){const r=e.getConstructorMetadata(t),n=[];for(const[a,i]of Object.entries(r.userGeneratedMetadata)){const o=parseInt(a);n[o]=lc(t,o,i)}if(r.compilerGeneratedMetadata!==void 0){for(let a=0;a<r.compilerGeneratedMetadata.length;++a)if(n[a]===void 0){const i=r.compilerGeneratedMetadata[a];n[a]=cc(i)}}return oc(t,n),n}function hc(t,e){const r=e.getPropertiesMetadata(t),n=new Map;for(const a of Reflect.ownKeys(r)){const i=r[a];n.set(a,dc(t,a,i))}return n}function Bf(t,e){const r=Rt(t,nc),n=Rt(t,ac);return{constructorArguments:Lf(t,e),lifecycle:{postConstructMethodName:r==null?void 0:r.value,preDestroyMethodName:n==null?void 0:n.value},properties:hc(t,e)}}function ni(t){const e=Object.getPrototypeOf(t.prototype);return e==null?void 0:e.constructor}function Vf(t){return t.kind===qe.unmanaged?[{key:ra,value:!0}]:function(e){const r=[zf(e)];e.name!==void 0&&r.push({key:Gs,value:e.name}),e.optional&&r.push({key:sa,value:!0});for(const[n,a]of e.tags)r.push({key:n,value:a});return e.targetName!==void 0&&r.push({key:ta,value:e.targetName}),r}(t)}function zf(t){let e;switch(t.kind){case qe.multipleInjection:e={key:aa,value:t.value};break;case qe.singleInjection:e={key:na,value:t.value}}return e}(function(t){t[t.injectionDecoratorConflict=0]="injectionDecoratorConflict",t[t.missingInjectionDecorator=1]="missingInjectionDecorator",t[t.planning=2]="planning",t[t.unknown=3]="unknown"})(It||(It={})),function(t){t[t.multipleInjection=0]="multipleInjection",t[t.singleInjection=1]="singleInjection",t[t.unmanaged=2]="unmanaged"}(qe||(qe={}));var _t,ki;let qf=(ki=class{constructor(e){yt(this,_t);dt(this,_t,e)}startsWith(e){return be(this,_t).startsWith(e)}endsWith(e){return be(this,_t).endsWith(e)}contains(e){return be(this,_t).includes(e)}equals(e){return be(this,_t)===e}value(){return be(this,_t)}},_t=new WeakMap,ki);const fn="@inversifyjs/core/targetId";var Re,Qr,Xr,tr,Jr,Zr;class Ms{constructor(e,r,n){yt(this,Re);yt(this,Qr);yt(this,Xr);yt(this,tr);yt(this,Jr);yt(this,Zr);dt(this,Qr,function(){const a=Rt(Object,fn)??0;return a===Number.MAX_SAFE_INTEGER?si(Object,fn,a,()=>Number.MIN_SAFE_INTEGER):si(Object,fn,a,i=>i+1),a}()),dt(this,Xr,e),dt(this,tr,void 0),dt(this,Re,r),dt(this,Jr,new qf(typeof e=="string"?e:e.toString().slice(7,-1))),dt(this,Zr,n)}get id(){return be(this,Qr)}get identifier(){return be(this,Xr)}get metadata(){return be(this,tr)===void 0&&dt(this,tr,Vf(be(this,Re))),be(this,tr)}get name(){return be(this,Jr)}get type(){return be(this,Zr)}get serviceIdentifier(){return Ff.is(be(this,Re).value)?be(this,Re).value.unwrap():be(this,Re).value}getCustomTags(){return[...be(this,Re).tags.entries()].map(([e,r])=>({key:e,value:r}))}getNamedTag(){return be(this,Re).name===void 0?null:{key:Gs,value:be(this,Re).name}}hasTag(e){return this.metadata.some(r=>r.key===e)}isArray(){return be(this,Re).kind===qe.multipleInjection}isNamed(){return be(this,Re).name!==void 0}isOptional(){return be(this,Re).optional}isTagged(){return be(this,Re).tags.size>0}matchesArray(e){return this.isArray()&&be(this,Re).value===e}matchesNamedTag(e){return be(this,Re).name===e}matchesTag(e){return r=>this.metadata.some(n=>n.key===e&&n.value===r)}}Re=new WeakMap,Qr=new WeakMap,Xr=new WeakMap,tr=new WeakMap,Jr=new WeakMap,Zr=new WeakMap;const mc=t=>function(e,r){return function(n){const a=e(n);let i=ni(n);for(;i!==void 0&&i!==Object;){const c=r(i);for(const[l,d]of c)a.properties.has(l)||a.properties.set(l,d);i=ni(i)}const o=[];for(const c of a.constructorArguments)if(c.kind!==qe.unmanaged){const l=c.targetName??"";o.push(new Ms(l,c,"ConstructorArgument"))}for(const[c,l]of a.properties)if(l.kind!==qe.unmanaged){const d=l.targetName??c;o.push(new Ms(d,l,"ClassProperty"))}return o}}(t===void 0?Df:e=>Bf(e,t),t===void 0?uc:e=>hc(e,t)),rt="named",Hf="unmanaged",Wf="optional",Gf="inject",Yf="multi_inject",Kf="inversify:tagged",Qf="inversify:tagged_props",Xf="design:paramtypes",ai="post_construct",Rn="pre_destroy",Oe={Request:"Request",Singleton:"Singleton",Transient:"Transient"},ve={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},fc={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};let Jf=0;function Ks(){return Jf++}class ia{constructor(e,r){B(this,"id");B(this,"moduleId");B(this,"activated");B(this,"serviceIdentifier");B(this,"implementationType");B(this,"cache");B(this,"dynamicValue");B(this,"scope");B(this,"type");B(this,"factory");B(this,"provider");B(this,"constraint");B(this,"onActivation");B(this,"onDeactivation");this.id=Ks(),this.activated=!1,this.serviceIdentifier=e,this.scope=r,this.type=ve.Invalid,this.constraint=n=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}clone(){const e=new ia(this.serviceIdentifier,this.scope);return e.activated=e.scope===Oe.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e}}const ii="NULL argument",oi="Key Not Found",Zf="Ambiguous match found for serviceIdentifier:",eg="No matching bindings found for serviceIdentifier:",In=(t,e)=>`onDeactivation() error in class ${t}: ${e}`;class tg{getConstructorMetadata(e){return{compilerGeneratedMetadata:Reflect.getMetadata(Xf,e)??[],userGeneratedMetadata:Reflect.getMetadata(Kf,e)??{}}}getPropertiesMetadata(e){return Reflect.getMetadata(Qf,e)??{}}}var _r;function gc(t){return t instanceof RangeError||t.message==="Maximum call stack size exceeded"}(function(t){t[t.MultipleBindingsAvailable=2]="MultipleBindingsAvailable",t[t.NoBindingsAvailable=0]="NoBindingsAvailable",t[t.OnlyOneBindingAvailable=1]="OnlyOneBindingAvailable"})(_r||(_r={}));function qt(t){return typeof t=="function"?t.name:typeof t=="symbol"?t.toString():t}function ci(t,e,r){let n="";const a=r(t,e);return a.length!==0&&(n=`
Registered bindings:`,a.forEach(i=>{let o="Object";i.implementationType!==null&&(o=bc(i.implementationType)),n=`${n}
 ${o}`,i.constraint.metaData&&(n=`${n} - ${i.constraint.metaData}`)})),n}function pc(t,e){return t.parentRequest!==null&&(t.parentRequest.serviceIdentifier===e||pc(t.parentRequest,e))}function xc(t){t.childRequests.forEach(e=>{if(pc(t,e.serviceIdentifier)){const r=function(n){return function i(o,c=[]){const l=qt(o.serviceIdentifier);return c.push(l),o.parentRequest!==null?i(o.parentRequest,c):c}(n).reverse().join(" --> ")}(e);throw new Error(`Circular dependency found: ${r}`)}xc(e)})}function bc(t){if(t.name!=null&&t.name!=="")return t.name;{const e=t.toString(),r=e.match(/^function\s*([^\s(]+)/);return r===null?`Anonymous function: ${e}`:r[1]}}function li(t){return`{"key":"${t.key.toString()}","value":"${t.value.toString()}"}`}class vc{constructor(e){B(this,"id");B(this,"container");B(this,"plan");B(this,"currentRequest");this.id=Ks(),this.container=e}addPlan(e){this.plan=e}setCurrentRequest(e){this.currentRequest=e}}class bs{constructor(e,r){B(this,"key");B(this,"value");this.key=e,this.value=r}toString(){return this.key===rt?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}class rg{constructor(e,r){B(this,"parentContext");B(this,"rootRequest");this.parentContext=e,this.rootRequest=r}}function yc(t,e){const r=function(c){const l=Object.getPrototypeOf(c.prototype);return l==null?void 0:l.constructor}(e);if(r===void 0||r===Object)return 0;const n=mc(t)(r),a=n.map(c=>c.metadata.filter(l=>l.key===Hf)),i=[].concat.apply([],a).length,o=n.length-i;return o>0?o:yc(t,r)}class os{constructor(e,r,n,a,i){B(this,"id");B(this,"serviceIdentifier");B(this,"parentContext");B(this,"parentRequest");B(this,"bindings");B(this,"childRequests");B(this,"target");B(this,"requestScope");this.id=Ks(),this.serviceIdentifier=e,this.parentContext=r,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(a)?a:[a],this.requestScope=n===null?new Map:null}addChildRequest(e,r,n){const a=new os(e,this.parentContext,this,r,n);return this.childRequests.push(a),a}}function Ts(t){return t._bindingDictionary}function di(t,e,r,n,a){let i=$r(r.container,a.serviceIdentifier),o=[];return i.length===_r.NoBindingsAvailable&&r.container.options.autoBindInjectable===!0&&typeof a.serviceIdentifier=="function"&&t.getConstructorMetadata(a.serviceIdentifier).compilerGeneratedMetadata&&(r.container.bind(a.serviceIdentifier).toSelf(),i=$r(r.container,a.serviceIdentifier)),o=e?i:i.filter(c=>{const l=new os(c.serviceIdentifier,r,n,c,a);return c.constraint(l)}),function(c,l,d,u,m){switch(l.length){case _r.NoBindingsAvailable:if(u.isOptional())return l;{const b=qt(c);let x=eg;throw x+=function(p,f){if(f.isTagged()||f.isNamed()){let h="";const g=f.getNamedTag(),w=f.getCustomTags();return g!==null&&(h+=li(g)+`
`),w!==null&&w.forEach(v=>{h+=li(v)+`
`}),` ${p}
 ${p} - ${h}`}return` ${p}`}(b,u),x+=ci(m,b,$r),d!==null&&(x+=`
Trying to resolve bindings for "${qt(d.serviceIdentifier)}"`),new Error(x)}case _r.OnlyOneBindingAvailable:return l;case _r.MultipleBindingsAvailable:default:if(u.isArray())return l;{const b=qt(c);let x=`${Zf} ${b}`;throw x+=ci(m,b,$r),new Error(x)}}}(a.serviceIdentifier,o,n,a,r.container),o}function wc(t,e){const r=e.isMultiInject?Yf:Gf,n=[new bs(r,t)];return e.customTag!==void 0&&n.push(new bs(e.customTag.key,e.customTag.value)),e.isOptional===!0&&n.push(new bs(Wf,!0)),n}function jc(t,e,r,n,a,i){let o,c;if(a===null){o=di(t,e,n,null,i),c=new os(r,n,null,o,i);const l=new rg(n,c);n.addPlan(l)}else o=di(t,e,n,a,i),c=a.addChildRequest(i.serviceIdentifier,o,i);o.forEach(l=>{let d=null;if(i.isArray())d=c.addChildRequest(l.serviceIdentifier,l,i);else{if(l.cache!==null)return;d=c}if(l.type===ve.Instance&&l.implementationType!==null){const u=function(m,b){return mc(m)(b)}(t,l.implementationType);if(n.container.options.skipBaseClassChecks!==!0){const m=yc(t,l.implementationType);if(u.length<m){const b=`The number of constructor arguments in the derived class ${bc(l.implementationType)} must be >= than the number of constructor arguments of its base class.`;throw new Error(b)}}u.forEach(m=>{jc(t,!1,m.serviceIdentifier,n,d,m)})}})}function $r(t,e){let r=[];const n=Ts(t);return n.hasKey(e)?r=n.get(e):t.parent!==null&&(r=$r(t.parent,e)),r}function sg(t,e,r,n,a,i=!1){const o=new vc(e),c=function(l,d,u){const m=wc(d,u),b=Ys(m);if(b.kind===qe.unmanaged)throw new Error("Unexpected metadata when creating target");return new Ms("",b,l)}(r,n,a);try{return jc(t,i,n,o,null,c),o}catch(l){throw gc(l)&&xc(o.plan.rootRequest),l}}function Le(t){return(typeof t=="object"&&t!==null||typeof t=="function")&&typeof t.then=="function"}function Nc(t){return!!Le(t)||Array.isArray(t)&&t.some(Le)}const ng=(t,e,r)=>{t.has(e.id)||t.set(e.id,r)},ag=(t,e)=>{t.cache=e,t.activated=!0,Le(e)&&ig(t,e)},ig=async(t,e)=>{try{const r=await e;t.cache=r}catch(r){throw t.cache=null,t.activated=!1,r}};var Vr;(function(t){t.DynamicValue="toDynamicValue",t.Factory="toFactory",t.Provider="toProvider"})(Vr||(Vr={}));function og(t,e,r){let n;if(e.length>0){const a=function(o,c){return o.reduce((l,d)=>{const u=c(d);return d.target.type===fc.ConstructorArgument?l.constructorInjections.push(u):(l.propertyRequests.push(d),l.propertyInjections.push(u)),l.isAsync||(l.isAsync=Nc(u)),l},{constructorInjections:[],isAsync:!1,propertyInjections:[],propertyRequests:[]})}(e,r),i={...a,constr:t};n=a.isAsync?async function(o){const c=await hi(o.constructorInjections),l=await hi(o.propertyInjections);return ui({...o,constructorInjections:c,propertyInjections:l})}(i):ui(i)}else n=new t;return n}function ui(t){const e=new t.constr(...t.constructorInjections);return t.propertyRequests.forEach((r,n)=>{const a=r.target.identifier,i=t.propertyInjections[n];r.target.isOptional()&&i===void 0||(e[a]=i)}),e}async function hi(t){const e=[];for(const r of t)Array.isArray(r)?e.push(Promise.all(r)):e.push(r);return Promise.all(e)}function mi(t,e){const r=function(n,a){var c;if(Reflect.hasMetadata(ai,n)){const l=Reflect.getMetadata(ai,n);try{return(c=a[l.value])==null?void 0:c.call(a)}catch(d){if(d instanceof Error)throw new Error((i=n.name,o=d.message,`@postConstruct error in class ${i}: ${o}`))}}var i,o}(t,e);return Le(r)?r.then(()=>e):e}function cg(t,e){t.scope!==Oe.Singleton&&function(r,n){const a=`Class cannot be instantiated in ${r.scope===Oe.Request?"request":"transient"} scope.`;if(typeof r.onDeactivation=="function")throw new Error(In(n.name,a));if(Reflect.hasMetadata(Rn,n))throw new Error(`@preDestroy error in class ${n.name}: ${a}`)}(t,e)}const oa=t=>e=>{e.parentContext.setCurrentRequest(e);const r=e.bindings,n=e.childRequests,a=e.target&&e.target.isArray(),i=!(e.parentRequest&&e.parentRequest.target&&e.target&&e.parentRequest.target.matchesArray(e.target.serviceIdentifier));if(a&&i)return n.map(o=>oa(t)(o));{if(e.target.isOptional()&&r.length===0)return;const o=r[0];return hg(t,e,o)}},lg=(t,e)=>{const r=(n=>{switch(n.type){case ve.Factory:return{factory:n.factory,factoryType:Vr.Factory};case ve.Provider:return{factory:n.provider,factoryType:Vr.Provider};case ve.DynamicValue:return{factory:n.dynamicValue,factoryType:Vr.DynamicValue};default:throw new Error(`Unexpected factory type ${n.type}`)}})(t);return((n,a)=>{try{return n()}catch(i){throw gc(i)?a():i}})(()=>r.factory.bind(t)(e),()=>{return new Error((n=r.factoryType,a=e.currentRequest.serviceIdentifier.toString(),`It looks like there is a circular dependency in one of the '${n}' bindings. Please investigate bindings with service identifier '${a}'.`));var n,a})},dg=(t,e,r)=>{let n;const a=e.childRequests;switch((i=>{let o=null;switch(i.type){case ve.ConstantValue:case ve.Function:o=i.cache;break;case ve.Constructor:case ve.Instance:o=i.implementationType;break;case ve.DynamicValue:o=i.dynamicValue;break;case ve.Provider:o=i.provider;break;case ve.Factory:o=i.factory}if(o===null){const c=qt(i.serviceIdentifier);throw new Error(`Invalid binding type: ${c}`)}})(r),r.type){case ve.ConstantValue:case ve.Function:n=r.cache;break;case ve.Constructor:n=r.implementationType;break;case ve.Instance:n=function(i,o,c,l){cg(i,o);const d=og(o,c,l);return Le(d)?d.then(u=>mi(o,u)):mi(o,d)}(r,r.implementationType,a,oa(t));break;default:n=lg(r,e.parentContext)}return n},ug=(t,e,r)=>{let n=((a,i)=>i.scope===Oe.Singleton&&i.activated?i.cache:i.scope===Oe.Request&&a.has(i.id)?a.get(i.id):null)(t,e);return n!==null||(n=r(),((a,i,o)=>{i.scope===Oe.Singleton&&ag(i,o),i.scope===Oe.Request&&ng(a,i,o)})(t,e,n)),n},hg=(t,e,r)=>ug(t,r,()=>{let n=dg(t,e,r);return n=Le(n)?n.then(a=>fi(e,r,a)):fi(e,r,n),n});function fi(t,e,r){let n=mg(t.parentContext,e,r);const a=pg(t.parentContext.container);let i,o=a.next();do{i=o.value;const c=t.parentContext,l=t.serviceIdentifier,d=gg(i,l);n=Le(n)?_c(d,c,n):fg(d,c,n),o=a.next()}while(o.done!==!0&&!Ts(i).hasKey(t.serviceIdentifier));return n}const mg=(t,e,r)=>{let n;return n=typeof e.onActivation=="function"?e.onActivation(t,r):r,n},fg=(t,e,r)=>{let n=t.next();for(;n.done!==!0;){if(Le(r=n.value(e,r)))return _c(t,e,r);n=t.next()}return r},_c=async(t,e,r)=>{let n=await r,a=t.next();for(;a.done!==!0;)n=await a.value(e,n),a=t.next();return n},gg=(t,e)=>{const r=t._activations;return r.hasKey(e)?r.get(e).values():[].values()},pg=t=>{const e=[t];let r=t.parent;for(;r!==null;)e.push(r),r=r.parent;return{next:()=>{const n=e.pop();return n!==void 0?{done:!1,value:n}:{done:!0,value:void 0}}}},jt=(t,e)=>{const r=t.parentRequest;return r!==null&&(!!e(r)||jt(r,e))},Dr=t=>e=>{const r=n=>n!==null&&n.target!==null&&n.target.matchesTag(t)(e);return r.metaData=new bs(t,e),r},ms=Dr(rt),gn=t=>e=>{let r=null;if(e!==null){if(r=e.bindings[0],typeof t=="string")return r.serviceIdentifier===t;{const n=e.bindings[0].implementationType;return t===n}}return!1};class Rs{constructor(e){B(this,"_binding");this._binding=e}when(e){return this._binding.constraint=e,new Te(this._binding)}whenTargetNamed(e){return this._binding.constraint=ms(e),new Te(this._binding)}whenTargetIsDefault(){return this._binding.constraint=e=>e===null?!1:e.target!==null&&!e.target.isNamed()&&!e.target.isTagged(),new Te(this._binding)}whenTargetTagged(e,r){return this._binding.constraint=Dr(e)(r),new Te(this._binding)}whenInjectedInto(e){return this._binding.constraint=r=>r!==null&&gn(e)(r.parentRequest),new Te(this._binding)}whenParentNamed(e){return this._binding.constraint=r=>r!==null&&ms(e)(r.parentRequest),new Te(this._binding)}whenParentTagged(e,r){return this._binding.constraint=n=>n!==null&&Dr(e)(r)(n.parentRequest),new Te(this._binding)}whenAnyAncestorIs(e){return this._binding.constraint=r=>r!==null&&jt(r,gn(e)),new Te(this._binding)}whenNoAncestorIs(e){return this._binding.constraint=r=>r!==null&&!jt(r,gn(e)),new Te(this._binding)}whenAnyAncestorNamed(e){return this._binding.constraint=r=>r!==null&&jt(r,ms(e)),new Te(this._binding)}whenNoAncestorNamed(e){return this._binding.constraint=r=>r!==null&&!jt(r,ms(e)),new Te(this._binding)}whenAnyAncestorTagged(e,r){return this._binding.constraint=n=>n!==null&&jt(n,Dr(e)(r)),new Te(this._binding)}whenNoAncestorTagged(e,r){return this._binding.constraint=n=>n!==null&&!jt(n,Dr(e)(r)),new Te(this._binding)}whenAnyAncestorMatches(e){return this._binding.constraint=r=>r!==null&&jt(r,e),new Te(this._binding)}whenNoAncestorMatches(e){return this._binding.constraint=r=>r!==null&&!jt(r,e),new Te(this._binding)}}class Te{constructor(e){B(this,"_binding");this._binding=e}onActivation(e){return this._binding.onActivation=e,new Rs(this._binding)}onDeactivation(e){return this._binding.onDeactivation=e,new Rs(this._binding)}}class Nt{constructor(e){B(this,"_bindingWhenSyntax");B(this,"_bindingOnSyntax");B(this,"_binding");this._binding=e,this._bindingWhenSyntax=new Rs(this._binding),this._bindingOnSyntax=new Te(this._binding)}when(e){return this._bindingWhenSyntax.when(e)}whenTargetNamed(e){return this._bindingWhenSyntax.whenTargetNamed(e)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(e,r){return this._bindingWhenSyntax.whenTargetTagged(e,r)}whenInjectedInto(e){return this._bindingWhenSyntax.whenInjectedInto(e)}whenParentNamed(e){return this._bindingWhenSyntax.whenParentNamed(e)}whenParentTagged(e,r){return this._bindingWhenSyntax.whenParentTagged(e,r)}whenAnyAncestorIs(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)}whenNoAncestorIs(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)}whenAnyAncestorNamed(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)}whenAnyAncestorTagged(e,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,r)}whenNoAncestorNamed(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)}whenNoAncestorTagged(e,r){return this._bindingWhenSyntax.whenNoAncestorTagged(e,r)}whenAnyAncestorMatches(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)}whenNoAncestorMatches(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)}onActivation(e){return this._bindingOnSyntax.onActivation(e)}onDeactivation(e){return this._bindingOnSyntax.onDeactivation(e)}}class xg{constructor(e){B(this,"_binding");this._binding=e}inRequestScope(){return this._binding.scope=Oe.Request,new Nt(this._binding)}inSingletonScope(){return this._binding.scope=Oe.Singleton,new Nt(this._binding)}inTransientScope(){return this._binding.scope=Oe.Transient,new Nt(this._binding)}}class gi{constructor(e){B(this,"_bindingInSyntax");B(this,"_bindingWhenSyntax");B(this,"_bindingOnSyntax");B(this,"_binding");this._binding=e,this._bindingWhenSyntax=new Rs(this._binding),this._bindingOnSyntax=new Te(this._binding),this._bindingInSyntax=new xg(e)}inRequestScope(){return this._bindingInSyntax.inRequestScope()}inSingletonScope(){return this._bindingInSyntax.inSingletonScope()}inTransientScope(){return this._bindingInSyntax.inTransientScope()}when(e){return this._bindingWhenSyntax.when(e)}whenTargetNamed(e){return this._bindingWhenSyntax.whenTargetNamed(e)}whenTargetIsDefault(){return this._bindingWhenSyntax.whenTargetIsDefault()}whenTargetTagged(e,r){return this._bindingWhenSyntax.whenTargetTagged(e,r)}whenInjectedInto(e){return this._bindingWhenSyntax.whenInjectedInto(e)}whenParentNamed(e){return this._bindingWhenSyntax.whenParentNamed(e)}whenParentTagged(e,r){return this._bindingWhenSyntax.whenParentTagged(e,r)}whenAnyAncestorIs(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)}whenNoAncestorIs(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)}whenAnyAncestorNamed(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)}whenAnyAncestorTagged(e,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,r)}whenNoAncestorNamed(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)}whenNoAncestorTagged(e,r){return this._bindingWhenSyntax.whenNoAncestorTagged(e,r)}whenAnyAncestorMatches(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)}whenNoAncestorMatches(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)}onActivation(e){return this._bindingOnSyntax.onActivation(e)}onDeactivation(e){return this._bindingOnSyntax.onDeactivation(e)}}class bg{constructor(e){B(this,"_binding");this._binding=e}to(e){return this._binding.type=ve.Instance,this._binding.implementationType=e,new gi(this._binding)}toSelf(){if(typeof this._binding.serviceIdentifier!="function")throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");const e=this._binding.serviceIdentifier;return this.to(e)}toConstantValue(e){return this._binding.type=ve.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Oe.Singleton,new Nt(this._binding)}toDynamicValue(e){return this._binding.type=ve.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new gi(this._binding)}toConstructor(e){return this._binding.type=ve.Constructor,this._binding.implementationType=e,this._binding.scope=Oe.Singleton,new Nt(this._binding)}toFactory(e){return this._binding.type=ve.Factory,this._binding.factory=e,this._binding.scope=Oe.Singleton,new Nt(this._binding)}toFunction(e){if(typeof e!="function")throw new Error("Value provided to function binding must be a function!");const r=this.toConstantValue(e);return this._binding.type=ve.Function,this._binding.scope=Oe.Singleton,r}toAutoFactory(e){return this._binding.type=ve.Factory,this._binding.factory=r=>()=>r.container.get(e),this._binding.scope=Oe.Singleton,new Nt(this._binding)}toAutoNamedFactory(e){return this._binding.type=ve.Factory,this._binding.factory=r=>n=>r.container.getNamed(e,n),new Nt(this._binding)}toProvider(e){return this._binding.type=ve.Provider,this._binding.provider=e,this._binding.scope=Oe.Singleton,new Nt(this._binding)}toService(e){this._binding.type=ve.DynamicValue,Object.defineProperty(this._binding,"cache",{configurable:!0,enumerable:!0,get:()=>null,set(r){}}),this._binding.dynamicValue=r=>{try{return r.container.get(e)}catch{return r.container.getAsync(e)}},this._binding.implementationType=null}}class ca{constructor(){B(this,"bindings");B(this,"activations");B(this,"deactivations");B(this,"middleware");B(this,"moduleActivationStore")}static of(e,r,n,a,i){const o=new ca;return o.bindings=e,o.middleware=r,o.deactivations=a,o.activations=n,o.moduleActivationStore=i,o}}class Pt{constructor(){B(this,"_map");this._map=new Map}getMap(){return this._map}add(e,r){if(this._checkNonNulish(e),r==null)throw new Error(ii);const n=this._map.get(e);n!==void 0?n.push(r):this._map.set(e,[r])}get(e){this._checkNonNulish(e);const r=this._map.get(e);if(r!==void 0)return r;throw new Error(oi)}remove(e){if(this._checkNonNulish(e),!this._map.delete(e))throw new Error(oi)}removeIntersection(e){this.traverse((r,n)=>{const a=e.hasKey(r)?e.get(r):void 0;if(a!==void 0){const i=n.filter(o=>!a.some(c=>o===c));this._setValue(r,i)}})}removeByCondition(e){const r=[];return this._map.forEach((n,a)=>{const i=[];for(const o of n)e(o)?r.push(o):i.push(o);this._setValue(a,i)}),r}hasKey(e){return this._checkNonNulish(e),this._map.has(e)}clone(){const e=new Pt;return this._map.forEach((r,n)=>{r.forEach(a=>{var i;e.add(n,typeof(i=a)=="object"&&i!==null&&"clone"in i&&typeof i.clone=="function"?a.clone():a)})}),e}traverse(e){this._map.forEach((r,n)=>{e(n,r)})}_checkNonNulish(e){if(e==null)throw new Error(ii)}_setValue(e,r){r.length>0?this._map.set(e,r):this._map.delete(e)}}class la{constructor(){B(this,"_map",new Map)}remove(e){const r=this._map.get(e);return r===void 0?this._getEmptyHandlersStore():(this._map.delete(e),r)}addDeactivation(e,r,n){this._getModuleActivationHandlers(e).onDeactivations.add(r,n)}addActivation(e,r,n){this._getModuleActivationHandlers(e).onActivations.add(r,n)}clone(){const e=new la;return this._map.forEach((r,n)=>{e._map.set(n,{onActivations:r.onActivations.clone(),onDeactivations:r.onDeactivations.clone()})}),e}_getModuleActivationHandlers(e){let r=this._map.get(e);return r===void 0&&(r=this._getEmptyHandlersStore(),this._map.set(e,r)),r}_getEmptyHandlersStore(){return{onActivations:new Pt,onDeactivations:new Pt}}}class Is{constructor(e){B(this,"id");B(this,"parent");B(this,"options");B(this,"_middleware");B(this,"_bindingDictionary");B(this,"_activations");B(this,"_deactivations");B(this,"_snapshots");B(this,"_metadataReader");B(this,"_moduleActivationStore");const r=e||{};if(typeof r!="object")throw new Error("Invalid Container constructor argument. Container options must be an object.");if(r.defaultScope===void 0)r.defaultScope=Oe.Transient;else if(r.defaultScope!==Oe.Singleton&&r.defaultScope!==Oe.Transient&&r.defaultScope!==Oe.Request)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(r.autoBindInjectable===void 0)r.autoBindInjectable=!1;else if(typeof r.autoBindInjectable!="boolean")throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(r.skipBaseClassChecks===void 0)r.skipBaseClassChecks=!1;else if(typeof r.skipBaseClassChecks!="boolean")throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:r.autoBindInjectable,defaultScope:r.defaultScope,skipBaseClassChecks:r.skipBaseClassChecks},this.id=Ks(),this._bindingDictionary=new Pt,this._snapshots=[],this._middleware=null,this._activations=new Pt,this._deactivations=new Pt,this.parent=null,this._metadataReader=new tg,this._moduleActivationStore=new la}static merge(e,r,...n){const a=new Is,i=[e,r,...n].map(c=>Ts(c)),o=Ts(a);return i.forEach(c=>{var l;l=o,c.traverse((d,u)=>{u.forEach(m=>{l.add(m.serviceIdentifier,m.clone())})})}),a}load(...e){const r=this._getContainerModuleHelpersFactory();for(const n of e){const a=r(n.id);n.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}}async loadAsync(...e){const r=this._getContainerModuleHelpersFactory();for(const n of e){const a=r(n.id);await n.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}}unload(...e){e.forEach(r=>{const n=this._removeModuleBindings(r.id);this._deactivateSingletons(n),this._removeModuleHandlers(r.id)})}async unloadAsync(...e){for(const r of e){const n=this._removeModuleBindings(r.id);await this._deactivateSingletonsAsync(n),this._removeModuleHandlers(r.id)}}bind(e){return this._bind(this._buildBinding(e))}rebind(e){return this.unbind(e),this.bind(e)}async rebindAsync(e){return await this.unbindAsync(e),this.bind(e)}unbind(e){if(this._bindingDictionary.hasKey(e)){const r=this._bindingDictionary.get(e);this._deactivateSingletons(r)}this._removeServiceFromDictionary(e)}async unbindAsync(e){if(this._bindingDictionary.hasKey(e)){const r=this._bindingDictionary.get(e);await this._deactivateSingletonsAsync(r)}this._removeServiceFromDictionary(e)}unbindAll(){this._bindingDictionary.traverse((e,r)=>{this._deactivateSingletons(r)}),this._bindingDictionary=new Pt}async unbindAllAsync(){const e=[];this._bindingDictionary.traverse((r,n)=>{e.push(this._deactivateSingletonsAsync(n))}),await Promise.all(e),this._bindingDictionary=new Pt}onActivation(e,r){this._activations.add(e,r)}onDeactivation(e,r){this._deactivations.add(e,r)}isBound(e){let r=this._bindingDictionary.hasKey(e);return!r&&this.parent&&(r=this.parent.isBound(e)),r}isCurrentBound(e){return this._bindingDictionary.hasKey(e)}isBoundNamed(e,r){return this.isBoundTagged(e,rt,r)}isBoundTagged(e,r,n){let a=!1;if(this._bindingDictionary.hasKey(e)){const i=this._bindingDictionary.get(e),o=function(c,l,d){const u=wc(l,d),m=Ys(u);if(m.kind===qe.unmanaged)throw new Error("Unexpected metadata when creating target");const b=new Ms("",m,"Variable"),x=new vc(c);return new os(l,x,null,[],b)}(this,e,{customTag:{key:r,value:n},isMultiInject:!1});a=i.some(c=>c.constraint(o))}return!a&&this.parent&&(a=this.parent.isBoundTagged(e,r,n)),a}snapshot(){this._snapshots.push(ca.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))}restore(){const e=this._snapshots.pop();if(e===void 0)throw new Error("No snapshot available to restore.");this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore}createChild(e){const r=new Is(e||this.options);return r.parent=this,r}applyMiddleware(...e){const r=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((n,a)=>a(n),r)}applyCustomMetadataReader(e){this._metadataReader=e}get(e){const r=this._getNotAllArgs(e,!1,!1);return this._getButThrowIfAsync(r)}async getAsync(e){const r=this._getNotAllArgs(e,!1,!1);return this._get(r)}getTagged(e,r,n){const a=this._getNotAllArgs(e,!1,!1,r,n);return this._getButThrowIfAsync(a)}async getTaggedAsync(e,r,n){const a=this._getNotAllArgs(e,!1,!1,r,n);return this._get(a)}getNamed(e,r){return this.getTagged(e,rt,r)}async getNamedAsync(e,r){return this.getTaggedAsync(e,rt,r)}getAll(e,r){const n=this._getAllArgs(e,r,!1);return this._getButThrowIfAsync(n)}async getAllAsync(e,r){const n=this._getAllArgs(e,r,!1);return this._getAll(n)}getAllTagged(e,r,n){const a=this._getNotAllArgs(e,!0,!1,r,n);return this._getButThrowIfAsync(a)}async getAllTaggedAsync(e,r,n){const a=this._getNotAllArgs(e,!0,!1,r,n);return this._getAll(a)}getAllNamed(e,r){return this.getAllTagged(e,rt,r)}async getAllNamedAsync(e,r){return this.getAllTaggedAsync(e,rt,r)}resolve(e){const r=this.isBound(e);r||this.bind(e).toSelf();const n=this.get(e);return r||this.unbind(e),n}tryGet(e){const r=this._getNotAllArgs(e,!1,!0);return this._getButThrowIfAsync(r)}async tryGetAsync(e){const r=this._getNotAllArgs(e,!1,!0);return this._get(r)}tryGetTagged(e,r,n){const a=this._getNotAllArgs(e,!1,!0,r,n);return this._getButThrowIfAsync(a)}async tryGetTaggedAsync(e,r,n){const a=this._getNotAllArgs(e,!1,!0,r,n);return this._get(a)}tryGetNamed(e,r){return this.tryGetTagged(e,rt,r)}async tryGetNamedAsync(e,r){return this.tryGetTaggedAsync(e,rt,r)}tryGetAll(e,r){const n=this._getAllArgs(e,r,!0);return this._getButThrowIfAsync(n)}async tryGetAllAsync(e,r){const n=this._getAllArgs(e,r,!0);return this._getAll(n)}tryGetAllTagged(e,r,n){const a=this._getNotAllArgs(e,!0,!0,r,n);return this._getButThrowIfAsync(a)}async tryGetAllTaggedAsync(e,r,n){const a=this._getNotAllArgs(e,!0,!0,r,n);return this._getAll(a)}tryGetAllNamed(e,r){return this.tryGetAllTagged(e,rt,r)}async tryGetAllNamedAsync(e,r){return this.tryGetAllTaggedAsync(e,rt,r)}_preDestroy(e,r){var n;if(e!==void 0&&Reflect.hasMetadata(Rn,e)){const a=Reflect.getMetadata(Rn,e);return(n=r[a.value])==null?void 0:n.call(r)}}_removeModuleHandlers(e){const r=this._moduleActivationStore.remove(e);this._activations.removeIntersection(r.onActivations),this._deactivations.removeIntersection(r.onDeactivations)}_removeModuleBindings(e){return this._bindingDictionary.removeByCondition(r=>r.moduleId===e)}_deactivate(e,r){const n=r==null?void 0:Object.getPrototypeOf(r).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){const i=this._deactivateContainer(r,this._deactivations.get(e.serviceIdentifier).values());if(Le(i))return this._handleDeactivationError(i.then(async()=>this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,r,n)),e.serviceIdentifier)}const a=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,r,n);if(Le(a))return this._handleDeactivationError(a,e.serviceIdentifier)}catch(a){if(a instanceof Error)throw new Error(In(qt(e.serviceIdentifier),a.message))}}async _handleDeactivationError(e,r){try{await e}catch(n){if(n instanceof Error)throw new Error(In(qt(r),n.message))}}_deactivateContainer(e,r){let n=r.next();for(;typeof n.value=="function";){const a=n.value(e);if(Le(a))return a.then(async()=>this._deactivateContainerAsync(e,r));n=r.next()}}async _deactivateContainerAsync(e,r){let n=r.next();for(;typeof n.value=="function";)await n.value(e),n=r.next()}_getContainerModuleHelpersFactory(){const e=l=>d=>{const u=this._buildBinding(d);return u.moduleId=l,this._bind(u)},r=()=>l=>{this.unbind(l)},n=()=>async l=>this.unbindAsync(l),a=()=>l=>this.isBound(l),i=l=>{const d=e(l);return u=>(this.unbind(u),d(u))},o=l=>(d,u)=>{this._moduleActivationStore.addActivation(l,d,u),this.onActivation(d,u)},c=l=>(d,u)=>{this._moduleActivationStore.addDeactivation(l,d,u),this.onDeactivation(d,u)};return l=>({bindFunction:e(l),isboundFunction:a(),onActivationFunction:o(l),onDeactivationFunction:c(l),rebindFunction:i(l),unbindAsyncFunction:n(),unbindFunction:r()})}_bind(e){return this._bindingDictionary.add(e.serviceIdentifier,e),new bg(e)}_buildBinding(e){const r=this.options.defaultScope||Oe.Transient;return new ia(e,r)}async _getAll(e){return Promise.all(this._get(e))}_get(e){const r={...e,contextInterceptor:n=>n,targetType:fc.Variable};if(this._middleware){const n=this._middleware(r);if(n==null)throw new Error("Invalid return type in middleware. Middleware must return!");return n}return this._planAndResolve()(r)}_getButThrowIfAsync(e){const r=this._get(e);if(Nc(r))throw new Error(`You are attempting to construct ${function(n){return typeof n=="function"?`[function/class ${n.name||"<anonymous>"}]`:typeof n=="symbol"?n.toString():`'${n}'`}(e.serviceIdentifier)} in a synchronous way but it has asynchronous dependencies.`);return r}_getAllArgs(e,r,n){return{avoidConstraints:!(r!=null&&r.enforceBindingConstraints),isMultiInject:!0,isOptional:n,serviceIdentifier:e}}_getNotAllArgs(e,r,n,a,i){return{avoidConstraints:!1,isMultiInject:r,isOptional:n,key:a,serviceIdentifier:e,value:i}}_getPlanMetadataFromNextArgs(e){const r={isMultiInject:e.isMultiInject};return e.key!==void 0&&(r.customTag={key:e.key,value:e.value}),e.isOptional===!0&&(r.isOptional=!0),r}_planAndResolve(){return e=>{let r=sg(this._metadataReader,this,e.targetType,e.serviceIdentifier,this._getPlanMetadataFromNextArgs(e),e.avoidConstraints);return r=e.contextInterceptor(r),function(a){return oa(a.plan.rootRequest.requestScope)(a.plan.rootRequest)}(r)}}_deactivateIfSingleton(e){if(e.activated)return Le(e.cache)?e.cache.then(r=>this._deactivate(e,r)):this._deactivate(e,e.cache)}_deactivateSingletons(e){for(const r of e)if(Le(this._deactivateIfSingleton(r)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}async _deactivateSingletonsAsync(e){await Promise.all(e.map(async r=>this._deactivateIfSingleton(r)))}_propagateContainerDeactivationThenBindingAndPreDestroy(e,r,n){return this.parent?this._deactivate.bind(this.parent)(e,r):this._bindingDeactivationAndPreDestroy(e,r,n)}async _propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,r,n){this.parent?await this._deactivate.bind(this.parent)(e,r):await this._bindingDeactivationAndPreDestroyAsync(e,r,n)}_removeServiceFromDictionary(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(`Could not unbind serviceIdentifier: ${qt(e)}`)}}_bindingDeactivationAndPreDestroy(e,r,n){if(typeof e.onDeactivation=="function"){const a=e.onDeactivation(r);if(Le(a))return a.then(()=>this._preDestroy(n,r))}return this._preDestroy(n,r)}async _bindingDeactivationAndPreDestroyAsync(e,r,n){typeof e.onDeactivation=="function"&&await e.onDeactivation(r),await this._preDestroy(n,r)}}const Be={Logger:Symbol.for("Logger"),OrderRepository:Symbol.for("OrderRepository"),ProductRepository:Symbol.for("ProductRepository"),ProviderRepository:Symbol.for("ProviderRepository"),AnalyticsService:Symbol.for("AnalyticsService"),DashboardViewModel:Symbol.for("DashboardViewModel")};class vg{formatMessage(e,r,...n){const a=new Date().toISOString(),i=n.map(o=>o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:JSON.stringify(o)).join(" ");return`[${a}] [${e}] ${r} ${i}`.trim()}debug(e,...r){}info(e,...r){console.info(this.formatMessage("INFO",e,...r))}warn(e,...r){console.warn(this.formatMessage("WARN",e,...r))}error(e,r,...n){console.error(this.formatMessage("ERROR",e,r,...n))}}class yg extends Error{constructor(e,r){super(e,r),this.name=this.constructor.name,Error.captureStackTrace(this,this.constructor)}}let ce=class extends yg{constructor(e,r){super(e,r),this.name="DatabaseError"}};class wg{constructor(){this.COLLECTION="orders"}checkAuth(){if(!_e.currentUser)throw new ce("User not authenticated")}async getAll(){try{this.checkAuth();const e=q(H,this.COLLECTION),r=await Me(e);return r.exists()?Object.entries(r.val()).map(([n,a])=>({id:n,...a})):[]}catch(e){throw e instanceof ce?e:new ce("Failed to fetch orders",{cause:e})}}async getById(e){try{this.checkAuth();const r=q(H,`${this.COLLECTION}/${e}`),n=await Me(r);return n.exists()?{id:e,...n.val()}:null}catch(r){throw r instanceof ce?r:new ce("Failed to fetch order",{cause:r})}}async getByProvider(e){try{this.checkAuth();const r=q(H,this.COLLECTION),n=sr(r,nr("providerId"),ar(e)),a=await Me(n);return a.exists()?Object.entries(a.val()).map(([i,o])=>({id:i,...o})).sort((i,o)=>o.date-i.date):[]}catch(r){throw r instanceof ce?r:new ce("Failed to fetch provider orders",{cause:r})}}async create(e){try{this.checkAuth();const r=q(H,this.COLLECTION),n=ct(r);if(!n.key)throw new ce("Failed to generate order ID");return await Ye(n,e),n.key}catch(r){throw r instanceof ce?r:new ce("Failed to create order",{cause:r})}}async update(e,r){try{this.checkAuth();const n=q(H,`${this.COLLECTION}/${e}`);await Ye(n,r)}catch(n){throw n instanceof ce?n:new ce("Failed to update order",{cause:n})}}async delete(e){try{this.checkAuth();const r=q(H,`${this.COLLECTION}/${e}`);await ur(r)}catch(r){throw r instanceof ce?r:new ce("Failed to delete order",{cause:r})}}subscribeToProviderOrders(e,r){try{this.checkAuth();const n=q(H,this.COLLECTION),a=sr(n,nr("providerId"),ar(e));return Ke(a,o=>{if(!o.exists()){r([]);return}const c=Object.entries(o.val()).map(([l,d])=>({id:l,...d})).sort((l,d)=>d.date-l.date);r(c)})}catch(n){throw n instanceof ce?n:new ce("Failed to subscribe to provider orders",{cause:n})}}}function pi(t){var e,r,n;return(e=t.name)!=null&&e.trim()?(r=t.sku)!=null&&r.trim()?(n=t.purchasePackaging)!=null&&n.trim()?t.providerId?typeof t.minPackageStock!="number"||isNaN(t.minPackageStock)?{field:"minPackageStock",message:"El stock mínimo debe ser un número válido"}:typeof t.desiredStock!="number"||isNaN(t.desiredStock)?{field:"desiredStock",message:"El stock deseado debe ser un número válido"}:t.minPackageStock<0?{field:"minPackageStock",message:"El stock mínimo no puede ser negativo"}:t.desiredStock<0?{field:"desiredStock",message:"El stock deseado no puede ser negativo"}:t.minPackageStock>t.desiredStock?{field:"minPackageStock",message:"El stock mínimo no puede ser mayor al stock deseado"}:typeof t.price!="number"||isNaN(t.price)?{field:"price",message:"El precio debe ser un número válido"}:t.price<0?{field:"price",message:"El precio no puede ser negativo"}:typeof t.order!="number"||isNaN(t.order)?{field:"order",message:"El orden debe ser un número válido"}:null:{field:"providerId",message:"El proveedor es requerido"}:{field:"purchasePackaging",message:"El empaque de compra es requerido"}:{field:"sku",message:"El SKU es requerido"}:{field:"name",message:"El nombre es requerido"}}class jg{constructor(){this.COLLECTION="products"}checkAuth(){if(!_e.currentUser)throw new ce("User not authenticated")}async getAll(){try{this.checkAuth();const e=q(H,this.COLLECTION),r=await Me(e);return r.exists()?Object.entries(r.val()).map(([n,a])=>({id:n,...a})):[]}catch(e){throw new ce("Failed to fetch products",{cause:e})}}async getById(e){try{this.checkAuth();const r=q(H,`${this.COLLECTION}/${e}`),n=await Me(r);return n.exists()?{id:e,...n.val()}:null}catch(r){throw new ce("Failed to fetch product",{cause:r})}}async getByProvider(e){try{this.checkAuth();const r=q(H,this.COLLECTION),n=sr(r,nr("providerId"),ar(e)),a=await Me(n);return a.exists()?Object.entries(a.val()).map(([i,o])=>({id:i,...o})).sort((i,o)=>i.order-o.order):[]}catch(r){throw new ce("Failed to fetch provider products",{cause:r})}}async create(e){var r,n,a;try{this.checkAuth();const i=pi(e);if(i)throw new ce(i.message);const o=q(H,this.COLLECTION),c=ct(o);if(!c.key)throw new ce("Failed to generate product ID");const l={name:e.name.trim().toUpperCase(),sku:e.sku.trim().toUpperCase(),supplierCode:((r=e.supplierCode)==null?void 0:r.trim().toUpperCase())||"",purchasePackaging:e.purchasePackaging.trim().toUpperCase(),salePackaging:((n=e.salePackaging)==null?void 0:n.trim().toUpperCase())||"",price:Number(e.price)||0,minPackageStock:Number(e.minPackageStock)||0,desiredStock:Number(e.desiredStock)||0,order:Number(e.order)||0,providerId:e.providerId,tags:Array.isArray(e.tags)?e.tags:[],isProduction:!!e.isProduction};return e.isProduction&&(l.unitMeasure=((a=e.unitMeasure)==null?void 0:a.trim().toUpperCase())||"UNIDAD",l.pricePerUnit=Number(e.pricePerUnit)||0),await Ye(c,l),c.key}catch(i){throw new ce("Failed to create product",{cause:i})}}async update(e,r){var n,a,i,o,c,l;try{this.checkAuth();const d=q(H,`${this.COLLECTION}/${e}`),u=await Me(d);if(!u.exists())throw new ce("Product not found");const m=u.val(),b={...m,...r,name:((n=r.name)==null?void 0:n.trim().toUpperCase())??m.name,sku:((a=r.sku)==null?void 0:a.trim().toUpperCase())??m.sku,supplierCode:((i=r.supplierCode)==null?void 0:i.trim().toUpperCase())??m.supplierCode??"",purchasePackaging:((o=r.purchasePackaging)==null?void 0:o.trim().toUpperCase())??m.purchasePackaging,salePackaging:((c=r.salePackaging)==null?void 0:c.trim().toUpperCase())??m.salePackaging??"",price:typeof r.price=="number"?Number(r.price):m.price,minPackageStock:typeof r.minPackageStock=="number"?Number(r.minPackageStock):m.minPackageStock,desiredStock:typeof r.desiredStock=="number"?Number(r.desiredStock):m.desiredStock,order:typeof r.order=="number"?Number(r.order):m.order,tags:r.tags??m.tags??[],isProduction:typeof r.isProduction=="boolean"?r.isProduction:m.isProduction};b.isProduction?(b.unitMeasure=((l=r.unitMeasure)==null?void 0:l.trim().toUpperCase())??m.unitMeasure??"UNIDAD",b.pricePerUnit=typeof r.pricePerUnit=="number"?Number(r.pricePerUnit):m.pricePerUnit??0):(delete b.unitMeasure,delete b.pricePerUnit);const x=pi(b);if(x)throw new ce(x.message);await Ye(d,b)}catch(d){throw new ce("Failed to update product",{cause:d})}}async delete(e){try{this.checkAuth();const r=q(H,`${this.COLLECTION}/${e}`);await ur(r)}catch(r){throw new ce("Failed to delete product",{cause:r})}}subscribeToProviderProducts(e,r){try{this.checkAuth();const n=q(H,this.COLLECTION),a=sr(n,nr("providerId"),ar(e));return Ke(a,o=>{if(!o.exists()){r([]);return}const c=Object.entries(o.val()).map(([l,d])=>({id:l,...d})).sort((l,d)=>l.order-d.order);r(c)})}catch(n){throw new ce("Failed to subscribe to provider products",{cause:n})}}}class Ng{constructor(){this.COLLECTION="providers"}async getAll(){try{const e=q(H,this.COLLECTION),r=await Me(e);return r.exists()?Object.entries(r.val()).map(([n,a])=>({id:n,...a})):[]}catch(e){throw new ce("Failed to fetch providers",{cause:e})}}async getById(e){try{const r=q(H,`${this.COLLECTION}/${e}`),n=await Me(r);return n.exists()?{id:e,...n.val()}:null}catch(r){throw new ce("Failed to fetch provider",{cause:r})}}async create(e){try{const r=q(H,this.COLLECTION),n=ct(r);if(!n.key)throw new ce("Failed to generate provider ID");return await Ye(n,e),n.key}catch(r){throw new ce("Failed to create provider",{cause:r})}}async update(e,r){try{const n=q(H,`${this.COLLECTION}/${e}`);await Ye(n,r)}catch(n){throw new ce("Failed to update provider",{cause:n})}}async delete(e){try{const r=q(H,`${this.COLLECTION}/${e}`);await ur(r)}catch(r){throw new ce("Failed to delete provider",{cause:r})}}subscribeToProviders(e){const r=q(H,this.COLLECTION);return Ke(r,a=>{if(!a.exists()){e([]);return}const i=Object.entries(a.val()).map(([o,c])=>({id:o,...c}));e(i)})}}class _g{constructor(e,r,n,a){this.orderRepository=e,this.productRepository=r,this.providerRepository=n,this.logger=a}calculateOrderStats(e){const r=e.length,n=e.reduce((a,i)=>a+i.total,0);return{total:r,totalAmount:n,averageAmount:r>0?n/r:0,byStatus:{pending:e.filter(a=>a.status==="pending").length,completed:e.filter(a=>a.status==="completed").length}}}calculateProductStats(e,r){const n=new Map;for(const a of e)for(const i of a.items){const o=r.get(i.productId);if(!o)continue;const c=n.get(i.productId)||{name:o.name,totalQuantity:0,totalAmount:0,orderCount:0,lastOrderDate:null};c.totalQuantity+=i.quantity,c.totalAmount+=i.subtotal,c.orderCount++,c.lastOrderDate=Math.max(a.date,c.lastOrderDate||0),n.set(i.productId,c)}return Array.from(n.entries()).map(([a,i])=>({id:a,name:i.name,totalQuantity:i.totalQuantity,totalAmount:i.totalAmount,orderCount:i.orderCount,averageQuantityPerOrder:i.totalQuantity/i.orderCount,lastOrderDate:i.lastOrderDate})).sort((a,i)=>i.totalAmount-a.totalAmount)}calculateProviderStats(e,r){const n=new Map;for(const a of e){if(!r.get(a.providerId))continue;const o=n.get(a.providerId)||{totalOrders:0,totalAmount:0,lastOrderDate:null};o.totalOrders++,o.totalAmount+=a.total,o.lastOrderDate=Math.max(a.date,o.lastOrderDate||0),n.set(a.providerId,o)}return Array.from(n.entries()).map(([a,i])=>{const o=r.get(a);return{id:a,name:o.commercialName,totalOrders:i.totalOrders,totalAmount:i.totalAmount,averageOrderAmount:i.totalAmount/i.totalOrders,lastOrderDate:i.lastOrderDate}}).sort((a,i)=>i.totalAmount-a.totalAmount)}async getDashboardStats(){try{this.logger.debug("Fetching dashboard stats");const[e,r,n]=await Promise.all([this.orderRepository.getAll(),this.productRepository.getAll(),this.providerRepository.getAll()]),a=new Map(r.map(f=>[f.id,f])),i=new Map(n.map(f=>[f.id,f])),o=new Date,c=st(o),l=nd(o),d=Ki(o),u=Yi(o),m=e.filter(f=>{const h=new Date(f.date);return h>=qr(o)&&h<=ed(o)}),b=e.filter(f=>{const h=new Date(f.date);return h>=c&&h<=l}),x=e.filter(f=>{const h=new Date(f.date);return h>=d&&h<=u}),p={orders:{today:this.calculateOrderStats(m),week:this.calculateOrderStats(b),month:this.calculateOrderStats(x)},topProducts:this.calculateProductStats(e,a).slice(0,10),topProviders:this.calculateProviderStats(e,i).slice(0,5),totals:{products:r.length,providers:n.length,orders:e.length}};return this.logger.debug("Dashboard stats calculated successfully",{todayOrders:p.orders.today.total,weekOrders:p.orders.week.total,monthOrders:p.orders.month.total,topProducts:p.topProducts.length,topProviders:p.topProviders.length}),p}catch(e){throw this.logger.error("Error calculating dashboard stats",e),e}}}class Sg{constructor(e,r){this.analyticsService=e,this.logger=r,this.stats={orders:{today:{total:0,totalAmount:0,averageAmount:0,byStatus:{pending:0,completed:0}},week:{total:0,totalAmount:0,averageAmount:0,byStatus:{pending:0,completed:0}},month:{total:0,totalAmount:0,averageAmount:0,byStatus:{pending:0,completed:0}}},topProducts:[],topProductsByTags:[],totals:{products:0,providers:0,orders:0}},this.loading=!0,this.error=null,this.lastUpdate=null,Km(this),this.loadStats()}async loadStats(){try{this.loading=!0,this.error=null,this.logger.info("Loading dashboard stats");const e=await this.analyticsService.getDashboardStats();sn(()=>{this.stats={orders:e.orders||this.stats.orders,topProducts:e.topProducts||[],topProductsByTags:e.topProductsByTags||[],totals:e.totals||this.stats.totals},this.lastUpdate=Date.now()}),this.logger.debug("Dashboard stats loaded successfully",{todayOrders:e.orders.today.total,weekOrders:e.orders.week.total,monthOrders:e.orders.month.total})}catch(e){sn(()=>{this.error="Error al cargar las estadísticas"}),this.logger.error("Failed to load dashboard stats",e),A.error(this.error)}finally{sn(()=>{this.loading=!1})}}get todayOrdersCount(){return this.stats.orders.today.total}get todayOrdersAmount(){return this.stats.orders.today.totalAmount}get weekOrdersCount(){return this.stats.orders.week.total}get weekOrdersAmount(){return this.stats.orders.week.totalAmount}get monthOrdersCount(){return this.stats.orders.month.total}get monthOrdersAmount(){return this.stats.orders.month.totalAmount}get pendingOrdersCount(){return this.stats.orders.today.byStatus.pending}get completedOrdersCount(){return this.stats.orders.today.byStatus.completed}get totalProducts(){return this.stats.totals.products}get totalProviders(){return this.stats.totals.providers}get totalOrders(){return this.stats.totals.orders}get topProducts(){return this.stats.topProducts||[]}get topProductsByTags(){return this.stats.topProductsByTags||[]}get currentDayName(){const e=fe(new Date,"EEEE",{locale:ye});return{lunes:"monday",martes:"tuesday",miércoles:"wednesday",jueves:"thursday",viernes:"friday",sábado:"saturday",domingo:"sunday"}[e]}get formattedLastUpdate(){return this.lastUpdate?fe(this.lastUpdate,"d 'de' MMMM, yyyy HH:mm",{locale:ye}):null}get isStale(){return this.lastUpdate?Date.now()-this.lastUpdate>5*60*1e3:!0}}const Jt=new Is;Jt.bind(Be.Logger).to(vg).inSingletonScope();Jt.bind(Be.OrderRepository).to(wg).inSingletonScope();Jt.bind(Be.ProductRepository).to(jg).inSingletonScope();Jt.bind(Be.ProviderRepository).to(Ng).inSingletonScope();Jt.bind(Be.AnalyticsService).toDynamicValue(t=>{const e=t.container.get(Be.OrderRepository),r=t.container.get(Be.ProductRepository),n=t.container.get(Be.ProviderRepository),a=t.container.get(Be.Logger);return new _g(e,r,n,a)}).inSingletonScope();Jt.bind(Be.DashboardViewModel).toDynamicValue(t=>{const e=t.container.get(Be.AnalyticsService),r=t.container.get(Be.Logger);return new Sg(e,r)}).inSingletonScope();function Cg(){return Jt.get(Be.DashboardViewModel)}function Ue({isOpen:t,onClose:e,title:r,children:n,className:a}){return t?s.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:s.jsxs("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25",onClick:e}),s.jsxs("div",{className:Fe("relative transform overflow-hidden rounded-lg bg-white p-6 text-left shadow-xl transition-all w-full max-w-md",a),children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:r}),s.jsx("button",{onClick:e,className:"rounded-full p-1 hover:bg-gray-100",children:s.jsx(Ve,{className:"w-5 h-5"})})]}),n]})]})}):null}function Pg({isOpen:t,onClose:e,products:r=[]}){const[n,a]=y.useState(null),i=y.useMemo(()=>{const l=new Set;return r.forEach(d=>{d.tags&&d.tags.forEach(u=>l.add(u))}),Array.from(l).sort()},[r]),o=y.useMemo(()=>n?r.filter(l=>{var d;return(d=l.tags)==null?void 0:d.includes(n)}):r,[r,n]),c=y.useMemo(()=>({amount:o.reduce((l,d)=>l+d.totalAmount,0),quantity:o.reduce((l,d)=>l+d.totalQuantity,0),orders:o.reduce((l,d)=>l+d.orderCount,0),average:o.length>0?o.reduce((l,d)=>l+d.totalAmount,0)/o.reduce((l,d)=>l+d.orderCount,0):0}),[o]);return s.jsx(Ue,{isOpen:t,onClose:e,title:"Top 10 Productos Más Comprados",className:"max-w-4xl",children:s.jsxs("div",{className:"space-y-6",children:[i.length>0&&s.jsxs("div",{className:"flex flex-wrap gap-2 p-4 bg-gray-50 rounded-lg border border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-2 pr-4 border-r border-gray-200",children:[s.jsx(sl,{className:"w-4 h-4 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrar por etiqueta:"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx(E,{variant:n===null?"primary":"outline",size:"sm",onClick:()=>a(null),className:"h-8",children:"Todas"}),i.map(l=>s.jsx(E,{variant:n===l?"primary":"outline",size:"sm",onClick:()=>a(l===n?null:l),className:"h-8",children:l},l))]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(Wt,{className:"w-4 h-4 text-blue-600"})}),s.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Total Compras"})]}),s.jsx("div",{className:"text-lg font-bold text-blue-700",children:Q(c.amount)})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-100",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(ze,{className:"w-4 h-4 text-green-600"})}),s.jsx("h4",{className:"text-sm font-medium text-green-900",children:"Total Unidades"})]}),s.jsx("div",{className:"text-lg font-bold text-green-700",children:c.quantity})]}),s.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-100",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:s.jsx(He,{className:"w-4 h-4 text-indigo-600"})}),s.jsx("h4",{className:"text-sm font-medium text-indigo-900",children:"Total Órdenes"})]}),s.jsx("div",{className:"text-lg font-bold text-indigo-700",children:c.orders})]}),s.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-100",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:s.jsx(Kt,{className:"w-4 h-4 text-amber-600"})}),s.jsx("h4",{className:"text-sm font-medium text-amber-900",children:"Promedio por Orden"})]}),s.jsx("div",{className:"text-lg font-bold text-amber-700",children:Q(c.average)})]})]}),s.jsxs("div",{className:"space-y-4",children:[o.map((l,d)=>s.jsxs("div",{className:`
                relative overflow-hidden bg-white rounded-lg border transition-all duration-200
                ${d===0?"shadow-md ring-2 ring-blue-100 border-blue-200":"border-gray-200 hover:border-gray-300"}
              `,children:[d<3&&s.jsxs("div",{className:`
                  absolute top-0 left-0 w-16 h-16 flex items-center justify-center
                  ${d===0?"bg-blue-500":d===1?"bg-indigo-500":"bg-violet-500"}
                  text-white font-bold text-2xl -rotate-45 transform -translate-x-6 -translate-y-6
                `,children:["#",d+1]}),s.jsx("div",{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"ml-8",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:l.name}),l.tags&&l.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:l.tags.map(u=>s.jsx("span",{className:`
                                inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                                ${u===n?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}
                              `,children:u},u))})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Q(l.totalAmount)}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Total Compras"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(ze,{className:"w-4 h-4 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Unidades Compradas"})]}),s.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:[l.totalQuantity," ",l.purchasePackaging]})]}),s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(He,{className:"w-4 h-4 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Órdenes"})]}),s.jsx("div",{className:"text-lg font-semibold text-gray-900",children:l.orderCount})]}),s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(Wt,{className:"w-4 h-4 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Promedio por Orden"})]}),s.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:[(l.totalQuantity/l.orderCount).toFixed(1)," ",l.purchasePackaging]})]})]}),l.lastOrderDate&&s.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Última compra: ",fe(l.lastOrderDate,"d 'de' MMMM, yyyy",{locale:ye})]})]})})]},l.id)),o.length===0&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:n?`No hay productos con la etiqueta "${n}"`:"No hay datos disponibles"})]})]})})}function kg({isOpen:t,onClose:e,tagStats:r=[]}){return s.jsx(Ue,{isOpen:t,onClose:e,title:"Top 10 Productos por Etiquetas",className:"max-w-4xl",children:s.jsxs("div",{className:"space-y-6",children:[r.map((n,a)=>s.jsxs("div",{className:`
              relative overflow-hidden bg-white rounded-lg border transition-all duration-200
              ${a===0?"shadow-md ring-2 ring-blue-100 border-blue-200":"border-gray-200"}
            `,children:[a<3&&s.jsxs("div",{className:`
                absolute top-0 left-0 w-16 h-16 flex items-center justify-center
                ${a===0?"bg-blue-500":a===1?"bg-indigo-500":"bg-violet-500"}
                text-white font-bold text-2xl -rotate-45 transform -translate-x-6 -translate-y-6
              `,children:["#",a+1]}),s.jsx("div",{className:"p-4 sm:p-6",children:s.jsxs("div",{className:"ml-8",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:n.tag}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[n.products.length," productos"]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Q(n.totalAmount)}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Total Compras"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(ze,{className:"w-4 h-4 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Unidades Compradas"})]}),s.jsx("div",{className:"text-lg font-semibold text-gray-900",children:n.totalQuantity})]}),s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(He,{className:"w-4 h-4 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Órdenes"})]}),s.jsx("div",{className:"text-lg font-semibold text-gray-900",children:n.orderCount})]}),s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(Wt,{className:"w-4 h-4 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Promedio por Orden"})]}),s.jsx("div",{className:"text-lg font-semibold text-gray-900",children:Q(n.totalAmount/n.orderCount)})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Top Productos"}),n.products.slice(0,5).map((i,o)=>s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"font-medium text-gray-900 truncate",children:i.name}),s.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[i.totalQuantity," ",i.purchasePackaging," • ",i.orderCount," órdenes"]})]}),s.jsxs("div",{className:"text-right ml-4",children:[s.jsx("div",{className:"font-medium text-blue-600",children:Q(i.totalAmount)}),i.lastOrderDate&&s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:fe(i.lastOrderDate,"d MMM, yyyy",{locale:ye})})]})]},i.id))]})]})})]},n.tag)),r.length===0&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay datos disponibles"})]})})}function Og({tagStats:t,onClick:e,loading:r}){if(r)return s.jsx(O,{children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"animate-pulse space-y-3",children:[s.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})});if(t.length===0)return null;const n=t[0];return s.jsx(O,{className:e?"cursor-pointer hover:shadow-md transition-shadow":"",onClick:e,children:s.jsx(O.Header,{className:"!p-4",children:s.jsx("div",{className:"flex items-center justify-between gap-4",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("div",{className:"p-2 bg-rose-100 rounded-lg",children:s.jsx(Oi,{className:"w-5 h-5 text-rose-600"})}),s.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Productos por Etiquetas"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-lg font-bold text-gray-900 truncate",children:n.tag}),s.jsxs("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-rose-100 text-rose-700",children:[n.products.length," productos"]})]}),s.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(ze,{className:"w-4 h-4"}),s.jsxs("span",{children:[n.totalQuantity," unidades"]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(Wt,{className:"w-4 h-4"}),s.jsxs("span",{children:[n.orderCount," órdenes"]})]})]})]}),s.jsx("div",{className:"space-y-2",children:n.products.slice(0,3).map(a=>s.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",children:a.name}),s.jsxs("div",{className:"text-xs text-gray-600",children:[a.totalQuantity," ",a.purchasePackaging]})]}),s.jsx("div",{className:"text-sm font-medium text-blue-600 whitespace-nowrap",children:Q(a.totalAmount)})]},a.id))}),s.jsx("div",{className:"pt-2 border-t",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Total Ventas"}),s.jsx("span",{className:"text-lg font-bold text-blue-600",children:Q(n.totalAmount)})]})})]})]})})})})}function Ut(){const[t,e]=y.useState([]),[r,n]=y.useState(!0);return y.useEffect(()=>{const i=q(H,"products"),o=Ke(i,c=>{if(!c.exists()){e([]),n(!1);return}const l=Object.entries(c.val()).map(([d,u])=>({id:d,...u,enabled:u.enabled??!0}));e(l),n(!1)});return()=>o()},[]),{products:t,loading:r,updateProduct:async(i,o)=>{try{const c=q(H,`products/${i}`);await Ye(c,{...o,lastUpdated:Date.now()}),A.success("Producto actualizado exitosamente")}catch(c){throw console.error("Error updating product:",c),A.error("Error al actualizar el producto"),c}}}}function pr(){const[t,e]=y.useState([]),[r,n]=y.useState(!0);return y.useEffect(()=>{const l=q(H,"providers"),d=Ke(l,u=>{const m=u.val(),b=m?Object.entries(m).map(([x,p])=>({id:x,...p})):[];e(b),n(!1)});return()=>d()},[]),{providers:t,loading:r,addProvider:async l=>{const d=q(H,"providers");await ct(d,l)},updateProvider:async(l,d)=>{const u=q(H,`providers/${l}`);await Ye(u,d)},deleteProvider:async l=>{const d=q(H,`providers/${l}`);await ur(d)},getProvider:async l=>{const d=q(H,`providers/${l}`),u=await Me(d);return u.exists()?{id:l,...u.val()}:null}}}function da(){const[t,e]=y.useState([]),[r,n]=y.useState(!0);return y.useEffect(()=>{const c=q(H,"recipes"),l=Ke(c,d=>{if(!d.exists()){e([]),n(!1);return}const u=Object.entries(d.val()).map(([m,b])=>({id:m,...b}));e(u),n(!1)});return()=>l()},[]),{recipes:t,loading:r,addRecipe:async c=>{const l=q(H,"recipes");await ct(l,{...c,lastUpdated:Date.now()})},updateRecipe:async(c,l)=>{const d=q(H,`recipes/${c}`);await Ye(d,{...l,lastUpdated:Date.now()})},deleteRecipe:async c=>{const l=q(H,`recipes/${c}`);await ur(l)}}}class oe extends Error{constructor(e,r){super(e,r),this.name="DatabaseError"}}async function xi(t,e){if(!_e.currentUser)throw new oe("User not authenticated");try{const r=q(H,`products/${t}`),n=await Me(r);if(!n.exists())throw new oe("Product not found");const a={...n.val(),enabled:n.val().enabled??!0},i={lastUpdated:Date.now()};if(typeof e.enabled=="boolean"&&(i.enabled=e.enabled),typeof e.price=="number"){const o=Number(e.price);if(Math.abs(o-a.price)>.01){i.price=o;const c=a.price>0?(o-a.price)/a.price*100:0,l={date:Date.now(),price:o,changePercentage:Number(c.toFixed(2))},d=a.priceHistory||[];i.priceHistory=[...d,l]}}if(typeof e.salePrice=="number"){const o=Number(e.salePrice);if(Math.abs(o-(a.salePrice||0))>.01){i.salePrice=o;const c=a.salePrice?(o-a.salePrice)/a.salePrice*100:0,l={date:Date.now(),price:o,changePercentage:Number(c.toFixed(2))},d=a.salePriceHistory||[];i.salePriceHistory=[...d,l]}}if(typeof e.name=="string"&&(i.name=e.name.trim().toUpperCase()),typeof e.sku=="string"&&(i.sku=e.sku.trim().toUpperCase()),typeof e.supplierCode=="string"&&(i.supplierCode=e.supplierCode.trim().toUpperCase()),typeof e.purchasePackaging=="string"&&(i.purchasePackaging=e.purchasePackaging.trim().toUpperCase()),typeof e.salePackaging=="string"&&(i.salePackaging=e.salePackaging.trim().toUpperCase()),typeof e.order=="number"&&(i.order=e.order),typeof e.minPackageStock=="number"&&(i.minPackageStock=e.minPackageStock),typeof e.desiredStock=="number"&&(i.desiredStock=e.desiredStock),Array.isArray(e.tags)&&(i.tags=e.tags),typeof e.isProduction=="boolean"&&(i.isProduction=e.isProduction),typeof e.forSale=="boolean"&&(i.forSale=e.forSale),typeof e.unitMeasure=="string"&&(i.unitMeasure=e.unitMeasure.trim().toUpperCase()),typeof e.pricePerUnit=="number"&&(i.pricePerUnit=e.pricePerUnit),typeof e.saleCostPerUnit=="number"&&(i.saleCostPerUnit=e.saleCostPerUnit),typeof e.priceThreshold=="number"&&(i.priceThreshold=e.priceThreshold),Array.isArray(e.stockAdjustments)){const o=a.stockAdjustments||[],c=e.stockAdjustments.filter(l=>!o.some(d=>d.date===l.date&&d.quantity===l.quantity));c.length>0&&(i.stockAdjustments=[...o,...c],i.lastStockCheck=Date.now())}Object.keys(i).length>0&&await Ye(r,i)}catch(r){throw console.error("Error updating product:",r),r instanceof oe?r:new oe("Failed to update product",{cause:r instanceof Error?r:new Error("Unknown error")})}}async function Ag(t,e){if(!_e.currentUser)throw new oe("User not authenticated");try{const r={};if(typeof e.salePrice=="number"&&(r.salePrice=Number(e.salePrice)),typeof e.forSale=="boolean"&&(r.forSale=e.forSale),r.lastUpdated=Date.now(),Object.keys(r).length>0){const n=q(H,`recipes/${t}`);await Ye(n,r)}}catch(r){throw console.error("Error updating recipe:",r),r instanceof oe?r:new oe("Failed to update recipe",{cause:r instanceof Error?r:new Error("Unknown error")})}}function Eg(t){if(!t.trim())return[];const e=[];let r="",n=!1;for(let a=0;a<t.length;a++){const i=t[a];i==='"'?n&&t[a+1]==='"'?(r+='"',a++):n=!n:(i===";"||i===",")&&!n?(e.push(r.trim()),r=""):r+=i}for(e.push(r.trim());e.length>0&&!e[e.length-1];)e.pop();return e}function Mg(t){const r=t.replace(/^\uFEFF/,"").replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).filter(n=>n.trim());if(r.length===0)throw new Error("El archivo está vacío");return r.map((n,a)=>{try{const i=Eg(n);if(i.length===0)throw new Error("Línea vacía");return i}catch(i){throw new Error(`Error en la línea ${a+1}: ${i instanceof Error?i.message:"Formato inválido"}`)}})}function Tg(t){const e={código:"codigo",codigo:"codigo",artículo:"nombre",articulo:"nombre",contado:"contado",fecha:"fecha",rut:"rut",nombre:"nombre",precio:"precio"};return t.map(r=>{const n=r.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e[n]||n})}function Rg(t){try{let e=t.replace(/[^\d.,]/g,"");e.includes(",")&&(e.indexOf(".")<e.indexOf(",")?e=e.replace(/\./g,"").replace(",","."):e=e.replace(",","."));const r=parseFloat(e);if(isNaN(r))throw new Error(`Valor no numérico: ${t}`);return Number(r.toFixed(2))}catch(e){throw new Error(`Error al procesar precio "${t}": ${e instanceof Error?e.message:"formato inválido"}`)}}async function Ig(t,e,r,n,a="purchase"){const i={updated:0,errors:[],details:{updatedProducts:[],notFoundProducts:[],invalidRows:[]}};try{if(!t.trim())throw new Error("El archivo está vacío");const o=Mg(t);if(o.length<2)throw new Error("No se encontraron datos para procesar");const c=Tg(o[0]),l=a==="purchase"?["fecha","rut","codigo","nombre","precio"]:["codigo","nombre","contado"],d=l.filter(m=>!c.includes(m));if(d.length>0)throw new Error(`Faltan las siguientes columnas: ${d.join(", ")}`);const u=l.map(m=>c.indexOf(m));for(const[m,b]of o.slice(1).entries())try{if(b.length<u.length){i.details.invalidRows.push({row:m+2,reason:"Número incorrecto de columnas"});continue}const x=a==="purchase"?{fecha:b[u[0]],rut:b[u[1]],codigo:b[u[2]].replace(/[°\[\]]/g,"").trim(),nombre:b[u[3]],precio:b[u[4]]}:{codigo:b[u[0]].replace(/[°\[\]]/g,"").trim(),nombre:b[u[1]],contado:b[u[2]]};try{const p=Rg(a==="purchase"?x.precio:x.contado);if(a==="purchase"){const f=e.filter(v=>v.sku===x.codigo);if(f.length===0){i.details.notFoundProducts.push({code:x.codigo,providerRut:x.rut,csvName:x.nombre||""});continue}const h=x.rut.replace(/\D/g,""),g=r.find(v=>{var _;return((_=v.rut)==null?void 0:_.replace(/\D/g,""))===h});if(!g){i.details.notFoundProducts.push({code:x.codigo,providerRut:x.rut,csvName:x.nombre||""});continue}const w=f.filter(v=>v.providerId===g.id);for(const v of w)Math.abs(v.price-p)>.01&&(await xi(v.id,{price:p}),i.updated++,i.details.updatedProducts.push({name:v.name,oldPrice:v.price,newPrice:p,csvName:x.nombre||x.codigo,type:"product"}))}else{const f=[...e.filter(h=>h.sku===x.codigo).map(h=>({type:"product",item:h})),...n.filter(h=>h.sku===x.codigo).map(h=>({type:"recipe",item:h}))];if(f.length===0){i.details.notFoundProducts.push({code:x.codigo,csvName:x.nombre||""});continue}for(const{type:h,item:g}of f){const w=g.salePrice||0;Math.abs(w-p)>.01&&(h==="product"?await xi(g.id,{salePrice:p,forSale:!0}):await Ag(g.id,{salePrice:p,forSale:!0}),i.updated++,i.details.updatedProducts.push({name:g.name,oldPrice:w,newPrice:p,csvName:x.nombre||x.codigo,type:h}))}}}catch(p){i.details.invalidRows.push({row:m+2,reason:p instanceof Error?p.message:"Error al procesar el precio"})}}catch(x){i.details.invalidRows.push({row:m+2,reason:x instanceof Error?x.message:"Error al procesar la fila"})}return i}catch(o){throw new Error(o instanceof Error?o.message:"Error procesando el archivo")}}function Fg({isOpen:t,onClose:e,result:r,importType:n}){const[a,i]=y.useState("");if(!r)return null;const o=r.updated>0,c=r.errors.length>0,l=r.details.updatedProducts.filter(m=>m.name.toLowerCase().includes(a.toLowerCase())||m.csvName.toLowerCase().includes(a.toLowerCase())),d=r.details.notFoundProducts.filter(m=>{var b;return m.code.toLowerCase().includes(a.toLowerCase())||m.csvName.toLowerCase().includes(a.toLowerCase())||((b=m.providerRut)==null?void 0:b.toLowerCase().includes(a.toLowerCase()))}),u=r.details.invalidRows.filter(m=>m.reason.toLowerCase().includes(a.toLowerCase()));return s.jsx(Ue,{isOpen:t,onClose:e,title:`Resultado de la Importación - Precios de ${n==="purchase"?"Compra":"Venta"}`,children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-lg bg-gray-50",children:[o&&!c?s.jsx(Un,{className:"w-6 h-6 text-green-500 flex-shrink-0"}):c?s.jsx(nl,{className:"w-6 h-6 text-amber-500 flex-shrink-0"}):s.jsx(Ai,{className:"w-6 h-6 text-red-500 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:"Resumen de la importación"}),s.jsxs("p",{className:"text-sm text-gray-600",children:[r.updated," ",r.updated===1?"actualización":"actualizaciones"," realizadas"]})]})]}),s.jsxs("div",{className:"relative",children:[s.jsx(se,{placeholder:"Buscar en los resultados...",value:a,onChange:m=>i(m.target.value),className:"pl-10"}),s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]}),s.jsxs("div",{className:"space-y-6 max-h-[60vh] overflow-y-auto",children:[l.length>0&&s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsxs("h4",{className:"font-medium text-green-900 mb-3",children:["Actualizaciones (",l.length,")"]}),s.jsx("div",{className:"space-y-3",children:l.map((m,b)=>s.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium text-green-700",children:m.name}),s.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-600",children:m.type==="product"?"Producto":"Receta"})]}),s.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Nombre en CSV: ",m.csvName]}),s.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Precio anterior: ",Q(m.oldPrice)," → Nuevo precio: ",Q(m.newPrice)]})]},b))})]}),d.length>0&&s.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[s.jsxs("h4",{className:"font-medium text-amber-900 mb-3",children:["No encontrados (",d.length,")"]}),s.jsx("div",{className:"space-y-3",children:d.map((m,b)=>s.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[s.jsxs("div",{className:"font-medium text-amber-700",children:["Código: ",m.code]}),s.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Nombre en CSV: ",m.csvName]}),m.providerRut&&s.jsxs("div",{className:"text-sm text-gray-600",children:["RUT Proveedor: ",m.providerRut]})]},b))})]}),u.length>0&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[s.jsxs("h4",{className:"font-medium text-red-900 mb-3",children:["Filas con errores (",u.length,")"]}),s.jsx("div",{className:"space-y-3",children:u.map((m,b)=>s.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[s.jsxs("div",{className:"font-medium text-red-700",children:["Fila ",m.row]}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:m.reason})]},b))})]}),a&&l.length===0&&d.length===0&&u.length===0&&s.jsxs("div",{className:"text-center py-8 text-gray-500",children:['No se encontraron resultados para "',a,'"']})]}),s.jsx("div",{className:"flex justify-end",children:s.jsx(E,{onClick:e,children:"Cerrar"})})]})})}function Ug(){const t=y.useRef(null),[e,r]=y.useState(!1),[n,a]=y.useState(null),[i,o]=y.useState(!1),[c,l]=y.useState("purchase"),[d,u]=y.useState(!1),{products:m,loading:b}=Ut(),{providers:x,loading:p}=pr(),{recipes:f,loading:h}=da(),g=async w=>{var P;const v=(P=w.target.files)==null?void 0:P[0];if(!v)return;if(!v.name.toLowerCase().endsWith(".csv")){A.error("El archivo debe ser de tipo CSV");return}r(!0);try{const S=await v.text(),ee=await Ig(S,m,x,f,c);a(ee),o(!0),ee.updated>0&&A.success(`${ee.updated} productos/recetas actualizados`)}catch(S){A.error(S instanceof Error?S.message:"Error al procesar el archivo")}finally{r(!1),t.current&&(t.current.value="")}};return s.jsxs(s.Fragment,{children:[s.jsx(O,{children:s.jsxs(O.Header,{className:"!p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg",children:s.jsx(Sa,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Actualización de Precios"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Importar precios desde archivos CSV"})]})]}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>u(!d),className:"p-2 hover:bg-gray-100 rounded-full",children:s.jsx(Ei,{className:`w-5 h-5 transition-transform duration-200 ${d?"rotate-180":""}`})})]}),d&&s.jsxs("div",{className:"mt-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx("button",{onClick:()=>l("purchase"),className:`
                    relative p-4 rounded-lg border-2 transition-all duration-200
                    ${c==="purchase"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-200 hover:bg-gray-50"}
                  `,children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("div",{className:`
                      p-2 rounded-lg
                      ${c==="purchase"?"bg-blue-100":"bg-gray-100"}
                    `,children:s.jsx($n,{className:`
                        w-5 h-5
                        ${c==="purchase"?"text-blue-600":"text-gray-600"}
                      `})}),s.jsx("span",{className:`
                      font-medium
                      ${c==="purchase"?"text-blue-900":"text-gray-700"}
                    `,children:"Precios de Compra"})]})}),s.jsx("button",{onClick:()=>l("sale"),className:`
                    relative p-4 rounded-lg border-2 transition-all duration-200
                    ${c==="sale"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-200 hover:bg-gray-50"}
                  `,children:s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("div",{className:`
                      p-2 rounded-lg
                      ${c==="sale"?"bg-blue-100":"bg-gray-100"}
                    `,children:s.jsx(At,{className:`
                        w-5 h-5
                        ${c==="sale"?"text-blue-600":"text-gray-600"}
                      `})}),s.jsx("span",{className:`
                      font-medium
                      ${c==="sale"?"text-blue-900":"text-gray-700"}
                    `,children:"Precios de Venta"})]})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("input",{ref:t,type:"file",accept:".csv",onChange:g,className:"hidden"}),s.jsx("div",{className:"relative",children:s.jsxs(E,{onClick:()=>{var w;return(w=t.current)==null?void 0:w.click()},isLoading:e,className:"w-full h-24 flex flex-col items-center justify-center gap-2 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700",children:[s.jsx(Sa,{className:"w-6 h-6"}),s.jsx("span",{className:"text-sm",children:e?"Procesando archivo...":"Seleccionar archivo CSV"})]})}),s.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200 overflow-hidden",children:[s.jsx("div",{className:"p-3 bg-gray-100 border-b border-gray-200",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Mi,{className:"w-4 h-4 text-gray-600"}),s.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Formato Requerido"})]})}),s.jsx("div",{className:"p-3",children:s.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[c==="purchase"?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),"Columnas: Fecha, RUT, Código, Nombre, Precio"]}),s.jsxs("p",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),"El RUT debe coincidir con el proveedor"]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),"Columnas: Código, Artículo, Contado"]}),s.jsxs("p",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),"El código debe coincidir con el SKU del producto"]})]}),s.jsxs("p",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),"Separador: Coma (,) o Punto y coma (;)"]}),s.jsxs("p",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500"}),"Codificación: UTF-8"]})]})})]})]})]})]})}),s.jsx(Fg,{isOpen:i,onClose:()=>o(!1),result:n,importType:c})]})}function $g(){const{recipes:t,loading:e}=da(),r=Bi();if(e)return s.jsx(O,{children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"animate-pulse space-y-3",children:[s.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})});const n=t.filter(i=>i.isBase),a=t.filter(i=>!i.isBase);return s.jsx(O,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>r("/recipes"),children:s.jsxs(O.Header,{className:"!p-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:s.jsx(Ht,{className:"w-5 h-5 text-amber-600"})}),s.jsx("h3",{className:"text-lg font-semibold",children:"Recetas"})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-amber-50 p-3 rounded-lg border border-amber-100",children:[s.jsxs("div",{className:"flex items-center gap-2 text-amber-800 mb-1",children:[s.jsx(al,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"Recetas Base"})]}),s.jsx("span",{className:"text-2xl font-bold text-amber-900",children:n.length})]}),s.jsxs("div",{className:"bg-amber-50 p-3 rounded-lg border border-amber-100",children:[s.jsxs("div",{className:"flex items-center gap-2 text-amber-800 mb-1",children:[s.jsx(il,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"Recetas"})]}),s.jsx("span",{className:"text-2xl font-bold text-amber-900",children:a.length})]})]}),s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:s.jsxs("div",{className:"flex items-center justify-between text-gray-600",children:[s.jsx("span",{children:"Total Recetas"}),s.jsx("span",{className:"text-xl font-bold text-amber-600",children:t.length})]})})]})})}function Sc(){const[t,e]=y.useState([]),[r,n]=y.useState(!0);return y.useEffect(()=>{const o=q(H,"measures"),c=Ke(o,l=>{try{if(!l.exists()){e([]),n(!1);return}const d=Object.entries(l.val()).map(([u,m])=>({id:u,name:m}));e([...d].sort((u,m)=>u.name.localeCompare(m.name)))}catch(d){console.error("Error loading measures:",d),A.error("Error al cargar las unidades de medida")}finally{n(!1)}});return()=>c()},[]),{unitMeasures:t,loading:r,addUnitMeasure:async o=>{try{const c=o.trim().toUpperCase();if(t.some(u=>u.name===c)){A.error("Esta unidad ya existe");return}const l=q(H,"measures"),d=ct(l);await vt(d,c),A.success("Unidad agregada exitosamente")}catch(c){throw console.error("Error adding measure:",c),A.error("Error al agregar la unidad"),c}},updateUnitMeasure:async(o,c)=>{try{const l=c.trim().toUpperCase();if(t.some(u=>u.name===l&&u.id!==o)){A.error("Ya existe una unidad con este nombre");return}const d=q(H,`measures/${o}`);await vt(d,l),A.success("Unidad actualizada exitosamente")}catch(l){throw console.error("Error updating measure:",l),A.error("Error al actualizar la unidad"),l}}}}const ua="unitConversions";async function Dg(t){try{const e=q(H,ua),r=ct(e);if(!r.key)throw new oe("Failed to generate conversion ID");const n=Date.now();return await Ye(r,{...t,createdAt:n,updatedAt:n}),r.key}catch(e){throw new oe("Failed to add unit conversion",{cause:e})}}async function Lg(t,e){try{const r=q(H,`${ua}/${t}`);await Ye(r,{...e,updatedAt:Date.now()})}catch(r){throw new oe("Failed to update unit conversion",{cause:r})}}async function Bg(t){try{const e=q(H,`${ua}/${t}`);await ur(e)}catch(e){throw new oe("Failed to delete unit conversion",{cause:e})}}function Cc(){const[t,e]=y.useState([]),[r,n]=y.useState(!0);return y.useEffect(()=>{const c=q(H,"unitConversions"),l=Ke(c,d=>{if(!d.exists()){e([]),n(!1);return}const u=Object.entries(d.val()).map(([m,b])=>({id:m,...b}));e(u),n(!1)});return()=>l()},[]),{conversions:t,loading:r,addConversion:async c=>Dg(c),updateConversion:async(c,l)=>Lg(c,l),deleteConversion:async c=>Bg(c)}}function Vg({isOpen:t,onClose:e}){const{unitMeasures:r,loading:n,addUnitMeasure:a,updateUnitMeasure:i}=Sc(),{conversions:o,loading:c,addConversion:l,updateConversion:d,deleteConversion:u}=Cc(),[m,b]=y.useState(""),[x,p]=y.useState(null),[f,h]=y.useState(""),[g,w]=y.useState(null),[v,_]=y.useState(null),[P,S]=y.useState(""),[ee,me]=y.useState(!1),[k,Y]=y.useState(!1),[de,G]=y.useState({fromUnit:"",toUnit:"",factor:1}),Se=r.filter(F=>F.name.toLowerCase().includes(m.toLowerCase())),X=o.filter(F=>F.fromUnit.toLowerCase().includes(m.toLowerCase())||F.toUnit.toLowerCase().includes(m.toLowerCase())),Pe=async(F,W)=>{try{await i(F,W.trim().toUpperCase()),p(null),h(""),A.success("Unidad actualizada exitosamente")}catch(U){console.error("Error updating unit:",U),A.error("Error al actualizar la unidad")}},J=async()=>{if(!P.trim()){A.error("Ingrese un nombre para la unidad");return}try{await a(P.trim().toUpperCase()),S(""),me(!1),A.success("Unidad agregada exitosamente")}catch(F){console.error("Error adding unit:",F),A.error("Error al agregar la unidad")}},xe=async F=>{const W=F?v:de;if(W){if(!W.fromUnit||!W.toUnit){A.error("Seleccione ambas unidades");return}if(!W.factor||W.factor<=0){A.error("El factor debe ser mayor a 0");return}try{F?(await d(F,W),w(null),_(null),A.success("Conversión actualizada exitosamente")):(await l(W),Y(!1),G({fromUnit:"",toUnit:"",factor:1}),A.success("Conversión agregada exitosamente"))}catch(U){console.error("Error saving conversion:",U),A.error("Error al guardar la conversión")}}};return n||c?s.jsx(Ue,{isOpen:t,onClose:e,title:"Gestión de Unidades de Medida",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):s.jsx(Ue,{isOpen:t,onClose:e,title:"Gestión de Unidades de Medida",className:"max-w-4xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx(se,{placeholder:"Buscar unidades o conversiones...",value:m,onChange:F=>b(F.target.value),className:"pl-10"}),s.jsx(Us,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Unidades de Medida"}),s.jsxs(E,{variant:"outline",size:"sm",onClick:()=>me(!0),className:"gap-1",children:[s.jsx(Gt,{className:"w-4 h-4"}),"Agregar"]})]}),s.jsxs("div",{className:"space-y-2",children:[ee&&s.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx(se,{value:P,onChange:F=>S(F.target.value.toUpperCase()),placeholder:"Nueva unidad...",className:"flex-1"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(E,{variant:"ghost",size:"sm",onClick:J,className:"w-8 h-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",children:s.jsx(er,{className:"w-4 h-4"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>{me(!1),S("")},className:"w-8 h-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx(Ve,{className:"w-4 h-4"})})]})]}),Se.map(F=>s.jsx("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg border border-gray-200",children:x===F.id?s.jsxs(s.Fragment,{children:[s.jsx(se,{value:f,onChange:W=>h(W.target.value.toUpperCase()),className:"flex-1"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>Pe(F.id,f),className:"w-8 h-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",children:s.jsx(er,{className:"w-4 h-4"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>{p(null),h("")},className:"w-8 h-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx(Ve,{className:"w-4 h-4"})})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"flex-1 font-medium",children:F.name}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>{p(F.id),h(F.name)},className:"w-8 h-8 p-0 text-gray-600 hover:text-gray-700 hover:bg-gray-100",children:s.jsx(Ca,{className:"w-4 h-4"})})]})},F.id))]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Conversiones"}),s.jsxs(E,{variant:"outline",size:"sm",onClick:()=>Y(!0),className:"gap-1",children:[s.jsx(Gt,{className:"w-4 h-4"}),"Agregar"]})]}),s.jsxs("div",{className:"space-y-2",children:[k&&s.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("select",{value:de.fromUnit,onChange:F=>G(W=>({...W,fromUnit:F.target.value,toUnit:W.toUnit===F.target.value?"":W.toUnit})),className:"rounded-md border border-gray-300 px-3 py-2 text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Desde..."}),r.map(F=>s.jsx("option",{value:F.name,children:F.name},F.id))]}),s.jsxs("select",{value:de.toUnit,onChange:F=>G(W=>({...W,toUnit:F.target.value,fromUnit:W.fromUnit===F.target.value?"":W.fromUnit})),className:"rounded-md border border-gray-300 px-3 py-2 text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Hacia..."}),r.filter(F=>F.name!==de.fromUnit).map(F=>s.jsx("option",{value:F.name,children:F.name},F.id))]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(se,{type:"number",value:de.factor,onChange:F=>G(W=>({...W,factor:parseFloat(F.target.value)||0})),min:0,step:"0.0001",placeholder:"Factor de conversión",className:"flex-1"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>xe(null),className:"w-8 h-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",children:s.jsx(er,{className:"w-4 h-4"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>{Y(!1),G({fromUnit:"",toUnit:"",factor:1})},className:"w-8 h-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx(Ve,{className:"w-4 h-4"})})]})]}),de.fromUnit&&de.toUnit&&de.factor>0&&s.jsxs("div",{className:"text-sm text-blue-700",children:["1 ",de.fromUnit," = ",de.factor," ",de.toUnit]})]}),X.map(F=>s.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:g===F.id?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("select",{value:(v==null?void 0:v.fromUnit)||"",onChange:W=>_(U=>({...U,fromUnit:W.target.value,toUnit:(U==null?void 0:U.toUnit)===W.target.value?"":(U==null?void 0:U.toUnit)||""})),className:"rounded-md border border-gray-300 px-3 py-2 text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Desde..."}),r.map(W=>s.jsx("option",{value:W.name,children:W.name},W.id))]}),s.jsxs("select",{value:(v==null?void 0:v.toUnit)||"",onChange:W=>_(U=>({...U,toUnit:W.target.value,fromUnit:(U==null?void 0:U.fromUnit)===W.target.value?"":(U==null?void 0:U.fromUnit)||""})),className:"rounded-md border border-gray-300 px-3 py-2 text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Hacia..."}),r.filter(W=>W.name!==(v==null?void 0:v.fromUnit)).map(W=>s.jsx("option",{value:W.name,children:W.name},W.id))]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(se,{type:"number",value:(v==null?void 0:v.factor)||"",onChange:W=>_(U=>({...U,factor:parseFloat(W.target.value)||0})),min:0,step:"0.0001",placeholder:"Factor de conversión",className:"flex-1"}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>xe(F.id),className:"w-8 h-8 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",children:s.jsx(er,{className:"w-4 h-4"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>{w(null),_(null)},className:"w-8 h-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx(Ve,{className:"w-4 h-4"})})]})]}),(v==null?void 0:v.fromUnit)&&(v==null?void 0:v.toUnit)&&(v==null?void 0:v.factor)>0&&s.jsxs("div",{className:"text-sm text-blue-700",children:["1 ",v.fromUnit," = ",v.factor," ",v.toUnit]})]}):s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium",children:F.fromUnit}),s.jsx(ol,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"font-medium",children:F.toUnit}),s.jsxs("span",{className:"text-sm text-gray-500",children:["(1 ",F.fromUnit," = ",F.factor," ",F.toUnit,")"]})]}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>{w(F.id),_({fromUnit:F.fromUnit,toUnit:F.toUnit,factor:F.factor})},className:"w-8 h-8 p-0 text-gray-600 hover:text-gray-700 hover:bg-gray-100",children:s.jsx(Ca,{className:"w-4 h-4"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>u(F.id),className:"w-8 h-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx(Ar,{className:"w-4 h-4"})})]})]})},F.id))]})]})]})})}const zg=Mf(()=>{const t=Cg(),[e,r]=y.useState(!1),[n,a]=y.useState(!1),[i,o]=y.useState(!1),[c,l]=y.useState(!1),d=async()=>{l(!0),await t.loadStats(),l(!1)},u=t.topProducts[0];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),t.formattedLastUpdate&&s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Última actualización: ",t.formattedLastUpdate,t.isStale&&s.jsx("span",{className:"text-amber-500 ml-2",children:"(Datos desactualizados)"})]})]}),s.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[s.jsxs(E,{variant:"outline",size:"sm",onClick:()=>o(!0),className:"gap-2 flex-1 sm:flex-none",children:[s.jsx(Us,{className:"w-4 h-4"}),s.jsx("span",{className:"whitespace-nowrap",children:"Unidades"})]}),s.jsxs(E,{variant:"outline",size:"sm",onClick:d,disabled:t.loading||c,className:"gap-2 flex-1 sm:flex-none",children:[s.jsx(Dn,{className:`w-4 h-4 ${c?"animate-spin":""}`}),s.jsx("span",{className:"whitespace-nowrap",children:"Actualizar"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(O,{variant:"blue",children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold capitalize",children:fe(new Date,"EEEE",{locale:ye})}),s.jsx("div",{className:"text-sm text-gray-600 mt-1",children:fe(new Date,"dd/MM/yyyy")})]}),s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(Kt,{className:"w-5 h-5 text-blue-600"})})]})})}),s.jsx(O,{variant:"purple",children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pedidos Hoy"}),s.jsx("h3",{className:"text-2xl font-bold mt-1",children:t.loading?s.jsx("span",{className:"text-gray-400",children:"..."}):t.todayOrdersCount}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:Q(t.todayOrdersAmount)})]}),s.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:s.jsx(ze,{className:"w-5 h-5 text-purple-600"})})]})})}),s.jsx(O,{variant:"indigo",children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Órdenes Semanales"}),s.jsx("h3",{className:"text-2xl font-bold mt-1",children:t.weekOrdersCount}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:Q(t.weekOrdersAmount)})]}),s.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:s.jsx(cl,{className:"w-5 h-5 text-indigo-600"})})]})})}),s.jsx(O,{variant:"amber",children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Órdenes Mensuales"}),s.jsx("h3",{className:"text-2xl font-bold mt-1",children:t.monthOrdersCount}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:Q(t.monthOrdersAmount)})]}),s.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:s.jsx(At,{className:"w-5 h-5 text-amber-600"})})]})})})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsx(O,{variant:"indigo",children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Productos"}),s.jsx("h3",{className:"text-2xl font-bold mt-1",children:t.totalProducts}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"En catálogo"})]}),s.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:s.jsx(Ti,{className:"w-5 h-5 text-indigo-600"})})]})})}),s.jsx(O,{variant:"emerald",children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Proveedores"}),s.jsx("h3",{className:"text-2xl font-bold mt-1",children:t.totalProviders}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Activos"})]}),s.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:s.jsx(Fn,{className:"w-5 h-5 text-emerald-600"})})]})})}),s.jsx(O,{variant:"rose",children:s.jsx(O.Header,{className:"!p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Órdenes"}),s.jsx("h3",{className:"text-2xl font-bold mt-1",children:t.totalOrders}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Históricas"})]}),s.jsx("div",{className:"p-2 bg-rose-100 rounded-lg",children:s.jsx(He,{className:"w-5 h-5 text-rose-600"})})]})})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[s.jsx(O,{variant:"green",className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>r(!0),children:s.jsxs(O.Header,{className:"!p-4",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(Wt,{className:"w-5 h-5 text-green-600"})}),s.jsx("h3",{className:"text-lg font-semibold",children:"Productos Más Valorados"})]})}),u&&s.jsxs("div",{children:[s.jsx("h4",{className:"text-xl font-bold break-words",children:u.name}),s.jsxs("div",{className:"flex items-center justify-between mt-2",children:[s.jsx("span",{className:"text-lg font-bold text-green-600",children:Q(u.totalAmount)}),s.jsxs("span",{className:"text-sm text-gray-500",children:[u.totalQuantity," unidades"]})]})]})]})}),s.jsx(Ug,{}),s.jsx($g,{})]}),s.jsx(Og,{tagStats:t.topProductsByTags,loading:t.loading,onClick:()=>a(!0)})]}),s.jsx(Pg,{isOpen:e,onClose:()=>r(!1),products:t.topProducts}),s.jsx(kg,{isOpen:n,onClose:()=>a(!1),tagStats:t.topProductsByTags}),s.jsx(Vg,{isOpen:i,onClose:()=>o(!1)})]})}),bi=[{value:"monday",label:"Lunes"},{value:"tuesday",label:"Martes"},{value:"wednesday",label:"Miércoles"},{value:"thursday",label:"Jueves"},{value:"friday",label:"Viernes"},{value:"saturday",label:"Sábado"},{value:"sunday",label:"Domingo"}],qg=Array.from({length:31},(t,e)=>e+1);function Hg({initialData:t,onSubmit:e,onCancel:r,isLoading:n}){const[a,i]=ws.useState({commercialName:(t==null?void 0:t.commercialName)||"",legalName:(t==null?void 0:t.legalName)||"",rut:(t==null?void 0:t.rut)||"",phone:(t==null?void 0:t.phone)||"",deliveryDays:(t==null?void 0:t.deliveryDays)||[],orderDays:(t==null?void 0:t.orderDays)||[],billingType:(t==null?void 0:t.billingType)||"weekly",billingDays:(t==null?void 0:t.billingDays)||[]}),[o,c]=y.useState(""),l=x=>{let p=x.target.value;p=p.replace(/\D/g,""),p.startsWith("598")&&(p=p.slice(3)),p=p.slice(0,9),i(f=>({...f,phone:p})),p&&!Fa(p)?c("Ingrese un número de celular válido de Uruguay (8 o 9 dígitos)"):c("")},d=async x=>{if(x.preventDefault(),a.phone&&!Fa(a.phone)){c("Ingrese un número de celular válido de Uruguay (8 o 9 dígitos)");return}await e(a)},u=(x,p)=>{i(f=>{var h,g;return{...f,[p==="delivery"?"deliveryDays":"orderDays"]:(h=f[p==="delivery"?"deliveryDays":"orderDays"])!=null&&h.includes(x)?(g=f[p==="delivery"?"deliveryDays":"orderDays"])==null?void 0:g.filter(w=>w!==x):[...f[p==="delivery"?"deliveryDays":"orderDays"]||[],x]}})},m=x=>{i(p=>({...p,billingDays:[x]}))},b=a.phone?Zi(a.phone):"";return s.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col overflow-hidden",children:[s.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white",children:s.jsxs("div",{className:"flex items-center justify-between px-4 h-14",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Fn,{className:"w-6 h-6"}),s.jsxs("h2",{className:"text-lg font-semibold",children:[t?"Editar":"Nuevo"," Proveedor"]})]}),s.jsx(E,{variant:"ghost",size:"sm",onClick:r,className:"p-2 hover:bg-white/10 text-white rounded-full",children:s.jsx(Ve,{className:"w-5 h-5"})})]})}),s.jsx("div",{className:"flex-1 overflow-auto p-4",children:s.jsxs("form",{onSubmit:d,className:"max-w-3xl mx-auto space-y-6",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg border shadow-sm space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información Básica"}),s.jsx(se,{label:"Nombre comercial",value:a.commercialName,onChange:x=>i(p=>({...p,commercialName:x.target.value})),required:!0}),s.jsx(se,{label:"Razón social",value:a.legalName,onChange:x=>i(p=>({...p,legalName:x.target.value}))}),s.jsx(se,{label:"RUT",value:a.rut,onChange:x=>i(p=>({...p,rut:x.target.value}))}),s.jsxs("div",{children:[s.jsx(se,{label:"Celular",type:"tel",value:a.phone,onChange:l,error:o,placeholder:"93609319"}),a.phone&&s.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Se guardará como: ",b]})]})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg border shadow-sm space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Configuración de Horarios"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:s.jsx(At,{className:"w-5 h-5 text-amber-600"})}),s.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Facturación"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-amber-50 rounded-lg border border-amber-200",children:[s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"radio",checked:a.billingType==="weekly",onChange:()=>i(x=>({...x,billingType:"weekly",billingDays:[]})),className:"w-4 h-4 text-amber-600 border-amber-300 focus:ring-amber-500"}),s.jsx("span",{className:"text-amber-900",children:"Semanal"})]}),s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"radio",checked:a.billingType==="monthly",onChange:()=>i(x=>({...x,billingType:"monthly",billingDays:[]})),className:"w-4 h-4 text-amber-600 border-amber-300 focus:ring-amber-500"}),s.jsx("span",{className:"text-amber-900",children:"Mensual"})]})]}),a.billingType==="monthly"&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-amber-900",children:"Día de facturación"}),s.jsx("div",{className:"grid grid-cols-7 gap-2",children:qg.map(x=>{var p;return s.jsx("button",{type:"button",onClick:()=>m(x),className:`
                          px-2 py-1.5 text-sm font-medium rounded-md transition-colors
                          ${(p=a.billingDays)!=null&&p.includes(x)?"bg-amber-200 text-amber-900 hover:bg-amber-300":"bg-white text-amber-700 hover:bg-amber-100 border border-amber-200"}
                        `,children:x},x)})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(He,{className:"w-5 h-5 text-blue-600"})}),s.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Días de Pedido"})]}),s.jsx("div",{className:"grid grid-cols-7 gap-2",children:bi.map(({value:x,label:p})=>{var f;return s.jsx("button",{type:"button",onClick:()=>u(x,"order"),className:`
                      px-3 py-2 text-sm font-medium rounded-lg transition-colors
                      ${(f=a.orderDays)!=null&&f.includes(x)?"bg-blue-200 text-blue-900 hover:bg-blue-300":"bg-white text-blue-700 hover:bg-blue-100 border border-blue-200"}
                    `,children:p},x)})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(ys,{className:"w-5 h-5 text-green-600"})}),s.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Días de Entrega"})]}),s.jsx("div",{className:"grid grid-cols-7 gap-2",children:bi.map(({value:x,label:p})=>{var f;return s.jsx("button",{type:"button",onClick:()=>u(x,"delivery"),className:`
                      px-3 py-2 text-sm font-medium rounded-lg transition-colors
                      ${(f=a.deliveryDays)!=null&&f.includes(x)?"bg-green-200 text-green-900 hover:bg-green-300":"bg-white text-green-700 hover:bg-green-100 border border-green-200"}
                    `,children:p},x)})})]})]})]})}),s.jsx("div",{className:"border-t bg-white p-4",children:s.jsxs("div",{className:"max-w-3xl mx-auto flex justify-end space-x-4",children:[s.jsx(E,{type:"button",variant:"outline",onClick:r,disabled:n,children:"Cancelar"}),s.jsxs(E,{type:"submit",onClick:d,isLoading:n,children:[t?"Actualizar":"Crear"," Proveedor"]})]})})]})}function Wg(){const{providers:t,loading:e,addProvider:r,updateProvider:n,deleteProvider:a}=pr(),[i,o]=y.useState(!1),[c,l]=y.useState(null),[d,u]=y.useState(!1),[m,b]=y.useState(null),[x,p]=y.useState(""),f=y.useMemo(()=>{if(!x)return t;const S=x.toLowerCase();return t.filter(ee=>{var me,k,Y;return ee.commercialName.toLowerCase().includes(S)||((me=ee.legalName)==null?void 0:me.toLowerCase().includes(S))||((k=ee.rut)==null?void 0:k.toLowerCase().includes(S))||((Y=ee.phone)==null?void 0:Y.includes(S))})},[t,x]),h=async S=>{u(!0);try{c?(await n(c.id,S),A.success("Proveedor actualizado exitosamente")):(await r(S),A.success("Proveedor creado exitosamente")),v()}catch(ee){console.error("Error saving provider:",ee),A.error("Ocurrió un error al guardar el proveedor")}finally{u(!1)}},g=S=>{b(S)},w=async()=>{if(m)try{await a(m.id),A.success("Proveedor eliminado exitosamente"),b(null)}catch(S){console.error("Error deleting provider:",S),A.error("Ocurrió un error al eliminar el proveedor")}},v=()=>{o(!1),l(null)},_=S=>{l(S),o(!0)},P=()=>{o(!0)};return e?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):i||c?s.jsx(Hg,{initialData:c||void 0,onSubmit:h,onCancel:v,isLoading:d}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(se,{placeholder:"Buscar proveedores...",value:x,onChange:S=>p(S.target.value),className:"pl-10"}),s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]}),s.jsxs(E,{onClick:P,className:"whitespace-nowrap",children:[s.jsx(Gt,{className:"w-4 h-4 mr-2"}),"Nuevo Proveedor"]})]}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[f.map(S=>s.jsxs("div",{className:"bg-white p-4 md:p-6 rounded-lg shadow-sm space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-lg font-semibold break-words",children:S.commercialName}),S.legalName&&s.jsx("p",{className:"text-sm text-gray-600 break-words",children:S.legalName}),S.rut&&s.jsxs("p",{className:"text-sm text-gray-600",children:["RUT: ",S.rut]}),S.phone&&s.jsxs("p",{className:"text-sm text-gray-600",children:["Celular: ",Zi(S.phone)]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2 items-center justify-between",children:[s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(E,{variant:"outline",size:"sm",onClick:()=>_(S),children:[s.jsx(Ln,{className:"w-4 h-4 mr-2"}),"Editar"]}),s.jsxs(E,{variant:"outline",size:"sm",onClick:()=>g(S),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[s.jsx(Ar,{className:"w-4 h-4 mr-2"}),"Eliminar"]})]}),S.phone&&s.jsx("a",{href:eo(S.phone,""),target:"_blank",rel:"noopener noreferrer",children:s.jsx(E,{variant:"ghost",size:"sm",children:s.jsx(ll,{className:"w-4 h-4"})})})]})]},S.id)),f.length===0&&s.jsx("div",{className:"col-span-full flex items-center justify-center h-32 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:s.jsx("p",{className:"text-gray-500 text-center",children:x?"No se encontraron proveedores que coincidan con la búsqueda":"No hay proveedores registrados"})})]}),s.jsx(Ue,{isOpen:!!m,onClose:()=>b(null),title:"Eliminar proveedor",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[s.jsxs("p",{className:"text-amber-800",children:["¿Está seguro que desea eliminar el proveedor ",s.jsx("span",{className:"font-semibold",children:m==null?void 0:m.commercialName}),"?"]}),s.jsx("p",{className:"text-sm text-amber-700 mt-2",children:"Esta acción no se puede deshacer."})]}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(E,{variant:"outline",onClick:()=>b(null),children:"Cancelar"}),s.jsx(E,{onClick:w,className:"bg-red-600 hover:bg-red-700 text-white",children:"Eliminar"})]})]})})]})}function Pc({providers:t,selectedProviderId:e,onChange:r}){const[n,a]=y.useState(!1),[i,o]=y.useState(""),c=y.useRef(null),{products:l}=Ut(),d=t.filter(p=>l.some(f=>f.providerId===p.id)),u=d.find(p=>p.id===e);y.useEffect(()=>{const p=f=>{c.current&&!c.current.contains(f.target)&&a(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const m=d.filter(p=>{var f;return p.commercialName.toLowerCase().includes(i.toLowerCase())||((f=p.legalName)==null?void 0:f.toLowerCase().includes(i.toLowerCase()))}),b=p=>{r(p),a(!1),o("")},x=p=>{p.stopPropagation(),r(""),o("")};return s.jsxs("div",{className:"relative",ref:c,children:[s.jsx("div",{className:"mb-2",children:s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Proveedor"})}),s.jsx("div",{role:"button",tabIndex:0,onClick:()=>a(!n),onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&a(!n)},className:Fe("relative w-full rounded-lg border bg-white px-4 py-3 h-[48px] cursor-pointer","focus:outline-none focus:ring-2 focus:ring-blue-500",e?"border-blue-200 hover:border-blue-300":"border-gray-200 hover:border-gray-300","transition-all duration-200 flex items-center"),children:s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx(Ri,{className:`
            w-5 h-5 flex-shrink-0
            ${e?"text-blue-500":"text-gray-400"}
          `}),s.jsx("div",{className:"flex-1 min-w-0",children:u?s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900 truncate",children:u.commercialName}),u.legalName&&u.legalName!==u.commercialName&&s.jsx("div",{className:"text-sm text-gray-500 truncate",children:u.legalName})]}):s.jsx("span",{className:"text-gray-500",children:"Seleccionar proveedor..."})}),s.jsxs("div",{className:"flex items-center gap-2",children:[e&&s.jsx("div",{role:"button",tabIndex:0,onClick:x,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&x(p)},className:"p-1 hover:bg-gray-100 rounded-full transition-colors cursor-pointer",children:s.jsx(Ve,{className:"w-4 h-4 text-gray-400"})}),s.jsx(Ei,{className:`
              w-5 h-5 transition-transform duration-200
              ${e?"text-blue-500":"text-gray-400"}
              ${n?"rotate-180":""}
            `})]})]})}),n&&s.jsxs("div",{className:"absolute z-10 mt-2 w-full rounded-lg bg-white shadow-lg border border-gray-200",children:[s.jsx("div",{className:"p-2 border-b",children:s.jsxs("div",{className:"relative",children:[s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"text",value:i,onChange:p=>o(p.target.value),placeholder:"Buscar proveedor...",className:`
                  w-full rounded-md border border-gray-200 pl-9 pr-4 py-2 text-sm
                  placeholder-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500
                `})]})}),s.jsx("div",{className:"max-h-60 overflow-auto",children:m.length>0?s.jsx("div",{className:"py-1",children:m.map(p=>s.jsxs("div",{role:"button",tabIndex:0,onClick:()=>b(p.id),onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&b(p.id)},className:Fe("px-4 py-2 cursor-pointer hover:bg-gray-50 transition-colors",p.id===e&&"bg-blue-50"),children:[s.jsx("div",{className:"font-medium text-gray-900",children:p.commercialName}),p.legalName&&p.legalName!==p.commercialName&&s.jsx("div",{className:"text-sm text-gray-500",children:p.legalName})]},p.id))}):s.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 text-center",children:"No se encontraron proveedores"})})]})]})}function kc(t){const[e,r]=y.useState([]),[n,a]=y.useState(!0),i=Jt.get(Be.ProductRepository);return y.useEffect(()=>{if(!t){r([]),a(!1);return}const d=i.subscribeToProviderProducts(t,u=>{const m=u.map(b=>({...b,enabled:b.enabled??!0}));r(m),a(!1)});return()=>d()},[t,i]),{products:e,loading:n,addProduct:async d=>{try{await i.create({...d,enabled:!0}),A.success("Producto creado exitosamente")}catch(u){throw console.error("Error creating product:",u),u}},updateProduct:async(d,u)=>{try{await i.update(d,u),A.success("Producto actualizado exitosamente")}catch(m){throw console.error("Error updating product:",m),m}},deleteProduct:async d=>{try{await i.delete(d),A.success("Producto eliminado exitosamente")}catch(u){throw console.error("Error deleting product:",u),u}}}}function vi({product:t,onEdit:e,onDelete:r,onStockAdjust:n}){var m,b,x,p;const[a,i]=y.useState(!1),o=t.forSale&&t.salePrice&&t.saleCostPerUnit?(t.salePrice-t.saleCostPerUnit)/t.salePrice*100:null,c=f=>f===null?"text-gray-700 bg-gray-50":f<0?"text-red-700 bg-red-50":f<=5?"text-orange-700 bg-orange-50":"text-green-700 bg-green-50",l=(m=t.salePriceHistory)==null?void 0:m[t.salePriceHistory.length-1],d=t.enabled!==!1,u=()=>{const f=[];return t.priceHistory&&f.push(...t.priceHistory.map(h=>({date:h.date,type:"purchase",value:h.price,changePercentage:h.changePercentage}))),t.salePriceHistory&&f.push(...t.salePriceHistory.map(h=>({date:h.date,type:"sale",value:h.price,changePercentage:h.changePercentage}))),t.stockAdjustments&&f.push(...t.stockAdjustments.map(h=>({date:h.date,type:"stock",value:h.quantity,notes:h.notes}))),f.sort((h,g)=>g.date-h.date)};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`
        bg-white rounded-lg transition-all duration-200
        ${o!==null?o<0?"border-2 border-red-200":o<=5?"border-2 border-orange-200":"border-2 border-green-200":"border border-gray-200"}
        hover:shadow-md
      `,children:s.jsxs("div",{className:"p-3 space-y-2",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("h3",{className:"font-medium text-gray-900 leading-tight break-words",children:[t.name,s.jsxs("span",{className:`
                  ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium gap-1
                  ${d?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}
                `,children:[s.jsx(Bn,{className:"w-3 h-3"}),d?"Habilitado":"Deshabilitado"]})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(ze,{className:"w-3 h-3"}),t.sku]}),t.supplierCode&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-gray-300",children:"•"}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(At,{className:"w-3 h-3"}),t.supplierCode]})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[t.isProduction&&s.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800",children:[s.jsx(Ht,{className:"w-3 h-3 mr-0.5"}),"Prod"]}),t.forSale&&s.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:[s.jsx(He,{className:"w-3 h-3 mr-0.5"}),"Venta"]}),(b=t.tags)==null?void 0:b.map(f=>s.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:f},f))]})]}),s.jsx("div",{className:"text-xs text-gray-500",children:co(t.order)})]}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between items-baseline",children:[s.jsxs("span",{className:"text-gray-600",children:["Compra ",s.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.purchasePackaging,")"]}),":"]}),s.jsx("span",{className:"font-medium text-blue-600",children:Q(t.price)})]}),t.isProduction&&s.jsxs("div",{className:"flex justify-between items-baseline",children:[s.jsxs("span",{className:"text-gray-600",children:["Costo ",s.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.unitMeasure||t.purchasePackaging,")"]}),":"]}),s.jsx("span",{className:"font-medium",children:Q(t.pricePerUnit||0)})]}),t.forSale&&s.jsxs("div",{className:"flex justify-between items-baseline",children:[s.jsxs("span",{className:"text-gray-600",children:["Venta ",s.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.saleUnit||t.purchasePackaging,")"]}),":"]}),s.jsxs("span",{className:"font-medium",children:[Q(t.salePrice||0),l&&Math.abs(l.changePercentage)>(t.priceThreshold||20)&&s.jsxs("span",{className:`ml-1 text-xs ${l.changePercentage>0?"text-red-500":"text-green-500"}`,children:[l.changePercentage>0?"↑":"↓",Math.abs(l.changePercentage).toFixed(1),"%"]})]})]})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[s.jsxs("span",{children:["Stock: ",t.minPackageStock,"-",t.desiredStock,s.jsx("span",{className:"text-xs text-gray-500 ml-1",children:t.purchasePackaging})]}),o!==null&&s.jsxs("span",{className:`px-2 py-0.5 rounded-md ${c(o)}`,children:["Margen: ",o.toFixed(1),"%"]})]}),s.jsxs("div",{className:"flex justify-end gap-1 pt-2 border-t",children:[n&&s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>n(t),className:"w-7 h-7 p-0",title:"Ajustar stock",children:s.jsx(Us,{className:"w-3.5 h-3.5 text-gray-600 hover:text-gray-900"})}),(((x=t.salePriceHistory)==null?void 0:x.length)>0||((p=t.priceHistory)==null?void 0:p.length)>0)&&s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>i(!0),className:"w-7 h-7 p-0",title:"Historial de precios",children:s.jsx(Vn,{className:"w-3.5 h-3.5 text-gray-600 hover:text-gray-900"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>e(t),className:"w-7 h-7 p-0",title:"Editar producto",children:s.jsx(Ln,{className:"w-3.5 h-3.5 text-gray-600 hover:text-gray-900"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>r(t),className:"w-7 h-7 p-0",title:"Eliminar producto",children:s.jsx(Ar,{className:"w-3.5 h-3.5 text-red-500 hover:text-red-700"})})]}),s.jsxs("div",{className:"text-[10px] text-gray-400 pt-1 border-t",children:["Actualizado: ",fe(t.lastUpdated||Date.now(),"d MMM yyyy HH:mm",{locale:ye})]})]})}),s.jsx(Ue,{isOpen:a,onClose:()=>i(!1),title:`Historial de Cambios - ${t.name}`,children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"space-y-3",children:u().map((f,h)=>{const g=f.type!=="stock"&&Math.abs(f.changePercentage||0)>(t.priceThreshold||20),w=f.value>0;return s.jsxs("div",{className:`p-3 rounded-lg ${f.type==="stock"?w?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200":g?w?"bg-red-50 border-2 border-red-200":"bg-green-50 border-2 border-green-200":"bg-gray-50 border border-gray-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("div",{className:"text-sm text-gray-600",children:fe(f.date,"d 'de' MMMM, yyyy HH:mm",{locale:ye})}),s.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${f.type==="purchase"?"bg-blue-100 text-blue-800":f.type==="sale"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:f.type==="purchase"?"Precio Compra":f.type==="sale"?"Precio Venta":"Stock"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"font-medium",children:f.type==="stock"?s.jsxs("div",{className:"flex items-center gap-1",children:[w?s.jsx(Wt,{className:"w-4 h-4 text-green-600"}):s.jsx(zn,{className:"w-4 h-4 text-red-600"}),s.jsxs("span",{className:w?"text-green-600":"text-red-600",children:[f.value>0?"+":"",f.value," ",t.purchasePackaging]})]}):Q(f.value)}),f.type!=="stock"&&f.changePercentage&&s.jsxs("span",{className:`text-sm font-medium ${f.changePercentage>0?"text-red-600":"text-green-600"}`,children:[f.changePercentage>0?"+":"",f.changePercentage.toFixed(1),"%"]})]}),f.type==="stock"&&f.notes&&s.jsx("div",{className:"mt-1 text-sm text-gray-600",children:f.notes})]},`${f.date}-${h}`)})}),u().length===0&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay historial de cambios disponible"}),s.jsx("div",{className:"flex justify-end",children:s.jsx(E,{onClick:()=>i(!1),children:"Cerrar"})})]})})]})}function Gg(t){const[e,r]=y.useState(!1);return y.useEffect(()=>{const n=window.matchMedia(t);r(n.matches);const a=i=>{r(i.matches)};return n.addEventListener("change",a),()=>n.removeEventListener("change",a)},[t]),e}function Yg({products:t,onEdit:e,onDelete:r}){const n=Gg("(min-width: 1024px)"),a=[...t].sort((i,o)=>{const c=u=>!u.forSale||!u.salePrice||!u.saleCostPerUnit?null:(u.salePrice-u.saleCostPerUnit)/u.salePrice*100,l=c(i),d=c(o);if(l!==null&&d!==null){const u=x=>x<0?0:x<=5?1:2,m=u(l),b=u(d);return m!==b?m-b:l-d}return l!==null?-1:d!==null?1:i.order-o.order});return n?s.jsx("div",{className:"grid grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4",children:a.map(i=>s.jsx(vi,{product:i,onEdit:e,onDelete:r},i.id))}):s.jsx("div",{className:"space-y-4",children:a.map(i=>s.jsx(vi,{product:i,onEdit:e,onDelete:r},i.id))})}const pn="product-filters";function Kg({onFilter:t,onClear:e,products:r,onClose:n,initialFilters:a,onUpdateFilters:i}){const[o,c]=y.useState(()=>{const f=localStorage.getItem(pn);return f?JSON.parse(f):a}),[l,d]=y.useState(!1);y.useEffect(()=>{localStorage.setItem(pn,JSON.stringify(o))},[o]);const u=f=>!f.forSale||!f.salePrice||!f.saleCostPerUnit?null:(f.salePrice-f.saleCostPerUnit)/f.salePrice*100,m=()=>{let f=0;return o.terms&&f++,o.margin!=="all"&&f++,o.price!=="all"&&f++,o.codes!=="all"&&f++,o.isProduction&&f++,o.forSale&&f++,o.enabled!=="all"&&f++,(o.sortBy!=="updated"||o.sortDirection!=="asc")&&f++,f},b=async()=>{d(!0);try{let f=[...r];if(o.terms){const h=o.terms.toLowerCase();f=f.filter(g=>{var w,v;return g.name.toLowerCase().includes(h)||g.sku.toLowerCase().includes(h)||((w=g.supplierCode)==null?void 0:w.toLowerCase().includes(h))||((v=g.tags)==null?void 0:v.some(_=>_.toLowerCase().includes(h)))})}o.margin!=="all"&&(f=f.filter(h=>{const g=u(h);switch(o.margin){case"red":return g!==null&&g<0;case"orange":return g!==null&&g>=0&&g<=5;case"green":return g!==null&&g>5;default:return!0}})),o.price==="no-purchase"?f=f.filter(h=>!h.price||h.price===0||h.price===null):o.price==="no-sale"&&(f=f.filter(h=>h.forSale&&(!h.salePrice||h.salePrice<=0))),o.isProduction&&(f=f.filter(h=>h.isProduction)),o.forSale&&(f=f.filter(h=>h.forSale)),o.enabled!=="all"&&(f=f.filter(h=>o.enabled==="enabled"?h.enabled!==!1:h.enabled===!1)),f.sort((h,g)=>{const w=o.sortDirection==="asc"?1:-1;switch(o.sortBy){case"updated":return((h.lastUpdated||0)-(g.lastUpdated||0))*w;case"margin":{const v=u(h)??-1/0,_=u(g)??-1/0;return(v-_)*w}case"name":return h.name.localeCompare(g.name)*w;case"price":return((h.price||0)-(g.price||0))*w;default:return 0}}),i(o),t(f),n()}finally{d(!1)}},x=()=>{const f={terms:"",margin:"all",price:"all",codes:"all",isProduction:!1,forSale:!1,enabled:"all",sortBy:"updated",sortDirection:"asc"};c(f),localStorage.removeItem(pn),i(f),e()},p=m()>0;return s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(se,{placeholder:"Buscar por nombre, SKU, código o etiquetas...",value:o.terms,onChange:f=>c(h=>({...h,terms:f.target.value})),className:"pl-10"}),s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("div",{className:"flex flex-wrap gap-1",children:[{value:"all",label:"Todos",color:"bg-gray-100 hover:bg-gray-200 text-gray-700"},{value:"red",label:"Pérdida (<0%)",color:"bg-red-100 hover:bg-red-200 text-red-700"},{value:"orange",label:"Riesgo (0-5%)",color:"bg-orange-100 hover:bg-orange-200 text-orange-700"},{value:"green",label:"Ganancia (>5%)",color:"bg-green-100 hover:bg-green-200 text-green-700"}].map(f=>s.jsx("button",{onClick:()=>c(h=>({...h,margin:f.value})),className:`
                px-3 py-1.5 rounded-full text-sm font-medium transition-colors
                ${o.margin===f.value?f.color:"bg-gray-50 text-gray-600 hover:bg-gray-100"}
              `,children:f.label},f.value))}),s.jsxs("button",{onClick:()=>c(f=>({...f,price:f.price==="no-purchase"?"all":"no-purchase"})),className:`
            px-3 py-1.5 rounded-full text-sm font-medium transition-colors inline-flex items-center gap-1.5
            ${o.price==="no-purchase"?"bg-red-100 text-red-700":"bg-gray-50 text-gray-600 hover:bg-gray-100"}
          `,children:[s.jsx(dl,{className:"w-4 h-4"}),"Sin Precio Compra"]}),s.jsxs("button",{onClick:()=>c(f=>({...f,isProduction:!f.isProduction})),className:`
            px-3 py-1.5 rounded-full text-sm font-medium transition-colors inline-flex items-center gap-1.5
            ${o.isProduction?"bg-amber-100 text-amber-700":"bg-gray-50 text-gray-600 hover:bg-gray-100"}
          `,children:[s.jsx(ze,{className:"w-4 h-4"}),"Producción"]}),s.jsxs("button",{onClick:()=>c(f=>({...f,forSale:!f.forSale})),className:`
            px-3 py-1.5 rounded-full text-sm font-medium transition-colors inline-flex items-center gap-1.5
            ${o.forSale?"bg-blue-100 text-blue-700":"bg-gray-50 text-gray-600 hover:bg-gray-100"}
          `,children:[s.jsx(Oi,{className:"w-4 h-4"}),"Venta"]}),s.jsxs("button",{onClick:()=>c(f=>({...f,enabled:f.enabled==="all"?"enabled":f.enabled==="enabled"?"disabled":"all"})),className:`
            px-3 py-1.5 rounded-full text-sm font-medium transition-colors inline-flex items-center gap-1.5
            ${o.enabled!=="all"?o.enabled==="enabled"?"bg-green-100 text-green-700":"bg-red-100 text-red-700":"bg-gray-50 text-gray-600 hover:bg-gray-100"}
          `,children:[s.jsx(Bn,{className:"w-4 h-4"}),o.enabled==="all"?"Estado":o.enabled==="enabled"?"Habilitados":"Deshabilitados"]}),s.jsxs("button",{onClick:()=>c(f=>({...f,sortDirection:f.sortDirection==="asc"?"desc":"asc"})),className:`
            px-3 py-1.5 rounded-full text-sm font-medium transition-colors inline-flex items-center gap-1.5
            ${o.sortBy!=="updated"||o.sortDirection!=="asc"?"bg-purple-100 text-purple-700":"bg-gray-50 text-gray-600 hover:bg-gray-100"}
          `,children:[s.jsx($n,{className:"w-4 h-4"}),o.sortBy==="updated"?"Fecha":o.sortBy==="margin"?"Margen":o.sortBy==="name"?"Nombre":"Precio",o.sortDirection==="asc"?" ↑":" ↓"]})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[p&&s.jsx(E,{variant:"outline",size:"sm",onClick:x,className:"text-sm h-8",children:"Limpiar"}),s.jsx(E,{onClick:b,isLoading:l,disabled:l,size:"sm",className:"h-8",children:"Aplicar"})]})]})}function Qg({label:t,value:e=[],onChange:r,suggestions:n=[],error:a,className:i}){const[o,c]=y.useState(""),[l,d]=y.useState(!1),u=y.useRef(null),m=y.useRef(null);y.useEffect(()=>{const w=v=>{m.current&&!m.current.contains(v.target)&&d(!1)};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[]);const b=w=>{c(w.target.value.toUpperCase()),d(!0)},x=w=>{w.key==="Enter"&&o.trim()?(w.preventDefault(),p(o.trim())):w.key==="Backspace"&&!o&&e.length>0&&f(e[e.length-1])},p=w=>{const v=w.toUpperCase();e.includes(v)||r([...e,v]),c(""),d(!1)},f=w=>{r(e.filter(v=>v!==w))},h=w=>{var v;p(w),(v=u.current)==null||v.focus()},g=n.filter(w=>!e.includes(w)&&w.includes(o.toUpperCase()));return s.jsxs("div",{ref:m,className:"relative",children:[t&&s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),s.jsxs("div",{className:Fe("flex flex-wrap items-center gap-2 min-h-[42px] w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5","focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",a&&"border-red-500 focus-within:border-red-500 focus-within:ring-red-500",i),children:[e.map(w=>s.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm bg-blue-100 text-blue-800",children:[w,s.jsx("button",{type:"button",onClick:()=>f(w),className:"ml-1 p-0.5 hover:bg-blue-200 rounded-full transition-colors",children:s.jsx(Ve,{className:"w-3 h-3"})})]},w)),s.jsx("div",{className:"flex-1 min-w-[120px]",children:s.jsx("input",{ref:u,type:"text",className:"w-full outline-none bg-transparent text-gray-900 placeholder-gray-500 text-sm",value:o,onChange:b,onKeyDown:x,onFocus:()=>d(!0),placeholder:"Agregar etiqueta..."})})]}),a&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:a}),l&&o&&g.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:g.map(w=>s.jsxs("button",{type:"button",className:"w-full px-4 py-2 text-left text-sm hover:bg-gray-100 focus:bg-gray-100 focus:outline-none flex items-center gap-2",onClick:()=>h(w),children:[s.jsx(Gt,{className:"w-4 h-4 text-gray-400"}),w]},w))})]})}function Xg(){const[t,e]=y.useState([]),[r,n]=y.useState(!0);return y.useEffect(()=>{const i=q(H,"measures"),o=Ke(i,c=>{const l=c.val(),d=l?Object.values(l):[];e([...d].sort()),n(!1)});return()=>o()},[]),{measures:t,loading:r,addMeasure:async i=>{const o=q(H,"measures"),c=ct(o);await vt(c,i.toUpperCase())}}}function vs({value:t,onChange:e,required:r,className:n,label:a,placeholder:i="Seleccionar..."}){const{measures:o,loading:c}=Xg();return s.jsxs("div",{className:"space-y-2",children:[a&&s.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[a,r&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsxs("select",{value:t,onChange:l=>e(l.target.value),required:r,disabled:c,className:Fe("w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900","focus:border-blue-500 focus:ring-1 focus:ring-blue-500","disabled:bg-gray-50 disabled:text-gray-500",n),children:[s.jsx("option",{value:"",disabled:!0,children:c?"Cargando...":i}),!c&&o.map(l=>s.jsx("option",{value:l,children:l},l))]})]})}function Jg(){const[t,e]=y.useState([]),[r,n]=y.useState(!0);return y.useEffect(()=>{const i=q(H,"tags"),o=q(H,"products"),c=Ke(i,d=>{const u=d.val(),m=u?Object.values(u):[];e(m.sort()),n(!1)}),l=Ke(o,d=>{const u=d.val();if(u){const m=Object.values(u).flatMap(b=>b.tags||[]).filter(Boolean).map(b=>b.toUpperCase());e(b=>[...new Set([...b,...m])].sort())}});return()=>{c(),l()}},[]),{tags:t,loading:r,addTag:async i=>{const o=q(H,"tags"),c=ct(o);await vt(c,i.toUpperCase())}}}const fs="M",xn=4;function Zg(){const[t,e]=y.useState(""),[r,n]=y.useState(!0);return y.useEffect(()=>{(async()=>{try{const i=q(H,"products"),o=await Me(i);if(!o.exists()){e(`${fs}${"0".repeat(xn-1)}1`);return}const c=Object.values(o.val()),l=new RegExp(`^${fs}\\d{${xn}}$`),d=c.map(b=>b.sku).filter(b=>l.test(b)).map(b=>parseInt(b.slice(fs.length))),m=(d.length>0?Math.max(...d)+1:1).toString().padStart(xn,"0");e(`${fs}${m}`)}catch(i){console.error("Error generating SKU suggestion:",i),e("")}finally{n(!1)}})()},[]),{suggestedSku:t,loading:r}}function ha(){const[t,e]=y.useState([]),[r,n]=y.useState(!0);return y.useEffect(()=>{const a=q(H,"orders"),i=Ke(a,o=>{if(!o.exists()){e([]),n(!1);return}const l=Object.entries(o.val()).map(([d,u])=>({id:d,...u})).sort((d,u)=>new Date(u.date).getTime()-new Date(d.date).getTime());e(l),n(!1)});return()=>i()},[]),{orders:t,loading:r}}const yi={GRL:{bg:"bg-gray-100",border:"border-gray-200",text:"text-gray-800"},GFR:{bg:"bg-green-100",border:"border-green-200",text:"text-green-800"},GRE:{bg:"bg-emerald-100",border:"border-emerald-200",text:"text-emerald-800"},GTM:{bg:"bg-teal-100",border:"border-teal-200",text:"text-teal-800"},GPA:{bg:"bg-amber-100",border:"border-amber-200",text:"text-amber-800"},GSC:{bg:"bg-orange-100",border:"border-orange-200",text:"text-orange-800"},HEL:{bg:"bg-blue-100",border:"border-blue-200",text:"text-blue-800"},REF:{bg:"bg-indigo-100",border:"border-indigo-200",text:"text-indigo-800"},CON:{bg:"bg-purple-100",border:"border-purple-200",text:"text-purple-800"},FRU:{bg:"bg-rose-100",border:"border-rose-200",text:"text-rose-800"}};function ep(t){return yi[t]||yi.GRL}function Oc({providerId:t,initialData:e,onSubmit:r,onCancel:n,isLoading:a,onDirtyChange:i}){const{providers:o}=pr(),{tags:c,addTag:l}=Jg(),{suggestedSku:d}=Zg(),{unitMeasures:u,loading:m}=Sc(),{conversions:b,loading:x}=Cc(),{orders:p}=ha(),f=y.useMemo(()=>{if(!(e!=null&&e.id))return 0;const k=p.filter(de=>de.items.some(G=>G.productId===e.id));if(k.length===0)return 0;const Y=k.reduce((de,G)=>{const Se=G.items.find(X=>X.productId===e.id);return de+((Se==null?void 0:Se.quantity)||0)},0);return Number((Y/k.length).toFixed(1))},[p,e==null?void 0:e.id]),[h,g]=y.useState({name:(e==null?void 0:e.name)||"",sku:(e==null?void 0:e.sku)||"",supplierCode:(e==null?void 0:e.supplierCode)||"",purchasePackaging:(e==null?void 0:e.purchasePackaging)||"",salePackaging:(e==null?void 0:e.salePackaging)||"",order:(e==null?void 0:e.order)||0,price:(e==null?void 0:e.price)||0,desiredStock:(e==null?void 0:e.desiredStock)||0,minPackageStock:(e==null?void 0:e.minPackageStock)||0,providerId:(e==null?void 0:e.providerId)||t,tags:(e==null?void 0:e.tags)||[],isProduction:(e==null?void 0:e.isProduction)||!1,unitMeasure:(e==null?void 0:e.unitMeasure)||"",pricePerUnit:(e==null?void 0:e.pricePerUnit)||0,forSale:(e==null?void 0:e.forSale)||!1,saleUnit:(e==null?void 0:e.saleUnit)||"",salePrice:(e==null?void 0:e.salePrice)||0,saleCostPerUnit:(e==null?void 0:e.saleCostPerUnit)||0,averageOrderQuantity:f,enabled:(e==null?void 0:e.enabled)??!0}),w=y.useMemo(()=>{if(!h.price||!h.purchasePackaging||!h.saleUnit)return 0;if(h.purchasePackaging===h.saleUnit)return h.price;const k=b==null?void 0:b.find(Y=>Y.fromUnit===h.purchasePackaging&&Y.toUnit===h.saleUnit||Y.fromUnit===h.saleUnit&&Y.toUnit===h.purchasePackaging);return k?k.fromUnit===h.purchasePackaging?Number((h.price/k.factor).toFixed(2)):Number((h.price*k.factor).toFixed(2)):0},[h.price,h.purchasePackaging,h.saleUnit,b]),v=y.useMemo(()=>{if(!h.price||!h.purchasePackaging||!h.unitMeasure)return 0;if(h.purchasePackaging===h.unitMeasure)return h.price;const k=b==null?void 0:b.find(Y=>Y.fromUnit===h.purchasePackaging&&Y.toUnit===h.unitMeasure||Y.fromUnit===h.unitMeasure&&Y.toUnit===h.purchasePackaging);return k?k.fromUnit===h.purchasePackaging?Number((h.price/k.factor).toFixed(2)):Number((h.price*k.factor).toFixed(2)):0},[h.price,h.purchasePackaging,h.unitMeasure,b]),_=y.useMemo(()=>!h.salePrice||!w?0:(h.salePrice-w)/h.salePrice*100,[h.salePrice,w]);y.useEffect(()=>{h.isProduction&&v>0&&g(k=>({...k,pricePerUnit:v}))},[v,h.isProduction]),y.useEffect(()=>{h.isProduction||g(k=>({...k,pricePerUnit:0,unitMeasure:""}))},[h.isProduction]),y.useEffect(()=>{w>0&&g(k=>({...k,saleCostPerUnit:w}))},[w]);const P=(k,Y)=>{g(de=>{const G={[k]:Y};return k==="isProduction"&&Y===!0&&(G.unitMeasure=de.unitMeasure||"UNIDAD"),{...de,...G}}),i==null||i(!0)},S=async k=>{k.preventDefault(),await r(h)},ee=k=>{P("name",k.target.value.toUpperCase())},me=ep(oo(h.order));return m||x?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsxs("form",{onSubmit:S,className:"space-y-6",children:[s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(O.Title,{children:"Información Básica"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Estado:"}),s.jsxs("button",{type:"button",onClick:()=>P("enabled",!h.enabled),className:`
                  relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent 
                  transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
                  ${h.enabled?"bg-green-500":"bg-gray-200"}
                `,children:[s.jsx("span",{className:"sr-only",children:"Estado del producto"}),s.jsx("span",{className:`
                    pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 
                    transition duration-200 ease-in-out
                    ${h.enabled?"translate-x-5":"translate-x-0"}
                  `})]}),s.jsx(Bn,{className:`w-4 h-4 ${h.enabled?"text-green-500":"text-gray-400"}`})]})]})}),s.jsxs(O.Content,{className:"space-y-4",children:[s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsx(se,{label:"Nombre del producto",value:h.name,onChange:k=>P("name",k.target.value),onBlur:ee,required:!0}),s.jsx(se,{label:!e&&d?`SKU (Sugerido: ${d})`:"SKU",value:h.sku,onChange:k=>P("sku",k.target.value.toUpperCase()),required:!0})]}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Proveedor"}),s.jsx("select",{value:h.providerId,onChange:k=>P("providerId",k.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",children:o.map(k=>s.jsx("option",{value:k.id,children:k.commercialName},k.id))})]}),s.jsx(se,{label:"Código de proveedor",value:h.supplierCode,onChange:k=>P("supplierCode",k.target.value.toUpperCase()),placeholder:"Código asignado por el proveedor"})]}),s.jsx("div",{children:s.jsx(vs,{label:"Empaque de Compra",value:h.purchasePackaging,onChange:k=>P("purchasePackaging",k),required:!0,placeholder:"Seleccionar empaque de compra"})})]})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsx(O.Title,{children:"Configuración de Venta"})}),s.jsx(O.Content,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"forSale",checked:h.forSale,onChange:k=>P("forSale",k.target.checked),className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsxs("label",{htmlFor:"forSale",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[s.jsx(He,{className:"w-4 h-4"}),"Producto para venta"]})]}),h.forSale&&s.jsx("div",{className:"space-y-4 mt-4",children:s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(se,{label:"SKU",value:h.sku,onChange:k=>P("sku",k.target.value.toUpperCase()),placeholder:"Ej: P-001"}),s.jsx(vs,{label:"Unidad de Venta",value:h.saleUnit,onChange:k=>P("saleUnit",k),required:!0,placeholder:"Seleccionar unidad de venta"}),s.jsx(se,{label:"Precio de Venta",type:"number",value:h.salePrice,onChange:k=>P("salePrice",parseFloat(k.target.value)||0),min:0,step:"0.01",required:!0,isCurrency:!0})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Costo Unitario"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:h.purchasePackaging===h.saleUnit?Q(h.price):w>0?Q(w):s.jsxs("span",{className:"text-amber-600 text-base",children:["No hay conversión disponible entre ",h.purchasePackaging," y ",h.saleUnit]})}),s.jsxs("div",{className:"text-sm text-gray-500",children:["Por ",h.saleUnit||"unidad"]})]}),h.salePrice>0&&(h.purchasePackaging===h.saleUnit||w>0)&&s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Margen de Ganancia"}),s.jsxs("div",{className:"text-2xl font-bold text-blue-600 mt-1",children:[_.toFixed(1),"%"]}),s.jsxs("div",{className:"text-sm text-gray-500",children:[Q(h.salePrice-(h.purchasePackaging===h.saleUnit?h.price:w))," por ",h.saleUnit]})]}),h.saleUnit&&h.purchasePackaging!==h.saleUnit&&!w&&s.jsxs("div",{className:"flex items-center gap-2 text-amber-600 bg-amber-50 p-3 rounded-lg",children:[s.jsx(yr,{className:"w-4 h-4 flex-shrink-0"}),s.jsxs("div",{className:"text-sm",children:["Agregue una conversión entre ",s.jsx("strong",{children:h.purchasePackaging})," y ",s.jsx("strong",{children:h.saleUnit})," en la gestión de unidades"]})]})]})]})})]})})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsx(O.Title,{children:"Configuración de Material"})}),s.jsx(O.Content,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"isProduction",checked:h.isProduction,onChange:k=>P("isProduction",k.target.checked),className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsxs("label",{htmlFor:"isProduction",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[s.jsx(Ht,{className:"w-4 h-4"}),"Material de producción"]})]}),h.isProduction&&s.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2",children:[s.jsx("div",{className:"space-y-4",children:s.jsx(vs,{label:"Unidad de Medida",value:h.unitMeasure||"UNIDAD",onChange:k=>P("unitMeasure",k),required:!0,placeholder:"Seleccionar unidad de medida"})}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Costo por Unidad"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:h.purchasePackaging===h.unitMeasure?Q(h.price):v>0?Q(v):s.jsxs("span",{className:"text-amber-600 text-base",children:["No hay conversión disponible entre ",h.purchasePackaging," y ",h.unitMeasure]})}),s.jsxs("div",{className:"text-sm text-gray-500",children:["Por ",h.unitMeasure||"unidad"]})]}),h.unitMeasure&&h.purchasePackaging!==h.unitMeasure&&!v&&s.jsxs("div",{className:"flex items-center gap-2 text-amber-600 bg-amber-50 p-3 rounded-lg mt-3",children:[s.jsx(yr,{className:"w-4 h-4 flex-shrink-0"}),s.jsxs("div",{className:"text-sm",children:["Agregue una conversión entre ",s.jsx("strong",{children:h.purchasePackaging})," y ",s.jsx("strong",{children:h.unitMeasure})," en la gestión de unidades"]})]})]})]})]})})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsx(O.Title,{children:"Etiquetas y Orden"})}),s.jsxs(O.Content,{className:"space-y-4",children:[s.jsx(Qg,{label:"Etiquetas",value:h.tags,onChange:async k=>{P("tags",k);for(const Y of k)c.includes(Y)||await l(Y)},suggestions:c}),s.jsx("div",{className:`rounded-lg p-4 border ${me.bg} ${me.border}`,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("label",{className:`text-sm font-medium ${me.text}`,children:"Orden del Producto"}),s.jsx("div",{className:`text-lg font-bold mt-1 ${me.text}`,children:co(h.order)})]}),s.jsx($n,{className:`w-5 h-5 ${me.text}`})]})})]})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsx(O.Title,{children:"Precio y Stock"})}),s.jsxs(O.Content,{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(se,{label:`Precio de Compra (por ${h.purchasePackaging||"unidad"})`,value:h.price,onChange:k=>P("price",parseFloat(k.target.value)||0),min:0,required:!0,isCurrency:!0}),s.jsx("p",{className:"text-sm text-gray-500",children:"Este es el precio de compra según el empaque de compra especificado"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx(se,{label:`Stock Mínimo (${h.purchasePackaging||"unidades"})`,type:"number",value:h.minPackageStock,onChange:k=>P("minPackageStock",parseInt(k.target.value)||0),min:0,required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Nivel mínimo de stock en empaques de compra"})]}),s.jsxs("div",{children:[s.jsx(se,{label:`Stock Deseado (${h.purchasePackaging||"unidades"})`,type:"number",value:h.desiredStock,onChange:k=>P("desiredStock",parseInt(k.target.value)||0),min:0,required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Nivel óptimo de stock en empaques de compra"})]}),s.jsx("div",{children:s.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Stock Promedio"}),s.jsxs("div",{className:"mt-1 text-2xl font-bold text-gray-900",children:[(e==null?void 0:e.averageOrderQuantity)||0," ",h.purchasePackaging]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Promedio de compra por orden"}),(e==null?void 0:e.averageOrderQuantity)&&e.averageOrderQuantity<h.desiredStock&&s.jsxs("div",{className:"flex items-center gap-2 text-amber-600 text-xs mt-2",children:[s.jsx(yr,{className:"w-3 h-3 flex-shrink-0"}),s.jsx("span",{children:"El promedio está por debajo del stock deseado"})]})]})})]}),h.minPackageStock>h.desiredStock&&s.jsxs("div",{className:"flex items-center gap-2 text-red-600 bg-red-50 p-3 rounded-lg",children:[s.jsx(yr,{className:"w-4 h-4 flex-shrink-0"}),s.jsx("div",{className:"text-sm",children:"El stock mínimo no puede ser mayor al stock deseado"})]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-4",children:[s.jsx(E,{type:"button",variant:"outline",onClick:n,disabled:a,children:"Cancelar"}),s.jsxs(E,{type:"submit",isLoading:a,children:[e?"Actualizar":"Crear"," Producto"]})]})]})}function tp({providerId:t,initialData:e,onSubmit:r,onCancel:n,isLoading:a}){const[i,o]=y.useState(!1),c=()=>{i?confirm("¿Está seguro que desea descartar los cambios?")&&n():n()};return s.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col overflow-hidden",children:[s.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white",children:s.jsxs("div",{className:"flex items-center justify-between px-4 h-14",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ze,{className:"w-6 h-6"}),s.jsxs("h2",{className:"text-lg font-semibold",children:[e?"Editar":"Nuevo"," Producto"]})]}),s.jsx(E,{variant:"ghost",size:"sm",onClick:c,className:"p-2 hover:bg-white/10 text-white rounded-full",children:s.jsx(Ve,{className:"w-5 h-5"})})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50",children:s.jsx("div",{className:"max-w-4xl mx-auto px-4 py-6",children:s.jsx(Oc,{providerId:t,initialData:e,onSubmit:r,onCancel:n,isLoading:a,onDirtyChange:o})})})]})}function Ac(t){const e=t.toString().padStart(5,"0"),r=parseInt(e.slice(0,2))-1;return r>=0&&r<zt.length?zt[r].code:zt[0].code}function rp(t){const e=t.toString().padStart(5,"0");return parseInt(e.slice(2))}function sp(t,e){const r=zt.findIndex(n=>n.code===t)+1;return parseInt(`${r.toString().padStart(2,"0")}${e.toString().padStart(3,"0")}`)}function np(t){const e=Ac(t),r=rp(t);return`${e}-${r.toString().padStart(3,"0")}`}const bn={terms:"",margin:"all",price:"all",codes:"all",isProduction:!1,forSale:!1,enabled:"all",sortBy:"updated",sortDirection:"asc"};function ap(){const{providers:t}=pr(),[e,r]=y.useState(""),{products:n,loading:a,addProduct:i,updateProduct:o,deleteProduct:c}=kc(e),{products:l,loading:d}=Ut(),[u,m]=y.useState([]),[b,x]=y.useState(!1),[p,f]=y.useState(null),[h,g]=y.useState(!1),[w,v]=y.useState(null),[_,P]=y.useState(!1),[S,ee]=y.useState(bn),[me,k]=y.useState(!1),Y=l,G=(R=>{let D=0;return R.terms&&D++,R.margin!=="all"&&D++,R.price!=="all"&&D++,R.codes!=="all"&&D++,R.isProduction&&D++,R.forSale&&D++,R.enabled!=="all"&&D++,(R.sortBy!=="updated"||R.sortDirection!=="asc")&&D++,D})(S);y.useEffect(()=>{!a&&!d&&Se()},[e,a,d]);const Se=y.useCallback(()=>{let R=[...Y];if(e&&(R=R.filter(D=>D.providerId===e)),S.terms){const D=S.terms.toLowerCase();R=R.filter(ie=>{var $e,$t;return ie.name.toLowerCase().includes(D)||ie.sku.toLowerCase().includes(D)||(($e=ie.supplierCode)==null?void 0:$e.toLowerCase().includes(D))||(($t=ie.tags)==null?void 0:$t.some(De=>De.toLowerCase().includes(D)))})}S.margin!=="all"&&(R=R.filter(D=>{const ie=D.forSale&&D.salePrice&&D.saleCostPerUnit?(D.salePrice-D.saleCostPerUnit)/D.salePrice*100:null;switch(S.margin){case"red":return ie!==null&&ie<0;case"orange":return ie!==null&&ie>=0&&ie<=5;case"green":return ie!==null&&ie>5;default:return!0}})),S.price==="no-purchase"?R=R.filter(D=>!D.price||D.price===0||D.price===null):S.price==="no-sale"&&(R=R.filter(D=>D.forSale&&(!D.salePrice||D.salePrice<=0))),S.isProduction&&(R=R.filter(D=>D.isProduction)),S.forSale&&(R=R.filter(D=>D.forSale)),S.enabled!=="all"&&(R=R.filter(D=>S.enabled==="enabled"?D.enabled!==!1:D.enabled===!1)),R.sort((D,ie)=>{const $e=S.sortDirection==="asc"?1:-1;switch(S.sortBy){case"updated":return((D.lastUpdated||0)-(ie.lastUpdated||0))*$e;case"margin":{const $t=D.forSale&&D.salePrice&&D.saleCostPerUnit?(D.salePrice-D.saleCostPerUnit)/D.salePrice*100:-1/0,De=ie.forSale&&ie.salePrice&&ie.saleCostPerUnit?(ie.salePrice-ie.saleCostPerUnit)/ie.salePrice*100:-1/0;return($t-De)*$e}case"name":return D.name.localeCompare(ie.name)*$e;case"price":return((D.price||0)-(ie.price||0))*$e;default:return 0}}),m(R),k(!0)},[Y,S,e]),X=R=>{r(R),ee(bn),k(!1)},Pe=y.useCallback((R,D)=>{ee(R),Se()},[Se]),J=y.useCallback(()=>{ee(bn),k(!1),Se()},[Se]),xe=async R=>{g(!0);try{if(p)await o(p.id,R),U();else{const D=zt[0].code,ie=Y.filter($t=>Ac($t.order)===D),$e=sp(D,ie.length+1);await i({...R,order:$e}),U()}}catch(D){console.error("Error al guardar producto:",D),A.error("Error al guardar el producto")}finally{g(!1)}},F=async R=>{v(R)},W=async()=>{if(w)try{await c(w.id),v(null)}catch{A.error("Error al eliminar el producto")}},U=()=>{x(!1),f(null)},he=R=>{f(R),x(!0)},V=()=>{if(!e){A.error("Seleccione un proveedor primero");return}if(p){const R=Ue({isOpen:!0,onClose:()=>{},title:"Advertencia",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-amber-600",children:"Hay un producto en edición. ¿Desea descartar los cambios y crear uno nuevo?"}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(E,{variant:"outline",onClick:()=>R.close(),children:"Cancelar"}),s.jsx(E,{onClick:()=>{f(null),x(!0),R.close()},children:"Continuar"})]})]})})}else x(!0)};if(b)return s.jsx(tp,{providerId:(p==null?void 0:p.providerId)||e,initialData:p||void 0,onSubmit:xe,onCancel:U,isLoading:h});const te=a||d,pe=me?u:e?n:l;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-end gap-2",children:[s.jsx("div",{className:"flex-1",children:s.jsx(Pc,{providers:t,selectedProviderId:e,onChange:X})}),s.jsxs("div",{className:"relative",children:[s.jsx(E,{variant:_?"primary":"outline",onClick:()=>P(!_),className:`h-[48px] w-[48px] flex items-center justify-center flex-shrink-0 ${G>0?"text-blue-600 border-blue-200 bg-blue-50":""}`,title:"Filtros avanzados",children:s.jsx(Ii,{className:"w-5 h-5"})}),G>0&&s.jsx("div",{className:"absolute -top-2 -right-2 w-5 h-5 flex items-center justify-center bg-blue-500 text-white text-xs font-medium rounded-full",children:G})]})]})}),e&&s.jsx("div",{className:"flex-shrink-0 w-full md:w-auto",children:s.jsxs(E,{onClick:V,className:"w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white h-[48px] px-6 rounded-lg shadow-sm hover:shadow transition-all",children:[s.jsx(Gt,{className:"w-5 h-5 mr-2"}),s.jsx("span",{className:"whitespace-nowrap",children:"Nuevo Producto"})]})})]}),_&&s.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg shadow-inner",children:s.jsx(Kg,{products:Y,onFilter:Pe,onClear:J,onClose:()=>P(!1),initialFilters:S,onUpdateFilters:ee})}),te?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):pe.length>0?s.jsx(Yg,{products:pe,onEdit:he,onDelete:F}):s.jsx("div",{className:"flex flex-col items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:me?s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-gray-500 text-center mb-4",children:"No se encontraron productos que coincidan con los filtros aplicados"}),s.jsx(E,{variant:"outline",size:"sm",onClick:J,className:"text-sm",children:"Limpiar filtros"})]}):s.jsx("p",{className:"text-gray-500 text-center",children:e?"No hay productos para este proveedor":"Seleccione un proveedor para ver sus productos"})}),s.jsx(Ue,{isOpen:!!w,onClose:()=>v(null),title:"Eliminar producto",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("p",{className:"text-amber-600",children:['¿Está seguro que desea eliminar el producto "',w==null?void 0:w.name,'"?']}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(E,{variant:"outline",onClick:()=>v(null),children:"Cancelar"}),s.jsx(E,{onClick:W,children:"Eliminar"})]})]})})]})}const Ec=`
  /* Reset */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  /* Base styles */
  body {
    font-family: 'Courier New', monospace;
    font-size: 12px;
    line-height: 1.2;
    background: #f3f4f6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Preview Container */
  .content {
    width: 80mm;
    background: white;
    margin: 20px auto;
    padding: 2mm;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border-radius: 4px;
  }

  /* Header */
  .header {
    margin-bottom: 3mm;
    border-bottom: 1px dashed #000;
    padding-bottom: 2mm;
  }

  .header div {
    margin-bottom: 1mm;
    font-weight: bold;
  }

  /* Business Info - Larger */
  .header div:nth-child(1) {
    font-size: 14px;
  }

  /* Owner Info */
  .header div:nth-child(2) {
    font-size: 12px;
  }

  /* Date - Smaller */
  .header div:nth-child(3) {
    font-size: 10px;
  }

  /* Table */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 2mm;
  }

  tr {
    border-bottom: none;
  }

  td {
    padding: 0.5mm 1mm;
    font-size: 12px;
    vertical-align: top;
  }

  td.quantity {
    white-space: nowrap;
    padding-right: 2mm;
    width: 1%;
    font-weight: bold;
  }

  td.name {
    word-break: break-word;
  }

  /* Summary Section */
  .summary {
    margin-top: 3mm;
    padding-top: 2mm;
    border-top: 1px dashed #000;
  }

  .summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1mm;
    font-size: 12px;
  }

  .summary-label {
    font-weight: normal;
  }

  .summary-value {
    font-weight: bold;
  }

  /* Print Controls */
  .controls {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 100;
  }

  .print-button {
    padding: 12px 24px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .print-button:hover {
    background: #1d4ed8;
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .print-button:active {
    transform: translateY(0);
  }

  .print-button:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
  }

  .print-button svg {
    width: 16px;
    height: 16px;
  }

  /* Print Media Styles */
  @media print {
    @page {
      size: 80mm auto;
      margin: 0;
    }

    body {
      width: 80mm;
      margin: 0;
      padding: 0;
      background: white;
      min-height: auto;
    }

    .content {
      width: 100%;
      margin: 0;
      padding: 2mm;
      box-shadow: none;
      border-radius: 0;
    }

    .controls {
      display: none !important;
    }

    /* Print header styles */
    .header {
      margin-bottom: 3mm;
      padding-bottom: 2mm;
    }

    .header div:nth-child(1) {
      font-size: 14px;
      font-weight: bold;
    }

    .header div:nth-child(2) {
      font-size: 12px;
      font-weight: bold;
    }

    .header div:nth-child(3) {
      font-size: 10px;
    }

    /* Print table styles */
    table {
      margin: 2mm 0;
    }

    td {
      padding: 0.5mm 1mm;
      font-size: 12px;
    }

    td.quantity {
      font-weight: bold;
    }

    /* Print summary styles */
    .summary {
      margin-top: 3mm;
      padding-top: 2mm;
      border-top: 1px dashed #000;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1mm;
      font-size: 12px;
    }

    .summary-label {
      font-weight: normal;
    }

    .summary-value {
      font-weight: bold;
    }
  }
`,Mc=`
  let isPrinting = false;
  let retryCount = 0;
  const MAX_RETRIES = 3;

  function createPrintIcon() {
    return \`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
      </svg>
    \`;
  }

  function showError(message) {
    const existingError = document.querySelector('.error-message');
    if (existingError) {
      existingError.remove();
    }

    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.textContent = message;
    document.body.appendChild(errorDiv);

    const printButton = document.getElementById('print-button');
    if (printButton) {
      printButton.disabled = false;
    }

    // Auto-hide error after 5 seconds
    setTimeout(() => {
      errorDiv.remove();
    }, 5000);
  }

  function handlePrint() {
    if (isPrinting) return;

    try {
      const printButton = document.getElementById('print-button');
      printButton.disabled = true;
      isPrinting = true;

      window.print();

      // Handle print completion
      window.onafterprint = () => {
        isPrinting = false;
        setTimeout(() => {
          window.close();
        }, 100);
      };

      // Timeout handler for print dialog
      setTimeout(() => {
        if (!window.closed && isPrinting) {
          isPrinting = false;
          printButton.disabled = false;
          
          if (retryCount < MAX_RETRIES) {
            retryCount++;
            showError('La impresión está tardando más de lo esperado. Intente nuevamente.');
          } else {
            showError('No se pudo completar la impresión. Por favor, cierre esta ventana e intente nuevamente.');
          }
        }
      }, 2000);

    } catch (error) {
      console.error('Print error:', error);
      isPrinting = false;
      showError('Error al imprimir. Por favor, intente nuevamente.');
    }
  }

  function setupPrintButton() {
    const printButton = document.getElementById('print-button');
    if (printButton) {
      printButton.innerHTML = createPrintIcon() + 'Imprimir';
      printButton.onclick = handlePrint;
    }
  }

  window.onload = () => {
    try {
      setupPrintButton();
    } catch (error) {
      console.error('Setup error:', error);
      showError('Error al inicializar. Por favor, use el botón Imprimir.');
    }
  };

  window.onerror = (message, source, lineno, colno, error) => {
    console.error('Print error:', { message, source, lineno, colno, error });
    showError('Ocurrió un error inesperado. Por favor, intente nuevamente.');
    return false;
  };
`;function ip(t,e){const r=fe(new Date,"dd/MM/yyyy HH:mm",{locale:ye}),n=t.materials.map(a=>{const i=e.find(o=>o.id===a.id);return i?`
        <tr>
          <td class="quantity text-left">${a.quantity} ${a.unit}</td>
          <td class="name text-right">${i.name}</td>
        </tr>
      `:""}).join("");return`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Receta: ${t.name}</title>
        <style>
          ${Ec}
          
          /* Additional styles for recipe printing */
          .recipe-header {
            text-align: center;
            margin: 3mm 0;
            padding-bottom: 2mm;
            border-bottom: 1px dashed #000;
          }
          
          .recipe-header h1 {
            font-size: 16px;
            font-weight: bold;
            margin: 0 0 2mm 0;
          }
          
          .recipe-header p {
            font-size: 12px;
            margin: 0;
          }
          
          table {
            width: 100%;
            border-collapse: collapse;
            margin: 3mm 0;
          }
          
          th {
            font-size: 12px;
            font-weight: bold;
            padding: 1mm 0;
            text-align: inherit;
          }
          
          td {
            padding: 1mm 0;
            font-size: 12px;
            vertical-align: top;
          }
          
          td.quantity {
            width: 30%;
            font-weight: bold;
            white-space: nowrap;
            text-align: left;
          }
          
          td.name {
            width: 70%;
            text-align: right;
            padding-left: 2mm;
          }
          
          .text-left {
            text-align: left;
          }
          
          .text-right {
            text-align: right;
          }
          
          .notes {
            margin-top: 3mm;
            padding-top: 2mm;
            border-top: 1px dashed #000;
          }
          
          .notes h2 {
            font-size: 12px;
            font-weight: bold;
            margin: 0 0 1mm 0;
          }
          
          .notes p {
            font-size: 12px;
            margin: 0;
            white-space: pre-line;
          }
        </style>
      </head>
      <body>
        <div class="content">
          <div class="header">
            <div>${Yt.name}</div>
            <div>${Yt.owner}</div>
            <div>Fecha: ${r}</div>
          </div>

          <div class="recipe-header">
            <h1>${t.name}</h1>
            <p>Rendimiento: ${t.yield} ${t.yieldUnit}</p>
          </div>

          <table>
            <thead>
              <tr>
                <th class="text-left">Cantidad</th>
                <th class="text-right">Material</th>
              </tr>
            </thead>
            <tbody>
              ${n}
            </tbody>
          </table>

          ${t.notes?`
            <div class="notes">
              <h2>Notas:</h2>
              <p>${t.notes.replace(/\n/g,"<br>")}</p>
            </div>
          `:""}
        </div>

        <div class="controls">
          <button id="print-button" class="print-button">
            Imprimir
          </button>
        </div>

        <script>${Mc}<\/script>
      </body>
    </html>
  `}function op({recipes:t,onEdit:e,onDelete:r}){var c;const[n,a]=y.useState(null),{products:i}=Ut(),o=l=>{const d=ip(l,i),u=window.open("","_blank");if(!u)throw new Error("No se pudo crear la pestaña de impresión");u.document.write(d),u.document.close()};return t.length===0?s.jsx("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed",children:s.jsx("p",{className:"text-gray-500",children:"No hay recetas para mostrar"})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:t.map(l=>{var p;const d=(p=l.costHistory)==null?void 0:p[l.costHistory.length-1],u=l.costThreshold||20,m=d&&Math.abs(d.changePercentage)>u,b=(d==null?void 0:d.changePercentage)>0,x=l.salePrice&&l.unitCost?(l.salePrice-l.unitCost)/l.unitCost*100:null;return s.jsxs("div",{className:`
                bg-white rounded-lg shadow-sm p-4 space-y-4 transition-colors
                ${m?`border-2 ${b?"border-red-500":"border-green-500"}`:"border"}
                ${m&&b?"bg-red-50":m?"bg-green-50":""}
              `,children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"text-lg font-semibold flex-1 break-words",children:l.name}),s.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.isBase&&s.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800",children:[s.jsx(Ht,{className:"w-3 h-3 mr-1"}),"Base"]}),l.forSale&&s.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:[s.jsx(He,{className:"w-3 h-3 mr-1"}),"Venta"]})]})]}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Rendimiento: ",l.yield," ",l.yieldUnit]}),l.sku&&s.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",l.sku]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Costo Total:"}),s.jsx("p",{className:"font-medium",children:Q(l.totalCost)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Costo Unitario:"}),s.jsxs("p",{className:"font-medium",children:[Q(l.unitCost)," / ",l.yieldUnit]})]})]}),l.forSale&&s.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Precio de Venta:"}),s.jsx("p",{className:"font-medium text-blue-600",children:Q(l.salePrice||0)})]}),x!==null&&s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Margen:"}),s.jsxs("p",{className:`font-medium ${x>=l.profitPercentage?"text-green-600":"text-amber-600"}`,children:[x.toFixed(1),"%"]})]})]}),m&&s.jsxs("div",{className:`p-2 rounded-lg ${b?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:[s.jsxs("div",{className:"font-medium",children:[b?"Aumento":"Reducción"," significativo"]}),s.jsxs("div",{className:"text-sm",children:[d.changePercentage>0?"+":"",d.changePercentage.toFixed(2),"% en el último mes"]})]}),s.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t",children:["Última actualización: ",fe(l.lastUpdated,"d 'de' MMMM, yyyy HH:mm",{locale:ye})]}),s.jsxs("div",{className:"flex justify-end gap-1 pt-2 border-t",children:[s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>a(l),title:"Ver historial de costos",className:"w-9 h-9 p-0",children:s.jsx(Vn,{className:"w-4 h-4"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>o(l),title:"Imprimir receta",className:"w-9 h-9 p-0",children:s.jsx(Fi,{className:"w-4 h-4"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>e(l),title:"Editar receta",className:"w-9 h-9 p-0",children:s.jsx(Ln,{className:"w-4 h-4"})}),s.jsx(E,{variant:"ghost",size:"sm",onClick:()=>r(l),title:"Eliminar receta",className:"w-9 h-9 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx(Ar,{className:"w-4 h-4"})})]})]},l.id)})}),s.jsx(Ue,{isOpen:!!n,onClose:()=>a(null),title:`Historial de Costos - ${n==null?void 0:n.name}`,children:s.jsxs("div",{className:"space-y-4",children:[(c=n==null?void 0:n.costHistory)!=null&&c.length?s.jsx("div",{className:"space-y-3",children:n.costHistory.map((l,d)=>{const u=Math.abs(l.changePercentage)>(n.costThreshold||20),m=l.changePercentage>0;return s.jsxs("div",{className:`p-3 rounded-lg ${u?m?"bg-red-50 border-2 border-red-500":"bg-green-50 border-2 border-green-500":"bg-gray-50 border border-gray-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:fe(l.date,"d 'de' MMMM, yyyy HH:mm",{locale:ye})}),s.jsxs("span",{className:`text-sm font-medium ${l.changePercentage>0?"text-red-600":"text-green-600"}`,children:[l.changePercentage>0?"+":"",l.changePercentage.toFixed(2),"%"]})]}),s.jsxs("div",{className:"mt-1",children:[s.jsx("span",{className:"font-medium",children:Q(l.unitCost)}),s.jsxs("span",{className:"text-gray-500",children:[" ","/ ",n.yieldUnit]})]})]},`${l.date}-${d}`)})}):s.jsx("p",{className:"text-gray-500 text-center py-4",children:"No hay historial de costos disponible"}),s.jsx("div",{className:"flex justify-end",children:s.jsx(E,{onClick:()=>a(null),children:"Cerrar"})})]})})]})}const Yr="monthlyFixedCosts";async function ma(){try{if(!_e.currentUser)throw new oe("User not authenticated");const t=q(H,Yr);(await Me(t)).exists()||await vt(t,{})}catch(t){throw new oe("Failed to initialize fixed costs collection",{cause:t})}}async function cp(t){try{if(!_e.currentUser)throw new oe("User not authenticated");await ma();const e=await Tc(t.month,t.year);if(e){const a=q(H,`${Yr}/${e.id}`);return await vt(a,{...t,lastUpdated:Date.now()}),e.id}const r=q(H,Yr),n=ct(r);if(!n.key)throw new oe("Failed to generate document ID");return await vt(n,{...t,lastUpdated:Date.now()}),n.key}catch(e){throw e instanceof oe?e:new oe("Failed to save monthly fixed costs",{cause:e})}}async function Tc(t,e){try{if(!_e.currentUser)throw new oe("User not authenticated");await ma();const r=q(H,Yr),n=sr(r,nr("month"),ar(t)),a=await Me(n);if(!a.exists())return null;const o=Object.entries(a.val()).find(([c,l])=>l.year===e);return o?{id:o[0],...o[1]}:null}catch(r){throw r instanceof oe?r:new oe("Failed to get monthly fixed costs",{cause:r})}}async function lp(){try{if(!_e.currentUser)throw new oe("User not authenticated");const t=new Date;return Tc(t.getMonth()+1,t.getFullYear())}catch(t){throw t instanceof oe?t:new oe("Failed to get current month fixed costs",{cause:t})}}async function dp(){try{if(!_e.currentUser)throw new oe("User not authenticated");await ma();const t=q(H,Yr),e=await Me(t);return e.exists()?Object.entries(e.val()).map(([r,n])=>({id:r,...n})).sort((r,n)=>n.lastUpdated-r.lastUpdated):[]}catch(t){throw t instanceof oe?t:new oe("Failed to get fixed costs history",{cause:t})}}function Rc(){const[t,e]=y.useState(null),[r,n]=y.useState([]),[a,i]=y.useState(!0),[o,c]=y.useState(null);y.useEffect(()=>{l()},[]);const l=async()=>{try{i(!0),c(null);const[u,m]=await Promise.all([lp(),dp()]);e(u),n(m)}catch(u){console.error("Error loading fixed costs:",u),c("Error al cargar los costos fijos")}finally{i(!1)}};return{currentCosts:t,history:r,loading:a,error:o,updateFixedCosts:async u=>{try{c(null),await cp(u),await l(),A.success("Costos fijos actualizados exitosamente")}catch(m){throw console.error("Error updating fixed costs:",m),c("Error al actualizar los costos fijos"),m}},loadData:l}}function wi(t,e){return t<=0?0:Number((e/t*100).toFixed(2))}function up(t,e,r){if(t.type==="product"){const n=e.find(a=>a.id===t.id);return n?t.quantity*(n.pricePerUnit||0):0}else{const n=r.find(a=>a.id===t.id);return n?t.quantity*n.unitCost:0}}function Fs(t,e,r,n,a,i,o){const c=t.reduce((p,f)=>p+up(f,e,r),0),l=c*a/100,d=Number((c+l).toFixed(2)),u=n>0?Number((d/n).toFixed(2)):0,m=i/100,b=m<1?Number((u/(1-m)).toFixed(2)):Number((u*2).toFixed(2));let x;return o&&Math.abs(u-o)>.01&&(x=[{date:Date.now(),unitCost:u,changePercentage:Number(((u-o)/o*100).toFixed(2))}]),{totalCost:d,unitCost:u,suggestedPrice:b,costHistory:x}}function Ic(t,e,r,n=new Set){var o;if(n.has(r))return t;n.add(r);const a=t.filter(c=>c.materials.some(l=>l.type==="recipe"&&l.id===r));let i=[...t];for(const c of a){const l=Fs(c.materials,e,i,c.yield,c.fixedCostPercentage,c.profitPercentage,c.unitCost),d=i.findIndex(u=>u.id===c.id);if(d!==-1){const u=c.costHistory||[];(o=l.costHistory)!=null&&o[0]&&u.push(l.costHistory[0]),i[d]={...c,totalCost:l.totalCost,unitCost:l.unitCost,suggestedPrice:l.suggestedPrice,costHistory:u,lastUpdated:Date.now()},i=Ic(i,e,c.id,n)}}return i}function hp({materials:t,products:e,recipes:r,onRemove:n}){if(t.length===0)return s.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[s.jsx(ze,{className:"w-8 h-8 text-gray-400 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500",children:"No hay materiales agregados"}),s.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Utilice el buscador para agregar materiales a la receta"})]});const a=t.reduce((i,o)=>i+o.totalCost,0);return s.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200 bg-white",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-sm font-medium text-gray-500",children:"Material"}),s.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-sm font-medium text-gray-500 w-32",children:"Cantidad"}),s.jsx("th",{scope:"col",className:"px-4 py-3 text-right text-sm font-medium text-gray-500 w-32",children:"Costo"}),s.jsx("th",{scope:"col",className:"px-4 py-3 text-center text-sm font-medium text-gray-500 w-16",children:s.jsx("span",{className:"sr-only",children:"Acciones"})})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:t.map((i,o)=>{const c=e.find(m=>m.id===i.id),l=r.find(m=>m.id===i.id),d=c||l;if(!d)return null;const u=i.type==="recipe";return s.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[s.jsx("td",{className:"px-4 py-3",children:s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[u?s.jsx(Ht,{className:"w-4 h-4 text-amber-500 flex-shrink-0"}):s.jsx(ze,{className:"w-4 h-4 text-blue-500 flex-shrink-0"}),s.jsx("span",{className:"font-medium text-gray-900 truncate",children:d.name})]}),s.jsx("div",{className:"mt-1 flex items-center gap-3 text-sm text-gray-500",children:u?s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Ht,{className:"w-4 h-4"}),"Receta Base"]}):s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ze,{className:"w-4 h-4"}),c.sku]}),c.unitMeasure&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Us,{className:"w-4 h-4"}),c.unitMeasure]})]})})]})})}),s.jsx("td",{className:"px-4 py-3 text-center",children:s.jsxs("span",{className:"font-medium",children:[i.quantity," ",i.unit]})}),s.jsxs("td",{className:"px-4 py-3 text-right",children:[s.jsx("div",{className:"font-medium text-gray-900",children:Q(i.totalCost)}),s.jsxs("div",{className:"text-sm text-gray-500",children:[Q(i.unitCost)," c/u"]})]}),s.jsx("td",{className:"px-4 py-3 text-center",children:s.jsx(E,{type:"button",variant:"ghost",size:"sm",onClick:()=>n(o),className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-1 rounded-full",children:s.jsx(Ar,{className:"w-4 h-4"})})})]},`${i.type}-${i.id}-${o}`)})}),s.jsx("tfoot",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"px-4 py-3 text-sm font-medium text-gray-500",children:"Total Materiales"}),s.jsx("td",{colSpan:2,className:"px-4 py-3 text-right",children:s.jsx("span",{className:"font-bold text-blue-600",children:Q(a)})})]})})]})})}function mp({products:t,recipes:e,onSelect:r,selectedMaterials:n}){const[a,i]=y.useState(""),[o,c]=y.useState(null),[l,d]=y.useState(0),[u,m]=y.useState(!1),b=t.filter(g=>g.isProduction&&!n.includes(g.id)),x=e.filter(g=>g.isBase&&!n.includes(g.id)),p=[...b.map(g=>({id:g.id,type:"product",name:g.name,sku:g.sku,unit:g.unitMeasure||g.purchasePackaging,unitCost:g.pricePerUnit||0})),...x.map(g=>({id:g.id,type:"recipe",name:g.name,unit:g.yieldUnit,unitCost:g.unitCost}))].filter(g=>{const w=a.toLowerCase();return g.name.toLowerCase().includes(w)||g.type==="product"&&g.sku.toLowerCase().includes(w)}).sort((g,w)=>{const v=g.name.toLowerCase().startsWith(a.toLowerCase()),_=w.name.toLowerCase().startsWith(a.toLowerCase());return v&&!_?-1:!v&&_?1:g.name.localeCompare(w.name)}).slice(0,5),f=g=>{c({id:g.id,type:g.type}),i(g.name),m(!1)},h=()=>{o&&l>0&&(r(o,l),c(null),i(""),d(0))};return s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"relative",children:[s.jsx(se,{placeholder:"Buscar material...",value:a,onChange:g=>{i(g.target.value),m(!0),c(null)},onFocus:()=>m(!0),className:"pl-10"}),s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]}),u&&a&&p.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg",children:p.map(g=>s.jsxs("button",{type:"button",onClick:()=>f(g),className:"w-full px-4 py-2 text-left hover:bg-gray-50",children:[s.jsx("div",{className:"font-medium",children:g.name}),s.jsxs("div",{className:"text-sm text-gray-500 flex items-center justify-between",children:[s.jsx("span",{children:g.type==="product"?g.sku:"Receta Base"}),s.jsxs("span",{className:"text-blue-600 font-medium",children:[Q(g.unitCost)," / ",g.unit]})]})]},`${g.type}-${g.id}`))}),u&&a&&p.length===0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border rounded-md shadow-lg p-4 text-center text-gray-500",children:"No se encontraron materiales disponibles"}),!a&&s.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[b.length," materiales de producción y ",x.length," recetas base disponibles"]})]}),o&&s.jsxs("div",{className:"flex gap-2",children:[s.jsx(se,{type:"number",value:l,onChange:g=>d(Number(g.target.value)),min:0,step:"0.01",placeholder:"Cantidad",className:"flex-1"}),s.jsx(E,{type:"button",onClick:h,disabled:l<=0,children:"Agregar"})]})]})})}function fp({initialData:t,onSubmit:e,onCancel:r,isLoading:n,onDirtyChange:a,recipes:i}){const{products:o}=Ut(),{currentCosts:c}=Rc(),[l,d]=y.useState({name:(t==null?void 0:t.name)||"",yield:(t==null?void 0:t.yield)||0,yieldUnit:(t==null?void 0:t.yieldUnit)||"",materials:(t==null?void 0:t.materials)||[],fixedCostPercentage:(c==null?void 0:c.fixedCostPercentage)||(t==null?void 0:t.fixedCostPercentage)||(i.length>0?i[0].fixedCostPercentage:15),profitPercentage:(t==null?void 0:t.profitPercentage)||90,notes:(t==null?void 0:t.notes)||"",totalCost:(t==null?void 0:t.totalCost)||0,unitCost:(t==null?void 0:t.unitCost)||0,suggestedPrice:(t==null?void 0:t.suggestedPrice)||0,lastUpdated:Date.now(),costHistory:(t==null?void 0:t.costHistory)||[],costThreshold:(t==null?void 0:t.costThreshold)||20,isBase:(t==null?void 0:t.isBase)||!1,forSale:(t==null?void 0:t.forSale)||!1,sku:(t==null?void 0:t.sku)||"",salePrice:(t==null?void 0:t.salePrice)||0});y.useEffect(()=>{if(l.materials.length>0&&l.yield>0){const g=Fs(l.materials,o,i,l.yield,l.fixedCostPercentage,l.profitPercentage,t==null?void 0:t.unitCost);d(w=>({...w,totalCost:g.totalCost,unitCost:g.unitCost,suggestedPrice:g.suggestedPrice,costHistory:g.costHistory?[...w.costHistory||[],...g.costHistory]:w.costHistory}))}},[l.materials,l.yield,l.fixedCostPercentage,l.profitPercentage,o,i,t==null?void 0:t.unitCost]),y.useEffect(()=>{c!=null&&c.fixedCostPercentage&&!t&&d(g=>({...g,fixedCostPercentage:c.fixedCostPercentage}))},[c,t]);const u=(g,w)=>{d(v=>({...v,[g]:w})),a==null||a(!0)},m=async g=>{g.preventDefault(),await e(l)},b=(g,w)=>{const v=g.type==="product"?o.find(ee=>ee.id===g.id):i.find(ee=>ee.id===g.id);if(!v)return;const _=g.type==="product"?v.pricePerUnit||0:v.unitCost,P=w*_,S={id:g.id,type:g.type,quantity:w,unit:g.type==="product"?v.unitMeasure||v.purchasePackaging:v.yieldUnit,unitCost:_,totalCost:P};u("materials",[...l.materials,S])},x=g=>{const w=[...l.materials];w.splice(g,1),u("materials",w)},p=l.salePrice>0&&l.unitCost>0?(l.salePrice-l.unitCost)/l.unitCost*100:0,f=l.unitCost>0?l.unitCost/(1-l.profitPercentage/100):0,h=l.salePrice>0&&f>0?Math.abs((l.salePrice-f)/f*100):0;return s.jsxs("form",{onSubmit:m,className:"space-y-6",children:[s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsx(O.Title,{children:"Información Básica"})}),s.jsxs(O.Content,{className:"space-y-4",children:[s.jsx(se,{label:"Nombre de la receta",value:l.name,onChange:g=>u("name",g.target.value),required:!0}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsx(se,{label:"Rendimiento",type:"number",value:l.yield,onChange:g=>u("yield",parseFloat(g.target.value)||0),min:0,step:"0.01",required:!0}),s.jsx(vs,{label:"Unidad de rendimiento",value:l.yieldUnit,onChange:g=>u("yieldUnit",g),required:!0,placeholder:"Seleccionar unidad..."})]})]})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsx(O.Title,{children:"Tipo de Receta"})}),s.jsx(O.Content,{children:s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"isBase",checked:l.isBase,onChange:g=>u("isBase",g.target.checked),className:"h-4 w-4 rounded border-gray-300 text-amber-600 focus:ring-amber-500"}),s.jsxs("label",{htmlFor:"isBase",className:"flex items-center gap-2 text-sm font-medium text-amber-900",children:[s.jsx(Ht,{className:"w-4 h-4"}),"Receta base"]})]}),s.jsx("p",{className:"text-xs text-amber-700 mt-2",children:"Las recetas base son utilizadas como materiales en otras recetas"})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"forSale",checked:l.forSale,onChange:g=>u("forSale",g.target.checked),className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsxs("label",{htmlFor:"forSale",className:"flex items-center gap-2 text-sm font-medium text-blue-900",children:[s.jsx(He,{className:"w-4 h-4"}),"Receta para venta"]})]}),s.jsx("p",{className:"text-xs text-blue-700 mt-2",children:"Habilita la configuración de precios y SKU para venta"})]})]})})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(ze,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx(O.Title,{children:"Materiales"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Gestión de materiales y cantidades"})]})]})}),s.jsxs(O.Content,{className:"space-y-6",children:[s.jsx(mp,{products:o,recipes:i,onSelect:b,selectedMaterials:l.materials.map(g=>g.id)}),s.jsx(hp,{materials:l.materials,products:o,recipes:i,onRemove:x})]})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(Ui,{className:"w-5 h-5 text-green-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx(O.Title,{children:"Costos y Precios"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Gestión de costos, márgenes y precios de venta"})]})]})}),s.jsxs(O.Content,{className:"space-y-6",children:[s.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(Mi,{className:"w-4 h-4 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Costos Fijos"})]}),s.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[l.fixedCostPercentage,"%"]}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Porcentaje aplicado"})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Costo Total"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:Q(l.totalCost)}),s.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Materiales + Fijos"})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Costo Unitario"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:Q(l.unitCost)}),s.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Por ",l.yieldUnit||"unidad"]})]})]}),l.forSale&&s.jsx("div",{className:"border-t pt-6 space-y-6",children:s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(se,{label:"SKU",value:l.sku,onChange:g=>u("sku",g.target.value.toUpperCase()),placeholder:"Ej: REC-001"}),s.jsx(se,{label:"Precio de Venta",type:"number",value:l.salePrice,onChange:g=>u("salePrice",parseFloat(g.target.value)||0),min:0,step:"0.01",isCurrency:!0}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Beneficio Objetivo"}),s.jsxs("div",{className:"mt-1 relative",children:[s.jsx(se,{type:"number",value:l.profitPercentage,onChange:g=>u("profitPercentage",parseFloat(g.target.value)||0),min:0,max:500,className:"pr-8"}),s.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:"%"})]})]})})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Margen Actual"}),s.jsxs("div",{className:`text-2xl font-bold mt-1 ${p>=l.profitPercentage?"text-green-600":"text-amber-600"}`,children:[p.toFixed(1),"%"]}),s.jsxs("div",{className:"text-sm text-gray-500",children:[Q(l.salePrice-l.unitCost)," por ",l.yieldUnit]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Precio Sugerido"}),s.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-1",children:Q(f)}),s.jsxs("div",{className:"text-sm text-gray-500",children:["Para ",l.profitPercentage,"% de beneficio"]})]}),h>10&&s.jsxs("div",{className:"flex items-center gap-2 text-amber-600 text-sm mt-2",children:[s.jsx(yr,{className:"w-4 h-4 flex-shrink-0"}),s.jsxs("span",{children:["El precio actual se desvía un ",h.toFixed(1),"% del sugerido"]})]})]})]})})]})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:s.jsx(At,{className:"w-5 h-5 text-gray-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx(O.Title,{children:"Notas"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Instrucciones y observaciones de la receta"})]})]})}),s.jsx(O.Content,{children:s.jsx("textarea",{value:l.notes,onChange:g=>u("notes",g.target.value),rows:6,className:"w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 placeholder-gray-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Escribe las instrucciones y notas de la receta aquí..."})})]}),s.jsxs("div",{className:"flex justify-end space-x-4",children:[s.jsx(E,{type:"button",variant:"outline",onClick:r,disabled:n,children:"Cancelar"}),s.jsxs(E,{type:"submit",isLoading:n,children:[t?"Actualizar":"Crear"," Receta"]})]})]})}function gp({initialData:t,onSubmit:e,onCancel:r,isLoading:n,history:a=[]}){const[i,o]=y.useState(!1),[c,l]=y.useState({month:new Date().getMonth()+1,year:new Date().getFullYear(),totalMaterialsCost:(t==null?void 0:t.totalMaterialsCost)||0,totalFixedCosts:(t==null?void 0:t.totalFixedCosts)||0,totalSales:(t==null?void 0:t.totalSales)||0,productionSales:(t==null?void 0:t.productionSales)||0,fixedCostPercentage:(t==null?void 0:t.fixedCostPercentage)||0,lastUpdated:Date.now()}),d=async f=>{if(f.preventDefault(),c.totalSales<c.productionSales){alert("Las ventas de producción no pueden ser mayores que las ventas totales");return}const h=c.totalSales>0?c.productionSales/c.totalSales*100:0,g=c.totalFixedCosts*(h/100),w=wi(c.totalMaterialsCost,g);try{o(!0),await e({...c,fixedCostPercentage:w,lastUpdated:Date.now()})}catch(v){console.error("Error saving fixed costs:",v)}finally{o(!1)}},u=c.totalSales>0?c.productionSales/c.totalSales*100:0,m=c.totalFixedCosts*(u/100),b=wi(c.totalMaterialsCost,m),x=a.reduce((f,h)=>{const g=h.year,w=h.month;return f[g]||(f[g]={}),f[g][w]||(f[g][w]=[]),f[g][w].push(h),f},{}),p=Object.keys(x).map(Number).sort((f,h)=>h-f);return s.jsxs("form",{onSubmit:d,className:"space-y-6",children:[s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsx(O.Title,{children:"Ventas"})}),s.jsxs(O.Content,{className:"space-y-4",children:[s.jsx(se,{label:"Ventas Totales",type:"number",min:"0",step:"any",value:c.totalSales,onChange:f=>l(h=>({...h,totalSales:parseFloat(f.target.value)||0})),required:!0,isCurrency:!0,disabled:i}),s.jsx(se,{label:"Ventas de Producción Propia",type:"number",min:"0",step:"any",value:c.productionSales,onChange:f=>l(h=>({...h,productionSales:parseFloat(f.target.value)||0})),required:!0,isCurrency:!0,disabled:i}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("div",{className:"text-sm text-blue-600 mb-2",children:"Porcentaje de Ventas de Producción:"}),s.jsxs("div",{className:"text-2xl font-bold text-blue-700",children:[u.toFixed(2),"%"]})]})]})]}),s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsx(O.Title,{children:"Costos"})}),s.jsxs(O.Content,{className:"space-y-4",children:[s.jsx(se,{label:"Costo Total de Materiales",type:"number",min:"0",step:"any",value:c.totalMaterialsCost,onChange:f=>l(h=>({...h,totalMaterialsCost:parseFloat(f.target.value)||0})),required:!0,isCurrency:!0,disabled:i}),s.jsx(se,{label:"Gastos Fijos Totales",type:"number",min:"0",step:"any",value:c.totalFixedCosts,onChange:f=>l(h=>({...h,totalFixedCosts:parseFloat(f.target.value)||0})),required:!0,isCurrency:!0,disabled:i}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Gastos Fijos de Producción:"}),s.jsx("div",{className:"text-xl font-bold text-blue-600",children:Q(m)}),s.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[u.toFixed(2),"% de ",Q(c.totalFixedCosts)]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Porcentaje sobre Materiales:"}),s.jsxs("div",{className:"text-xl font-bold text-blue-600",children:[b.toFixed(2),"%"]}),s.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[Q(m)," / ",Q(c.totalMaterialsCost)]})]})]})]})]}),p.length>0&&s.jsxs(O,{children:[s.jsx(O.Header,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Vn,{className:"w-5 h-5 text-gray-500"}),s.jsx(O.Title,{children:"Historial por Año y Mes"})]})}),s.jsx(O.Content,{children:s.jsx("div",{className:"space-y-6",children:p.map(f=>s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:f}),s.jsx("div",{className:"space-y-4",children:Object.entries(x[f]).sort(([h],[g])=>Number(g)-Number(h)).map(([h,g])=>{const w=fe(new Date(f,Number(h)-1),"MMMM",{locale:ye}),v=g[g.length-1],_=a.find(S=>S.year===f&&S.month===Number(h)-1),P=_?(v.fixedCostPercentage-_.fixedCostPercentage)/_.fixedCostPercentage*100:0;return s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium text-gray-700 capitalize",children:w}),s.jsxs("div",{className:`p-4 rounded-lg ${Math.abs(P)>10?P>0?"bg-red-50":"bg-green-50":"bg-gray-50"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("div",{className:"text-sm text-gray-600",children:"Última actualización:"}),_&&s.jsxs("div",{className:`text-sm font-medium ${P>0?"text-red-600":"text-green-600"}`,children:[P>0?"+":"",P.toFixed(2),"%"]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Materiales:"}),s.jsx("div",{className:"font-medium",children:Q(v.totalMaterialsCost)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Gastos Fijos:"}),s.jsx("div",{className:"font-medium",children:Q(v.totalFixedCosts)})]}),s.jsxs("div",{className:"col-span-2",children:[s.jsx("span",{className:"text-gray-600",children:"Porcentaje:"}),s.jsxs("div",{className:"font-medium",children:[v.fixedCostPercentage.toFixed(2),"%"]})]})]}),Math.abs(P)>10&&s.jsxs("div",{className:`mt-2 flex items-center gap-1.5 text-sm ${P>0?"text-red-600":"text-green-600"}`,children:[P>0?s.jsx(Wt,{className:"w-4 h-4"}):s.jsx(zn,{className:"w-4 h-4"}),s.jsxs("span",{children:[P>0?"Aumento significativo":"Reducción significativa"," respecto al mes anterior"]})]})]})]},h)})})]},f))})})]}),s.jsxs("div",{className:"flex justify-end space-x-4",children:[s.jsx(E,{type:"button",variant:"outline",onClick:r,disabled:i||n,children:"Cancelar"}),s.jsx(E,{type:"submit",disabled:i||n,className:"min-w-[100px]",children:i?s.jsxs(s.Fragment,{children:[s.jsx(ul,{className:"w-4 h-4 mr-2 animate-spin"}),"Guardando..."]}):"Guardar"})]})]})}function pp(){const{recipes:t,loading:e,addRecipe:r,updateRecipe:n,deleteRecipe:a}=da(),{products:i,loading:o}=Ut(),{currentCosts:c,loading:l,updateFixedCosts:d}=Rc(),[u,m]=y.useState(!1),[b,x]=y.useState(!1),[p,f]=y.useState(null),[h,g]=y.useState(""),[w,v]=y.useState(!1),[_,P]=y.useState(!1),[S,ee]=y.useState(null),k=[...t].sort((J,xe)=>J.isBase&&!xe.isBase?-1:!J.isBase&&xe.isBase?1:J.name.localeCompare(xe.name)).filter(J=>J.name.toLowerCase().includes(h.toLowerCase())),Y=async J=>{if(!J.name||!J.yield||!J.yieldUnit||!J.materials.length){A.error("Por favor complete todos los campos requeridos");return}v(!0);try{p?(await n(p.id,{...J,costThreshold:J.costThreshold||20,lastUpdated:Date.now()}),A.success("Receta actualizada exitosamente")):(await r({...J,costHistory:[],costThreshold:20,lastUpdated:Date.now()}),A.success("Receta creada exitosamente")),Se()}catch(xe){console.error("Error saving recipe:",xe),A.error("Error al guardar la receta")}finally{v(!1)}},de=J=>{ee(J)},G=async()=>{if(S)try{await a(S.id),A.success("Receta eliminada exitosamente"),ee(null)}catch(J){console.error("Error deleting recipe:",J),A.error("Error al eliminar la receta")}},Se=()=>{m(!1),f(null)},X=J=>{f(J),m(!0)},Pe=async()=>{var F,W;if(!i.length){A.error("No hay productos disponibles para actualizar los costos");return}if(!c){A.error("Debe configurar los costos fijos del mes actual primero"),x(!0);return}P(!0);let J=0,xe=0;try{let U=[...t];const he=U.filter(te=>te.isBase);for(const te of he)try{const pe=Fs(te.materials,i,U,te.yield,c.fixedCostPercentage,te.profitPercentage,te.unitCost);if(pe.totalCost!==te.totalCost||pe.unitCost!==te.unitCost||pe.suggestedPrice!==te.suggestedPrice){const R=te.costHistory||[];(F=pe.costHistory)!=null&&F[0]&&R.push(pe.costHistory[0]);const D={...te,totalCost:pe.totalCost,unitCost:pe.unitCost,suggestedPrice:pe.suggestedPrice,fixedCostPercentage:c.fixedCostPercentage,costHistory:R,lastUpdated:Date.now()};await n(te.id,D),J++;const ie=U.findIndex($e=>$e.id===te.id);ie!==-1&&(U[ie]=D),U=Ic(U,i,te.id)}}catch(pe){console.error(`Error updating recipe ${te.id}:`,pe),xe++}const V=U.filter(te=>!te.isBase);for(const te of V)try{const pe=Fs(te.materials,i,U,te.yield,c.fixedCostPercentage,te.profitPercentage,te.unitCost);if(pe.totalCost!==te.totalCost||pe.unitCost!==te.unitCost||pe.suggestedPrice!==te.suggestedPrice){const R=te.costHistory||[];(W=pe.costHistory)!=null&&W[0]&&R.push(pe.costHistory[0]),await n(te.id,{...te,totalCost:pe.totalCost,unitCost:pe.unitCost,suggestedPrice:pe.suggestedPrice,fixedCostPercentage:c.fixedCostPercentage,costHistory:R,lastUpdated:Date.now()}),J++}}catch(pe){console.error(`Error updating recipe ${te.id}:`,pe),xe++}J>0?A.success(`${J} recetas actualizadas exitosamente`):xe===0&&A.success("Los costos están actualizados"),xe>0&&A.error(`Error al actualizar ${xe} recetas`)}catch(U){console.error("Error updating costs:",U),A.error("Error al actualizar los costos")}finally{P(!1)}};return s.jsxs("div",{className:"space-y-6",children:[u?s.jsx(fp,{initialData:p,onSubmit:Y,onCancel:Se,isLoading:w,recipes:t}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(se,{placeholder:"Buscar recetas...",value:h,onChange:J=>g(J.target.value),className:"pl-10"}),s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[s.jsxs(E,{onClick:()=>x(!0),variant:"outline",className:"w-full",children:[s.jsx(Ui,{className:"w-4 h-4 mr-2 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:"Costos Fijos"}),s.jsx("span",{className:"sm:hidden",children:"Costos"})]}),s.jsxs(E,{onClick:Pe,variant:"outline",isLoading:_,disabled:_||e||o||l,className:"w-full",children:[s.jsx(Dn,{className:"w-4 h-4 mr-2 sm:mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:"Actualizar Costos"}),s.jsx("span",{className:"sm:hidden",children:"Actualizar"})]}),s.jsxs(E,{onClick:()=>m(!0),className:"w-full sm:col-auto col-span-2",children:[s.jsx(Gt,{className:"w-4 h-4 mr-2"}),s.jsx("span",{children:"Nueva Receta"})]})]})]}),e?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsx(op,{recipes:k,onEdit:X,onDelete:de})]}),s.jsx(Ue,{isOpen:b,onClose:()=>x(!1),title:"Configuración de Costos Fijos",children:s.jsx(gp,{initialData:c||void 0,onSubmit:async J=>{try{await d(J),x(!1),Pe()}catch{}},onCancel:()=>x(!1)})}),s.jsx(Ue,{isOpen:!!S,onClose:()=>ee(null),title:"Eliminar receta",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[s.jsxs("p",{className:"text-amber-800",children:["¿Está seguro que desea eliminar la receta ",s.jsx("span",{className:"font-semibold",children:S==null?void 0:S.name}),"?"]}),(S==null?void 0:S.isBase)&&s.jsx("p",{className:"text-sm text-amber-700 mt-2",children:"Esta es una receta base. Al eliminarla, las recetas que la utilizan como material se verán afectadas."}),s.jsx("p",{className:"text-sm text-amber-700 mt-2",children:"Esta acción no se puede deshacer."})]}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(E,{variant:"outline",onClick:()=>ee(null),children:"Cancelar"}),s.jsx(E,{onClick:G,className:"bg-red-600 hover:bg-red-700 text-white",children:"Eliminar"})]})]})})]})}async function xp(t,e){if(!_e.currentUser)throw new oe("User not authenticated");try{const r=q(H,t),n=ct(r);if(!n.key)throw new oe("Failed to generate document ID");return await vt(n,e),n.key}catch(r){throw new oe("Failed to create document",{cause:r})}}async function bp(t,e,r){if(!_e.currentUser)throw new oe("User not authenticated");try{const n=q(H,`${t}/${e}`);await vt(n,r)}catch(n){throw new oe("Failed to update document",{cause:n})}}async function vp(t,e){if(!_e.currentUser)throw new oe("User not authenticated");try{const r=q(H,`${t}/${e}`);await ur(r)}catch(r){throw new oe("Failed to delete document",{cause:r})}}async function yp(t,e,r){if(!_e.currentUser)throw new oe("User not authenticated");try{const n=q(H,t),a=sr(n,nr(e),ar(r)),i=await Me(a);return i.exists()?Object.entries(i.val()).map(([o,c])=>({id:o,...c})):[]}catch(n){throw new oe("Failed to query documents",{cause:n})}}const wp=["orders","products","providers","measures","monthlyFixedCosts","unitConversions"];async function jp(t){try{if(!_e.currentUser)return{name:t,exists:!1};const e=q(H,t),r=await Me(e);return{name:t,exists:r.exists()}}catch(e){return{name:t,exists:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function Np(t){if(!_e.currentUser){console.warn(`Skipping collection creation for "${t}" - user not authenticated`);return}const e=q(H,t);await vt(e,{})}async function _p(){try{if(!_e.currentUser){console.info("Skipping collections initialization - user not authenticated");return}console.info("Starting collections initialization...");const e=(await Promise.all(wp.map(r=>jp(r)))).filter(r=>!r.exists).map(async({name:r})=>{try{await Np(r),console.info(`Collection "${r}" created successfully`)}catch(n){console.error(`Failed to create collection "${r}":`,n)}});await Promise.all(e),console.info("Collections initialization completed")}catch(t){console.error("Failed to initialize collections:",t)}}_e.onAuthStateChanged(t=>{t&&_p().catch(e=>{console.error("Critical error during collections initialization:",e)})});const vr="orders";async function Sp(t){if(!_e.currentUser)return console.warn("User not authenticated, returning empty orders"),[];try{return(await yp(vr,"providerId",t)).sort((r,n)=>new Date(n.date).getTime()-new Date(r.date).getTime())}catch(e){return console.error("Error fetching provider orders:",e),A.error("Error al cargar las órdenes"),[]}}const Ur={subscribeToProviderOrders(t,e){if(!_e.currentUser)return console.warn("User not authenticated, skipping subscription"),e([]),()=>{};const r=q(H,vr),n=sr(r,nr("providerId"),ar(t));return Ke(n,i=>{if(!i.exists()){e([]);return}const c=Object.entries(i.val()).map(([l,d])=>({id:l,...d})).sort((l,d)=>new Date(d.date).getTime()-new Date(l.date).getTime());e(c)},i=>{console.error("Error fetching provider orders:",i),A.error("Error al cargar las órdenes"),e([])})},async getByProvider(t){return Sp(t)},async create(t){if(!_e.currentUser)throw new Error("User not authenticated");try{return await xp(vr,t)}catch(e){throw console.error("Error creating order:",e),A.error("Error al crear la orden"),e}},async update(t,e){if(!_e.currentUser)throw new Error("User not authenticated");try{const r=q(H,`${vr}/${t}`),n=await Me(r);if(!n.exists())throw new Error("Order not found");const i={...n.val(),...e};await bp(vr,t,i)}catch(r){throw console.error("Error updating order:",r),A.error("Error al actualizar la orden"),r}},async delete(t){if(!_e.currentUser)throw new Error("User not authenticated");try{await vp(vr,t)}catch(e){throw console.error("Error deleting order:",e),A.error("Error al eliminar la orden"),e}}};function Qs(t){const[e,r]=y.useState([]),[n,a]=y.useState(!0);return y.useEffect(()=>{let l;return(async()=>{if(!t){r([]),a(!1);return}try{const u=await Ur.getByProvider(t);u&&r(u),l=Ur.subscribeToProviderOrders(t,m=>{r(m)})}catch(u){console.error("Error setting up orders subscription:",u),A.error("Error al cargar las órdenes")}finally{a(!1)}})(),()=>{l&&l()}},[t]),{orders:e,loading:n,addOrder:async l=>{try{const d=await Ur.create(l);if(!d)throw new Error("Failed to create order");return d}catch(d){throw console.error("Error creating order:",d),new Error("Error al crear la orden")}},updateOrder:async(l,d)=>{try{await Ur.update(l,d)}catch(u){throw console.error("Error updating order:",u),new Error("Error al actualizar la orden")}},deleteOrder:async l=>{try{await Ur.delete(l)}catch(d){throw console.error("Error deleting order:",d),new Error("Error al eliminar la orden")}}}}function Xs(t){return new Date(t)}function Cp(){return Date.now()}function Pp(t){const e=fe(Xs(t),"dd/MM/yyyy HH:mm",{locale:ye});return[Yt.name,Yt.owner,`Pedido Fecha: ${e}`,""]}function kp(t,e,r){return`${`${t} ${e}`.padEnd(15)}${r}`}function Op(t,e){return e.sort((r,n)=>{const a=t.find(o=>o.id===r.productId),i=t.find(o=>o.id===n.productId);return!a||!i?0:a.order-i.order}).map(r=>{const n=t.find(a=>a.id===r.productId);return n?kp(r.quantity,n.purchasePackaging,n.name):null}).filter(r=>r!==null)}function Ap(t){const e=t.length,r=t.reduce((n,a)=>n+a.quantity,0);return["","--------------------------------",`Total Items: ${e}`,`Total Unidades: ${r}`,""]}function Fc(t,e,r=!1){if(r){const o=[`Pedido Fecha: ${fe(Xs(t.date),"dd/MM/yyyy HH:mm",{locale:ye})}`,Yt.name,Yt.owner,""],c=t.items.sort((m,b)=>{const x=e.find(f=>f.id===m.productId),p=e.find(f=>f.id===b.productId);return!x||!p?0:x.order-p.order}).map(m=>{const b=e.find(x=>x.id===m.productId);return b?`• *${m.quantity} ${b.purchasePackaging}* - ${b.name}`:null}).filter(Boolean),l=t.items.length,d=t.items.reduce((m,b)=>m+b.quantity,0),u=["","--------------------------------",`Total Items: ${l}`,`Total Unidades: ${d}`];return[...o,...c,...u].join(`
`)}const n=Pp(t.date),a=Op(e,t.items),i=Ap(t.items);return[...n,...a,...i].join(`
`)}function Ep(t,e,r){return Fc(t,e,!0)}function Mp(t,e){const r=fe(Xs(t.date),"dd/MM/yyyy HH:mm",{locale:ye}),n=t.items.sort((c,l)=>{const d=e.find(m=>m.id===c.productId),u=e.find(m=>m.id===l.productId);return!d||!u?0:d.order-u.order}),a=n.length,i=n.reduce((c,l)=>c+l.quantity,0),o=n.map(c=>{const l=e.find(d=>d.id===c.productId);return l?`
        <tr>
          <td class="quantity">${c.quantity} ${l.purchasePackaging}</td>
          <td class="name font-bold text-gray-900">${l.name}</td>
        </tr>
      `:""}).join("");return`
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Orden de Compra</title>
        <style>${Ec}</style>
        <style>
          /* Additional styles for bold product names */
          td.name {
            font-weight: bold !important;
            color: #111827 !important; /* text-gray-900 */
          }
          
          @media print {
            td.name {
              font-weight: bold !important;
              color: #000000 !important;
            }
          }
        </style>
      </head>
      <body>
        <div class="content">
          <div class="header">
            <div>${Yt.name}</div>
            <div>${Yt.owner}</div>
            <div>Pedido Fecha: ${r}</div>
          </div>

          <table>
            <tbody>
              ${o}
            </tbody>
          </table>

          <div class="summary">
            <div class="summary-row">
              <span class="summary-label">Total Items:</span>
              <span class="summary-value">${a}</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Total Unidades:</span>
              <span class="summary-value">${i}</span>
            </div>
          </div>
        </div>

        <div class="controls">
          <button id="print-button" class="print-button">
            Imprimir
          </button>
        </div>

        <script>${Mc}<\/script>
      </body>
    </html>
  `}function Uc({order:t,products:e,provider:r,onReopen:n}){const{updateOrder:a,deleteOrder:i}=Qs(r.id),[o,c]=y.useState(!1),[l,d]=y.useState(!1),u=async()=>{if(!r.phone){A.error("Este proveedor no tiene número de teléfono registrado");return}d(!0);try{t.status==="pending"&&await a(t.id,{...t,status:"completed"});const x=Ep(t,e,r),p=eo(r.phone,x);window.open(p,"_blank"),t.status==="pending"&&A.success("Orden completada y enviada por WhatsApp")}catch(x){console.error("Error sending WhatsApp:",x),A.error("Error al enviar por WhatsApp")}finally{d(!1)}},m=async()=>{d(!0);try{t.status==="pending"&&await a(t.id,{...t,status:"completed"});const x=Mp(t,e),p=window.open("","_blank");if(!p)throw new Error("No se pudo crear la pestaña de impresión");p.document.write(x),p.document.close(),t.status==="pending"&&A.success("Orden completada e impresa")}catch(x){console.error("Error printing order:",x),A.error("Error al imprimir la orden")}finally{d(!1)}},b=async()=>{d(!0);try{await i(t.id),A.success("Orden eliminada exitosamente"),c(!1)}catch(x){console.error("Error deleting order:",x),A.error("Error al eliminar la orden")}finally{d(!1)}};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r.phone&&s.jsx(E,{type:"button",variant:"ghost",size:"sm",onClick:u,disabled:l,className:"text-green-600 hover:text-green-700 hover:bg-green-50 w-11 h-11 p-0",title:"Enviar por WhatsApp",children:s.jsx(hl,{className:"w-5 h-5"})}),s.jsx(E,{type:"button",variant:"ghost",size:"sm",onClick:m,disabled:l,className:"text-gray-600 hover:text-gray-700 hover:bg-gray-50 w-11 h-11 p-0",title:"Imprimir",children:s.jsx(Fi,{className:"w-5 h-5"})}),t.status==="completed"&&n&&s.jsx(E,{type:"button",variant:"ghost",size:"sm",onClick:n,disabled:l,className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 w-11 h-11 p-0",title:"Reabrir orden",children:s.jsx(ml,{className:"w-5 h-5"})}),s.jsx(E,{type:"button",variant:"ghost",size:"sm",onClick:()=>c(!0),disabled:l,className:"text-red-600 hover:text-red-700 hover:bg-red-50 w-11 h-11 p-0",title:"Eliminar orden",children:s.jsx(Ar,{className:"w-5 h-5"})})]}),s.jsx(Ue,{isOpen:o,onClose:()=>c(!1),title:"Eliminar orden",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-amber-600",children:"¿Está seguro que desea eliminar esta orden?"}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(E,{variant:"outline",onClick:()=>c(!1),disabled:l,children:"Cancelar"}),s.jsx(E,{onClick:b,isLoading:l,children:"Eliminar"})]})]})})]})}function ji({orders:t,products:e,provider:r,onSelect:n}){const{providers:a}=pr(),i=[...t].sort((o,c)=>new Date(c.date).getTime()-new Date(o.date).getTime());return s.jsxs("div",{className:"space-y-4",children:[i.map((o,c)=>{const l=new Set(o.items.map(b=>b.productId)).size,d=o.items.reduce((b,x)=>b+x.quantity,0),u=i.length-c,m=r||a.find(b=>b.id===o.providerId);return m?s.jsxs("div",{className:`
              bg-white rounded-lg border transition-all duration-200
              ${o.status==="completed"?"border-green-200 hover:border-green-300":"border-amber-200 hover:border-amber-300"}
              hover:shadow-md
            `,children:[s.jsx("div",{className:"cursor-pointer",onClick:()=>n(o,u),children:s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[s.jsxs("div",{className:"text-lg font-bold text-gray-900",children:[fe(new Date(o.date),"d 'de' MMMM",{locale:ye}),s.jsx("span",{className:"text-gray-500 ml-2 text-base font-normal",children:fe(new Date(o.date),"HH:mm",{locale:ye})})]}),s.jsx("span",{className:`
                    inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                    ${o.status==="completed"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}
                  `,children:o.status==="completed"?s.jsxs(s.Fragment,{children:[s.jsx(Un,{className:"w-4 h-4 mr-1.5"}),"Completada"]}):s.jsxs(s.Fragment,{children:[s.jsx(fl,{className:"w-4 h-4 mr-1.5"}),"Pendiente"]})})]}),s.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-2xl font-bold text-blue-600",children:["Orden #",u]}),s.jsxs("div",{className:"text-base font-medium text-gray-900 mt-1",children:[m.commercialName,m.legalName&&m.legalName!==m.commercialName&&s.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",m.legalName,")"]})]})]}),s.jsx("div",{className:"text-right",children:s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:Q(o.total)})})]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.jsxs("span",{children:[l," ",l===1?"producto":"productos"]}),s.jsx("span",{className:"text-gray-300",children:"•"}),s.jsxs("span",{children:[d," ",d===1?"unidad":"unidades"]})]})]})}),s.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t rounded-b-lg",children:s.jsx(Uc,{order:o,products:e,provider:m})})]},o.id):null}),t.length===0&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay órdenes para mostrar"})]})}function Tp({order:t,products:e,provider:r,preview:n=!0}){[...t.items].sort((i,o)=>{const c=e.find(d=>d.id===i.productId),l=e.find(d=>d.id===o.productId);return!c||!l?0:c.order-l.order});const a=Fc(t,e,n);return s.jsx("div",{className:"font-mono text-sm bg-gray-50 p-4 rounded-lg overflow-x-auto whitespace-pre-wrap",children:a})}function Rp({order:t,orderNumber:e,products:r,provider:n,onClose:a,onEdit:i}){const[o,c]=y.useState(!1),{updateOrder:l}=Qs(n.id),[d,u]=y.useState(!1),m=fe(Xs(t.date),"d 'de' MMMM, yyyy HH:mm",{locale:ye}),b=t.items.length,x=t.items.reduce((f,h)=>f+h.quantity,0),p=async()=>{u(!0);try{await l(t.id,{...t,status:"pending"}),A.success("Orden reabierta exitosamente"),i==null||i()}catch(f){console.error("Error reopening order:",f),A.error("Error al reabrir la orden")}finally{u(!1),c(!1)}};return s.jsxs("div",{className:"fixed inset-0 bg-gray-50 z-50 flex flex-col",children:[s.jsx("div",{className:"bg-white border-b print:hidden sticky top-0 z-10",children:s.jsxs("div",{className:"flex items-center justify-between px-3 h-14",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(E,{variant:"ghost",size:"sm",onClick:a,className:"md:hidden",children:s.jsx(gl,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("h2",{className:"text-lg font-semibold",children:["Orden #",e]}),s.jsx("span",{className:`
                  px-2 py-0.5 text-xs font-medium rounded-full
                  ${t.status==="completed"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}
                `,children:t.status==="completed"?"Completada":"Pendiente"})]}),s.jsx("p",{className:"text-sm text-gray-500",children:m})]})]}),s.jsx("button",{onClick:a,className:"hidden md:flex p-2 hover:bg-gray-100 rounded-full transition-colors",children:s.jsx(Ve,{className:"w-5 h-5"})})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:s.jsxs("div",{className:"container mx-auto max-w-4xl px-3 py-4",children:[s.jsxs("div",{className:"hidden print:block mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-center mb-2",children:"Orden de Compra"}),s.jsxs("div",{className:"text-center text-gray-600 mb-4",children:["#",e]})]}),s.jsxs("div",{className:"grid gap-4",children:[s.jsxs("div",{className:"grid gap-4 sm:grid-cols-3 print:grid-cols-3",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm print:border-gray-300",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:s.jsx(Kt,{className:"w-5 h-5 text-blue-600"})}),s.jsx("h3",{className:"font-medium",children:"Fecha"})]}),s.jsx("p",{className:"text-gray-600",children:m})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm print:border-gray-300",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:s.jsx(Ri,{className:"w-5 h-5 text-purple-600"})}),s.jsx("h3",{className:"font-medium",children:"Proveedor"})]}),s.jsx("p",{className:"font-medium",children:n.commercialName}),n.legalName&&n.legalName!==n.commercialName&&s.jsx("p",{className:"text-sm text-gray-500",children:n.legalName})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm print:border-gray-300",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:s.jsx(ze,{className:"w-5 h-5 text-green-600"})}),s.jsx("h3",{className:"font-medium",children:"Resumen"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("p",{className:"text-gray-600",children:[b," ",b===1?"item":"items"]}),s.jsxs("p",{className:"text-gray-600",children:[x," ",x===1?"unidad":"unidades"]}),s.jsx("p",{className:"font-medium text-lg text-blue-600",children:Q(t.total)})]})]})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm print:border-gray-300",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4 print:mb-2",children:[s.jsx("div",{className:"p-2 bg-amber-50 rounded-lg",children:s.jsx(At,{className:"w-5 h-5 text-amber-600"})}),s.jsx("h3",{className:"font-medium",children:"Detalles del Pedido"})]}),s.jsx(Tp,{order:t,products:r,provider:n,preview:!1})]}),t.status==="completed"?s.jsx("div",{className:"print:hidden",children:s.jsx("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:s.jsx(Uc,{order:t,products:r,provider:n,onReopen:()=>c(!0)})})}):s.jsx("div",{className:"print:hidden bg-amber-50 border border-amber-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-3 text-amber-700",children:[s.jsx(yr,{className:"w-5 h-5 flex-shrink-0"}),s.jsx("p",{children:"Esta orden está pendiente de completar"})]})})]})]})}),s.jsx(Ue,{isOpen:o,onClose:()=>c(!1),title:"Reabrir orden",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-amber-600",children:"¿Está seguro que desea reabrir esta orden para edición?"}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(E,{variant:"outline",onClick:()=>c(!1),disabled:d,children:"Cancelar"}),s.jsx(E,{onClick:p,isLoading:d,children:"Reabrir"})]})]})})]})}function Ip({orders:t,products:e,onOrderSelect:r}){const[n,a]=y.useState(""),[i,o]=y.useState([]);return y.useEffect(()=>{if(!n.trim()){o([]);return}const c=n.toLowerCase(),l=[...t].sort((u,m)=>new Date(m.date).getTime()-new Date(u.date).getTime()),d=l.map((u,m)=>{const b=u.items.map(x=>{var h;const p=e.find(g=>g.id===x.productId);return p&&(p.name.toLowerCase().includes(c)||p.sku.toLowerCase().includes(c)||((h=p.tags)==null?void 0:h.some(g=>g.toLowerCase().includes(c))))?{product:p,quantity:x.quantity}:null}).filter(x=>x!==null);return b.length===0?null:{...u,orderNumber:l.length-m,matchingProducts:b}}).filter(u=>u!==null).slice(0,5);o(d)},[n,t,e]),s.jsxs("div",{className:"relative mb-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx(se,{placeholder:"Buscar productos en órdenes...",value:n,onChange:c=>a(c.target.value),className:"pl-10 bg-amber-50 border-amber-200 focus:border-amber-400 focus:ring-amber-400 placeholder-amber-400"}),s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-amber-400"})]}),i.length>0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-amber-200 rounded-lg shadow-lg max-h-[400px] overflow-auto",children:i.map(c=>s.jsx("button",{onClick:()=>r(c,c.orderNumber),className:"w-full px-4 py-3 text-left hover:bg-amber-50 border-b border-amber-100 last:border-b-0",children:s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsxs("span",{className:"font-medium text-amber-700",children:["Orden #",c.orderNumber]}),s.jsx("span",{className:"text-gray-400",children:"•"}),s.jsx("span",{className:"text-sm text-gray-600",children:fe(new Date(c.date),"d 'de' MMMM, yyyy",{locale:ye})})]}),s.jsx("div",{className:"space-y-1",children:c.matchingProducts.map(({product:l,quantity:d})=>s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-gray-900",children:l.name}),s.jsxs("span",{className:"text-gray-600 whitespace-nowrap ml-2",children:[d," ",l.purchasePackaging]})]},l.id))})]}),s.jsx("div",{className:"text-amber-600 font-medium whitespace-nowrap",children:Q(c.total)})]})},c.id))}),n&&i.length===0&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-amber-200 rounded-lg shadow-lg p-4 text-center text-gray-500",children:"No se encontraron productos en las órdenes"})]})}function vn(t){return new Intl.NumberFormat("es-UY",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}function Fp({providerId:t,product:e,onSubmit:r,onCancel:n,isSubmitting:a}){const[i,o]=y.useState(!1),c=()=>{i?confirm("¿Está seguro que desea descartar los cambios?")&&n():n()},l=async d=>{await r(e,d)};return s.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col",children:[s.jsx("div",{className:"border-b bg-white",children:s.jsxs("div",{className:"flex items-center justify-between px-4 h-14",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Editar Producto"}),s.jsx(E,{variant:"ghost",size:"sm",onClick:c,className:"p-2 hover:bg-gray-100 rounded-full",children:s.jsx(Ve,{className:"w-5 h-5"})})]})}),s.jsx("div",{className:"flex-1 overflow-hidden",children:s.jsx("div",{className:"h-full overflow-y-auto px-4 py-6",children:s.jsx("div",{className:"max-w-3xl mx-auto",children:s.jsx(Oc,{providerId:t,initialData:e,onSubmit:l,onCancel:n,isLoading:a,onDirtyChange:o})})})})]})}function Up({product:t,quantity:e,onQuantityChange:r,onReview:n,isReviewed:a,allowEdit:i=!0,onDragHandleHold:o,isDragging:c}){const[l,d]=y.useState(!1),[u,m]=y.useState(!1),[b,x]=y.useState(!1),[p,f]=y.useState(e.toString()),h=y.useRef(null),g=y.useRef(null),w=y.useRef(),{products:v,updateProduct:_}=Ut(),P=y.useRef(null),S=v.find(X=>X.id===t.id)||t;y.useEffect(()=>{f(e.toString())},[e]),y.useEffect(()=>{const X=Pe=>{h.current&&!h.current.contains(Pe.target)&&x(!1)};return document.addEventListener("mousedown",X),()=>document.removeEventListener("mousedown",X)},[]),y.useEffect(()=>{b&&g.current&&(g.current.focus(),g.current.select())},[b]);const ee=async X=>{m(!0);try{await _(S.id,X),d(!1)}catch(Pe){console.error("Error updating product:",Pe)}finally{m(!1)}},me=X=>{X.target instanceof HTMLButtonElement||X.target instanceof HTMLInputElement||X.target.closest("button")||X.target.closest("input")||X.target.closest(".quantity-controls")||X.target.closest(".drag-handle")||(w.current?(clearTimeout(w.current),w.current=void 0,r(e>0?0:S.desiredStock)):w.current=setTimeout(()=>{w.current=void 0,a||n()},250))},k=X=>{X.stopPropagation(),x(!0)},Y=X=>{X>=0&&(r(X),a||n())},de=X=>{X.stopPropagation(),e>0&&Y(Math.max(0,e-1))},G=X=>{X.stopPropagation(),Y(e+1)},Se=X=>{const Pe=X.target.value;f(Pe);const J=parseFloat(Pe);!isNaN(J)&&J>=0&&Y(J)};return s.jsxs(s.Fragment,{children:[s.jsx(O,{isSelected:e>0,children:s.jsx(O.Header,{className:"!p-3",children:s.jsxs(pl.div,{className:"relative",onClick:me,animate:c?{scale:1.02,boxShadow:"0 5px 15px rgba(0,0,0,0.1)"}:{scale:1},children:[a&&s.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full p-1",children:s.jsx(er,{className:"w-4 h-4"})}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`
                  flex-shrink-0 w-5 h-5 rounded border cursor-pointer transition-colors mt-1
                  ${e>0?"bg-blue-500 border-blue-500":"border-gray-300 hover:border-blue-500"}
                `,onClick:X=>{X.stopPropagation(),Y(e>0?0:S.desiredStock)},children:e>0&&s.jsx(er,{className:"w-full h-full text-white p-0.5"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.jsx("h3",{className:"font-semibold text-gray-900",children:S.name})}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-600 mb-3",children:[s.jsxs("div",{ref:P,className:"flex items-center gap-2 cursor-grab active:cursor-grabbing drag-handle",onPointerDown:X=>{X.preventDefault(),o==null||o()},children:[s.jsx(xl,{className:"w-4 h-4 text-gray-400"}),s.jsxs("span",{children:["Orden: ",np(S.order)]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(Ti,{className:"w-4 h-4 mr-1.5 flex-shrink-0"}),s.jsxs("span",{children:["Stock: ",S.minPackageStock," - ",S.desiredStock]})]})]}),e>0&&s.jsxs("div",{className:"flex items-end justify-between gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsx("div",{ref:h,className:"quantity-controls",children:b?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(E,{type:"button",variant:"outline",size:"sm",onClick:de,disabled:e<=0,className:"w-12 h-12 rounded-full",children:s.jsx(bl,{className:"w-5 h-5"})}),s.jsx(se,{ref:g,type:"number",min:"0",step:"0.01",value:p,onChange:Se,onClick:X=>X.stopPropagation(),placeholder:S.desiredStock.toString(),className:"text-center text-lg h-12"}),s.jsx(E,{type:"button",variant:"outline",size:"sm",onClick:G,className:"w-12 h-12 rounded-full",children:s.jsx(Gt,{className:"w-5 h-5"})})]}):s.jsx("button",{onClick:k,className:"w-full h-12 px-4 text-left bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsxs("span",{className:"text-lg font-medium",children:[e," ",S.purchasePackaging]})})})}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-lg font-bold text-blue-600",children:vn(S.price)}),s.jsxs("div",{className:"text-sm text-gray-500",children:["Total: ",vn(S.price*e)]})]})]}),!e&&s.jsx("div",{className:"text-lg font-bold text-blue-600",children:vn(S.price)})]})]})]})})}),i&&l&&s.jsx(Fp,{providerId:S.providerId,product:S,onSubmit:ee,onCancel:()=>d(!1),isSubmitting:u})]})}function $p({value:t,onChange:e}){return s.jsxs("div",{className:"relative mb-6",children:[s.jsx(se,{placeholder:"Filtrar",value:t,onChange:r=>e(r.target.value),className:"pl-10"}),s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]})}function Dp({products:t,selectedProducts:e,onProductSelect:r,allowEdit:n=!0,onReorder:a}){const[i,o]=y.useState(new Set),[c,l]=y.useState(""),[d,u]=y.useState(!1),[m,b]=y.useState(null),x=vl(),f=[...t].filter(v=>v.enabled!==!1).sort((v,_)=>v.order-_.order).filter(v=>{var _,P;if(d&&!e.has(v.id))return!1;if(c.trim()){const S=c.toLowerCase();return v.name.toLowerCase().includes(S)||v.sku.toLowerCase().includes(S)||((_=v.supplierCode)==null?void 0:_.toLowerCase().includes(S))||((P=v.tags)==null?void 0:P.some(ee=>ee.toLowerCase().includes(S)))}return!0}),h=(v,_)=>{_>=0&&(r(v,_),g(v))},g=v=>{o(_=>new Set(_).add(v))},w=v=>{a&&a(v)};return s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{className:"flex-1",children:s.jsx($p,{value:c,onChange:l,placeholder:"Filtrar"})}),s.jsx(E,{variant:d?"primary":"outline",onClick:()=>u(!d),className:"w-10 h-10 p-0 flex items-center justify-center",title:d?"Mostrar todos":"Solo seleccionados",children:s.jsx(Ii,{className:"w-4 h-4"})})]}),s.jsx(yl,{axis:"y",values:f,onReorder:w,className:"space-y-3",children:f.map(v=>s.jsx(wl,{value:v,dragListener:!1,dragControls:x,onDragStart:()=>b(v.id),onDragEnd:()=>b(null),children:s.jsx(Up,{product:v,quantity:e.get(v.id)||0,onQuantityChange:_=>h(v.id,_),onReview:()=>g(v.id),isReviewed:i.has(v.id),allowEdit:n,onDragHandleHold:()=>x.start(v.id),isDragging:m===v.id})},v.id))}),f.length===0&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:d?"No hay productos seleccionados":"No se encontraron productos que coincidan con la búsqueda"})]})}function Lp(t){return Number(t.reduce((e,r)=>e+Number((r.price*r.quantity).toFixed(2)),0).toFixed(2))}function Bp(t,e){const r=Number(Number(t.price).toFixed(2)),n=Number((r*e).toFixed(2));return{productId:t.id,quantity:Number(e),price:r,subtotal:n}}function $c(t,e,r){if(!t||!r||r.length===0)throw new Error("Invalid order data");const n=Array.from(e.entries()).map(([i,o])=>{const c=r.find(l=>l.id===i);if(!c)throw new Error(`Product ${i} not found`);return Bp(c,o)}).sort((i,o)=>{const c=r.find(d=>d.id===i.productId),l=r.find(d=>d.id===o.productId);return!c||!l?0:c.order-l.order}),a=Lp(n);return{providerId:t,date:Cp(),status:"pending",items:n,total:a}}function Dc(t,e){try{if(!t.providerId)return"El proveedor es requerido";if(!t.items||t.items.length===0)return"Debe agregar al menos un producto";const r=new Set;for(const a of t.items){if(!a.productId)return"Producto inválido";if(r.has(a.productId))return"No puede haber productos duplicados";if(r.add(a.productId),a.quantity<=0)return"La cantidad debe ser mayor a 0";const i=e.find(c=>c.id===a.productId);if(!i)return"Producto no encontrado";if(Math.abs(a.price-i.price)>.01)return`El precio del producto ${i.name} no coincide`;const o=Number((a.price*a.quantity).toFixed(2));if(Math.abs(a.subtotal-o)>.01)return`El subtotal del producto ${i.name} no coincide`}const n=Number(t.items.reduce((a,i)=>a+Number((i.price*i.quantity).toFixed(2)),0).toFixed(2));return Math.abs(t.total-n)>.01?"El total no coincide":null}catch(r){return console.error("Error validating order:",r),"Error al validar la orden"}}const yn=6e4,Vp=2e3;function zp({providerId:t,selectedProducts:e,products:r,onSave:n,orderId:a,enabled:i=!0}){const o=y.useRef(Date.now()),c=y.useRef(),l=y.useRef(),d=y.useRef(!1),u=y.useRef(!0),m=y.useRef(a),b=y.useRef("");y.useEffect(()=>{m.current=a},[a]);const x=()=>{const f=Array.from(e.entries()).sort(([h],[g])=>h.localeCompare(g)).map(([h,g])=>`${h}:${g}`).join(",");return`${t}-${f}`},p=()=>{c.current&&(clearTimeout(c.current),c.current=void 0),l.current&&(clearTimeout(l.current),l.current=void 0),u.current=!1};return y.useEffect(()=>{if(u.current=!0,!i||!t||e.size===0){p();return}const f=async()=>{if(!(!u.current||d.current))try{const h=x();if(h===b.current)return;d.current=!0;const g=$c(t,e,r),w=Dc(g,r);if(w){console.warn("Autosave skipped due to validation error:",w);return}Date.now()-o.current>=yn&&(await n(g),u.current&&(o.current=Date.now(),b.current=h))}catch(h){console.error("Error in autosave:",h),u.current&&A.error("Error al guardar automáticamente")}finally{d.current=!1,u.current&&i&&(c.current=setTimeout(f,yn))}};return l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{c.current&&clearTimeout(c.current),c.current=setTimeout(f,yn)},Vp),p},[i,t,e,r,n,a]),{lastSaveTime:o.current}}function qp({products:t,selectedProducts:e,onProductSelect:r,onConfirm:n,onCancel:a,isSubmitting:i,provider:o,orderId:c}){const[l,d]=y.useState(t),{orders:u,addOrder:m,updateOrder:b}=Qs(o.id),[x,p]=y.useState(!1);y.useEffect(()=>{d(h=>{const g=new Set(t.map(v=>v.id)),w=h.filter(v=>!g.has(v.id));return[...t,...w]})},[t]),zp({providerId:o.id,selectedProducts:e,products:l,orderId:c,onSave:async h=>{if(!x){p(!0);try{c?await b(c,h):await m(h)}catch(g){throw console.error("Error saving order:",g),g}finally{p(!1)}}}});const f=Array.from(e.entries()).reduce((h,[g,w])=>{const v=l.find(_=>_.id===g);return h+((v==null?void 0:v.price)||0)*w},0);return s.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col overflow-hidden",children:[s.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-indigo-600 text-white",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 h-14",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(He,{className:"w-6 h-6"}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("h2",{className:"text-lg font-semibold truncate",children:o.commercialName}),o.legalName&&o.legalName!==o.commercialName&&s.jsx("p",{className:"text-xs text-indigo-100 truncate",children:o.legalName})]})]}),s.jsx(E,{variant:"ghost",size:"sm",onClick:a,className:"p-2 hover:bg-white/10 text-white rounded-full",children:s.jsx(Ve,{className:"w-5 h-5"})})]}),e.size>0&&s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 px-4 py-3 border-t border-indigo-400",children:[s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsx("span",{className:"text-sm sm:text-base text-indigo-100",children:"Total:"}),s.jsx("span",{className:"text-lg sm:text-xl font-bold",children:Q(f)})]}),s.jsxs(E,{onClick:n,isLoading:i||x,className:"w-full sm:w-auto bg-white text-indigo-600 hover:bg-indigo-50",children:[c?"Actualizar":"Guardar"," Orden"]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50",children:s.jsx("div",{className:"container mx-auto max-w-3xl px-4 py-6",children:s.jsx(Dp,{products:l,selectedProducts:e,onProductSelect:r,allowEdit:!1})})})]})}function Hp(){const t=Bi(),[e,r]=Cl(),{providers:n}=pr(),[a,i]=y.useState(""),{orders:o,loading:c,addOrder:l,updateOrder:d}=Qs(a),{products:u,updateProduct:m}=kc(a),{orders:b,loading:x}=ha(),{products:p,loading:f}=Ut(),[h,g]=y.useState(!1),[w,v]=y.useState(null),[_,P]=y.useState(null),[S,ee]=y.useState(!1),[me,k]=y.useState(new Map),[Y,de]=y.useState(!1),G=n.find(U=>U.id===a),Se=b.sort((U,he)=>new Date(he.date).getTime()-new Date(U.date).getTime()).slice(0,5);y.useEffect(()=>{const U=e.get("provider"),he=e.get("new")==="true";if(U){if(i(U),he)g(!0),de(!0);else{const V=new Date,te=new Date(V.setHours(0,0,0,0)),pe=new Date(V.setHours(23,59,59,999)),R=o.find(D=>{const ie=new Date(D.date);return ie>=te&&ie<=pe});if(R){const D=new Map;R.items.forEach(ie=>{D.set(ie.productId,ie.quantity)}),k(D),v(R),g(!0),de(!0)}}r({})}},[e,r,o]);const X=(U,he)=>{const V=new Map(me);he>0?V.set(U,he):V.delete(U),k(V)},Pe=async()=>{if(!a||!u||!G){A.error("Seleccione un proveedor");return}if(me.size===0){A.error("Debe agregar al menos un producto");return}ee(!0);try{const U=$c(a,me,u),he=Dc(U,u);if(he){A.error(he);return}w?(await d(w.id,U),A.success("Orden actualizada exitosamente")):(await l(U),A.success("Orden creada exitosamente")),J()}catch(U){console.error("Error saving order:",U),A.error("Error al guardar la orden")}finally{ee(!1)}},J=()=>{g(!1),v(null),k(new Map),Y&&t("/")},xe=(U,he)=>{if(a||i(U.providerId),U.status==="completed")P({order:U,orderNumber:he});else{const V=new Map;U.items.forEach(te=>{V.set(te.productId,te.quantity)}),k(V),v(U),g(!0)}},F=()=>{if(!_)return;const U=new Map;_.order.items.forEach(he=>{U.set(he.productId,he.quantity)}),k(U),v(_.order),P(null),g(!0)},W=c||x||f;return h&&G?s.jsx(qp,{products:u,selectedProducts:me,onProductSelect:X,onConfirm:Pe,onCancel:J,isSubmitting:S,provider:G,orderId:w==null?void 0:w.id}):s.jsxs("div",{className:"space-y-4",children:[s.jsx(Ip,{orders:b,products:p,onOrderSelect:xe}),s.jsx("div",{className:"space-y-4 md:space-y-0",children:s.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsx(Pc,{providers:n,selectedProviderId:a,onChange:i})}),a&&s.jsx("div",{className:"flex-shrink-0 w-full md:w-auto",children:s.jsxs(E,{onClick:()=>g(!0),className:"w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white h-[48px] px-6 rounded-lg shadow-sm hover:shadow transition-all",children:[s.jsx(Gt,{className:"w-5 h-5 mr-2"}),s.jsx("span",{className:"whitespace-nowrap",children:"Nueva Orden"})]})})]})}),W?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsxs(s.Fragment,{children:[!a&&Se.length>0&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Últimas Órdenes"}),s.jsx(ji,{orders:Se,products:p,onSelect:xe})]}),_&&G&&s.jsx(Rp,{order:_.order,orderNumber:_.orderNumber,products:p,provider:G,onClose:()=>P(null),onEdit:F}),!_&&a&&s.jsx(ji,{orders:o,products:u,provider:G,onSelect:xe})]})]})}function Wp({isOpen:t,onClose:e,date:r,events:n}){return s.jsx(Ue,{isOpen:t,onClose:e,title:fe(r,"EEEE d 'de' MMMM, yyyy",{locale:ye}),children:s.jsxs("div",{className:"space-y-6",children:[n.billing.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-amber-900 mb-3",children:"Facturas"}),s.jsx("div",{className:"space-y-2",children:n.billing.map(a=>s.jsxs("div",{className:"bg-amber-50 p-3 rounded-lg",children:[s.jsx("div",{className:"font-medium text-amber-900",children:a.commercialName}),a.legalName&&a.legalName!==a.commercialName&&s.jsx("div",{className:"text-sm text-amber-700",children:a.legalName})]},a.id))})]}),n.orders.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-blue-900 mb-3",children:"Pedidos"}),s.jsx("div",{className:"space-y-2",children:n.orders.map(a=>s.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[s.jsx("div",{className:"font-medium text-blue-900",children:a.commercialName}),a.legalName&&a.legalName!==a.commercialName&&s.jsx("div",{className:"text-sm text-blue-700",children:a.legalName})]},a.id))})]}),n.deliveries.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-green-900 mb-3",children:"Entregas"}),s.jsx("div",{className:"space-y-2",children:n.deliveries.map(a=>s.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[s.jsx("div",{className:"font-medium text-green-900",children:a.commercialName}),a.legalName&&a.legalName!==a.commercialName&&s.jsx("div",{className:"text-sm text-green-700",children:a.legalName})]},a.id))})]}),n.billing.length===0&&n.orders.length===0&&n.deliveries.length===0&&s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay eventos programados para este día"})]})})}function Gp({currentDate:t,weeks:e,providers:r,weekdays:n,getDayEvents:a,onDayClick:i}){return s.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[s.jsx("div",{className:"p-4 border-b",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-lg font-semibold",children:fe(t,"MMMM yyyy",{locale:ye})}),s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(Kt,{className:"w-5 h-5 text-blue-600"})})]})}),s.jsx("div",{className:"grid grid-cols-7 border-b",children:n.map(({label:o})=>s.jsx("div",{className:"p-2 text-center font-medium text-sm border-r last:border-r-0",children:o},o))}),s.jsx("div",{className:"divide-y",children:e.map((o,c)=>{const l=td({start:o,end:new Date(o.getTime()+5184e5)});return s.jsx("div",{className:"grid grid-cols-7 min-h-[120px]",children:l.map((d,u)=>{const m=a(d),b=ru(d,t),x=su(d),p=m.billing.length>0||m.orders.length>0||m.deliveries.length>0;return s.jsxs("div",{onClick:()=>i(d),className:`p-2 border-r last:border-r-0 ${b?"bg-white":"bg-gray-50"} ${x?"bg-blue-50":""} ${p?"cursor-pointer hover:bg-gray-50":""}`,children:[s.jsx("div",{className:`text-sm font-medium mb-1 ${b?"text-gray-900":"text-gray-400"} ${x?"text-blue-600":""}`,children:fe(d,"d")}),s.jsxs("div",{className:"space-y-1 text-xs",children:[m.billing.length>0&&s.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[s.jsx(At,{className:"w-3 h-3 flex-shrink-0"}),s.jsxs("span",{className:"font-medium truncate",children:[m.billing.length," ",m.billing.length===1?"Factura":"Facturas"]})]}),m.orders.length>0&&s.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[s.jsx(He,{className:"w-3 h-3 flex-shrink-0"}),s.jsxs("span",{className:"font-medium truncate",children:[m.orders.length," ",m.orders.length===1?"Pedido":"Pedidos"]})]}),m.deliveries.length>0&&s.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[s.jsx(ys,{className:"w-3 h-3 flex-shrink-0"}),s.jsxs("span",{className:"font-medium truncate",children:[m.deliveries.length," ",m.deliveries.length===1?"Entrega":"Entregas"]})]})]})]},u)})},c)})})]})}function Yp({currentDate:t,today:e,weekdays:r,providers:n,ordersByProvider:a,monthlyBillingProviders:i,getDayEvents:o}){const c=st(t),l=r.map(({day:d,label:u},m)=>{const b=Hi(c,m),x=o(b);return{day:d,label:u,date:b,events:x,isToday:fe(b,"yyyy-MM-dd")===fe(t,"yyyy-MM-dd")}});return s.jsxs(s.Fragment,{children:[s.jsxs(O,{variant:"blue",children:[s.jsx(O.Header,{className:"pb-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-lg font-semibold text-blue-900",children:["Hoy - ",fe(t,"EEEE d 'de' MMMM",{locale:ye})]}),s.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[Object.keys(a).length," proveedores con pedidos hoy"]})]}),s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(Kt,{className:"w-5 h-5 text-blue-600"})})]})}),s.jsxs(O.Content,{className:"space-y-4",children:[i.length>0&&s.jsxs("div",{className:"bg-amber-50 rounded-lg p-4 border border-amber-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(At,{className:"w-5 h-5 text-amber-600"}),s.jsx("h3",{className:"font-medium text-amber-900",children:"Facturas"})]}),s.jsx("div",{className:"space-y-3",children:i.map(d=>s.jsxs("div",{className:"bg-white p-3 rounded-lg border border-amber-200",children:[s.jsx("div",{className:"font-medium text-amber-900",children:d.commercialName}),d.legalName&&d.legalName!==d.commercialName&&s.jsx("div",{className:"text-sm text-amber-700 mt-1",children:d.legalName})]},d.id))})]}),s.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx(He,{className:"w-5 h-5 text-blue-600"}),s.jsx("h3",{className:"font-medium text-blue-900",children:"Pedidos"})]}),Object.keys(a).length>0?s.jsx("div",{className:"space-y-3",children:Object.entries(a).map(([d,u])=>{var f;const m=n.find(h=>h.id===d);if(!m)return null;const b=u.reduce((h,g)=>h+g.total,0),x=u.reduce((h,g)=>h+g.items.length,0),p=u.reduce((h,g)=>h+g.items.reduce((w,v)=>w+v.quantity,0),0);return s.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-blue-900",children:m.commercialName}),m.legalName&&m.legalName!==m.commercialName&&s.jsx("div",{className:"text-sm text-blue-700 mt-1",children:m.legalName}),s.jsxs("div",{className:"text-sm text-blue-600 mt-2",children:[s.jsxs("span",{children:[u.length," ",u.length===1?"pedido":"pedidos"]}),s.jsx("span",{className:"mx-1",children:"•"}),s.jsxs("span",{children:[x," ",x===1?"producto":"productos"]}),s.jsx("span",{className:"mx-1",children:"•"}),s.jsxs("span",{children:[p," ",p===1?"unidad":"unidades"]})]})]}),s.jsx("div",{className:"text-right",children:s.jsx("span",{className:"font-medium text-blue-900",children:Q(b)})})]}),((f=m.deliveryDays)==null?void 0:f.includes(e))&&s.jsx("div",{className:"mt-3 pt-3 border-t border-blue-100",children:s.jsxs("div",{className:"text-sm text-blue-700 flex items-center gap-2",children:[s.jsx(ys,{className:"w-4 h-4"}),s.jsx("span",{children:"Entrega programada para hoy"})]})})]},d)})}):s.jsx("div",{className:"bg-white p-4 rounded-lg border border-blue-200 text-center text-blue-600",children:"No hay pedidos para hoy"})]})]})]}),s.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:l.map(({day:d,label:u,date:m,events:b,isToday:x})=>s.jsxs(O,{className:x?"ring-2 ring-blue-500":"",children:[s.jsx(O.Header,{className:"pb-4 border-b",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(O.Title,{className:x?"text-blue-600":"",children:u}),s.jsx("span",{className:`text-sm ${x?"text-blue-600":"text-gray-500"}`,children:fe(m,"d MMM",{locale:ye})})]})}),s.jsxs(O.Content,{className:"pt-4 space-y-6",children:[b.billing.length>0&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"p-1.5 bg-amber-100 rounded-md",children:s.jsx(At,{className:"w-4 h-4 text-amber-600"})}),s.jsx("h4",{className:"text-sm font-medium text-amber-900",children:"Facturas"})]}),s.jsx("ul",{className:"space-y-2",children:b.billing.map(p=>s.jsxs("li",{className:"bg-amber-50 px-3 py-2 rounded-md border border-amber-100 hover:bg-amber-100 transition-colors",children:[s.jsx("div",{className:"font-medium text-amber-900",children:p.commercialName}),p.legalName&&p.legalName!==p.commercialName&&s.jsx("div",{className:"text-sm text-amber-700 mt-0.5",children:p.legalName})]},p.id))})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"p-1.5 bg-blue-100 rounded-md",children:s.jsx(He,{className:"w-4 h-4 text-blue-600"})}),s.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Pedidos"})]}),b.orders.length>0?s.jsx("ul",{className:"space-y-2",children:b.orders.map(p=>s.jsxs("li",{className:"bg-blue-50 px-3 py-2 rounded-md border border-blue-100 hover:bg-blue-100 transition-colors",children:[s.jsx("div",{className:"font-medium text-blue-900",children:p.commercialName}),p.legalName&&p.legalName!==p.commercialName&&s.jsx("div",{className:"text-sm text-blue-700 mt-0.5",children:p.legalName})]},p.id))}):s.jsx("p",{className:"text-sm text-gray-500 bg-gray-50 px-3 py-2 rounded-md border border-gray-100",children:"No hay pedidos programados"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"p-1.5 bg-green-100 rounded-md",children:s.jsx(ys,{className:"w-4 h-4 text-green-600"})}),s.jsx("h4",{className:"text-sm font-medium text-green-900",children:"Entregas"})]}),b.deliveries.length>0?s.jsx("ul",{className:"space-y-2",children:b.deliveries.map(p=>s.jsxs("li",{className:"bg-green-50 px-3 py-2 rounded-md border border-green-100 hover:bg-green-100 transition-colors",children:[s.jsx("div",{className:"font-medium text-green-900",children:p.commercialName}),p.legalName&&p.legalName!==p.commercialName&&s.jsx("div",{className:"text-sm text-green-700 mt-0.5",children:p.legalName})]},p.id))}):s.jsx("p",{className:"text-sm text-gray-500 bg-gray-50 px-3 py-2 rounded-md border border-gray-100",children:"No hay entregas programadas"})]})]})]},d))})]})}const Ni=[{day:"tuesday",label:"Martes"},{day:"wednesday",label:"Miércoles"},{day:"thursday",label:"Jueves"},{day:"friday",label:"Viernes"},{day:"saturday",label:"Sábado"},{day:"sunday",label:"Domingo"},{day:"monday",label:"Lunes"}],Kp={0:"tuesday",1:"wednesday",2:"thursday",3:"friday",4:"saturday",5:"sunday",6:"monday"};function Qp(){const{providers:t}=pr(),{orders:e}=ha(),[r,n]=y.useState(!1),[a,i]=y.useState(null),[o,c]=y.useState(null),l=fe(new Date,"EEEE",{locale:ye}).toLowerCase(),d=new Date,u=d.getDate(),b=e.filter(v=>{const _=new Date(v.date),P=new Date;return _.getFullYear()===P.getFullYear()&&_.getMonth()===P.getMonth()&&_.getDate()===P.getDate()}).reduce((v,_)=>(v[_.providerId]||(v[_.providerId]=[]),v[_.providerId].push(_),v),{}),x=t.filter(v=>{var _;return v.billingType==="monthly"&&((_=v.billingDays)==null?void 0:_.includes(u))}),p=Ki(d),f=Yi(d),h=rd({start:p,end:f},{weekStartsOn:2}),g=v=>{const _=v.getDate(),P=Kp[v.getDay()],S=t.filter(k=>{var Y;return k.billingType==="monthly"&&((Y=k.billingDays)==null?void 0:Y.includes(_))}),ee=t.filter(k=>{var Y;return(Y=k.orderDays)==null?void 0:Y.includes(P)}),me=t.filter(k=>{var Y;return(Y=k.deliveryDays)==null?void 0:Y.includes(P)});return{billing:S,orders:ee,deliveries:me}},w=v=>{const _=g(v);i(v),c(_)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cronograma de Proveedores"}),s.jsx(E,{variant:"outline",onClick:()=>n(!r),className:"gap-2",children:r?s.jsxs(s.Fragment,{children:[s.jsx(jl,{className:"w-4 h-4"}),"Vista Semanal"]}):s.jsxs(s.Fragment,{children:[s.jsx(Kt,{className:"w-4 h-4"}),"Vista Mensual"]})})]}),r?s.jsx(Gp,{currentDate:d,weeks:h,providers:t,weekdays:Ni,getDayEvents:g,onDayClick:w}):s.jsx(Yp,{currentDate:d,today:l,weekdays:Ni,providers:t,ordersByProvider:b,monthlyBillingProviders:x,getDayEvents:g}),a&&o&&s.jsx(Wp,{isOpen:!0,onClose:()=>{i(null),c(null)},date:a,events:o})]})}async function Xp(){try{if(!(await fetch("https://scraper-production-9c05.up.railway.app/auth")).ok)throw new Error("Error de autenticación");return!0}catch(t){return console.error("Authentication error:",t),!1}}async function Jp(t){try{if(!(t!=null&&t.trim()))throw new Error("Código de artículo inválido");const e=await fetch(`https://scraper-production-9c05.up.railway.app/stock/${t}`,{headers:{Accept:"application/json"}});if(!e.ok){let a="Error desconocido";try{const i=e.headers.get("content-type");i!=null&&i.includes("application/json")?a=(await e.json()).error||"Error desconocido":a=await e.text()||e.statusText||"Error desconocido"}catch(i){console.error("Error parsing error response:",i),a=e.statusText||"Error de comunicación con el servidor"}switch(e.status){case 404:throw new Error(`No se encontró el artículo ${t}`);case 500:throw new Error("El servidor no está disponible en este momento. Por favor, intente más tarde");case 502:case 503:case 504:throw new Error("Servicio temporalmente no disponible. Por favor, intente más tarde");case 401:case 403:throw new Error("Sesión expirada. Por favor, autentíquese nuevamente");default:throw new Error(`Error al consultar el stock: ${a}`)}}let r;try{r=await e.json()}catch(a){throw console.error("Error parsing success response:",a),new Error("Error al procesar la respuesta del servidor")}if(!r||typeof r!="object")throw new Error("Respuesta inválida del servidor");if(!("stock"in r))throw new Error("La respuesta no contiene información de stock");const n=Number(r.stock);if(isNaN(n))throw new Error("El valor de stock no es un número válido");return n}catch(e){const r={articleCode:t,error:e instanceof Error?e.message:"Error desconocido",timestamp:new Date().toISOString(),type:e instanceof Error?e.name:"UnknownError",details:e||"No additional error details available",stack:e instanceof Error?e.stack:void 0};throw console.error("Error checking stock:",r),e instanceof Error?e:new Error("Error inesperado al consultar el stock")}}function Zp({productId:t,sku:e,onStockAdjustment:r,isEnabled:n}){const[a,i]=y.useState(!1),[o,c]=y.useState(null),[l,d]=y.useState(""),[u,m]=y.useState(!1),b=async()=>{if(!e){A.error("Este producto no tiene SKU definido");return}if(!n){A.error("Debe autenticarse primero");return}i(!0);const f=A.loading("Consultando stock en Zureo...");try{const h=await Jp(e);if(A.dismiss(f),h===null){A.error("No se pudo obtener el stock del artículo");return}c(h),m(!0),A.success(`Stock consultado: ${h}`)}catch(h){A.dismiss(f);let g="Error al consultar stock en Zureo";h instanceof Error&&(h.message.includes("Sesión expirada")?g="Sesión expirada. Por favor, autentíquese nuevamente":h.message.includes("servidor no está disponible")||h.message.includes("temporalmente no disponible")?g="El servicio no está disponible. Por favor, intente más tarde":h.message.includes("No se encontró")?g=`No se encontró el artículo ${e}`:h.message.includes("Error al procesar")?g="Error de comunicación con el servidor":g=h.message),A.error(g),console.error("Error checking stock:",{sku:e,error:h instanceof Error?h.message:"Unknown error",timestamp:new Date().toISOString()})}finally{i(!1)}},x=async()=>{try{const f=parseInt(l);if(isNaN(f)){A.error("Ingrese un valor válido");return}await r(f),A.success("Ajuste de stock registrado exitosamente"),c(null),d(""),m(!1)}catch(f){A.error("Error al registrar el ajuste"),console.error("Error updating stock:",f)}},p=()=>{c(null),d(""),m(!1)};return s.jsxs("div",{className:"space-y-3",children:[u&&s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[s.jsx("div",{className:"text-sm text-blue-700 font-medium",children:"Stock en Zureo:"}),s.jsx("div",{className:"text-lg font-bold text-blue-800",children:o})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[s.jsx(se,{type:"number",value:l,onChange:f=>d(f.target.value),placeholder:"Ingrese el ajuste (+/-)",className:"text-center flex-1"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(E,{variant:"ghost",size:"sm",onClick:x,className:"flex-1 sm:flex-none text-green-600 hover:text-green-700 hover:bg-green-50",title:"Confirmar",children:[s.jsx(er,{className:"w-5 h-5"}),s.jsx("span",{className:"sm:hidden ml-2",children:"Confirmar"})]}),s.jsxs(E,{variant:"ghost",size:"sm",onClick:p,className:"flex-1 sm:flex-none text-red-600 hover:text-red-700 hover:bg-red-50",title:"Cancelar",children:[s.jsx(Ve,{className:"w-5 h-5"}),s.jsx("span",{className:"sm:hidden ml-2",children:"Cancelar"})]})]})]})]}),s.jsxs(E,{variant:"outline",onClick:b,disabled:a||!e||!n,className:"w-full",title:n?"":"Debe autenticarse primero",children:[s.jsx(Dn,{className:`w-4 h-4 mr-2 ${a?"animate-spin":""}`}),"Controlar Stock"]})]})}function ex({data:t,maxDate:e,onClose:r}){const n=()=>{window.print()},a=e?t.filter(o=>o.stockAdjustments.some(c=>c.date>=e.getTime())):t,i=a.reduce((o,c)=>{const l=c.stockAdjustments.filter(p=>p.quantity>0&&(!e||p.date>=e.getTime())),d=c.stockAdjustments.filter(p=>p.quantity<0&&(!e||p.date>=e.getTime())),u=l.reduce((p,f)=>p+f.quantity,0),m=Math.abs(d.reduce((p,f)=>p+f.quantity,0)),b=u*c.unitCost,x=m*c.unitCost;return{surplusQuantity:o.surplusQuantity+u,shortageQuantity:o.shortageQuantity+m,surplusValue:o.surplusValue+b,shortageValue:o.shortageValue+x}},{surplusQuantity:0,shortageQuantity:0,surplusValue:0,shortageValue:0});return s.jsxs("div",{className:"bg-white rounded-lg border shadow-lg",children:[s.jsxs("div",{className:"sticky top-0 bg-white border-b p-4 flex items-center justify-between print:hidden",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Reporte de Ajustes de Stock"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(E,{onClick:n,children:"Imprimir"}),s.jsx(E,{variant:"outline",onClick:r,children:"Cerrar"})]})]}),s.jsxs("div",{className:"hidden print:block text-center mb-6 p-4",children:[s.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Reporte de Ajustes de Stock"}),s.jsx("p",{className:"text-gray-600",children:fe(new Date,"d 'de' MMMM, yyyy",{locale:ye})}),e&&s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Ajustes desde: ",fe(e,"d 'de' MMMM, yyyy",{locale:ye})]})]}),s.jsx("div",{className:"p-4 bg-gray-50 border-b",children:s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[s.jsx("h3",{className:"text-sm font-medium text-green-800 mb-3",children:"Total Sobrantes"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-green-600",children:"Cantidad"}),s.jsx("div",{className:"text-lg font-bold text-green-700",children:i.surplusQuantity})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-green-600",children:"Valor"}),s.jsx("div",{className:"text-lg font-bold text-green-700",children:Q(i.surplusValue)})]})]})]}),s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800 mb-3",children:"Total Faltantes"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-red-600",children:"Cantidad"}),s.jsx("div",{className:"text-lg font-bold text-red-700",children:i.shortageQuantity})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-red-600",children:"Valor"}),s.jsx("div",{className:"text-lg font-bold text-red-700",children:Q(i.shortageValue)})]})]})]})]})}),s.jsx("div",{className:"p-4",children:a.length>0?s.jsx("div",{className:"space-y-6",children:a.map(o=>{const c=o.stockAdjustments.filter(x=>x.quantity>0&&(!e||x.date>=e.getTime())),l=o.stockAdjustments.filter(x=>x.quantity<0&&(!e||x.date>=e.getTime())),d=c.reduce((x,p)=>x+p.quantity,0),u=Math.abs(l.reduce((x,p)=>x+p.quantity,0)),m=d*o.unitCost,b=u*o.unitCost;return s.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[s.jsx("div",{className:"bg-gray-50 p-4 border-b",children:s.jsx("div",{className:"flex items-center justify-between gap-4",children:s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("h3",{className:"font-medium text-gray-900",children:["SKU: ",o.sku]}),typeof o.processed<"u"&&s.jsx("span",{className:`
                              inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium
                              ${o.processed?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}
                            `,children:o.processed?s.jsxs(s.Fragment,{children:[s.jsx(Un,{className:"w-3 h-3"}),"Procesado"]}):s.jsxs(s.Fragment,{children:[s.jsx(Ai,{className:"w-3 h-3"}),"Pendiente"]})})]}),o.names.map((x,p)=>s.jsx("p",{className:o.names.length>1?"text-sm text-gray-600":"",children:x},p))]})})}),s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"Fecha"}),s.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-500",children:"Ajuste"}),s.jsx("th",{className:"px-4 py-2 text-right text-sm font-medium text-gray-500",children:"Valor"}),s.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"Notas"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-100",children:o.stockAdjustments.filter(x=>!e||x.date>=e.getTime()).sort((x,p)=>p.date-x.date).map((x,p)=>{const f=Math.abs(x.quantity*o.unitCost);return s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-4 py-2 text-sm text-gray-600",children:fe(x.date,"d/MM/yyyy HH:mm",{locale:ye})}),s.jsx("td",{className:"px-4 py-2",children:s.jsxs("div",{className:"flex items-center justify-end gap-1",children:[x.quantity>0?s.jsx(Wt,{className:"w-4 h-4 text-green-500"}):s.jsx(zn,{className:"w-4 h-4 text-red-500"}),s.jsxs("span",{className:`text-sm font-medium ${x.quantity>0?"text-green-600":"text-red-600"}`,children:[x.quantity>0?"+":"",x.quantity," ",o.packaging]})]})}),s.jsx("td",{className:"px-4 py-2 text-right",children:s.jsx("span",{className:`text-sm font-medium ${x.quantity>0?"text-green-600":"text-red-600"}`,children:Q(f)})}),s.jsx("td",{className:"px-4 py-2 text-sm text-gray-600",children:x.notes||"-"})]},`${o.sku}-${p}`)})})]}),s.jsx("div",{className:"bg-gray-50 p-4 border-t",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"text-gray-600",children:"Total Sobrantes:"}),s.jsxs("span",{className:"font-medium text-green-600",children:[d," ",o.packaging]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Valor:"}),s.jsx("span",{className:"font-medium text-green-600",children:Q(m)})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"text-gray-600",children:"Total Faltantes:"}),s.jsxs("span",{className:"font-medium text-red-600",children:[u," ",o.packaging]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Valor:"}),s.jsx("span",{className:"font-medium text-red-600",children:Q(b)})]})]})]})})]},o.sku)})}):s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay ajustes de stock en el período seleccionado"})})]})}function tx(){const{products:t,loading:e,updateProduct:r}=Ut(),[n,a]=y.useState(""),[i,o]=y.useState(!1),[c,l]=y.useState(!1),[d,u]=y.useState(!1),[m,b]=y.useState(new Date),x=async()=>{l(!0);try{const g=await Xp();o(g),g?A.success("Autenticación exitosa"):A.error("Error de autenticación")}catch(g){console.error("Authentication error:",g),A.error("Error de autenticación"),o(!1)}finally{l(!1)}},p=y.useMemo(()=>{const w=t.filter(v=>{var _;return(_=v.sku)==null?void 0:_.trim()}).reduce((v,_)=>{const P=_.sku.trim().toUpperCase();return v[P]||(v[P]={sku:P,products:[],stockAdjustments:_.stockAdjustments||[],lastStockCheck:_.lastStockCheck||null,unitCost:_.pricePerUnit||_.price||0}),v[P].products.push(_),_.lastStockCheck&&(!v[P].lastStockCheck||_.lastStockCheck>v[P].lastStockCheck)&&(v[P].stockAdjustments=_.stockAdjustments||[],v[P].lastStockCheck=_.lastStockCheck),v},{});return Object.values(w).filter(v=>!n||v.sku.toLowerCase().includes(n.toLowerCase())||v.products.some(_=>{var P;return _.name.toLowerCase().includes(n.toLowerCase())||((P=_.tags)==null?void 0:P.some(S=>S.toLowerCase().includes(n.toLowerCase())))})).sort((v,_)=>!v.lastStockCheck&&!_.lastStockCheck?0:v.lastStockCheck?_.lastStockCheck?_.lastStockCheck-v.lastStockCheck:-1:1)},[t,n]),f=async(g,w)=>{var v;try{const _=((v=p.find(P=>P.sku===g))==null?void 0:v.products.map(P=>r(P.id,{stockAdjustments:[...P.stockAdjustments||[],{date:Date.now(),quantity:w}],lastStockCheck:Date.now()})))||[];await Promise.all(_)}catch(_){throw console.error("Error updating stock:",_),_}},h=p.map(g=>({sku:g.sku,names:g.products.map(w=>w.name),stockAdjustments:g.stockAdjustments||[],packaging:g.products[0].salePackaging||g.products[0].purchasePackaging,unitCost:g.unitCost}));return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex flex-col gap-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Control de Inventario"}),s.jsxs("div",{className:"grid grid-cols-2 sm:flex gap-2 w-full sm:w-auto",children:[s.jsxs(E,{onClick:()=>u(!0),variant:"outline",className:"w-full sm:w-auto gap-2",children:[s.jsx(Kt,{className:"w-4 h-4"}),s.jsx("span",{className:"whitespace-nowrap",children:"Ver Reporte"})]}),s.jsxs(E,{onClick:x,isLoading:c,variant:i?"outline":"default",className:"w-full sm:w-auto gap-2",children:[s.jsx(Nl,{className:"w-4 h-4"}),s.jsx("span",{className:"whitespace-nowrap",children:i?"Autenticado":"Autenticar"})]})]})]})}),!d&&s.jsxs("div",{className:"relative",children:[s.jsx(se,{placeholder:"Buscar productos...",value:n,onChange:g=>a(g.target.value),className:"pl-10"}),s.jsx(Ft,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]}),d?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:s.jsxs("div",{className:"w-full sm:max-w-xs",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mostrar ajustes desde:"}),s.jsx("input",{type:"date",value:m?m.toISOString().split("T")[0]:"",onChange:g=>b(g.target.value?new Date(g.target.value):null),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})}),s.jsx(ex,{data:h,maxDate:m,onClose:()=>u(!1)})]}):e?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:p.map(g=>{var _,P;const w=g.lastStockCheck?Math.floor((Date.now()-g.lastStockCheck)/864e5):null,v=((_=g.stockAdjustments)==null?void 0:_.reduce((S,ee)=>S+ee.quantity,0))||0;return s.jsxs("div",{className:`bg-white p-4 rounded-lg border shadow-sm space-y-4 ${g.lastStockCheck?w&&w>30?"border-yellow-200 bg-yellow-50":"":"border-amber-300 bg-amber-50"}`,children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("h3",{className:"font-medium text-gray-900",children:["SKU: ",g.sku]}),s.jsxs("span",{className:"text-sm text-gray-500",children:[g.products.length," ",g.products.length===1?"producto":"productos"]})]}),s.jsx("div",{className:"space-y-1 mb-2",children:g.products.map(S=>s.jsx("p",{className:`text-sm ${g.products.length>1?"text-xs leading-tight":"text-base"} text-gray-600`,children:S.name},S.id))}),((P=g.products[0].tags)==null?void 0:P.length)>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:g.products[0].tags.map(S=>s.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:S},S))})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Último Ajuste:"}),s.jsxs("p",{className:"font-medium text-gray-900",children:[v>0?s.jsxs("span",{className:"text-green-600",children:["+",v]}):v<0?s.jsx("span",{className:"text-red-600",children:v}):s.jsx("span",{children:"0"})," ",g.products[0].salePackaging||g.products[0].purchasePackaging]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"Último Control:"}),s.jsx("p",{className:`font-medium ${g.lastStockCheck?w&&w>30?"text-yellow-700":"text-gray-900":"text-amber-700"}`,children:g.lastStockCheck?s.jsxs(s.Fragment,{children:[new Date(g.lastStockCheck).toLocaleDateString(),s.jsxs("span",{className:"block text-xs text-gray-500",children:["Hace ",w," días"]})]}):"Nunca"})]})]}),s.jsx("div",{className:"pt-2 border-t",children:s.jsx(Zp,{productId:g.products[0].id,sku:g.sku,onStockAdjustment:S=>f(g.sku,S),isEnabled:i})})]},g.sku)})})]})}function rx(){return s.jsx(Pl,{children:s.jsxs(zl,{children:[s.jsx(_l,{position:"top-right"}),s.jsxs(kl,{children:[s.jsx(ut,{path:"/login",element:s.jsx(ph,{})}),s.jsx(ut,{element:s.jsx(ql,{}),children:s.jsxs(ut,{element:s.jsx(gh,{}),children:[s.jsx(ut,{path:"/",element:s.jsx(zg,{})}),s.jsx(ut,{path:"/providers",element:s.jsx(Wg,{})}),s.jsx(ut,{path:"/products",element:s.jsx(ap,{})}),s.jsx(ut,{path:"/recipes",element:s.jsx(pp,{})}),s.jsx(ut,{path:"/orders",element:s.jsx(Hp,{})}),s.jsx(ut,{path:"/schedule",element:s.jsx(Qp,{})}),s.jsx(ut,{path:"/inventory",element:s.jsx(tx,{})})]})})]})]})})}Vi(document.getElementById("root")).render(s.jsx(y.StrictMode,{children:s.jsx(rx,{})}));
//# sourceMappingURL=index-IyCBDp8w.js.map
